import{r as e,a as t,R as n}from"./vendor-react-DtX1tuCI.js";import{s,r}from"./vendor-capacitor-Hq9DW67G.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i={exports:{}},o={},a=e,l=Symbol.for("react.element"),c=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,u=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function m(e,t,n){var s,r={},i=null,o=null;for(s in void 0!==n&&(i=""+n),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(o=t.ref),t)d.call(t,s)&&!p.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===r[s]&&(r[s]=t[s]);return{$$typeof:l,type:e,key:i,ref:o,props:r,_owner:u.current}}o.Fragment=c,o.jsx=m,o.jsxs=m,i.exports=o;var h,g=i.exports,f=t;h=f.createRoot,f.hydrateRoot;var x=(e=>(e.GOOD="Good",e.BAD="Bad",e.ATTENTION="Needs Attention",e.NIL="Nil",e))(x||{});const b={truckNo:"",trailerNo:"",inspectedBy:"",driverName:"",location:"",odometer:"",jobCard:"",timestamp:"",rate:0,remarks:"",inspectorSignature:"",driverSignature:"",photoFront:"",photoLS:"",photoRS:"",photoBack:"",photoDamage:""},v=[{id:"details",title:"Details",label:"Details"},{id:"photos",title:"Photos",label:"Photos"},{id:"checklist_1",title:"Checklist 1",label:"Part 1"},{id:"checklist_2",title:"Checklist 2",label:"Part 2"},{id:"checklist_3",title:"Checklist 3",label:"Part 3"},{id:"signatures",title:"Signatures",label:"Signatures"},{id:"summary",title:"Summary",label:"Summary"}],y="PPE & Safety Gear",w="Documentation & Legal",N="Vehicle Exterior & Cab",j="Lights & Electrical",S="Mechanical & Safety Equipment",E="Trailer Specifics",C=[{id:"reflectiveWorkSuit",label:"Reflective Work Suit",category:y},{id:"safetyGear",label:"Safety Goggles, Boots, Gloves, Hard Hat",category:y},{id:"dustMask",label:"Dust Mask (Task Application)",category:y},{id:"roadFitness",label:"Valid Road Fitness / Road Tax / Insurance",category:w},{id:"validDriverDocs",label:"Valid Driver’s License, DDT Certificate, Driver ID",category:w},{id:"driverManual",label:"Driver Manual",category:w},{id:"routeRisk",label:"Route Risk Assessment",category:w},{id:"windscreen",label:"Windscreen Condition",category:N},{id:"mirrors",label:"Mirrors Condition",category:N},{id:"chevrons",label:"Chevrons, Plate/Reflective Tape",category:N},{id:"generalCondition",label:"General Condition (Interior Cab, Body: Signs of Tear & Wear, Dents)",category:N},{id:"seatBelt",label:"Three-Point Retractable Seat Belt",category:N},{id:"headLamps",label:"Head Lamps Condition",category:j},{id:"indicators",label:"Indicators Condition",category:j},{id:"parkingLights",label:"Parking Lights Condition",category:j},{id:"reverseAlarm",label:"Reverse Alarm, Reverse Lights Condition",category:j},{id:"hornIgnition",label:"Horn, Ignition & Electrical (Doors/Windows)",category:j},{id:"brakes",label:"Brakes, Brake Lights, Trailer Lights, Brake Air Pipes",category:S},{id:"tyres",label:"Tyres Condition (Not Worn Out, Pressure, Spare)",category:S},{id:"wheelNuts",label:"Wheel Nuts, Wheel Pointers",category:S},{id:"fluidLeaks",label:"No Leaks of Lubricants/Fluids (Oil, Coolant, etc.)",category:S},{id:"fireExtinguisher",label:"Recommended Fire Extinguisher (9Kg & 2.5Kg)",category:S},{id:"warningTriangles",label:"Warning Triangles, Two Approved Wheel Chocks",category:S},{id:"firstAid",label:"First Aid Kit",category:S},{id:"trailerCondition",label:"Trailer Condition",category:E},{id:"fifthWheel",label:"Fifth Wheel Condition",category:E},{id:"landingLegs",label:"Position and Condition of Landing Legs",category:E},{id:"tarpaulins",label:"Tarpaulins, Ropes, Belts or Straps",category:E}],_="Truck/Tractor and Equipment",k="Tyres and Horses",I="Drivers Protective Gear & ID",A="Documents",T="On Board Equipment",O=[{id:"petro_1",label:"1. OBC functionality: live",category:_},{id:"petro_2",label:"2. Large exterior mirror for all around vision (incl. parabolic on passenger side)",category:_},{id:"petro_3",label:"3. Single pane laminated windshields (no cracks)",category:_},{id:"petro_4",label:"4. Ergonomically designed seats and head restraints",category:_},{id:"petro_5",label:"5. 3 point seat belts on both seats",category:_},{id:"petro_6",label:"6. Brake Testing required",category:_},{id:"petro_7",label:"7. Functioning, master battery switch & engine cut – off switch on side of cab",category:_},{id:"petro_8",label:"8. Stop Tail, Backing and Turn lights",category:_},{id:"petro_9",label:"9. Cab mounted grab handle for ease of entry exit",category:_},{id:"petro_10",label:"10. Jack, Mats, Wheel Spanner",category:_},{id:"petro_11",label:"11. Cabin Jack",category:_},{id:"petro_12",label:"12. P. window switches",category:_},{id:"petro_13",label:"13. Condition of the fifth wheel (Lock/Lubricants)",category:_},{id:"petro_14",label:"14. Each component outlets (faucet) numbered and marked with fill capacity",category:_},{id:"petro_15",label:"15. 2 bronze grounding bolts compatible with loading rack (permissive) system",category:_},{id:"petro_16",label:"16. Anti – slip walkway along the whole length of the tank",category:_},{id:"petro_17",label:"17. Tank hatch and roll – over protection (coatings)",category:_},{id:"petro_18",label:"18. Double latching lockable man lids, installed with hinges facing forward",category:_},{id:"petro_19",label:"19. Trailer fitted with fall protection harness of handrails",category:_},{id:"petro_20",label:"20. Ullage marks in correct places & sealed, also Doom Cover",category:_},{id:"petro_21",label:"21. Presence of emergency/foot valves",category:_},{id:"petro_22",label:"22. Emergence valves for all components",category:_},{id:"petro_23",label:"23. Condition of landing legs",category:_},{id:"petro_24",label:"24. Minimum tread depth set at the center for all wheel (incl. Spare tyre)",category:k},{id:"petro_25",label:"25. Wheel nut indicators",category:k},{id:"petro_26",label:"26. Mudguards for all wheels",category:k},{id:"petro_27",label:"27. Choke blocks",category:k},{id:"petro_28",label:"28. Hoses damaged/fittings? Continuity Test done?",category:k},{id:"petro_29",label:"29. Delivery hose(s) for gravity drops",category:k},{id:"petro_30",label:"30. Truck/trailer loaded within legal limits (axle weight)?",category:k},{id:"petro_31",label:"31. Signs of lubrication loss on wheel",category:k},{id:"petro_32",label:"32. Anti-static clothes/Work suite?",category:I},{id:"petro_33",label:"33. Gloves for hydrocarbon handing Present?",category:I},{id:"petro_34",label:"34. Safety shoes - hydrocarbon proof Present?",category:I},{id:"petro_35",label:"35. Hard hat Present?",category:I},{id:"petro_36",label:"36. Driver’s ID Present?",category:I},{id:"petro_37",label:"37. Road worthiness approval by authorities",category:A},{id:"petro_38",label:"38. Valid driver’s DDT certificate",category:A},{id:"petro_39",label:"39. Valid driver’s License",category:A},{id:"petro_40",label:"40. Electric certificate",category:A},{id:"petro_41",label:"41. Drivers Manual",category:A},{id:"petro_42",label:"42. Route Risk Assessment",category:A},{id:"petro_43",label:"43. ZCSA certificate",category:A},{id:"petro_44",label:"44. Assize Certificate",category:A},{id:"petro_45",label:"45. TREM Card",category:A},{id:"petro_46",label:"46. Fire extinguisher (2kg dry chemical) fixed & valid X 1",category:T},{id:"petro_47",label:"47. Fire extinguisher (9kg dry chemical) within inspection X 2",category:T},{id:"petro_48",label:"48. Barricading tape",category:T},{id:"petro_49",label:"49. Charge Line",category:T},{id:"petro_50",label:"50. Torch",category:T},{id:"petro_51",label:"51. Spill Kit",category:T},{id:"petro_52",label:"52. First aid kit 4 warning triangles and 3 cones",category:T},{id:"petro_53",label:"53. On Board camera",category:T},{id:"petro_54",label:"54. Safe Loading Pass/ Safe to operate/ Tech inspection",category:T}],R="A. Personal Protective Equipment",P="B. Vehicle (Horse & Trailer)",L="C. Spill Kit",M="D. Documentation",D=[{id:"acid_1",label:"1. Reflective Work Suit (Acid Proof), Gumboots Safety Goggles",category:R},{id:"acid_2",label:"2. Hard Hat, PVC Gloves, Respirator (Double side), Face shield",category:R},{id:"acid_3",label:"3. Valid road fitness/road tax/Insurance/permit",category:P},{id:"acid_4",label:"4. Wind screen condition",category:P},{id:"acid_5",label:"5. Mirrors in good condition",category:P},{id:"acid_6",label:"6. Three-point retractable seat belt",category:P},{id:"acid_7",label:"7. Horn working, ignition switch, electrical (doors/windows)",category:P},{id:"acid_8",label:"8. Valid Fire extinguisher (9kg=2, 2kg=1)",category:P},{id:"acid_9",label:"9. Warning triangles, Cones, two approved wheel chokes",category:P},{id:"acid_10",label:"10. Headlamps working",category:P},{id:"acid_11",label:"11. Amber beacon",category:P},{id:"acid_12",label:"12. Brake lights, trailer lights, indicators working",category:P},{id:"acid_13",label:"13. Brakes, air pipes, air bags OK",category:P},{id:"acid_14",label:"14. Tyres not worn – out, visual Tyre Pressure, Spare wheel",category:P},{id:"acid_15",label:"15. Wheel nuts, wheel pointers, bolts, Flanges OK",category:P},{id:"acid_16",label:"16. Revers alarm, reverse lights working",category:P},{id:"acid_17",label:"17. Chevrons plate/reflective tape",category:P},{id:"acid_18",label:"18. Hazchem diamond symbols correct & display on both 2 sides",category:P},{id:"acid_19",label:"19. Anti-slip protection, Ladder, Hand rails",category:P},{id:"acid_20",label:"20. Over spill hose connected to containment container",category:P},{id:"acid_21",label:"21. Hatch, Valves, Vents",category:P},{id:"acid_22",label:"22. No leaks of chemicals/lubricants (oil, coolants, acid etc.)",category:P},{id:"acid_23",label:"23. General condition (interior cab, body: signs of Corrosion, Cracks, leaks)",category:P},{id:"acid_25",label:"25. Lime box filled with lime",category:L},{id:"acid_26",label:"26. First Aid Kit, Diphotrine",category:L},{id:"acid_27",label:"27. Pick and Shovel",category:L},{id:"acid_28",label:"28. Barricading tape",category:L},{id:"acid_29",label:"29. Water (20 liters container)",category:L},{id:"acid_30",label:"30. Pressure/Thickness Test Certificate",category:M},{id:"acid_31",label:"31. Electric System Certificate",category:M},{id:"acid_32",label:"32. Tank Cleanliness Certificate",category:M},{id:"acid_33",label:"33. Driver Manual, Route Risk Assessment/Journey plan",category:M},{id:"acid_34",label:"34. Valid Driver licence, DDT certificate, ID",category:M}],U="Prime Mover",q="Trailer/Tanks",G="Driver",H="Safety & Warning Signs",B="Licence & Mandatory Documents",V=[{id:"petro2_1",label:"1. General: Appearance, Paint, Leaks, Charge line",category:U},{id:"petro2_2",label:"2. Visibility: Windscreen, Windows, Wipers, Mirrors",category:U},{id:"petro2_3",label:"3. Lighting: Headlights, Beacon, Turning, Stop, Reverse Lights",category:U},{id:"petro2_4",label:"4. Provision for Orange Diamond",category:U},{id:"petro2_5",label:"5. Seat Belt: 3-point Contact, Retractable",category:U},{id:"petro2_6",label:"6. IVMS /Speed limiting device: installed, working",category:U},{id:"petro2_7",label:"7. Document Holder/Box : Position, Colour, Labeled",category:U},{id:"petro2_8",label:"8. Tools: Jack, Wheel Spanner, Cabin, Triangles (4), Cones (3)",category:U},{id:"petro2_9",label:"9. Equipment: Spill Kit, First Aid Kit, Barricading Tape, Fire Extinguisher (Cabin, Trailer x2)",category:U},{id:"petro2_10",label:"10. Electrical: Battery Master Switch, Battery Box, Terminals, Wiring",category:U},{id:"petro2_11",label:"11. Tyres: No Retread, Combination, Spray Suppression, Wheels",category:U},{id:"petro2_12",label:"12. Brake System: ABS, Wheel Pointers, Brake Testing Required?",category:U},{id:"petro2_13",label:"13. Shielding of Engine, Rear Window Non-opening",category:U},{id:"petro2_14",label:"14. Exhaust: Discharge on Right Side, Tank outlet 100mm Clearance",category:U},{id:"petro2_15",label:"15. Condition of the Fifth Wheel (Lock/Lubrication)",category:U},{id:"petro2_16",label:"16. Compartment Capacities: labeled, < 7000L per compartment",category:q},{id:"petro2_17",label:"17. Under Run Protection: Sides, Rear End",category:q},{id:"petro2_18",label:"18. Overturn Damage Protection",category:q},{id:"petro2_19",label:"19. Valves: Discharge, Actuator, Dust Cups, Colour Coding",category:q},{id:"petro2_20",label:"20. Emergency Shut Off: Main, Side(s)/ Brake Interlock System",category:q},{id:"petro2_21",label:"21. Electrical Bonding: Cable, Bronze Earthing Studs",category:q},{id:"petro2_22",label:"22. Spill Tray, Hose Storage Rack, Fire Extinguisher Holders",category:q},{id:"petro2_23",label:"23. Tyres: Tread Depth, Spare Tyre, Non-retread, Combination",category:q},{id:"petro2_24",label:"24. Mudguards for all Wheels, Spray Suppressors",category:q},{id:"petro2_25",label:"25. Landing Legs",category:q},{id:"petro2_26",label:"26. Reversing Alarm",category:q},{id:"petro2_27",label:"27. Delivery Hose(s): State, Continuity, Colour Coded, Dust Cups",category:q},{id:"petro2_28",label:"28. Lighting: Brakes, Reverse, Warning, Emergency Lighting",category:q},{id:"petro2_29",label:"29. Rear Bumper: > 300mm Beyond Tank",category:q},{id:"petro2_30",label:"30. Fall Protection: Access Ladder, Anti-slip Walkway, Handrail",category:q},{id:"petro2_31",label:"31. Manholes: Dia, Center, Secured, Standard (EN 13317)",category:q},{id:"petro2_32",label:"32. Fittings: Ullage Marks, Overfill Protection, Pressure Release",category:q},{id:"petro2_33",label:"33. Work Suit: Anti-static, Reflective",category:G},{id:"petro2_34",label:"34. Safety Gloves: For Hydrocarbon Handing",category:G},{id:"petro2_35",label:"35. Safety Boot: With Toe Cap, Oil Resistant",category:G},{id:"petro2_36",label:"36. Safety Helmet: 2- 4-Point Chin Strap",category:G},{id:"petro2_37",label:"37. Driver’s ID: Identity Card, Driver Blue Tag",category:G},{id:"petro2_38",label:"38. Hazchem: Both Sides, Rear",category:H},{id:"petro2_39",label:"39. No Smocking, Naked Flame, Cell Phone",category:H},{id:"petro2_40",label:"40. Orange Reflectors: Continuous",category:H},{id:"petro2_41",label:"41. Chevron, Red Reflectors at Rear",category:H},{id:"petro2_42",label:"42. Number Plate: ZABS Approved, Lighting",category:H},{id:"petro2_43",label:"43. Speed Limit Sign: 80 km/h",category:H},{id:"petro2_44",label:"44. Data Plate: Pressure Test",category:H},{id:"petro2_45",label:"45. Road Tax, Certificate of Fitness, Insurance, Identity",category:B},{id:"petro2_46",label:"46. Defensive Driver Training (DDT): Dangerous Goods Certificate",category:B},{id:"petro2_47",label:"47. Driver’s License: Validity of Dangerous Goods, CE",category:B},{id:"petro2_48",label:"48. Electric Certificate",category:B},{id:"petro2_49",label:"49. Drivers Manual",category:B},{id:"petro2_50",label:"50. Route Risk Assessment Guide",category:B},{id:"petro2_51",label:"51. ZCSA Certificate",category:B},{id:"petro2_52",label:"52. Assize Certificate",category:B},{id:"petro2_53",label:"53. TREM Card",category:B}],F=["id","timestamp","truckNo","trailerNo","inspectedBy","driverName","location","odometer","rate","remarks","inspectorSignature","driverSignature","photoFront","photoLS","photoRS","photoBack","photoDamage","jobCard"],W=[...F,...C.map(e=>e.id)],J=[...F,...O.map(e=>e.id)],$=[...F,...V.map(e=>e.id)],z=[...F,...D.map(e=>e.id)],Y={"1_Controller.gs":"\nfunction doPost(e) {\n  const lock = LockService.getScriptLock();\n  lock.tryLock(30000); \n  try {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const body = e.postData ? JSON.parse(e.postData.contents) : {};\n    return routeRequest(ss, body);\n  } catch (err) {\n    return ResponseBuilder.error(err.toString());\n  } finally {\n    lock.releaseLock();\n  }\n}\n\nfunction doGet(e) {\n  const ss = SpreadsheetApp.getActiveSpreadsheet();\n  return DataHandlers.handleGetRequest(ss);\n}\n\nfunction routeRequest(ss, body) {\n  const action = body.action;\n  const routes = {\n    'login': () => AuthHandlers.handleLogin(ss, body),\n    'register_user': () => AuthHandlers.handleRegisterUser(ss, body),\n    'get_users': () => AuthHandlers.handleGetUsers(ss),\n    'delete_user': () => AuthHandlers.handleDeleteUser(ss, body),\n    'update_user': () => AuthHandlers.handleUpdateUser(ss, body),\n    'manage_fleet': () => SystemHandlers.handleManageFleet(ss, body),\n    'bulk_manage_fleet': () => SystemHandlers.handleBulkManageFleet(ss, body),\n    'update_settings': () => SystemHandlers.handleUpdateSettings(ss, body)\n  };\n  if (!action || action === 'create' || !routes[action]) return DataHandlers.handleDataSubmission(ss, body);\n  return routes[action]();\n}","2_Auth.gs":'\nconst AuthHandlers = {\n  handleLogin: function(ss, body) {\n    let userSheet = ss.getSheetByName(\'Users\');\n    if (!userSheet) return ResponseBuilder.error("No users found.");\n    const data = userSheet.getDataRange().getValues();\n    const username = body.username.toLowerCase();\n    for (let i = 1; i < data.length; i++) {\n        if (data[i][0].toLowerCase() === username && data[i][1] === body.password) {\n            return ResponseBuilder.success({ user: { username: data[i][0], name: data[i][2], role: data[i][3] } });\n        }\n    }\n    return ResponseBuilder.error("Invalid credentials.");\n  },\n  handleRegisterUser: function(ss, body) {\n    let sheet = ss.getSheetByName(\'Users\') || ss.insertSheet(\'Users\');\n    sheet.appendRow([body.username.toLowerCase(), body.password, body.name, body.role, body.position, new Date().toISOString(), "{}", "TRUE"]);\n    return ResponseBuilder.success();\n  },\n  handleGetUsers: function(ss) {\n    let sheet = ss.getSheetByName(\'Users\');\n    if (!sheet) return ResponseBuilder.success({ users: [] });\n    const data = sheet.getDataRange().getValues();\n    const users = data.slice(1).map(r => ({ username: r[0], name: r[2], role: r[3], position: r[4], isActive: r[7] === "TRUE" }));\n    return ResponseBuilder.success({ users });\n  },\n  handleDeleteUser: function(ss, body) {\n    let sheet = ss.getSheetByName(\'Users\');\n    const data = sheet.getDataRange().getValues();\n    for (let i = 1; i < data.length; i++) {\n      if (data[i][0].toLowerCase() === body.username.toLowerCase()) {\n        sheet.deleteRow(i + 1);\n        return ResponseBuilder.success();\n      }\n    }\n    return ResponseBuilder.error("User not found");\n  },\n  handleUpdateUser: function(ss, body) {\n    let sheet = ss.getSheetByName(\'Users\');\n    const data = sheet.getDataRange().getValues();\n    for (let i = 1; i < data.length; i++) {\n      if (data[i][0].toLowerCase() === (body.originalUsername || body.username).toLowerCase()) {\n        if (body.username) sheet.getRange(i + 1, 1).setValue(body.username);\n        if (body.password) sheet.getRange(i + 1, 2).setValue(body.password);\n        if (body.name) sheet.getRange(i + 1, 3).setValue(body.name);\n        if (body.role) sheet.getRange(i + 1, 4).setValue(body.role);\n        if (body.position) sheet.getRange(i + 1, 5).setValue(body.position);\n        if (body.isActive !== undefined) sheet.getRange(i + 1, 8).setValue(body.isActive ? "TRUE" : "FALSE");\n        if (body.preferences) sheet.getRange(i + 1, 7).setValue(JSON.stringify(body.preferences));\n        return ResponseBuilder.success();\n      }\n    }\n    return ResponseBuilder.error("User not found");\n  }\n};',"3_Core.gs":'\nconst DataHandlers = {\n  handleDataSubmission: function(ss, body) {\n    let sheet = ss.getSheetByName(body.sheet) || ss.insertSheet(body.sheet);\n    if (sheet.getLastRow() === 0 && body.headers) sheet.appendRow(body.headers);\n    sheet.appendRow(body.row);\n    return ResponseBuilder.success();\n  },\n  handleGetRequest: function(ss) {\n    const data = {};\n    ss.getSheets().forEach(sheet => {\n      const name = sheet.getName();\n      const lastRow = sheet.getLastRow();\n      if (lastRow === 0) { data[name] = []; return; }\n      if (name === \'Validation_Data\') {\n         const values = sheet.getDataRange().getValues();\n         const columns = {};\n         if (values.length > 0) {\n             const headers = values[0];\n             headers.forEach((h, idx) => {\n                 columns[h] = values.slice(1).map(r => r[idx]).filter(v => v !== "");\n             });\n         }\n         data[name] = columns;\n      } else {\n         data[name] = sheet.getDataRange().getValues();\n      }\n    });\n    return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);\n  }\n};\n\nconst SystemHandlers = {\n  handleManageFleet: function(ss, body) {\n    let sheet = ss.getSheetByName(\'Validation_Data\') || ss.insertSheet(\'Validation_Data\');\n    const lastRow = sheet.getLastRow();\n    if (lastRow === 0) {\n      sheet.appendRow(["Driver_Name","Inspector_Name","Location","Position","Misc1","Misc2","Misc3","Truck_Reg_No","Trailer_Reg_No"]);\n      sheet.setFrozenRows(1);\n    }\n    \n    const colIdx = body.type === \'truck\' ? 8 : 9; \n    const range = sheet.getRange(1, colIdx, Math.max(1, sheet.getLastRow()), 1);\n    const colValues = range.getValues().flat();\n    const firstEmpty = colValues.indexOf("");\n    const targetRow = firstEmpty === -1 ? sheet.getLastRow() + 1 : firstEmpty + 1;\n    \n    sheet.getRange(targetRow, colIdx).setValue(body.value);\n    return ResponseBuilder.success({ message: "Asset added" });\n  },\n\n  handleBulkManageFleet: function(ss, body) {\n    let sheet = ss.getSheetByName(\'Validation_Data\') || ss.insertSheet(\'Validation_Data\');\n    const lastRow = sheet.getLastRow();\n    if (lastRow === 0) {\n      sheet.appendRow(["Driver_Name","Inspector_Name","Location","Position","Misc1","Misc2","Misc3","Truck_Reg_No","Trailer_Reg_No"]);\n      sheet.setFrozenRows(1);\n    }\n    \n    const trucks = body.trucks || [];\n    const trailers = body.trailers || [];\n\n    const getFirstEmptyInCol = (col) => {\n        const vals = sheet.getRange(1, col, Math.max(1, sheet.getLastRow()), 1).getValues().flat();\n        const idx = vals.indexOf("");\n        return idx === -1 ? sheet.getLastRow() + 1 : idx + 1;\n    };\n\n    if (trucks.length > 0) {\n        const startRow = getFirstEmptyInCol(8);\n        sheet.getRange(startRow, 8, trucks.length, 1).setValues(trucks.map(t => [t]));\n    }\n    \n    if (trailers.length > 0) {\n        const startRow = getFirstEmptyInCol(9);\n        sheet.getRange(startRow, 9, trailers.length, 1).setValues(trailers.map(t => [t]));\n    }\n\n    return ResponseBuilder.success({ message: "Bulk import complete" });\n  },\n\n  handleUpdateSettings: function(ss, body) {\n    let sheet = ss.getSheetByName(\'System_Settings\') || ss.insertSheet(\'System_Settings\');\n    const row = [\n      body.companyName, \n      body.managerEmail, \n      new Date(), \n      "Admin", \n      body.companyLogo || "", \n      body.mobileApkLink || "", \n      body.webAppUrl || "", \n      body.maintenanceMode ? "TRUE" : "FALSE", \n      body.maintenanceMessage || ""\n    ];\n    if (sheet.getLastRow() < 2) sheet.appendRow(["A","B","C","D","E","F","G","H","I"]);\n    sheet.getRange(2, 1, 1, row.length).setValues([row]);\n    return ResponseBuilder.success();\n  }\n};',"5_Utils.gs":'const ResponseBuilder = {\n  success: function(data = {}) { return this.build({ status: "success", ...data }); },\n  error: function(message) { return this.build({ status: "error", message: message }); },\n  build: function(data) { return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON); }\n};'};Object.values(Y).join("\n\n");const K=432e5,X=()=>{const[t,n]=e.useState(null),[s,r]=e.useState(null),i=e.useRef(Date.now()),o=e.useRef(Date.now()),a=e.useRef(null);e.useEffect(()=>{const e=localStorage.getItem("safetyCheck_user"),t=localStorage.getItem("safetyCheck_session_start");if(e)try{if(t){if(Date.now()-parseInt(t)>K)return void u("max_duration");o.current=parseInt(t)}else localStorage.setItem("safetyCheck_session_start",Date.now().toString());const s=JSON.parse(e),r=s.role?String(s.role).trim().toLowerCase():"";s.role="admin"===r?"Admin":"operations"===r?"Operations":"maintenance"===r?"Maintenance":"secretary"===r?"Secretary":"other"===r?"Other":"superadmin"===r?"SuperAdmin":"Inspector",s.needsSetup=!s.name||!0===s.needsSetup,n(s),c()}catch(s){u()}},[]);const l=e.useCallback(()=>{if(!t)return;const e=Date.now();e-i.current>1e3&&(i.current=e,localStorage.setItem("safetyCheck_last_activity",e.toString()))},[t]),c=()=>{window.addEventListener("mousemove",l),window.addEventListener("keydown",l),window.addEventListener("touchstart",l),window.addEventListener("click",l),a.current&&window.clearInterval(a.current),a.current=window.setInterval(d,6e4)},d=()=>{const e=Date.now();e-i.current>18e5?u("idle"):e-o.current>K&&u("max_duration")},u=e=>{window.removeEventListener("mousemove",l),window.removeEventListener("keydown",l),window.removeEventListener("touchstart",l),window.removeEventListener("click",l),a.current&&(window.clearInterval(a.current),a.current=null),n(null),e&&r(e);["safetyCheck_user","safetyCheck_session_start","safetyCheck_last_activity","sc_validation_lists"].forEach(e=>localStorage.removeItem(e))};return{currentUser:t,setCurrentUser:n,handleLogin:e=>{const t=Date.now(),s={...e,needsSetup:!e.name||!0===e.needsSetup};n(s),localStorage.setItem("safetyCheck_user",JSON.stringify(s)),localStorage.setItem("safetyCheck_session_start",t.toString()),localStorage.setItem("safetyCheck_last_activity",t.toString()),o.current=t,i.current=t,r(null),c()},handleLogout:u,sessionExpired:s,setSessionExpired:r}};var Q={};
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Z,ee;function te(e,t,n,s){var r,i;if(!(null==e?void 0:e.baseUrl)){const e={geminiUrl:Z,vertexUrl:ee};return t?null!==(r=e.vertexUrl)&&void 0!==r?r:n:null!==(i=e.geminiUrl)&&void 0!==i?i:s}return e.baseUrl}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ne{}function se(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){const e=t[n];return null!=e?String(e):""}throw new Error(`Key '${n}' not found in valueMap.`)})}function re(e,t,n){for(let i=0;i<t.length-1;i++){const s=t[i];if(s.endsWith("[]")){const r=s.slice(0,-2);if(!(r in e)){if(!Array.isArray(n))throw new Error(`Value must be a list given an array path ${s}`);e[r]=Array.from({length:n.length},()=>({}))}if(Array.isArray(e[r])){const s=e[r];if(Array.isArray(n))for(let e=0;e<s.length;e++){re(s[e],t.slice(i+1),n[e])}else for(const e of s)re(e,t.slice(i+1),n)}return}if(s.endsWith("[0]")){const r=s.slice(0,-3);r in e||(e[r]=[{}]);return void re(e[r][0],t.slice(i+1),n)}e[s]&&"object"==typeof e[s]||(e[s]={}),e=e[s]}const s=t[t.length-1],r=e[s];if(void 0!==r){if(!n||"object"==typeof n&&0===Object.keys(n).length)return;if(n===r)return;if("object"!=typeof r||"object"!=typeof n||null===r||null===n)throw new Error(`Cannot set value for an existing key. Key: ${s}`);Object.assign(r,n)}else if("_self"!==s||"object"!=typeof n||null===n||Array.isArray(n))e[s]=n;else{const t=n;Object.assign(e,t)}}function ie(e,t,n=void 0){try{if(1===t.length&&"_self"===t[0])return e;for(let s=0;s<t.length;s++){if("object"!=typeof e||null===e)return n;const r=t[s];if(r.endsWith("[]")){const i=r.slice(0,-2);if(i in e){const r=e[i];return Array.isArray(r)?r.map(e=>ie(e,t.slice(s+1),n)):n}return n}e=e[r]}return e}catch(s){if(s instanceof TypeError)return n;throw s}}function oe(e,t,n,s,r){if(s>=t.length)return;if("object"!=typeof e||null===e)return;const i=t[s];if(i.endsWith("[]")){const o=i.slice(0,-2),a=e;if(o in a&&Array.isArray(a[o]))for(const e of a[o])oe(e,t,n,s+1,r)}else if("*"===i){if("object"==typeof e&&null!==e&&!Array.isArray(e)){const t=e,i=Object.keys(t).filter(e=>!e.startsWith("_")&&!r.has(e)),o={};for(const e of i)o[e]=t[e];for(const[e,r]of Object.entries(o)){const i=[];for(const t of n.slice(s))"*"===t?i.push(e):i.push(t);re(t,i,r)}for(const e of i)delete t[e]}}else{i in e&&oe(e[i],t,n,s+1,r)}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ae(e){if("string"!=typeof e)throw new Error("fromImageBytes must be a string");return e}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function le(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["name"],n);const s=ie(e,["metadata"]);null!=s&&re(t,["metadata"],s);const r=ie(e,["done"]);null!=r&&re(t,["done"],r);const i=ie(e,["error"]);null!=i&&re(t,["error"],i);const o=ie(e,["response","generateVideoResponse"]);return null!=o&&re(t,["response"],function(e){const t={},n=ie(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["video"]);null!=n&&re(t,["video"],function(e){const t={},n=ie(e,["uri"]);null!=n&&re(t,["uri"],n);const s=ie(e,["encodedVideo"]);null!=s&&re(t,["videoBytes"],ae(s));const r=ie(e,["encoding"]);null!=r&&re(t,["mimeType"],r);return t}(n));return t}(e))),re(t,["generatedVideos"],e)}const s=ie(e,["raiMediaFilteredCount"]);null!=s&&re(t,["raiMediaFilteredCount"],s);const r=ie(e,["raiMediaFilteredReasons"]);null!=r&&re(t,["raiMediaFilteredReasons"],r);return t}(o)),t}function ce(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["name"],n);const s=ie(e,["metadata"]);null!=s&&re(t,["metadata"],s);const r=ie(e,["done"]);null!=r&&re(t,["done"],r);const i=ie(e,["error"]);null!=i&&re(t,["error"],i);const o=ie(e,["response"]);return null!=o&&re(t,["response"],function(e){const t={},n=ie(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["_self"]);null!=n&&re(t,["video"],function(e){const t={},n=ie(e,["gcsUri"]);null!=n&&re(t,["uri"],n);const s=ie(e,["bytesBase64Encoded"]);null!=s&&re(t,["videoBytes"],ae(s));const r=ie(e,["mimeType"]);null!=r&&re(t,["mimeType"],r);return t}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(n));return t}(e))),re(t,["generatedVideos"],e)}const s=ie(e,["raiMediaFilteredCount"]);null!=s&&re(t,["raiMediaFilteredCount"],s);const r=ie(e,["raiMediaFilteredReasons"]);null!=r&&re(t,["raiMediaFilteredReasons"],r);return t}(o)),t}function de(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["name"],n);const s=ie(e,["metadata"]);null!=s&&re(t,["metadata"],s);const r=ie(e,["done"]);null!=r&&re(t,["done"],r);const i=ie(e,["error"]);null!=i&&re(t,["error"],i);const o=ie(e,["response"]);return null!=o&&re(t,["response"],function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["parent"]);null!=s&&re(t,["parent"],s);const r=ie(e,["documentName"]);null!=r&&re(t,["documentName"],r);return t}(o)),t}function ue(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["name"],n);const s=ie(e,["metadata"]);null!=s&&re(t,["metadata"],s);const r=ie(e,["done"]);null!=r&&re(t,["done"],r);const i=ie(e,["error"]);null!=i&&re(t,["error"],i);const o=ie(e,["response"]);return null!=o&&re(t,["response"],function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["parent"]);null!=s&&re(t,["parent"],s);const r=ie(e,["documentName"]);null!=r&&re(t,["documentName"],r);return t}(o)),t}var pe,me,he,ge,fe,xe,be,ve,ye,we,Ne,je,Se,Ee,Ce,_e,ke,Ie,Ae,Te,Oe,Re,Pe,Le,Me,De,Ue,qe,Ge,He,Be,Ve,Fe,We,Je,$e,ze,Ye,Ke,Xe,Qe,Ze,et,tt,nt,st,rt,it,ot,at,lt,ct,dt,ut,pt,mt,ht,gt,ft,xt,bt,vt,yt,wt,Nt,jt,St,Et,Ct,_t,kt,It,At,Tt,Ot,Rt,Pt,Lt,Mt,Dt,Ut,qt,Gt,Ht,Bt,Vt,Ft,Wt,Jt,$t,zt,Yt,Kt,Xt,Qt,Zt,en,tn,nn,sn,rn,on,an,ln,cn,dn,un,pn,mn,hn,gn,fn;(me=pe||(pe={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",me.OUTCOME_OK="OUTCOME_OK",me.OUTCOME_FAILED="OUTCOME_FAILED",me.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(ge=he||(he={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",ge.PYTHON="PYTHON",(xe=fe||(fe={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",xe.SILENT="SILENT",xe.WHEN_IDLE="WHEN_IDLE",xe.INTERRUPT="INTERRUPT",(ve=be||(be={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",ve.STRING="STRING",ve.NUMBER="NUMBER",ve.INTEGER="INTEGER",ve.BOOLEAN="BOOLEAN",ve.ARRAY="ARRAY",ve.OBJECT="OBJECT",ve.NULL="NULL",(we=ye||(ye={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",we.SIMPLE_SEARCH="SIMPLE_SEARCH",we.ELASTIC_SEARCH="ELASTIC_SEARCH",(je=Ne||(Ne={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",je.NO_AUTH="NO_AUTH",je.API_KEY_AUTH="API_KEY_AUTH",je.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",je.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",je.OAUTH="OAUTH",je.OIDC_AUTH="OIDC_AUTH",(Ee=Se||(Se={})).HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",Ee.HTTP_IN_QUERY="HTTP_IN_QUERY",Ee.HTTP_IN_HEADER="HTTP_IN_HEADER",Ee.HTTP_IN_PATH="HTTP_IN_PATH",Ee.HTTP_IN_BODY="HTTP_IN_BODY",Ee.HTTP_IN_COOKIE="HTTP_IN_COOKIE",(_e=Ce||(Ce={})).PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",_e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",_e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",_e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",_e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",_e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",_e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH",(Ie=ke||(ke={})).UNSPECIFIED="UNSPECIFIED",Ie.BLOCKING="BLOCKING",Ie.NON_BLOCKING="NON_BLOCKING",(Te=Ae||(Ae={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",Te.MODE_DYNAMIC="MODE_DYNAMIC",(Re=Oe||(Oe={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",Re.AUTO="AUTO",Re.ANY="ANY",Re.NONE="NONE",Re.VALIDATED="VALIDATED",(Le=Pe||(Pe={})).THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",Le.LOW="LOW",Le.MEDIUM="MEDIUM",Le.HIGH="HIGH",Le.MINIMAL="MINIMAL",(De=Me||(Me={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",De.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",De.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",De.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",De.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",De.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",De.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",De.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",De.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",De.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",De.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(qe=Ue||(Ue={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",qe.SEVERITY="SEVERITY",qe.PROBABILITY="PROBABILITY",(He=Ge||(Ge={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",He.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",He.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",He.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",He.BLOCK_NONE="BLOCK_NONE",He.OFF="OFF",(Ve=Be||(Be={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",Ve.STOP="STOP",Ve.MAX_TOKENS="MAX_TOKENS",Ve.SAFETY="SAFETY",Ve.RECITATION="RECITATION",Ve.LANGUAGE="LANGUAGE",Ve.OTHER="OTHER",Ve.BLOCKLIST="BLOCKLIST",Ve.PROHIBITED_CONTENT="PROHIBITED_CONTENT",Ve.SPII="SPII",Ve.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",Ve.IMAGE_SAFETY="IMAGE_SAFETY",Ve.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",Ve.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",Ve.NO_IMAGE="NO_IMAGE",Ve.IMAGE_RECITATION="IMAGE_RECITATION",Ve.IMAGE_OTHER="IMAGE_OTHER",(We=Fe||(Fe={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",We.NEGLIGIBLE="NEGLIGIBLE",We.LOW="LOW",We.MEDIUM="MEDIUM",We.HIGH="HIGH",($e=Je||(Je={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",$e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",$e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",$e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",$e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(Ye=ze||(ze={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",Ye.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",Ye.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",Ye.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",Ye.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(Xe=Ke||(Ke={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",Xe.SAFETY="SAFETY",Xe.OTHER="OTHER",Xe.BLOCKLIST="BLOCKLIST",Xe.PROHIBITED_CONTENT="PROHIBITED_CONTENT",Xe.IMAGE_SAFETY="IMAGE_SAFETY",Xe.MODEL_ARMOR="MODEL_ARMOR",Xe.JAILBREAK="JAILBREAK",(Ze=Qe||(Qe={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",Ze.ON_DEMAND="ON_DEMAND",Ze.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(tt=et||(et={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",tt.TEXT="TEXT",tt.IMAGE="IMAGE",tt.AUDIO="AUDIO",(st=nt||(nt={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",st.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",st.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",st.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(it=rt||(rt={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",it.TUNING_MODE_FULL="TUNING_MODE_FULL",it.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(at=ot||(ot={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",at.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",at.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",at.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",at.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",at.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",at.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(ct=lt||(lt={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",ct.JOB_STATE_QUEUED="JOB_STATE_QUEUED",ct.JOB_STATE_PENDING="JOB_STATE_PENDING",ct.JOB_STATE_RUNNING="JOB_STATE_RUNNING",ct.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",ct.JOB_STATE_FAILED="JOB_STATE_FAILED",ct.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",ct.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",ct.JOB_STATE_PAUSED="JOB_STATE_PAUSED",ct.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",ct.JOB_STATE_UPDATING="JOB_STATE_UPDATING",ct.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(ut=dt||(dt={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",ut.TUNING_TASK_I2V="TUNING_TASK_I2V",ut.TUNING_TASK_T2V="TUNING_TASK_T2V",ut.TUNING_TASK_R2V="TUNING_TASK_R2V",(mt=pt||(pt={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",mt.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",mt.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",mt.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",mt.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH",(gt=ht||(ht={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",gt.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",gt.BALANCED="BALANCED",gt.PRIORITIZE_COST="PRIORITIZE_COST",(xt=ft||(ft={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",xt.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",(vt=bt||(bt={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",vt.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",vt.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",vt.BLOCK_NONE="BLOCK_NONE",(wt=yt||(yt={})).DONT_ALLOW="DONT_ALLOW",wt.ALLOW_ADULT="ALLOW_ADULT",wt.ALLOW_ALL="ALLOW_ALL",(jt=Nt||(Nt={})).auto="auto",jt.en="en",jt.ja="ja",jt.ko="ko",jt.hi="hi",jt.zh="zh",jt.pt="pt",jt.es="es",(Et=St||(St={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",Et.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",Et.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",Et.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",Et.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",(_t=Ct||(Ct={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",_t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",_t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",_t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(It=kt||(kt={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",It.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",It.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",It.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",(Tt=At||(At={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",Tt.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",Tt.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",Tt.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",Tt.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",Tt.EDIT_MODE_STYLE="EDIT_MODE_STYLE",Tt.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",Tt.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(Rt=Ot||(Ot={})).FOREGROUND="FOREGROUND",Rt.BACKGROUND="BACKGROUND",Rt.PROMPT="PROMPT",Rt.SEMANTIC="SEMANTIC",Rt.INTERACTIVE="INTERACTIVE",(Lt=Pt||(Pt={})).ASSET="ASSET",Lt.STYLE="STYLE",(Dt=Mt||(Mt={})).INSERT="INSERT",Dt.REMOVE="REMOVE",Dt.REMOVE_STATIC="REMOVE_STATIC",Dt.OUTPAINT="OUTPAINT",(qt=Ut||(Ut={})).OPTIMIZED="OPTIMIZED",qt.LOSSLESS="LOSSLESS",(Ht=Gt||(Gt={})).SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",Ht.PREFERENCE_TUNING="PREFERENCE_TUNING",(Vt=Bt||(Bt={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",Vt.STATE_PENDING="STATE_PENDING",Vt.STATE_ACTIVE="STATE_ACTIVE",Vt.STATE_FAILED="STATE_FAILED",(Wt=Ft||(Ft={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",Wt.PROCESSING="PROCESSING",Wt.ACTIVE="ACTIVE",Wt.FAILED="FAILED",($t=Jt||(Jt={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",$t.UPLOADED="UPLOADED",$t.GENERATED="GENERATED",$t.REGISTERED="REGISTERED",(Yt=zt||(zt={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",Yt.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",Yt.RESPONSE_REJECTED="RESPONSE_REJECTED",Yt.NEED_MORE_INPUT="NEED_MORE_INPUT",(Xt=Kt||(Kt={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",Xt.TEXT="TEXT",Xt.IMAGE="IMAGE",Xt.VIDEO="VIDEO",Xt.AUDIO="AUDIO",Xt.DOCUMENT="DOCUMENT",(Zt=Qt||(Qt={})).VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",Zt.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",Zt.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS",(tn=en||(en={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",tn.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",tn.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(sn=nn||(nn={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",sn.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",sn.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",(on=rn||(rn={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",on.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",on.NO_INTERRUPTION="NO_INTERRUPTION",(ln=an||(an={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",ln.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",ln.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(dn=cn||(cn={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",dn.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",dn.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",dn.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",dn.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",dn.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",dn.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",dn.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",dn.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",dn.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",dn.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",dn.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",dn.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(pn=un||(un={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",pn.QUALITY="QUALITY",pn.DIVERSITY="DIVERSITY",pn.VOCALIZATION="VOCALIZATION",(hn=mn||(mn={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",hn.PLAY="PLAY",hn.PAUSE="PAUSE",hn.STOP="STOP",hn.RESET_CONTEXT="RESET_CONTEXT";class xn{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class bn{get text(){var e,t,n,s,r,i,o,a;if(0===(null===(s=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===s?void 0:s.length))return;this.candidates&&this.candidates.length;let l="",c=!1;const d=[];for(const u of null!==(a=null===(o=null===(i=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===i?void 0:i.content)||void 0===o?void 0:o.parts)&&void 0!==a?a:[]){for(const[e,t]of Object.entries(u))"text"===e||"thought"===e||"thoughtSignature"===e||null===t&&void 0===t||d.push(e);if("string"==typeof u.text){if("boolean"==typeof u.thought&&u.thought)continue;c=!0,l+=u.text}}return d.length,c?l:void 0}get data(){var e,t,n,s,r,i,o,a;if(0===(null===(s=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===s?void 0:s.length))return;this.candidates&&this.candidates.length;let l="";const c=[];for(const d of null!==(a=null===(o=null===(i=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===i?void 0:i.content)||void 0===o?void 0:o.parts)&&void 0!==a?a:[]){for(const[e,t]of Object.entries(d))"inlineData"===e||null===t&&void 0===t||c.push(e);d.inlineData&&"string"==typeof d.inlineData.data&&(l+=atob(d.inlineData.data))}return c.length,l.length>0?btoa(l):void 0}get functionCalls(){var e,t,n,s,r,i,o,a;if(0===(null===(s=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===s?void 0:s.length))return;this.candidates&&this.candidates.length;const l=null===(a=null===(o=null===(i=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===i?void 0:i.content)||void 0===o?void 0:o.parts)||void 0===a?void 0:a.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);return 0!==(null==l?void 0:l.length)?l:void 0}get executableCode(){var e,t,n,s,r,i,o,a,l;if(0===(null===(s=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===s?void 0:s.length))return;this.candidates&&this.candidates.length;const c=null===(a=null===(o=null===(i=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===i?void 0:i.content)||void 0===o?void 0:o.parts)||void 0===a?void 0:a.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);return 0!==(null==c?void 0:c.length)?null===(l=null==c?void 0:c[0])||void 0===l?void 0:l.code:void 0}get codeExecutionResult(){var e,t,n,s,r,i,o,a,l;if(0===(null===(s=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===s?void 0:s.length))return;this.candidates&&this.candidates.length;const c=null===(a=null===(o=null===(i=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===i?void 0:i.content)||void 0===o?void 0:o.parts)||void 0===a?void 0:a.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);return 0!==(null==c?void 0:c.length)?null===(l=null==c?void 0:c[0])||void 0===l?void 0:l.output:void 0}}class vn{}class yn{}class wn{}class Nn{}class jn{}class Sn{}class En{}class Cn{}class _n{}class kn{}class In{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new In;let s;const r=e;return s=t?ce(r):le(r),Object.assign(n,s),n}}class An{}class Tn{}class On{}class Rn{}class Pn{}class Ln{}class Mn{}class Dn{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new Dn,s=de(e);return Object.assign(n,s),n}}class Un{}class qn{}class Gn{}class Hn{}class Bn{get text(){var e,t,n;let s="",r=!1;const i=[];for(const o of null!==(n=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==n?n:[]){for(const[e,t]of Object.entries(o))"text"!==e&&"thought"!==e&&null!==t&&i.push(e);if("string"==typeof o.text){if("boolean"==typeof o.thought&&o.thought)continue;r=!0,s+=o.text}}return i.length,r?s:void 0}get data(){var e,t,n;let s="";const r=[];for(const i of null!==(n=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==n?n:[]){for(const[e,t]of Object.entries(i))"inlineData"!==e&&null!==t&&r.push(e);i.inlineData&&"string"==typeof i.inlineData.data&&(s+=atob(i.inlineData.data))}return r.length,s.length>0?btoa(s):void 0}}class Vn{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Fn{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new Fn,s=ue(e);return Object.assign(n,s),n}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Wn(e,t){if(!t||"string"!=typeof t)throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}return`publishers/google/models/${t}`}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function Jn(e,t){const n=Wn(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function $n(e){return Array.isArray(e)?e.map(e=>zn(e)):[zn(e)]}function zn(e){if("object"==typeof e&&null!==e)return e;throw new Error("Could not parse input as Blob. Unsupported blob type: "+typeof e)}function Yn(e){const t=zn(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Kn(e){const t=zn(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Xn(e){if(null==e)throw new Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw new Error("Unsupported part type: "+typeof e)}function Qn(e){if(null==e||Array.isArray(e)&&0===e.length)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>Xn(e)):[Xn(e)]}function Zn(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function es(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function ts(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function ns(e){if(null==e)throw new Error("ContentUnion is required");return Zn(e)?e:{role:"user",parts:Qn(e)}}function ss(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{const t=ns(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){const e=ns(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>ns(e)):[ns(t)]}function rs(e){if(null==e||Array.isArray(e)&&0===e.length)throw new Error("contents are required");if(!Array.isArray(e)){if(es(e)||ts(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ns(e)]}const t=[],n=[],s=Zn(e[0]);for(const r of e){const e=Zn(r);if(e!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(r);else{if(es(r)||ts(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(r)}}return s||t.push({role:"user",parts:Qn(n)}),t}function is(e){const t={},n=["items"],s=["anyOf"],r=["properties"];if(e.type&&e.anyOf)throw new Error("type and anyOf cannot be both populated.");const i=e.anyOf;null!=i&&2==i.length&&("null"===i[0].type?(t.nullable=!0,e=i[1]):"null"===i[1].type&&(t.nullable=!0,e=i[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);const n=e.filter(e=>"null"!==e);if(1===n.length)t.type=Object.values(be).includes(n[0].toUpperCase())?n[0].toUpperCase():be.TYPE_UNSPECIFIED;else{t.anyOf=[];for(const e of n)t.anyOf.push({type:Object.values(be).includes(e.toUpperCase())?e.toUpperCase():be.TYPE_UNSPECIFIED})}}(e.type,t);for(const[o,a]of Object.entries(e))if(null!=a)if("type"==o){if("null"===a)throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(be).includes(a.toUpperCase())?a.toUpperCase():be.TYPE_UNSPECIFIED}else if(n.includes(o))t[o]=is(a);else if(s.includes(o)){const e=[];for(const n of a)"null"!=n.type?e.push(is(n)):t.nullable=!0;t[o]=e}else if(r.includes(o)){const e={};for(const[t,n]of Object.entries(a))e[t]=is(n);t[o]=e}else{if("additionalProperties"===o)continue;t[o]=a}return t}function os(e){return is(e)}function as(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error("Unsupported speechConfig type: "+typeof e)}function ls(e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function cs(e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=is(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=is(t.response));return e}function ds(e){if(null==e)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const n of e)t.push(n);return t}function us(e,t){if("string"!=typeof t)throw new Error("name must be a string");return function(e,t,n,s=1){const r=!t.startsWith(`${n}/`)&&t.split("/").length===s;return e.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${n}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:r?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`:t:r?`${n}/${t}`:t}(e,t,"cachedContents")}function ps(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function ms(e){return ae(e)}function hs(e){var t;let n;var s;if(null!=(s=e)&&"object"==typeof s&&"name"in s&&(n=e.name),!(function(e){return null!=e&&"object"==typeof e&&"uri"in e}(e)&&(n=e.uri,void 0===n)||function(e){return null!=e&&"object"==typeof e&&"video"in e}(e)&&(n=null===(t=e.video)||void 0===t?void 0:t.uri,void 0===n))){if("string"==typeof e&&(n=e),void 0===n)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const e=n.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw new Error(`Could not extract file name from URI ${n}`);n=e[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function gs(e,t){let n;return n=e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels",n}function fs(e){for(const t of["models","tunedModels","publisherModels"])if(xs(e,t))return e[t];return[]}function xs(e,t){return null!==e&&"object"==typeof e&&t in e}function bs(e,t={}){const n=e,s={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};n.outputSchema&&(s.responseJsonSchema=n.outputSchema),t.behavior&&(s.behavior=t.behavior);return{functionDeclarations:[s]}}function vs(e,t){let n;if("string"==typeof t)if(e.isVertexAI())if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else{if(!t.startsWith("bq://"))throw new Error(`Unsupported string source for Vertex AI: ${t}`);n={format:"bigquery",bigqueryUri:t}}else{if(!t.startsWith("files/"))throw new Error(`Unsupported string source for Gemini API: ${t}`);n={fileName:t}}else if(Array.isArray(t)){if(e.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;const s=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,r=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(r>0||1!==s)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||1!==r)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function ys(e){if("object"!=typeof e||null===e)return{};const t=e,n=t.inlinedResponses;if("object"!=typeof n||null===n)return e;const s=n.inlinedResponses;if(!Array.isArray(s)||0===s.length)return e;let r=!1;for(const i of s){if("object"!=typeof i||null===i)continue;const e=i.response;if("object"!=typeof e||null===e)continue;if(void 0!==e.embedding){r=!0;break}}return r&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),e}function ws(e,t){const n=t;if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function Ns(e){return"BATCH_STATE_UNSPECIFIED"===e?"JOB_STATE_UNSPECIFIED":"BATCH_STATE_PENDING"===e?"JOB_STATE_PENDING":"BATCH_STATE_RUNNING"===e?"JOB_STATE_RUNNING":"BATCH_STATE_SUCCEEDED"===e?"JOB_STATE_SUCCEEDED":"BATCH_STATE_FAILED"===e?"JOB_STATE_FAILED":"BATCH_STATE_CANCELLED"===e?"JOB_STATE_CANCELLED":"BATCH_STATE_EXPIRED"===e?"JOB_STATE_EXPIRED":e}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function js(e){const t={},n=ie(e,["responsesFile"]);null!=n&&re(t,["fileName"],n);const s=ie(e,["inlinedResponses","inlinedResponses"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["response"]);null!=n&&re(t,["response"],function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["candidates"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["content"]);null!=n&&re(t,["content"],n);const s=ie(e,["citationMetadata"]);null!=s&&re(t,["citationMetadata"],function(e){const t={},n=ie(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["citations"],e)}return t}(s));const r=ie(e,["tokenCount"]);null!=r&&re(t,["tokenCount"],r);const i=ie(e,["finishReason"]);null!=i&&re(t,["finishReason"],i);const o=ie(e,["avgLogprobs"]);null!=o&&re(t,["avgLogprobs"],o);const a=ie(e,["groundingMetadata"]);null!=a&&re(t,["groundingMetadata"],a);const l=ie(e,["index"]);null!=l&&re(t,["index"],l);const c=ie(e,["logprobsResult"]);null!=c&&re(t,["logprobsResult"],c);const d=ie(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["safetyRatings"],e)}const u=ie(e,["urlContextMetadata"]);null!=u&&re(t,["urlContextMetadata"],u);return t}(e))),re(t,["candidates"],e)}const r=ie(e,["modelVersion"]);null!=r&&re(t,["modelVersion"],r);const i=ie(e,["promptFeedback"]);null!=i&&re(t,["promptFeedback"],i);const o=ie(e,["responseId"]);null!=o&&re(t,["responseId"],o);const a=ie(e,["usageMetadata"]);null!=a&&re(t,["usageMetadata"],a);return t}(n));const s=ie(e,["error"]);null!=s&&re(t,["error"],s);return t}(e))),re(t,["inlinedResponses"],e)}const r=ie(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["inlinedEmbedContentResponses"],e)}return t}function Ss(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["name"],n);const s=ie(e,["metadata","displayName"]);null!=s&&re(t,["displayName"],s);const r=ie(e,["metadata","state"]);null!=r&&re(t,["state"],Ns(r));const i=ie(e,["metadata","createTime"]);null!=i&&re(t,["createTime"],i);const o=ie(e,["metadata","endTime"]);null!=o&&re(t,["endTime"],o);const a=ie(e,["metadata","updateTime"]);null!=a&&re(t,["updateTime"],a);const l=ie(e,["metadata","model"]);null!=l&&re(t,["model"],l);const c=ie(e,["metadata","output"]);return null!=c&&re(t,["dest"],js(ys(c))),t}function Es(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["name"],n);const s=ie(e,["displayName"]);null!=s&&re(t,["displayName"],s);const r=ie(e,["state"]);null!=r&&re(t,["state"],Ns(r));const i=ie(e,["error"]);null!=i&&re(t,["error"],i);const o=ie(e,["createTime"]);null!=o&&re(t,["createTime"],o);const a=ie(e,["startTime"]);null!=a&&re(t,["startTime"],a);const l=ie(e,["endTime"]);null!=l&&re(t,["endTime"],l);const c=ie(e,["updateTime"]);null!=c&&re(t,["updateTime"],c);const d=ie(e,["model"]);null!=d&&re(t,["model"],d);const u=ie(e,["inputConfig"]);null!=u&&re(t,["src"],function(e){const t={},n=ie(e,["instancesFormat"]);null!=n&&re(t,["format"],n);const s=ie(e,["gcsSource","uris"]);null!=s&&re(t,["gcsUri"],s);const r=ie(e,["bigquerySource","inputUri"]);null!=r&&re(t,["bigqueryUri"],r);return t}(u));const p=ie(e,["outputConfig"]);null!=p&&re(t,["dest"],function(e){const t={},n=ie(e,["predictionsFormat"]);null!=n&&re(t,["format"],n);const s=ie(e,["gcsDestination","outputUriPrefix"]);null!=s&&re(t,["gcsUri"],s);const r=ie(e,["bigqueryDestination","outputUri"]);return null!=r&&re(t,["bigqueryUri"],r),t}(ys(p)));const m=ie(e,["completionStats"]);return null!=m&&re(t,["completionStats"],m),t}function Cs(e,t){const n={};if(void 0!==ie(t,["format"]))throw new Error("format parameter is not supported in Gemini API.");if(void 0!==ie(t,["gcsUri"]))throw new Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==ie(t,["bigqueryUri"]))throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=ie(t,["fileName"]);null!=s&&re(n,["fileName"],s);const r=ie(t,["inlinedRequests"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>function(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["request","model"],Wn(e,s));const r=ie(t,["contents"]);if(null!=r){let e=rs(r);Array.isArray(e)&&(e=e.map(e=>_s(e))),re(n,["request","contents"],e)}const i=ie(t,["metadata"]);null!=i&&re(n,["metadata"],i);const o=ie(t,["config"]);null!=o&&re(n,["request","generationConfig"],function(e,t,n){const s={},r=ie(t,["systemInstruction"]);void 0!==n&&null!=r&&re(n,["systemInstruction"],_s(ns(r)));const i=ie(t,["temperature"]);null!=i&&re(s,["temperature"],i);const o=ie(t,["topP"]);null!=o&&re(s,["topP"],o);const a=ie(t,["topK"]);null!=a&&re(s,["topK"],a);const l=ie(t,["candidateCount"]);null!=l&&re(s,["candidateCount"],l);const c=ie(t,["maxOutputTokens"]);null!=c&&re(s,["maxOutputTokens"],c);const d=ie(t,["stopSequences"]);null!=d&&re(s,["stopSequences"],d);const u=ie(t,["responseLogprobs"]);null!=u&&re(s,["responseLogprobs"],u);const p=ie(t,["logprobs"]);null!=p&&re(s,["logprobs"],p);const m=ie(t,["presencePenalty"]);null!=m&&re(s,["presencePenalty"],m);const h=ie(t,["frequencyPenalty"]);null!=h&&re(s,["frequencyPenalty"],h);const g=ie(t,["seed"]);null!=g&&re(s,["seed"],g);const f=ie(t,["responseMimeType"]);null!=f&&re(s,["responseMimeType"],f);const x=ie(t,["responseSchema"]);null!=x&&re(s,["responseSchema"],os(x));const b=ie(t,["responseJsonSchema"]);null!=b&&re(s,["responseJsonSchema"],b);if(void 0!==ie(t,["routingConfig"]))throw new Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==ie(t,["modelSelectionConfig"]))throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const v=ie(t,["safetySettings"]);if(void 0!==n&&null!=v){let e=v;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["category"]);null!=n&&re(t,["category"],n);if(void 0!==ie(e,["method"]))throw new Error("method parameter is not supported in Gemini API.");const s=ie(e,["threshold"]);null!=s&&re(t,["threshold"],s);return t}(e))),re(n,["safetySettings"],e)}const y=ie(t,["tools"]);if(void 0!==n&&null!=y){let e=ds(y);Array.isArray(e)&&(e=e.map(e=>function(e){const t={};if(void 0!==ie(e,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const n=ie(e,["computerUse"]);null!=n&&re(t,["computerUse"],n);const s=ie(e,["fileSearch"]);null!=s&&re(t,["fileSearch"],s);const r=ie(e,["codeExecution"]);null!=r&&re(t,["codeExecution"],r);if(void 0!==ie(e,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const i=ie(e,["functionDeclarations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["functionDeclarations"],e)}const o=ie(e,["googleMaps"]);null!=o&&re(t,["googleMaps"],function(e){const t={};if(void 0!==ie(e,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=ie(e,["enableWidget"]);null!=n&&re(t,["enableWidget"],n);return t}(o));const a=ie(e,["googleSearch"]);null!=a&&re(t,["googleSearch"],function(e){const t={};if(void 0!==ie(e,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ie(e,["blockingConfidence"]))throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=ie(e,["timeRangeFilter"]);null!=n&&re(t,["timeRangeFilter"],n);return t}(a));const l=ie(e,["googleSearchRetrieval"]);null!=l&&re(t,["googleSearchRetrieval"],l);const c=ie(e,["urlContext"]);null!=c&&re(t,["urlContext"],c);return t}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(cs(e)))),re(n,["tools"],e)}const w=ie(t,["toolConfig"]);void 0!==n&&null!=w&&re(n,["toolConfig"],function(e){const t={},n=ie(e,["retrievalConfig"]);null!=n&&re(t,["retrievalConfig"],n);const s=ie(e,["functionCallingConfig"]);null!=s&&re(t,["functionCallingConfig"],function(e){const t={},n=ie(e,["allowedFunctionNames"]);null!=n&&re(t,["allowedFunctionNames"],n);const s=ie(e,["mode"]);null!=s&&re(t,["mode"],s);if(void 0!==ie(e,["streamFunctionCallArguments"]))throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(s));return t}(w));if(void 0!==ie(t,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");const N=ie(t,["cachedContent"]);void 0!==n&&null!=N&&re(n,["cachedContent"],us(e,N));const j=ie(t,["responseModalities"]);null!=j&&re(s,["responseModalities"],j);const S=ie(t,["mediaResolution"]);null!=S&&re(s,["mediaResolution"],S);const E=ie(t,["speechConfig"]);null!=E&&re(s,["speechConfig"],as(E));if(void 0!==ie(t,["audioTimestamp"]))throw new Error("audioTimestamp parameter is not supported in Gemini API.");const C=ie(t,["thinkingConfig"]);null!=C&&re(s,["thinkingConfig"],C);const _=ie(t,["imageConfig"]);null!=_&&re(s,["imageConfig"],function(e){const t={},n=ie(e,["aspectRatio"]);null!=n&&re(t,["aspectRatio"],n);const s=ie(e,["imageSize"]);null!=s&&re(t,["imageSize"],s);if(void 0!==ie(e,["personGeneration"]))throw new Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==ie(e,["outputMimeType"]))throw new Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==ie(e,["outputCompressionQuality"]))throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(_));const k=ie(t,["enableEnhancedCivicAnswers"]);null!=k&&re(s,["enableEnhancedCivicAnswers"],k);return s}(e,o,ie(n,["request"],{})));return n}(e,t))),re(n,["requests","requests"],t)}return n}function _s(e){const t={},n=ie(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["mediaResolution"]);null!=n&&re(t,["mediaResolution"],n);const s=ie(e,["codeExecutionResult"]);null!=s&&re(t,["codeExecutionResult"],s);const r=ie(e,["executableCode"]);null!=r&&re(t,["executableCode"],r);const i=ie(e,["fileData"]);null!=i&&re(t,["fileData"],function(e){const t={};if(void 0!==ie(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=ie(e,["fileUri"]);null!=n&&re(t,["fileUri"],n);const s=ie(e,["mimeType"]);null!=s&&re(t,["mimeType"],s);return t}(i));const o=ie(e,["functionCall"]);null!=o&&re(t,["functionCall"],function(e){const t={},n=ie(e,["id"]);null!=n&&re(t,["id"],n);const s=ie(e,["args"]);null!=s&&re(t,["args"],s);const r=ie(e,["name"]);null!=r&&re(t,["name"],r);if(void 0!==ie(e,["partialArgs"]))throw new Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ie(e,["willContinue"]))throw new Error("willContinue parameter is not supported in Gemini API.");return t}(o));const a=ie(e,["functionResponse"]);null!=a&&re(t,["functionResponse"],a);const l=ie(e,["inlineData"]);null!=l&&re(t,["inlineData"],function(e){const t={},n=ie(e,["data"]);if(null!=n&&re(t,["data"],n),void 0!==ie(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const s=ie(e,["mimeType"]);return null!=s&&re(t,["mimeType"],s),t}(l));const c=ie(e,["text"]);null!=c&&re(t,["text"],c);const d=ie(e,["thought"]);null!=d&&re(t,["thought"],d);const u=ie(e,["thoughtSignature"]);null!=u&&re(t,["thoughtSignature"],u);const p=ie(e,["videoMetadata"]);null!=p&&re(t,["videoMetadata"],p);return t}(e))),re(t,["parts"],e)}const s=ie(e,["role"]);return null!=s&&re(t,["role"],s),t}function ks(e,t){const n=ie(e,["displayName"]);void 0!==t&&null!=n&&re(t,["displayName"],n);const s=ie(e,["dest"]);return void 0!==t&&null!=s&&re(t,["outputConfig"],function(e){const t={},n=ie(e,["format"]);null!=n&&re(t,["predictionsFormat"],n);const s=ie(e,["gcsUri"]);null!=s&&re(t,["gcsDestination","outputUriPrefix"],s);const r=ie(e,["bigqueryUri"]);if(null!=r&&re(t,["bigqueryDestination","outputUri"],r),void 0!==ie(e,["fileName"]))throw new Error("fileName parameter is not supported in Vertex AI.");if(void 0!==ie(e,["inlinedResponses"]))throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==ie(e,["inlinedEmbedContentResponses"]))throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;const t=e;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}(s))),{}}function Is(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["src"]);null!=r&&re(n,["batch","inputConfig"],Cs(e,vs(e,r)));const i=ie(t,["config"]);return null!=i&&function(e,t){const n=ie(e,["displayName"]);if(void 0!==t&&null!=n&&re(t,["batch","displayName"],n),void 0!==ie(e,["dest"]))throw new Error("dest parameter is not supported in Gemini API.")}(i,n),n}function As(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["model"],Wn(e,s));const r=ie(t,["src"]);null!=r&&re(n,["inputConfig"],function(e){const t={},n=ie(e,["format"]);null!=n&&re(t,["instancesFormat"],n);const s=ie(e,["gcsUri"]);null!=s&&re(t,["gcsSource","uris"],s);const r=ie(e,["bigqueryUri"]);if(null!=r&&re(t,["bigquerySource","inputUri"],r),void 0!==ie(e,["fileName"]))throw new Error("fileName parameter is not supported in Vertex AI.");if(void 0!==ie(e,["inlinedRequests"]))throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(vs(e,r)));const i=ie(t,["config"]);return null!=i&&ks(i,n),n}function Ts(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["src"]);null!=r&&re(n,["batch","inputConfig"],function(e,t){const n={},s=ie(t,["fileName"]);null!=s&&re(n,["file_name"],s);const r=ie(t,["inlinedRequests"]);null!=r&&re(n,["requests"],function(e,t){const n={},s=ie(t,["contents"]);if(null!=s){let t=ss(e,s);Array.isArray(t)&&(t=t.map(e=>e)),re(n,["requests[]","request","content"],t)}const r=ie(t,["config"]);null!=r&&(re(n,["_self"],function(e,t){const n={},s=ie(e,["taskType"]);void 0!==t&&null!=s&&re(t,["requests[]","taskType"],s);const r=ie(e,["title"]);void 0!==t&&null!=r&&re(t,["requests[]","title"],r);const i=ie(e,["outputDimensionality"]);void 0!==t&&null!=i&&re(t,["requests[]","outputDimensionality"],i);if(void 0!==ie(e,["mimeType"]))throw new Error("mimeType parameter is not supported in Gemini API.");if(void 0!==ie(e,["autoTruncate"]))throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}(r,n)),function(e,t){for(const[n,s]of Object.entries(t)){const t=n.split("."),r=s.split("."),i=new Set;let o=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){o=e;break}if(-1!==o&&r.length>o)for(let e=o;e<r.length;e++){const t=r[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||i.add(t)}oe(e,t,r,0,i)}}(n,{"requests[].*":"requests[].request.*"}));return n}(e,r));return n}(e,r));const i=ie(t,["config"]);return null!=i&&function(e,t){const n=ie(e,["displayName"]);void 0!==t&&null!=n&&re(t,["batch","displayName"],n)}(i,n),n}function Os(e){const t={},n=ie(e,["config"]);return null!=n&&function(e,t){const n=ie(e,["pageSize"]);void 0!==t&&null!=n&&re(t,["_query","pageSize"],n);const s=ie(e,["pageToken"]);if(void 0!==t&&null!=s&&re(t,["_query","pageToken"],s),void 0!==ie(e,["filter"]))throw new Error("filter parameter is not supported in Gemini API.")}(n,t),t}function Rs(e){const t={},n=ie(e,["config"]);return null!=n&&function(e,t){const n=ie(e,["pageSize"]);void 0!==t&&null!=n&&re(t,["_query","pageSize"],n);const s=ie(e,["pageToken"]);void 0!==t&&null!=s&&re(t,["_query","pageToken"],s);const r=ie(e,["filter"]);void 0!==t&&null!=r&&re(t,["_query","filter"],r)}(n,t),t}(fn=gn||(gn={})).PAGED_ITEM_BATCH_JOBS="batchJobs",fn.PAGED_ITEM_MODELS="models",fn.PAGED_ITEM_TUNING_JOBS="tuningJobs",fn.PAGED_ITEM_FILES="files",fn.PAGED_ITEM_CACHED_CONTENTS="cachedContents",fn.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",fn.PAGED_ITEM_DOCUMENTS="documents";class Ps{constructor(e,t,n,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,s)}init(e,t,n){var s,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let i={config:{}};i=n&&0!==Object.keys(n).length?"object"==typeof n?Object.assign({},n):n:{config:{}},i.config&&(i.config.pageToken=t.nextPageToken),this.paramsInternal=i,this.pageInternalSize=null!==(r=null===(s=i.config)||void 0===s?void 0:s.pageSize)&&void 0!==r?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength){if(!this.hasNextPage())return{value:void 0,done:!0};await this.nextPage()}const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return void 0!==(null===(e=this.params.config)||void 0===e?void 0:e.pageToken)}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ls extends ne{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new Ps(gn.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)}}createInlinedGenerateContentRequest(e){const t=Is(this.apiClient,e),n=se("{model}:batchGenerateContent",t._url),s=t.batch.inputConfig.requests,r=s.requests,i=[];for(const o of r){const e=Object.assign({},o);if(e.systemInstruction){const t=e.systemInstruction;delete e.systemInstruction;const n=e.request;n.systemInstruction=t,e.request=n}i.push(e)}return s.requests=i,delete t.config,delete t._url,delete t._query,{path:n,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){const n=t?Object.assign({},t):{},s=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${s}`),void 0===n.dest){const t=this.getGcsUri(e),r=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?n.dest=`${t.slice(0,-6)}/dest`:n.dest=`${t}_dest_${s}`;else{if(!r)throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.");n.dest=`${r}_dest_${s}`}}return n}async createInternal(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=As(this.apiClient,e);return o=se("batchPredictionJobs",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>Es(e))}{const t=Is(this.apiClient,e);return o=se("{model}:batchGenerateContent",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),i.then(e=>Ss(e))}}async createEmbeddingsInternal(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=Ts(this.apiClient,e);return r=se("{model}:asyncBatchEmbedContent",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>Ss(e))}}async get(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=function(e,t){const n={},s=ie(t,["name"]);return null!=s&&re(n,["_url","name"],ws(e,s)),n}(this.apiClient,e);return o=se("batchPredictionJobs/{name}",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>Es(e))}{const t=function(e,t){const n={},s=ie(t,["name"]);return null!=s&&re(n,["_url","name"],ws(e,s)),n}(this.apiClient,e);return o=se("batches/{name}",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),i.then(e=>Ss(e))}}async cancel(e){var t,n,s,r;let i="",o={};if(this.apiClient.isVertexAI()){const s=function(e,t){const n={},s=ie(t,["name"]);return null!=s&&re(n,["_url","name"],ws(e,s)),n}(this.apiClient,e);i=se("batchPredictionJobs/{name}:cancel",s._url),o=s._query,delete s._url,delete s._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}else{const t=function(e,t){const n={},s=ie(t,["name"]);return null!=s&&re(n,["_url","name"],ws(e,s)),n}(this.apiClient,e);i=se("batches/{name}:cancel",t._url),o=t._query,delete t._url,delete t._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal})}}async listInternal(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=Rs(e);return o=se("batchPredictionJobs",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["nextPageToken"]);null!=s&&re(t,["nextPageToken"],s);const r=ie(e,["batchPredictionJobs"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>Es(e))),re(t,["batchJobs"],e)}return t}(e),n=new Hn;return Object.assign(n,t),n})}{const t=Os(e);return o=se("batches",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["nextPageToken"]);null!=s&&re(t,["nextPageToken"],s);const r=ie(e,["operations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>Ss(e))),re(t,["batchJobs"],e)}return t}(e),n=new Hn;return Object.assign(n,t),n})}}async delete(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=function(e,t){const n={},s=ie(t,["name"]);return null!=s&&re(n,["_url","name"],ws(e,s)),n}(this.apiClient,e);return o=se("batchPredictionJobs/{name}",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["name"]);null!=s&&re(t,["name"],s);const r=ie(e,["done"]);null!=r&&re(t,["done"],r);const i=ie(e,["error"]);return null!=i&&re(t,["error"],i),t}(e))}{const t=function(e,t){const n={},s=ie(t,["name"]);return null!=s&&re(n,["_url","name"],ws(e,s)),n}(this.apiClient,e);return o=se("batches/{name}",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["name"]);null!=s&&re(t,["name"],s);const r=ie(e,["done"]);null!=r&&re(t,["done"],r);const i=ie(e,["error"]);return null!=i&&re(t,["error"],i),t}(e))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ms(e){const t={},n=ie(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["mediaResolution"]);null!=n&&re(t,["mediaResolution"],n);const s=ie(e,["codeExecutionResult"]);null!=s&&re(t,["codeExecutionResult"],s);const r=ie(e,["executableCode"]);null!=r&&re(t,["executableCode"],r);const i=ie(e,["fileData"]);null!=i&&re(t,["fileData"],function(e){const t={};if(void 0!==ie(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=ie(e,["fileUri"]);null!=n&&re(t,["fileUri"],n);const s=ie(e,["mimeType"]);null!=s&&re(t,["mimeType"],s);return t}(i));const o=ie(e,["functionCall"]);null!=o&&re(t,["functionCall"],function(e){const t={},n=ie(e,["id"]);null!=n&&re(t,["id"],n);const s=ie(e,["args"]);null!=s&&re(t,["args"],s);const r=ie(e,["name"]);null!=r&&re(t,["name"],r);if(void 0!==ie(e,["partialArgs"]))throw new Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ie(e,["willContinue"]))throw new Error("willContinue parameter is not supported in Gemini API.");return t}(o));const a=ie(e,["functionResponse"]);null!=a&&re(t,["functionResponse"],a);const l=ie(e,["inlineData"]);null!=l&&re(t,["inlineData"],function(e){const t={},n=ie(e,["data"]);if(null!=n&&re(t,["data"],n),void 0!==ie(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const s=ie(e,["mimeType"]);return null!=s&&re(t,["mimeType"],s),t}(l));const c=ie(e,["text"]);null!=c&&re(t,["text"],c);const d=ie(e,["thought"]);null!=d&&re(t,["thought"],d);const u=ie(e,["thoughtSignature"]);null!=u&&re(t,["thoughtSignature"],u);const p=ie(e,["videoMetadata"]);null!=p&&re(t,["videoMetadata"],p);return t}(e))),re(t,["parts"],e)}const s=ie(e,["role"]);return null!=s&&re(t,["role"],s),t}function Ds(e,t){const n=ie(e,["ttl"]);void 0!==t&&null!=n&&re(t,["ttl"],n);const s=ie(e,["expireTime"]);void 0!==t&&null!=s&&re(t,["expireTime"],s);const r=ie(e,["displayName"]);void 0!==t&&null!=r&&re(t,["displayName"],r);const i=ie(e,["contents"]);if(void 0!==t&&null!=i){let e=rs(i);Array.isArray(e)&&(e=e.map(e=>Ms(e))),re(t,["contents"],e)}const o=ie(e,["systemInstruction"]);void 0!==t&&null!=o&&re(t,["systemInstruction"],Ms(ns(o)));const a=ie(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>function(e){const t={};if(void 0!==ie(e,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const n=ie(e,["computerUse"]);null!=n&&re(t,["computerUse"],n);const s=ie(e,["fileSearch"]);null!=s&&re(t,["fileSearch"],s);const r=ie(e,["codeExecution"]);null!=r&&re(t,["codeExecution"],r);if(void 0!==ie(e,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const i=ie(e,["functionDeclarations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["functionDeclarations"],e)}const o=ie(e,["googleMaps"]);null!=o&&re(t,["googleMaps"],function(e){const t={};if(void 0!==ie(e,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=ie(e,["enableWidget"]);null!=n&&re(t,["enableWidget"],n);return t}(o));const a=ie(e,["googleSearch"]);null!=a&&re(t,["googleSearch"],function(e){const t={};if(void 0!==ie(e,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ie(e,["blockingConfidence"]))throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=ie(e,["timeRangeFilter"]);null!=n&&re(t,["timeRangeFilter"],n);return t}(a));const l=ie(e,["googleSearchRetrieval"]);null!=l&&re(t,["googleSearchRetrieval"],l);const c=ie(e,["urlContext"]);null!=c&&re(t,["urlContext"],c);return t}(e))),re(t,["tools"],e)}const l=ie(e,["toolConfig"]);if(void 0!==t&&null!=l&&re(t,["toolConfig"],function(e){const t={},n=ie(e,["retrievalConfig"]);null!=n&&re(t,["retrievalConfig"],n);const s=ie(e,["functionCallingConfig"]);null!=s&&re(t,["functionCallingConfig"],function(e){const t={},n=ie(e,["allowedFunctionNames"]);null!=n&&re(t,["allowedFunctionNames"],n);const s=ie(e,["mode"]);null!=s&&re(t,["mode"],s);if(void 0!==ie(e,["streamFunctionCallArguments"]))throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(s));return t}(l)),void 0!==ie(e,["kmsKeyName"]))throw new Error("kmsKeyName parameter is not supported in Gemini API.");return{}}function Us(e,t){const n=ie(e,["ttl"]);void 0!==t&&null!=n&&re(t,["ttl"],n);const s=ie(e,["expireTime"]);void 0!==t&&null!=s&&re(t,["expireTime"],s);const r=ie(e,["displayName"]);void 0!==t&&null!=r&&re(t,["displayName"],r);const i=ie(e,["contents"]);if(void 0!==t&&null!=i){let e=rs(i);Array.isArray(e)&&(e=e.map(e=>e)),re(t,["contents"],e)}const o=ie(e,["systemInstruction"]);void 0!==t&&null!=o&&re(t,["systemInstruction"],ns(o));const a=ie(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["retrieval"]);null!=n&&re(t,["retrieval"],n);const s=ie(e,["computerUse"]);null!=s&&re(t,["computerUse"],s);if(void 0!==ie(e,["fileSearch"]))throw new Error("fileSearch parameter is not supported in Vertex AI.");const r=ie(e,["codeExecution"]);null!=r&&re(t,["codeExecution"],r);const i=ie(e,["enterpriseWebSearch"]);null!=i&&re(t,["enterpriseWebSearch"],i);const o=ie(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["description"]);null!=n&&re(t,["description"],n);const s=ie(e,["name"]);null!=s&&re(t,["name"],s);const r=ie(e,["parameters"]);null!=r&&re(t,["parameters"],r);const i=ie(e,["parametersJsonSchema"]);null!=i&&re(t,["parametersJsonSchema"],i);const o=ie(e,["response"]);null!=o&&re(t,["response"],o);const a=ie(e,["responseJsonSchema"]);null!=a&&re(t,["responseJsonSchema"],a);if(void 0!==ie(e,["behavior"]))throw new Error("behavior parameter is not supported in Vertex AI.");return t}(e))),re(t,["functionDeclarations"],e)}const a=ie(e,["googleMaps"]);null!=a&&re(t,["googleMaps"],a);const l=ie(e,["googleSearch"]);null!=l&&re(t,["googleSearch"],l);const c=ie(e,["googleSearchRetrieval"]);null!=c&&re(t,["googleSearchRetrieval"],c);const d=ie(e,["urlContext"]);null!=d&&re(t,["urlContext"],d);return t}(e))),re(t,["tools"],e)}const l=ie(e,["toolConfig"]);void 0!==t&&null!=l&&re(t,["toolConfig"],l);const c=ie(e,["kmsKeyName"]);return void 0!==t&&null!=c&&re(t,["encryption_spec","kmsKeyName"],c),{}}function qs(e){const t={},n=ie(e,["config"]);return null!=n&&function(e,t){const n=ie(e,["pageSize"]);void 0!==t&&null!=n&&re(t,["_query","pageSize"],n);const s=ie(e,["pageToken"]);void 0!==t&&null!=s&&re(t,["_query","pageToken"],s)}(n,t),t}function Gs(e){const t={},n=ie(e,["config"]);return null!=n&&function(e,t){const n=ie(e,["pageSize"]);void 0!==t&&null!=n&&re(t,["_query","pageSize"],n);const s=ie(e,["pageToken"]);void 0!==t&&null!=s&&re(t,["_query","pageToken"],s)}(n,t),t}function Hs(e,t){const n={},s=ie(t,["name"]);null!=s&&re(n,["_url","name"],us(e,s));const r=ie(t,["config"]);return null!=r&&function(e,t){const n=ie(e,["ttl"]);void 0!==t&&null!=n&&re(t,["ttl"],n);const s=ie(e,["expireTime"]);void 0!==t&&null!=s&&re(t,["expireTime"],s)}(r,n),n}function Bs(e,t){const n={},s=ie(t,["name"]);null!=s&&re(n,["_url","name"],us(e,s));const r=ie(t,["config"]);return null!=r&&function(e,t){const n=ie(e,["ttl"]);void 0!==t&&null!=n&&re(t,["ttl"],n);const s=ie(e,["expireTime"]);void 0!==t&&null!=s&&re(t,["expireTime"],s)}(r,n),n}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Vs extends ne{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new Ps(gn.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=function(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["model"],Jn(e,s));const r=ie(t,["config"]);return null!=r&&Us(r,n),n}(this.apiClient,e);return o=se("cachedContents",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>e)}{const t=function(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["model"],Jn(e,s));const r=ie(t,["config"]);return null!=r&&Ds(r,n),n}(this.apiClient,e);return o=se("cachedContents",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),i.then(e=>e)}}async get(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=function(e,t){const n={},s=ie(t,["name"]);return null!=s&&re(n,["_url","name"],us(e,s)),n}(this.apiClient,e);return o=se("{name}",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>e)}{const t=function(e,t){const n={},s=ie(t,["name"]);return null!=s&&re(n,["_url","name"],us(e,s)),n}(this.apiClient,e);return o=se("{name}",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),i.then(e=>e)}}async delete(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=function(e,t){const n={},s=ie(t,["name"]);return null!=s&&re(n,["_url","name"],us(e,s)),n}(this.apiClient,e);return o=se("{name}",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);return null!=n&&re(t,["sdkHttpResponse"],n),t}(e),n=new On;return Object.assign(n,t),n})}{const t=function(e,t){const n={},s=ie(t,["name"]);return null!=s&&re(n,["_url","name"],us(e,s)),n}(this.apiClient,e);return o=se("{name}",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);return null!=n&&re(t,["sdkHttpResponse"],n),t}(e),n=new On;return Object.assign(n,t),n})}}async update(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=Bs(this.apiClient,e);return o=se("{name}",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>e)}{const t=Hs(this.apiClient,e);return o=se("{name}",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),i.then(e=>e)}}async listInternal(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=Gs(e);return o=se("cachedContents",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["nextPageToken"]);null!=s&&re(t,["nextPageToken"],s);const r=ie(e,["cachedContents"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["cachedContents"],e)}return t}(e),n=new Rn;return Object.assign(n,t),n})}{const t=qs(e);return o=se("cachedContents",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["nextPageToken"]);null!=s&&re(t,["nextPageToken"],s);const r=ie(e,["cachedContents"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["cachedContents"],e)}return t}(e),n=new Rn;return Object.assign(n,t),n})}}}function Fs(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n}function Ws(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],s=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Js(e){return this instanceof Js?(this.v=e,this):new Js(e)}function $s(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,r=n.apply(e,t||[]),i=[];return s=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),s[Symbol.asyncIterator]=function(){return this},s;function o(e,t){r[e]&&(s[e]=function(t){return new Promise(function(n,s){i.push([e,t,n,s])>1||a(e,t)})},t&&(s[e]=t(s[e])))}function a(e,t){try{(n=r[e](t)).value instanceof Js?Promise.resolve(n.value.v).then(l,c):d(i[0][2],n)}catch(s){d(i[0][3],s)}var n}function l(e){a("next",e)}function c(e){a("throw",e)}function d(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function zs(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Ws(e),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(n){t[n]=e[n]&&function(t){return new Promise(function(s,r){(function(e,t,n,s){Promise.resolve(s).then(function(t){e({value:t,done:n})},t)})(s,r,(t=e[n](t)).done,t.value)})}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
function Ys(e){var t;if(null==e.candidates||0===e.candidates.length)return!1;const n=null===(t=e.candidates[0])||void 0===t?void 0:t.content;return void 0!==n&&Ks(n)}function Ks(e){if(void 0===e.parts||0===e.parts.length)return!1;for(const t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function Xs(e){if(void 0===e||0===e.length)return[];const t=[],n=e.length;let s=0;for(;s<n;)if("user"===e[s].role)t.push(e[s]),s++;else{const r=[];let i=!0;for(;s<n&&"model"===e[s].role;)r.push(e[s]),i&&!Ks(e[s])&&(i=!1),s++;i?t.push(...r):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class Qs{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Zs(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Zs{constructor(e,t,n,s={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=s,this.history=r,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length)for(const t of e)if("user"!==t.role&&"model"!==t.role)throw new Error(`Role must be user or model, but got ${t.role}.`)}(r)}async sendMessage(e){var t;await this.sendPromise;const n=ns(e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!==(t=e.config)&&void 0!==t?t:this.config});return this.sendPromise=(async()=>{var e,t,r;const i=await s,o=null===(t=null===(e=i.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content,a=i.automaticFunctionCallingHistory,l=this.getHistory(!0).length;let c=[];null!=a&&(c=null!==(r=a.slice(l))&&void 0!==r?r:[]);const d=o?[o]:[];this.recordHistory(n,d,c)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;const n=ns(e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!==(t=e.config)&&void 0!==t?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});const r=await s;return this.processStreamResponse(r,n)}getHistory(e=!1){const t=e?Xs(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return $s(this,arguments,function*(){var n,s,r,i,o,a;const l=[];try{for(var c,d=!0,u=zs(e);!(n=(c=yield Js(u.next())).done);d=!0){i=c.value,d=!1;const e=i;if(Ys(e)){const t=null===(a=null===(o=e.candidates)||void 0===o?void 0:o[0])||void 0===a?void 0:a.content;void 0!==t&&l.push(t)}yield yield Js(e)}}catch(p){s={error:p}}finally{try{d||n||!(r=u.return)||(yield Js(r.call(u)))}finally{if(s)throw s.error}}this.recordHistory(t,l)})}recordHistory(e,t,n){let s=[];t.length>0&&t.every(e=>void 0!==e.role)?s=t:s.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...Xs(n)):this.history.push(e),this.history.push(...s)}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class er extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,er.prototype)}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tr(e){const t={},n=ie(e,["config"]);return null!=n&&function(e,t){const n=ie(e,["pageSize"]);void 0!==t&&null!=n&&re(t,["_query","pageSize"],n);const s=ie(e,["pageToken"]);void 0!==t&&null!=s&&re(t,["_query","pageToken"],s)}(n,t),t}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
class nr extends ne{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new Ps(gn.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=tr(e);return r=se("files",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),s.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["nextPageToken"]);null!=s&&re(t,["nextPageToken"],s);const r=ie(e,["files"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["files"],e)}return t}(e),n=new Un;return Object.assign(n,t),n})}}async createInternal(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=function(e){const t={},n=ie(e,["file"]);return null!=n&&re(t,["file"],n),t}(e);return r=se("upload/v1beta/files",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);return null!=n&&re(t,["sdkHttpResponse"],n),t}(e),n=new qn;return Object.assign(n,t),n})}}async get(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=function(e){const t={},n=ie(e,["name"]);return null!=n&&re(t,["_url","file"],hs(n)),t}(e);return r=se("files/{file}",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>e)}}async delete(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=function(e){const t={},n=ie(e,["name"]);return null!=n&&re(t,["_url","file"],hs(n)),t}(e);return r=se("files/{file}",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),s.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);return null!=n&&re(t,["sdkHttpResponse"],n),t}(e),n=new Gn;return Object.assign(n,t),n})}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function sr(e){const t={},n=ie(e,["data"]);if(null!=n&&re(t,["data"],n),void 0!==ie(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const s=ie(e,["mimeType"]);return null!=s&&re(t,["mimeType"],s),t}function rr(e){const t={},n=ie(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["mediaResolution"]);null!=n&&re(t,["mediaResolution"],n);const s=ie(e,["codeExecutionResult"]);null!=s&&re(t,["codeExecutionResult"],s);const r=ie(e,["executableCode"]);null!=r&&re(t,["executableCode"],r);const i=ie(e,["fileData"]);null!=i&&re(t,["fileData"],function(e){const t={};if(void 0!==ie(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=ie(e,["fileUri"]);null!=n&&re(t,["fileUri"],n);const s=ie(e,["mimeType"]);null!=s&&re(t,["mimeType"],s);return t}(i));const o=ie(e,["functionCall"]);null!=o&&re(t,["functionCall"],function(e){const t={},n=ie(e,["id"]);null!=n&&re(t,["id"],n);const s=ie(e,["args"]);null!=s&&re(t,["args"],s);const r=ie(e,["name"]);null!=r&&re(t,["name"],r);if(void 0!==ie(e,["partialArgs"]))throw new Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ie(e,["willContinue"]))throw new Error("willContinue parameter is not supported in Gemini API.");return t}(o));const a=ie(e,["functionResponse"]);null!=a&&re(t,["functionResponse"],a);const l=ie(e,["inlineData"]);null!=l&&re(t,["inlineData"],sr(l));const c=ie(e,["text"]);null!=c&&re(t,["text"],c);const d=ie(e,["thought"]);null!=d&&re(t,["thought"],d);const u=ie(e,["thoughtSignature"]);null!=u&&re(t,["thoughtSignature"],u);const p=ie(e,["videoMetadata"]);null!=p&&re(t,["videoMetadata"],p);return t}(e))),re(t,["parts"],e)}const s=ie(e,["role"]);return null!=s&&re(t,["role"],s),t}function ir(e,t){const n=ie(e,["generationConfig"]);void 0!==t&&null!=n&&re(t,["setup","generationConfig"],n);const s=ie(e,["responseModalities"]);void 0!==t&&null!=s&&re(t,["setup","generationConfig","responseModalities"],s);const r=ie(e,["temperature"]);void 0!==t&&null!=r&&re(t,["setup","generationConfig","temperature"],r);const i=ie(e,["topP"]);void 0!==t&&null!=i&&re(t,["setup","generationConfig","topP"],i);const o=ie(e,["topK"]);void 0!==t&&null!=o&&re(t,["setup","generationConfig","topK"],o);const a=ie(e,["maxOutputTokens"]);void 0!==t&&null!=a&&re(t,["setup","generationConfig","maxOutputTokens"],a);const l=ie(e,["mediaResolution"]);void 0!==t&&null!=l&&re(t,["setup","generationConfig","mediaResolution"],l);const c=ie(e,["seed"]);void 0!==t&&null!=c&&re(t,["setup","generationConfig","seed"],c);const d=ie(e,["speechConfig"]);void 0!==t&&null!=d&&re(t,["setup","generationConfig","speechConfig"],ls(d));const u=ie(e,["thinkingConfig"]);void 0!==t&&null!=u&&re(t,["setup","generationConfig","thinkingConfig"],u);const p=ie(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&re(t,["setup","generationConfig","enableAffectiveDialog"],p);const m=ie(e,["systemInstruction"]);void 0!==t&&null!=m&&re(t,["setup","systemInstruction"],rr(ns(m)));const h=ie(e,["tools"]);if(void 0!==t&&null!=h){let e=ds(h);Array.isArray(e)&&(e=e.map(e=>function(e){const t={};if(void 0!==ie(e,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const n=ie(e,["computerUse"]);null!=n&&re(t,["computerUse"],n);const s=ie(e,["fileSearch"]);null!=s&&re(t,["fileSearch"],s);const r=ie(e,["codeExecution"]);null!=r&&re(t,["codeExecution"],r);if(void 0!==ie(e,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const i=ie(e,["functionDeclarations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["functionDeclarations"],e)}const o=ie(e,["googleMaps"]);null!=o&&re(t,["googleMaps"],function(e){const t={};if(void 0!==ie(e,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=ie(e,["enableWidget"]);return null!=n&&re(t,["enableWidget"],n),t}(o));const a=ie(e,["googleSearch"]);null!=a&&re(t,["googleSearch"],function(e){const t={};if(void 0!==ie(e,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ie(e,["blockingConfidence"]))throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=ie(e,["timeRangeFilter"]);return null!=n&&re(t,["timeRangeFilter"],n),t}(a));const l=ie(e,["googleSearchRetrieval"]);null!=l&&re(t,["googleSearchRetrieval"],l);const c=ie(e,["urlContext"]);null!=c&&re(t,["urlContext"],c);return t}(cs(e)))),re(t,["setup","tools"],e)}const g=ie(e,["sessionResumption"]);void 0!==t&&null!=g&&re(t,["setup","sessionResumption"],function(e){const t={},n=ie(e,["handle"]);null!=n&&re(t,["handle"],n);if(void 0!==ie(e,["transparent"]))throw new Error("transparent parameter is not supported in Gemini API.");return t}(g));const f=ie(e,["inputAudioTranscription"]);void 0!==t&&null!=f&&re(t,["setup","inputAudioTranscription"],f);const x=ie(e,["outputAudioTranscription"]);void 0!==t&&null!=x&&re(t,["setup","outputAudioTranscription"],x);const b=ie(e,["realtimeInputConfig"]);void 0!==t&&null!=b&&re(t,["setup","realtimeInputConfig"],b);const v=ie(e,["contextWindowCompression"]);void 0!==t&&null!=v&&re(t,["setup","contextWindowCompression"],v);const y=ie(e,["proactivity"]);if(void 0!==t&&null!=y&&re(t,["setup","proactivity"],y),void 0!==ie(e,["explicitVadSignal"]))throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return{}}function or(e,t){const n=ie(e,["generationConfig"]);void 0!==t&&null!=n&&re(t,["setup","generationConfig"],function(e){const t={},n=ie(e,["modelSelectionConfig"]);null!=n&&re(t,["modelConfig"],n);const s=ie(e,["responseJsonSchema"]);null!=s&&re(t,["responseJsonSchema"],s);const r=ie(e,["audioTimestamp"]);null!=r&&re(t,["audioTimestamp"],r);const i=ie(e,["candidateCount"]);null!=i&&re(t,["candidateCount"],i);const o=ie(e,["enableAffectiveDialog"]);null!=o&&re(t,["enableAffectiveDialog"],o);const a=ie(e,["frequencyPenalty"]);null!=a&&re(t,["frequencyPenalty"],a);const l=ie(e,["logprobs"]);null!=l&&re(t,["logprobs"],l);const c=ie(e,["maxOutputTokens"]);null!=c&&re(t,["maxOutputTokens"],c);const d=ie(e,["mediaResolution"]);null!=d&&re(t,["mediaResolution"],d);const u=ie(e,["presencePenalty"]);null!=u&&re(t,["presencePenalty"],u);const p=ie(e,["responseLogprobs"]);null!=p&&re(t,["responseLogprobs"],p);const m=ie(e,["responseMimeType"]);null!=m&&re(t,["responseMimeType"],m);const h=ie(e,["responseModalities"]);null!=h&&re(t,["responseModalities"],h);const g=ie(e,["responseSchema"]);null!=g&&re(t,["responseSchema"],g);const f=ie(e,["routingConfig"]);null!=f&&re(t,["routingConfig"],f);const x=ie(e,["seed"]);null!=x&&re(t,["seed"],x);const b=ie(e,["speechConfig"]);null!=b&&re(t,["speechConfig"],b);const v=ie(e,["stopSequences"]);null!=v&&re(t,["stopSequences"],v);const y=ie(e,["temperature"]);null!=y&&re(t,["temperature"],y);const w=ie(e,["thinkingConfig"]);null!=w&&re(t,["thinkingConfig"],w);const N=ie(e,["topK"]);null!=N&&re(t,["topK"],N);const j=ie(e,["topP"]);if(null!=j&&re(t,["topP"],j),void 0!==ie(e,["enableEnhancedCivicAnswers"]))throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(n));const s=ie(e,["responseModalities"]);void 0!==t&&null!=s&&re(t,["setup","generationConfig","responseModalities"],s);const r=ie(e,["temperature"]);void 0!==t&&null!=r&&re(t,["setup","generationConfig","temperature"],r);const i=ie(e,["topP"]);void 0!==t&&null!=i&&re(t,["setup","generationConfig","topP"],i);const o=ie(e,["topK"]);void 0!==t&&null!=o&&re(t,["setup","generationConfig","topK"],o);const a=ie(e,["maxOutputTokens"]);void 0!==t&&null!=a&&re(t,["setup","generationConfig","maxOutputTokens"],a);const l=ie(e,["mediaResolution"]);void 0!==t&&null!=l&&re(t,["setup","generationConfig","mediaResolution"],l);const c=ie(e,["seed"]);void 0!==t&&null!=c&&re(t,["setup","generationConfig","seed"],c);const d=ie(e,["speechConfig"]);void 0!==t&&null!=d&&re(t,["setup","generationConfig","speechConfig"],ls(d));const u=ie(e,["thinkingConfig"]);void 0!==t&&null!=u&&re(t,["setup","generationConfig","thinkingConfig"],u);const p=ie(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&re(t,["setup","generationConfig","enableAffectiveDialog"],p);const m=ie(e,["systemInstruction"]);void 0!==t&&null!=m&&re(t,["setup","systemInstruction"],ns(m));const h=ie(e,["tools"]);if(void 0!==t&&null!=h){let e=ds(h);Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["retrieval"]);null!=n&&re(t,["retrieval"],n);const s=ie(e,["computerUse"]);null!=s&&re(t,["computerUse"],s);if(void 0!==ie(e,["fileSearch"]))throw new Error("fileSearch parameter is not supported in Vertex AI.");const r=ie(e,["codeExecution"]);null!=r&&re(t,["codeExecution"],r);const i=ie(e,["enterpriseWebSearch"]);null!=i&&re(t,["enterpriseWebSearch"],i);const o=ie(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["description"]);null!=n&&re(t,["description"],n);const s=ie(e,["name"]);null!=s&&re(t,["name"],s);const r=ie(e,["parameters"]);null!=r&&re(t,["parameters"],r);const i=ie(e,["parametersJsonSchema"]);null!=i&&re(t,["parametersJsonSchema"],i);const o=ie(e,["response"]);null!=o&&re(t,["response"],o);const a=ie(e,["responseJsonSchema"]);if(null!=a&&re(t,["responseJsonSchema"],a),void 0!==ie(e,["behavior"]))throw new Error("behavior parameter is not supported in Vertex AI.");return t}(e))),re(t,["functionDeclarations"],e)}const a=ie(e,["googleMaps"]);null!=a&&re(t,["googleMaps"],a);const l=ie(e,["googleSearch"]);null!=l&&re(t,["googleSearch"],l);const c=ie(e,["googleSearchRetrieval"]);null!=c&&re(t,["googleSearchRetrieval"],c);const d=ie(e,["urlContext"]);null!=d&&re(t,["urlContext"],d);return t}(cs(e)))),re(t,["setup","tools"],e)}const g=ie(e,["sessionResumption"]);void 0!==t&&null!=g&&re(t,["setup","sessionResumption"],g);const f=ie(e,["inputAudioTranscription"]);void 0!==t&&null!=f&&re(t,["setup","inputAudioTranscription"],f);const x=ie(e,["outputAudioTranscription"]);void 0!==t&&null!=x&&re(t,["setup","outputAudioTranscription"],x);const b=ie(e,["realtimeInputConfig"]);void 0!==t&&null!=b&&re(t,["setup","realtimeInputConfig"],b);const v=ie(e,["contextWindowCompression"]);void 0!==t&&null!=v&&re(t,["setup","contextWindowCompression"],v);const y=ie(e,["proactivity"]);void 0!==t&&null!=y&&re(t,["setup","proactivity"],y);const w=ie(e,["explicitVadSignal"]);return void 0!==t&&null!=w&&re(t,["setup","explicitVadSignal"],w),{}}function ar(e){const t={},n=ie(e,["media"]);if(null!=n){let e=$n(n);Array.isArray(e)&&(e=e.map(e=>sr(e))),re(t,["mediaChunks"],e)}const s=ie(e,["audio"]);null!=s&&re(t,["audio"],sr(Kn(s)));const r=ie(e,["audioStreamEnd"]);null!=r&&re(t,["audioStreamEnd"],r);const i=ie(e,["video"]);null!=i&&re(t,["video"],sr(Yn(i)));const o=ie(e,["text"]);null!=o&&re(t,["text"],o);const a=ie(e,["activityStart"]);null!=a&&re(t,["activityStart"],a);const l=ie(e,["activityEnd"]);return null!=l&&re(t,["activityEnd"],l),t}function lr(e){const t={},n=ie(e,["media"]);if(null!=n){let e=$n(n);Array.isArray(e)&&(e=e.map(e=>e)),re(t,["mediaChunks"],e)}const s=ie(e,["audio"]);null!=s&&re(t,["audio"],Kn(s));const r=ie(e,["audioStreamEnd"]);null!=r&&re(t,["audioStreamEnd"],r);const i=ie(e,["video"]);null!=i&&re(t,["video"],Yn(i));const o=ie(e,["text"]);null!=o&&re(t,["text"],o);const a=ie(e,["activityStart"]);null!=a&&re(t,["activityStart"],a);const l=ie(e,["activityEnd"]);return null!=l&&re(t,["activityEnd"],l),t}function cr(e){const t={},n=ie(e,["setupComplete"]);null!=n&&re(t,["setupComplete"],n);const s=ie(e,["serverContent"]);null!=s&&re(t,["serverContent"],s);const r=ie(e,["toolCall"]);null!=r&&re(t,["toolCall"],r);const i=ie(e,["toolCallCancellation"]);null!=i&&re(t,["toolCallCancellation"],i);const o=ie(e,["usageMetadata"]);null!=o&&re(t,["usageMetadata"],function(e){const t={},n=ie(e,["promptTokenCount"]);null!=n&&re(t,["promptTokenCount"],n);const s=ie(e,["cachedContentTokenCount"]);null!=s&&re(t,["cachedContentTokenCount"],s);const r=ie(e,["candidatesTokenCount"]);null!=r&&re(t,["responseTokenCount"],r);const i=ie(e,["toolUsePromptTokenCount"]);null!=i&&re(t,["toolUsePromptTokenCount"],i);const o=ie(e,["thoughtsTokenCount"]);null!=o&&re(t,["thoughtsTokenCount"],o);const a=ie(e,["totalTokenCount"]);null!=a&&re(t,["totalTokenCount"],a);const l=ie(e,["promptTokensDetails"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["promptTokensDetails"],e)}const c=ie(e,["cacheTokensDetails"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["cacheTokensDetails"],e)}const d=ie(e,["candidatesTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["responseTokensDetails"],e)}const u=ie(e,["toolUsePromptTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["toolUsePromptTokensDetails"],e)}const p=ie(e,["trafficType"]);null!=p&&re(t,["trafficType"],p);return t}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(o));const a=ie(e,["goAway"]);null!=a&&re(t,["goAway"],a);const l=ie(e,["sessionResumptionUpdate"]);null!=l&&re(t,["sessionResumptionUpdate"],l);const c=ie(e,["voiceActivityDetectionSignal"]);return null!=c&&re(t,["voiceActivityDetectionSignal"],c),t}function dr(e){const t={},n=ie(e,["content"]);null!=n&&re(t,["content"],n);const s=ie(e,["citationMetadata"]);null!=s&&re(t,["citationMetadata"],function(e){const t={},n=ie(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["citations"],e)}return t}(s));const r=ie(e,["tokenCount"]);null!=r&&re(t,["tokenCount"],r);const i=ie(e,["finishReason"]);null!=i&&re(t,["finishReason"],i);const o=ie(e,["avgLogprobs"]);null!=o&&re(t,["avgLogprobs"],o);const a=ie(e,["groundingMetadata"]);null!=a&&re(t,["groundingMetadata"],a);const l=ie(e,["index"]);null!=l&&re(t,["index"],l);const c=ie(e,["logprobsResult"]);null!=c&&re(t,["logprobsResult"],c);const d=ie(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["safetyRatings"],e)}const u=ie(e,["urlContextMetadata"]);return null!=u&&re(t,["urlContextMetadata"],u),t}function ur(e){const t={},n=ie(e,["values"]);null!=n&&re(t,["values"],n);const s=ie(e,["statistics"]);return null!=s&&re(t,["statistics"],function(e){const t={},n=ie(e,["truncated"]);null!=n&&re(t,["truncated"],n);const s=ie(e,["token_count"]);null!=s&&re(t,["tokenCount"],s);return t}(s)),t}function pr(e){const t={},n=ie(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["mediaResolution"]);null!=n&&re(t,["mediaResolution"],n);const s=ie(e,["codeExecutionResult"]);null!=s&&re(t,["codeExecutionResult"],s);const r=ie(e,["executableCode"]);null!=r&&re(t,["executableCode"],r);const i=ie(e,["fileData"]);null!=i&&re(t,["fileData"],function(e){const t={};if(void 0!==ie(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=ie(e,["fileUri"]);null!=n&&re(t,["fileUri"],n);const s=ie(e,["mimeType"]);null!=s&&re(t,["mimeType"],s);return t}(i));const o=ie(e,["functionCall"]);null!=o&&re(t,["functionCall"],function(e){const t={},n=ie(e,["id"]);null!=n&&re(t,["id"],n);const s=ie(e,["args"]);null!=s&&re(t,["args"],s);const r=ie(e,["name"]);null!=r&&re(t,["name"],r);if(void 0!==ie(e,["partialArgs"]))throw new Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ie(e,["willContinue"]))throw new Error("willContinue parameter is not supported in Gemini API.");return t}(o));const a=ie(e,["functionResponse"]);null!=a&&re(t,["functionResponse"],a);const l=ie(e,["inlineData"]);null!=l&&re(t,["inlineData"],function(e){const t={},n=ie(e,["data"]);if(null!=n&&re(t,["data"],n),void 0!==ie(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const s=ie(e,["mimeType"]);return null!=s&&re(t,["mimeType"],s),t}(l));const c=ie(e,["text"]);null!=c&&re(t,["text"],c);const d=ie(e,["thought"]);null!=d&&re(t,["thought"],d);const u=ie(e,["thoughtSignature"]);null!=u&&re(t,["thoughtSignature"],u);const p=ie(e,["videoMetadata"]);null!=p&&re(t,["videoMetadata"],p);return t}(e))),re(t,["parts"],e)}const s=ie(e,["role"]);return null!=s&&re(t,["role"],s),t}function mr(e,t){const n=ie(e,["systemInstruction"]);void 0!==t&&null!=n&&re(t,["systemInstruction"],ns(n));const s=ie(e,["tools"]);if(void 0!==t&&null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>Jr(e))),re(t,["tools"],e)}const r=ie(e,["generationConfig"]);return void 0!==t&&null!=r&&re(t,["generationConfig"],function(e){const t={},n=ie(e,["modelSelectionConfig"]);null!=n&&re(t,["modelConfig"],n);const s=ie(e,["responseJsonSchema"]);null!=s&&re(t,["responseJsonSchema"],s);const r=ie(e,["audioTimestamp"]);null!=r&&re(t,["audioTimestamp"],r);const i=ie(e,["candidateCount"]);null!=i&&re(t,["candidateCount"],i);const o=ie(e,["enableAffectiveDialog"]);null!=o&&re(t,["enableAffectiveDialog"],o);const a=ie(e,["frequencyPenalty"]);null!=a&&re(t,["frequencyPenalty"],a);const l=ie(e,["logprobs"]);null!=l&&re(t,["logprobs"],l);const c=ie(e,["maxOutputTokens"]);null!=c&&re(t,["maxOutputTokens"],c);const d=ie(e,["mediaResolution"]);null!=d&&re(t,["mediaResolution"],d);const u=ie(e,["presencePenalty"]);null!=u&&re(t,["presencePenalty"],u);const p=ie(e,["responseLogprobs"]);null!=p&&re(t,["responseLogprobs"],p);const m=ie(e,["responseMimeType"]);null!=m&&re(t,["responseMimeType"],m);const h=ie(e,["responseModalities"]);null!=h&&re(t,["responseModalities"],h);const g=ie(e,["responseSchema"]);null!=g&&re(t,["responseSchema"],g);const f=ie(e,["routingConfig"]);null!=f&&re(t,["routingConfig"],f);const x=ie(e,["seed"]);null!=x&&re(t,["seed"],x);const b=ie(e,["speechConfig"]);null!=b&&re(t,["speechConfig"],b);const v=ie(e,["stopSequences"]);null!=v&&re(t,["stopSequences"],v);const y=ie(e,["temperature"]);null!=y&&re(t,["temperature"],y);const w=ie(e,["thinkingConfig"]);null!=w&&re(t,["thinkingConfig"],w);const N=ie(e,["topK"]);null!=N&&re(t,["topK"],N);const j=ie(e,["topP"]);null!=j&&re(t,["topP"],j);if(void 0!==ie(e,["enableEnhancedCivicAnswers"]))throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(r)),{}}function hr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["contents"]);if(null!=r){let e=rs(r);Array.isArray(e)&&(e=e.map(e=>pr(e))),re(n,["contents"],e)}const i=ie(t,["config"]);return null!=i&&function(e){if(void 0!==ie(e,["systemInstruction"]))throw new Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==ie(e,["tools"]))throw new Error("tools parameter is not supported in Gemini API.");if(void 0!==ie(e,["generationConfig"]))throw new Error("generationConfig parameter is not supported in Gemini API.")}(i),n}function gr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["prompt"]);null!=r&&re(n,["instances[0]","prompt"],r);const i=ie(t,["referenceImages"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["referenceImage"]);null!=n&&re(t,["referenceImage"],Mr(n));const s=ie(e,["referenceId"]);null!=s&&re(t,["referenceId"],s);const r=ie(e,["referenceType"]);null!=r&&re(t,["referenceType"],r);const i=ie(e,["maskImageConfig"]);null!=i&&re(t,["maskImageConfig"],function(e){const t={},n=ie(e,["maskMode"]);null!=n&&re(t,["maskMode"],n);const s=ie(e,["segmentationClasses"]);null!=s&&re(t,["maskClasses"],s);const r=ie(e,["maskDilation"]);null!=r&&re(t,["dilation"],r);return t}(i));const o=ie(e,["controlImageConfig"]);null!=o&&re(t,["controlImageConfig"],function(e){const t={},n=ie(e,["controlType"]);null!=n&&re(t,["controlType"],n);const s=ie(e,["enableControlImageComputation"]);return null!=s&&re(t,["computeControl"],s),t}(o));const a=ie(e,["styleImageConfig"]);null!=a&&re(t,["styleImageConfig"],a);const l=ie(e,["subjectImageConfig"]);null!=l&&re(t,["subjectImageConfig"],l);return t}(e))),re(n,["instances[0]","referenceImages"],e)}const o=ie(t,["config"]);return null!=o&&function(e,t){const n=ie(e,["outputGcsUri"]);void 0!==t&&null!=n&&re(t,["parameters","storageUri"],n);const s=ie(e,["negativePrompt"]);void 0!==t&&null!=s&&re(t,["parameters","negativePrompt"],s);const r=ie(e,["numberOfImages"]);void 0!==t&&null!=r&&re(t,["parameters","sampleCount"],r);const i=ie(e,["aspectRatio"]);void 0!==t&&null!=i&&re(t,["parameters","aspectRatio"],i);const o=ie(e,["guidanceScale"]);void 0!==t&&null!=o&&re(t,["parameters","guidanceScale"],o);const a=ie(e,["seed"]);void 0!==t&&null!=a&&re(t,["parameters","seed"],a);const l=ie(e,["safetyFilterLevel"]);void 0!==t&&null!=l&&re(t,["parameters","safetySetting"],l);const c=ie(e,["personGeneration"]);void 0!==t&&null!=c&&re(t,["parameters","personGeneration"],c);const d=ie(e,["includeSafetyAttributes"]);void 0!==t&&null!=d&&re(t,["parameters","includeSafetyAttributes"],d);const u=ie(e,["includeRaiReason"]);void 0!==t&&null!=u&&re(t,["parameters","includeRaiReason"],u);const p=ie(e,["language"]);void 0!==t&&null!=p&&re(t,["parameters","language"],p);const m=ie(e,["outputMimeType"]);void 0!==t&&null!=m&&re(t,["parameters","outputOptions","mimeType"],m);const h=ie(e,["outputCompressionQuality"]);void 0!==t&&null!=h&&re(t,["parameters","outputOptions","compressionQuality"],h);const g=ie(e,["addWatermark"]);void 0!==t&&null!=g&&re(t,["parameters","addWatermark"],g);const f=ie(e,["labels"]);void 0!==t&&null!=f&&re(t,["labels"],f);const x=ie(e,["editMode"]);void 0!==t&&null!=x&&re(t,["parameters","editMode"],x);const b=ie(e,["baseSteps"]);void 0!==t&&null!=b&&re(t,["parameters","editConfig","baseSteps"],b)}(o,n),n}function fr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["contents"]);if(null!=r){let t=ss(e,r);Array.isArray(t)&&(t=t.map(e=>e)),re(n,["requests[]","content"],t)}const i=ie(t,["config"]);null!=i&&function(e,t){const n=ie(e,["taskType"]);void 0!==t&&null!=n&&re(t,["requests[]","taskType"],n);const s=ie(e,["title"]);void 0!==t&&null!=s&&re(t,["requests[]","title"],s);const r=ie(e,["outputDimensionality"]);if(void 0!==t&&null!=r&&re(t,["requests[]","outputDimensionality"],r),void 0!==ie(e,["mimeType"]))throw new Error("mimeType parameter is not supported in Gemini API.");if(void 0!==ie(e,["autoTruncate"]))throw new Error("autoTruncate parameter is not supported in Gemini API.")}(i,n);const o=ie(t,["model"]);return void 0!==o&&re(n,["requests[]","model"],Wn(e,o)),n}function xr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["contents"]);if(null!=r){let t=ss(e,r);Array.isArray(t)&&(t=t.map(e=>e)),re(n,["instances[]","content"],t)}const i=ie(t,["config"]);return null!=i&&function(e,t){const n=ie(e,["taskType"]);void 0!==t&&null!=n&&re(t,["instances[]","task_type"],n);const s=ie(e,["title"]);void 0!==t&&null!=s&&re(t,["instances[]","title"],s);const r=ie(e,["outputDimensionality"]);void 0!==t&&null!=r&&re(t,["parameters","outputDimensionality"],r);const i=ie(e,["mimeType"]);void 0!==t&&null!=i&&re(t,["instances[]","mimeType"],i);const o=ie(e,["autoTruncate"]);void 0!==t&&null!=o&&re(t,["parameters","autoTruncate"],o)}(i,n),n}function br(e,t,n){const s={},r=ie(t,["systemInstruction"]);void 0!==n&&null!=r&&re(n,["systemInstruction"],pr(ns(r)));const i=ie(t,["temperature"]);null!=i&&re(s,["temperature"],i);const o=ie(t,["topP"]);null!=o&&re(s,["topP"],o);const a=ie(t,["topK"]);null!=a&&re(s,["topK"],a);const l=ie(t,["candidateCount"]);null!=l&&re(s,["candidateCount"],l);const c=ie(t,["maxOutputTokens"]);null!=c&&re(s,["maxOutputTokens"],c);const d=ie(t,["stopSequences"]);null!=d&&re(s,["stopSequences"],d);const u=ie(t,["responseLogprobs"]);null!=u&&re(s,["responseLogprobs"],u);const p=ie(t,["logprobs"]);null!=p&&re(s,["logprobs"],p);const m=ie(t,["presencePenalty"]);null!=m&&re(s,["presencePenalty"],m);const h=ie(t,["frequencyPenalty"]);null!=h&&re(s,["frequencyPenalty"],h);const g=ie(t,["seed"]);null!=g&&re(s,["seed"],g);const f=ie(t,["responseMimeType"]);null!=f&&re(s,["responseMimeType"],f);const x=ie(t,["responseSchema"]);null!=x&&re(s,["responseSchema"],os(x));const b=ie(t,["responseJsonSchema"]);if(null!=b&&re(s,["responseJsonSchema"],b),void 0!==ie(t,["routingConfig"]))throw new Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==ie(t,["modelSelectionConfig"]))throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const v=ie(t,["safetySettings"]);if(void 0!==n&&null!=v){let e=v;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["category"]);null!=n&&re(t,["category"],n);if(void 0!==ie(e,["method"]))throw new Error("method parameter is not supported in Gemini API.");const s=ie(e,["threshold"]);null!=s&&re(t,["threshold"],s);return t}(e))),re(n,["safetySettings"],e)}const y=ie(t,["tools"]);if(void 0!==n&&null!=y){let e=ds(y);Array.isArray(e)&&(e=e.map(e=>function(e){const t={};if(void 0!==ie(e,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const n=ie(e,["computerUse"]);null!=n&&re(t,["computerUse"],n);const s=ie(e,["fileSearch"]);null!=s&&re(t,["fileSearch"],s);const r=ie(e,["codeExecution"]);null!=r&&re(t,["codeExecution"],r);if(void 0!==ie(e,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const i=ie(e,["functionDeclarations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["functionDeclarations"],e)}const o=ie(e,["googleMaps"]);null!=o&&re(t,["googleMaps"],function(e){const t={};if(void 0!==ie(e,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=ie(e,["enableWidget"]);null!=n&&re(t,["enableWidget"],n);return t}(o));const a=ie(e,["googleSearch"]);null!=a&&re(t,["googleSearch"],function(e){const t={};if(void 0!==ie(e,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ie(e,["blockingConfidence"]))throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=ie(e,["timeRangeFilter"]);null!=n&&re(t,["timeRangeFilter"],n);return t}(a));const l=ie(e,["googleSearchRetrieval"]);null!=l&&re(t,["googleSearchRetrieval"],l);const c=ie(e,["urlContext"]);null!=c&&re(t,["urlContext"],c);return t}(cs(e)))),re(n,["tools"],e)}const w=ie(t,["toolConfig"]);if(void 0!==n&&null!=w&&re(n,["toolConfig"],function(e){const t={},n=ie(e,["retrievalConfig"]);null!=n&&re(t,["retrievalConfig"],n);const s=ie(e,["functionCallingConfig"]);null!=s&&re(t,["functionCallingConfig"],function(e){const t={},n=ie(e,["allowedFunctionNames"]);null!=n&&re(t,["allowedFunctionNames"],n);const s=ie(e,["mode"]);if(null!=s&&re(t,["mode"],s),void 0!==ie(e,["streamFunctionCallArguments"]))throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(s));return t}(w)),void 0!==ie(t,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");const N=ie(t,["cachedContent"]);void 0!==n&&null!=N&&re(n,["cachedContent"],us(e,N));const j=ie(t,["responseModalities"]);null!=j&&re(s,["responseModalities"],j);const S=ie(t,["mediaResolution"]);null!=S&&re(s,["mediaResolution"],S);const E=ie(t,["speechConfig"]);if(null!=E&&re(s,["speechConfig"],as(E)),void 0!==ie(t,["audioTimestamp"]))throw new Error("audioTimestamp parameter is not supported in Gemini API.");const C=ie(t,["thinkingConfig"]);null!=C&&re(s,["thinkingConfig"],C);const _=ie(t,["imageConfig"]);null!=_&&re(s,["imageConfig"],function(e){const t={},n=ie(e,["aspectRatio"]);null!=n&&re(t,["aspectRatio"],n);const s=ie(e,["imageSize"]);null!=s&&re(t,["imageSize"],s);if(void 0!==ie(e,["personGeneration"]))throw new Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==ie(e,["outputMimeType"]))throw new Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==ie(e,["outputCompressionQuality"]))throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(_));const k=ie(t,["enableEnhancedCivicAnswers"]);return null!=k&&re(s,["enableEnhancedCivicAnswers"],k),s}function vr(e,t,n){const s={},r=ie(t,["systemInstruction"]);void 0!==n&&null!=r&&re(n,["systemInstruction"],ns(r));const i=ie(t,["temperature"]);null!=i&&re(s,["temperature"],i);const o=ie(t,["topP"]);null!=o&&re(s,["topP"],o);const a=ie(t,["topK"]);null!=a&&re(s,["topK"],a);const l=ie(t,["candidateCount"]);null!=l&&re(s,["candidateCount"],l);const c=ie(t,["maxOutputTokens"]);null!=c&&re(s,["maxOutputTokens"],c);const d=ie(t,["stopSequences"]);null!=d&&re(s,["stopSequences"],d);const u=ie(t,["responseLogprobs"]);null!=u&&re(s,["responseLogprobs"],u);const p=ie(t,["logprobs"]);null!=p&&re(s,["logprobs"],p);const m=ie(t,["presencePenalty"]);null!=m&&re(s,["presencePenalty"],m);const h=ie(t,["frequencyPenalty"]);null!=h&&re(s,["frequencyPenalty"],h);const g=ie(t,["seed"]);null!=g&&re(s,["seed"],g);const f=ie(t,["responseMimeType"]);null!=f&&re(s,["responseMimeType"],f);const x=ie(t,["responseSchema"]);null!=x&&re(s,["responseSchema"],os(x));const b=ie(t,["responseJsonSchema"]);null!=b&&re(s,["responseJsonSchema"],b);const v=ie(t,["routingConfig"]);null!=v&&re(s,["routingConfig"],v);const y=ie(t,["modelSelectionConfig"]);null!=y&&re(s,["modelConfig"],y);const w=ie(t,["safetySettings"]);if(void 0!==n&&null!=w){let e=w;Array.isArray(e)&&(e=e.map(e=>e)),re(n,["safetySettings"],e)}const N=ie(t,["tools"]);if(void 0!==n&&null!=N){let e=ds(N);Array.isArray(e)&&(e=e.map(e=>Jr(cs(e)))),re(n,["tools"],e)}const j=ie(t,["toolConfig"]);void 0!==n&&null!=j&&re(n,["toolConfig"],j);const S=ie(t,["labels"]);void 0!==n&&null!=S&&re(n,["labels"],S);const E=ie(t,["cachedContent"]);void 0!==n&&null!=E&&re(n,["cachedContent"],us(e,E));const C=ie(t,["responseModalities"]);null!=C&&re(s,["responseModalities"],C);const _=ie(t,["mediaResolution"]);null!=_&&re(s,["mediaResolution"],_);const k=ie(t,["speechConfig"]);null!=k&&re(s,["speechConfig"],as(k));const I=ie(t,["audioTimestamp"]);null!=I&&re(s,["audioTimestamp"],I);const A=ie(t,["thinkingConfig"]);null!=A&&re(s,["thinkingConfig"],A);const T=ie(t,["imageConfig"]);if(null!=T&&re(s,["imageConfig"],function(e){const t={},n=ie(e,["aspectRatio"]);null!=n&&re(t,["aspectRatio"],n);const s=ie(e,["imageSize"]);null!=s&&re(t,["imageSize"],s);const r=ie(e,["personGeneration"]);null!=r&&re(t,["personGeneration"],r);const i=ie(e,["outputMimeType"]);null!=i&&re(t,["imageOutputOptions","mimeType"],i);const o=ie(e,["outputCompressionQuality"]);null!=o&&re(t,["imageOutputOptions","compressionQuality"],o);return t}(T)),void 0!==ie(t,["enableEnhancedCivicAnswers"]))throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return s}function yr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["contents"]);if(null!=r){let e=rs(r);Array.isArray(e)&&(e=e.map(e=>pr(e))),re(n,["contents"],e)}const i=ie(t,["config"]);return null!=i&&re(n,["generationConfig"],br(e,i,n)),n}function wr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["contents"]);if(null!=r){let e=rs(r);Array.isArray(e)&&(e=e.map(e=>e)),re(n,["contents"],e)}const i=ie(t,["config"]);return null!=i&&re(n,["generationConfig"],vr(e,i,n)),n}function Nr(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["candidates"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>dr(e))),re(t,["candidates"],e)}const r=ie(e,["modelVersion"]);null!=r&&re(t,["modelVersion"],r);const i=ie(e,["promptFeedback"]);null!=i&&re(t,["promptFeedback"],i);const o=ie(e,["responseId"]);null!=o&&re(t,["responseId"],o);const a=ie(e,["usageMetadata"]);return null!=a&&re(t,["usageMetadata"],a),t}function jr(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["candidates"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["candidates"],e)}const r=ie(e,["createTime"]);null!=r&&re(t,["createTime"],r);const i=ie(e,["modelVersion"]);null!=i&&re(t,["modelVersion"],i);const o=ie(e,["promptFeedback"]);null!=o&&re(t,["promptFeedback"],o);const a=ie(e,["responseId"]);null!=a&&re(t,["responseId"],a);const l=ie(e,["usageMetadata"]);return null!=l&&re(t,["usageMetadata"],l),t}function Sr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["prompt"]);null!=r&&re(n,["instances[0]","prompt"],r);const i=ie(t,["config"]);return null!=i&&function(e,t){if(void 0!==ie(e,["outputGcsUri"]))throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==ie(e,["negativePrompt"]))throw new Error("negativePrompt parameter is not supported in Gemini API.");const n=ie(e,["numberOfImages"]);void 0!==t&&null!=n&&re(t,["parameters","sampleCount"],n);const s=ie(e,["aspectRatio"]);void 0!==t&&null!=s&&re(t,["parameters","aspectRatio"],s);const r=ie(e,["guidanceScale"]);if(void 0!==t&&null!=r&&re(t,["parameters","guidanceScale"],r),void 0!==ie(e,["seed"]))throw new Error("seed parameter is not supported in Gemini API.");const i=ie(e,["safetyFilterLevel"]);void 0!==t&&null!=i&&re(t,["parameters","safetySetting"],i);const o=ie(e,["personGeneration"]);void 0!==t&&null!=o&&re(t,["parameters","personGeneration"],o);const a=ie(e,["includeSafetyAttributes"]);void 0!==t&&null!=a&&re(t,["parameters","includeSafetyAttributes"],a);const l=ie(e,["includeRaiReason"]);void 0!==t&&null!=l&&re(t,["parameters","includeRaiReason"],l);const c=ie(e,["language"]);void 0!==t&&null!=c&&re(t,["parameters","language"],c);const d=ie(e,["outputMimeType"]);void 0!==t&&null!=d&&re(t,["parameters","outputOptions","mimeType"],d);const u=ie(e,["outputCompressionQuality"]);if(void 0!==t&&null!=u&&re(t,["parameters","outputOptions","compressionQuality"],u),void 0!==ie(e,["addWatermark"]))throw new Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==ie(e,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");const p=ie(e,["imageSize"]);if(void 0!==t&&null!=p&&re(t,["parameters","sampleImageSize"],p),void 0!==ie(e,["enhancePrompt"]))throw new Error("enhancePrompt parameter is not supported in Gemini API.")}(i,n),n}function Er(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["prompt"]);null!=r&&re(n,["instances[0]","prompt"],r);const i=ie(t,["config"]);return null!=i&&function(e,t){const n=ie(e,["outputGcsUri"]);void 0!==t&&null!=n&&re(t,["parameters","storageUri"],n);const s=ie(e,["negativePrompt"]);void 0!==t&&null!=s&&re(t,["parameters","negativePrompt"],s);const r=ie(e,["numberOfImages"]);void 0!==t&&null!=r&&re(t,["parameters","sampleCount"],r);const i=ie(e,["aspectRatio"]);void 0!==t&&null!=i&&re(t,["parameters","aspectRatio"],i);const o=ie(e,["guidanceScale"]);void 0!==t&&null!=o&&re(t,["parameters","guidanceScale"],o);const a=ie(e,["seed"]);void 0!==t&&null!=a&&re(t,["parameters","seed"],a);const l=ie(e,["safetyFilterLevel"]);void 0!==t&&null!=l&&re(t,["parameters","safetySetting"],l);const c=ie(e,["personGeneration"]);void 0!==t&&null!=c&&re(t,["parameters","personGeneration"],c);const d=ie(e,["includeSafetyAttributes"]);void 0!==t&&null!=d&&re(t,["parameters","includeSafetyAttributes"],d);const u=ie(e,["includeRaiReason"]);void 0!==t&&null!=u&&re(t,["parameters","includeRaiReason"],u);const p=ie(e,["language"]);void 0!==t&&null!=p&&re(t,["parameters","language"],p);const m=ie(e,["outputMimeType"]);void 0!==t&&null!=m&&re(t,["parameters","outputOptions","mimeType"],m);const h=ie(e,["outputCompressionQuality"]);void 0!==t&&null!=h&&re(t,["parameters","outputOptions","compressionQuality"],h);const g=ie(e,["addWatermark"]);void 0!==t&&null!=g&&re(t,["parameters","addWatermark"],g);const f=ie(e,["labels"]);void 0!==t&&null!=f&&re(t,["labels"],f);const x=ie(e,["imageSize"]);void 0!==t&&null!=x&&re(t,["parameters","sampleImageSize"],x);const b=ie(e,["enhancePrompt"]);void 0!==t&&null!=b&&re(t,["parameters","enhancePrompt"],b)}(i,n),n}function Cr(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["predictions"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["_self"]);null!=n&&re(t,["image"],function(e){const t={},n=ie(e,["bytesBase64Encoded"]);null!=n&&re(t,["imageBytes"],ms(n));const s=ie(e,["mimeType"]);null!=s&&re(t,["mimeType"],s);return t}(n));const s=ie(e,["raiFilteredReason"]);null!=s&&re(t,["raiFilteredReason"],s);const r=ie(e,["_self"]);null!=r&&re(t,["safetyAttributes"],Br(r));return t}(e))),re(t,["generatedImages"],e)}const r=ie(e,["positivePromptSafetyAttributes"]);return null!=r&&re(t,["positivePromptSafetyAttributes"],Br(r)),t}function _r(e,t){const n=ie(e,["numberOfVideos"]);if(void 0!==t&&null!=n&&re(t,["parameters","sampleCount"],n),void 0!==ie(e,["outputGcsUri"]))throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==ie(e,["fps"]))throw new Error("fps parameter is not supported in Gemini API.");const s=ie(e,["durationSeconds"]);if(void 0!==t&&null!=s&&re(t,["parameters","durationSeconds"],s),void 0!==ie(e,["seed"]))throw new Error("seed parameter is not supported in Gemini API.");const r=ie(e,["aspectRatio"]);void 0!==t&&null!=r&&re(t,["parameters","aspectRatio"],r);const i=ie(e,["resolution"]);void 0!==t&&null!=i&&re(t,["parameters","resolution"],i);const o=ie(e,["personGeneration"]);if(void 0!==t&&null!=o&&re(t,["parameters","personGeneration"],o),void 0!==ie(e,["pubsubTopic"]))throw new Error("pubsubTopic parameter is not supported in Gemini API.");const a=ie(e,["negativePrompt"]);void 0!==t&&null!=a&&re(t,["parameters","negativePrompt"],a);const l=ie(e,["enhancePrompt"]);if(void 0!==t&&null!=l&&re(t,["parameters","enhancePrompt"],l),void 0!==ie(e,["generateAudio"]))throw new Error("generateAudio parameter is not supported in Gemini API.");const c=ie(e,["lastFrame"]);void 0!==t&&null!=c&&re(t,["instances[0]","lastFrame"],Lr(c));const d=ie(e,["referenceImages"]);if(void 0!==t&&null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["image"]);null!=n&&re(t,["image"],Lr(n));const s=ie(e,["referenceType"]);null!=s&&re(t,["referenceType"],s);return t}(e))),re(t,["instances[0]","referenceImages"],e)}if(void 0!==ie(e,["mask"]))throw new Error("mask parameter is not supported in Gemini API.");if(void 0!==ie(e,["compressionQuality"]))throw new Error("compressionQuality parameter is not supported in Gemini API.");return{}}function kr(e,t){const n=ie(e,["numberOfVideos"]);void 0!==t&&null!=n&&re(t,["parameters","sampleCount"],n);const s=ie(e,["outputGcsUri"]);void 0!==t&&null!=s&&re(t,["parameters","storageUri"],s);const r=ie(e,["fps"]);void 0!==t&&null!=r&&re(t,["parameters","fps"],r);const i=ie(e,["durationSeconds"]);void 0!==t&&null!=i&&re(t,["parameters","durationSeconds"],i);const o=ie(e,["seed"]);void 0!==t&&null!=o&&re(t,["parameters","seed"],o);const a=ie(e,["aspectRatio"]);void 0!==t&&null!=a&&re(t,["parameters","aspectRatio"],a);const l=ie(e,["resolution"]);void 0!==t&&null!=l&&re(t,["parameters","resolution"],l);const c=ie(e,["personGeneration"]);void 0!==t&&null!=c&&re(t,["parameters","personGeneration"],c);const d=ie(e,["pubsubTopic"]);void 0!==t&&null!=d&&re(t,["parameters","pubsubTopic"],d);const u=ie(e,["negativePrompt"]);void 0!==t&&null!=u&&re(t,["parameters","negativePrompt"],u);const p=ie(e,["enhancePrompt"]);void 0!==t&&null!=p&&re(t,["parameters","enhancePrompt"],p);const m=ie(e,["generateAudio"]);void 0!==t&&null!=m&&re(t,["parameters","generateAudio"],m);const h=ie(e,["lastFrame"]);void 0!==t&&null!=h&&re(t,["instances[0]","lastFrame"],Mr(h));const g=ie(e,["referenceImages"]);if(void 0!==t&&null!=g){let e=g;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["image"]);null!=n&&re(t,["image"],Mr(n));const s=ie(e,["referenceType"]);null!=s&&re(t,["referenceType"],s);return t}(e))),re(t,["instances[0]","referenceImages"],e)}const f=ie(e,["mask"]);void 0!==t&&null!=f&&re(t,["instances[0]","mask"],function(e){const t={},n=ie(e,["image"]);null!=n&&re(t,["_self"],Mr(n));const s=ie(e,["maskMode"]);null!=s&&re(t,["maskMode"],s);return t}(f));const x=ie(e,["compressionQuality"]);return void 0!==t&&null!=x&&re(t,["parameters","compressionQuality"],x),{}}function Ir(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["name"],n);const s=ie(e,["metadata"]);null!=s&&re(t,["metadata"],s);const r=ie(e,["done"]);null!=r&&re(t,["done"],r);const i=ie(e,["error"]);null!=i&&re(t,["error"],i);const o=ie(e,["response","generateVideoResponse"]);return null!=o&&re(t,["response"],function(e){const t={},n=ie(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["video"]);null!=n&&re(t,["video"],function(e){const t={},n=ie(e,["uri"]);null!=n&&re(t,["uri"],n);const s=ie(e,["encodedVideo"]);null!=s&&re(t,["videoBytes"],ms(s));const r=ie(e,["encoding"]);null!=r&&re(t,["mimeType"],r);return t}(n));return t}(e))),re(t,["generatedVideos"],e)}const s=ie(e,["raiMediaFilteredCount"]);null!=s&&re(t,["raiMediaFilteredCount"],s);const r=ie(e,["raiMediaFilteredReasons"]);null!=r&&re(t,["raiMediaFilteredReasons"],r);return t}(o)),t}function Ar(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["name"],n);const s=ie(e,["metadata"]);null!=s&&re(t,["metadata"],s);const r=ie(e,["done"]);null!=r&&re(t,["done"],r);const i=ie(e,["error"]);null!=i&&re(t,["error"],i);const o=ie(e,["response"]);return null!=o&&re(t,["response"],function(e){const t={},n=ie(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["_self"]);null!=n&&re(t,["video"],function(e){const t={},n=ie(e,["gcsUri"]);null!=n&&re(t,["uri"],n);const s=ie(e,["bytesBase64Encoded"]);null!=s&&re(t,["videoBytes"],ms(s));const r=ie(e,["mimeType"]);null!=r&&re(t,["mimeType"],r);return t}(n));return t}(e))),re(t,["generatedVideos"],e)}const s=ie(e,["raiMediaFilteredCount"]);null!=s&&re(t,["raiMediaFilteredCount"],s);const r=ie(e,["raiMediaFilteredReasons"]);null!=r&&re(t,["raiMediaFilteredReasons"],r);return t}(o)),t}function Tr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["prompt"]);null!=r&&re(n,["instances[0]","prompt"],r);const i=ie(t,["image"]);null!=i&&re(n,["instances[0]","image"],Lr(i));const o=ie(t,["video"]);null!=o&&re(n,["instances[0]","video"],Kr(o));const a=ie(t,["source"]);null!=a&&function(e,t){const n={},s=ie(e,["prompt"]);void 0!==t&&null!=s&&re(t,["instances[0]","prompt"],s);const r=ie(e,["image"]);void 0!==t&&null!=r&&re(t,["instances[0]","image"],Lr(r));const i=ie(e,["video"]);void 0!==t&&null!=i&&re(t,["instances[0]","video"],Kr(i))}(a,n);const l=ie(t,["config"]);return null!=l&&_r(l,n),n}function Or(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["prompt"]);null!=r&&re(n,["instances[0]","prompt"],r);const i=ie(t,["image"]);null!=i&&re(n,["instances[0]","image"],Mr(i));const o=ie(t,["video"]);null!=o&&re(n,["instances[0]","video"],Xr(o));const a=ie(t,["source"]);null!=a&&function(e,t){const n={},s=ie(e,["prompt"]);void 0!==t&&null!=s&&re(t,["instances[0]","prompt"],s);const r=ie(e,["image"]);void 0!==t&&null!=r&&re(t,["instances[0]","image"],Mr(r));const i=ie(e,["video"]);void 0!==t&&null!=i&&re(t,["instances[0]","video"],Xr(i))}(a,n);const l=ie(t,["config"]);return null!=l&&kr(l,n),n}function Rr(e){const t={},n=ie(e,["_self"]);null!=n&&re(t,["image"],Pr(n));const s=ie(e,["raiFilteredReason"]);null!=s&&re(t,["raiFilteredReason"],s);const r=ie(e,["_self"]);null!=r&&re(t,["safetyAttributes"],Vr(r));const i=ie(e,["prompt"]);return null!=i&&re(t,["enhancedPrompt"],i),t}function Pr(e){const t={},n=ie(e,["gcsUri"]);null!=n&&re(t,["gcsUri"],n);const s=ie(e,["bytesBase64Encoded"]);null!=s&&re(t,["imageBytes"],ms(s));const r=ie(e,["mimeType"]);return null!=r&&re(t,["mimeType"],r),t}function Lr(e){const t={};if(void 0!==ie(e,["gcsUri"]))throw new Error("gcsUri parameter is not supported in Gemini API.");const n=ie(e,["imageBytes"]);null!=n&&re(t,["bytesBase64Encoded"],ms(n));const s=ie(e,["mimeType"]);return null!=s&&re(t,["mimeType"],s),t}function Mr(e){const t={},n=ie(e,["gcsUri"]);null!=n&&re(t,["gcsUri"],n);const s=ie(e,["imageBytes"]);null!=s&&re(t,["bytesBase64Encoded"],ms(s));const r=ie(e,["mimeType"]);return null!=r&&re(t,["mimeType"],r),t}function Dr(e,t){const n={},s=ie(t,["config"]);return null!=s&&function(e,t,n){const s=ie(t,["pageSize"]);void 0!==n&&null!=s&&re(n,["_query","pageSize"],s);const r=ie(t,["pageToken"]);void 0!==n&&null!=r&&re(n,["_query","pageToken"],r);const i=ie(t,["filter"]);void 0!==n&&null!=i&&re(n,["_query","filter"],i);const o=ie(t,["queryBase"]);void 0!==n&&null!=o&&re(n,["_url","models_url"],gs(e,o))}(e,s,n),n}function Ur(e,t){const n={},s=ie(t,["config"]);return null!=s&&function(e,t,n){const s=ie(t,["pageSize"]);void 0!==n&&null!=s&&re(n,["_query","pageSize"],s);const r=ie(t,["pageToken"]);void 0!==n&&null!=r&&re(n,["_query","pageToken"],r);const i=ie(t,["filter"]);void 0!==n&&null!=i&&re(n,["_query","filter"],i);const o=ie(t,["queryBase"]);void 0!==n&&null!=o&&re(n,["_url","models_url"],gs(e,o))}(e,s,n),n}function qr(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["name"],n);const s=ie(e,["displayName"]);null!=s&&re(t,["displayName"],s);const r=ie(e,["description"]);null!=r&&re(t,["description"],r);const i=ie(e,["version"]);null!=i&&re(t,["version"],i);const o=ie(e,["_self"]);null!=o&&re(t,["tunedModelInfo"],function(e){const t={},n=ie(e,["baseModel"]);null!=n&&re(t,["baseModel"],n);const s=ie(e,["createTime"]);null!=s&&re(t,["createTime"],s);const r=ie(e,["updateTime"]);null!=r&&re(t,["updateTime"],r);return t}(o));const a=ie(e,["inputTokenLimit"]);null!=a&&re(t,["inputTokenLimit"],a);const l=ie(e,["outputTokenLimit"]);null!=l&&re(t,["outputTokenLimit"],l);const c=ie(e,["supportedGenerationMethods"]);null!=c&&re(t,["supportedActions"],c);const d=ie(e,["temperature"]);null!=d&&re(t,["temperature"],d);const u=ie(e,["maxTemperature"]);null!=u&&re(t,["maxTemperature"],u);const p=ie(e,["topP"]);null!=p&&re(t,["topP"],p);const m=ie(e,["topK"]);null!=m&&re(t,["topK"],m);const h=ie(e,["thinking"]);return null!=h&&re(t,["thinking"],h),t}function Gr(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["name"],n);const s=ie(e,["displayName"]);null!=s&&re(t,["displayName"],s);const r=ie(e,["description"]);null!=r&&re(t,["description"],r);const i=ie(e,["versionId"]);null!=i&&re(t,["version"],i);const o=ie(e,["deployedModels"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["endpoint"]);null!=n&&re(t,["name"],n);const s=ie(e,["deployedModelId"]);return null!=s&&re(t,["deployedModelId"],s),t}(e))),re(t,["endpoints"],e)}const a=ie(e,["labels"]);null!=a&&re(t,["labels"],a);const l=ie(e,["_self"]);null!=l&&re(t,["tunedModelInfo"],function(e){const t={},n=ie(e,["labels","google-vertex-llm-tuning-base-model-id"]);null!=n&&re(t,["baseModel"],n);const s=ie(e,["createTime"]);null!=s&&re(t,["createTime"],s);const r=ie(e,["updateTime"]);null!=r&&re(t,["updateTime"],r);return t}(l));const c=ie(e,["defaultCheckpointId"]);null!=c&&re(t,["defaultCheckpointId"],c);const d=ie(e,["checkpoints"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["checkpoints"],e)}return t}function Hr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["source"]);null!=r&&function(e,t){const n={},s=ie(e,["prompt"]);void 0!==t&&null!=s&&re(t,["instances[0]","prompt"],s);const r=ie(e,["personImage"]);void 0!==t&&null!=r&&re(t,["instances[0]","personImage","image"],Mr(r));const i=ie(e,["productImages"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["productImage"]);return null!=n&&re(t,["image"],Mr(n)),t}(e))),re(t,["instances[0]","productImages"],e)}}(r,n);const i=ie(t,["config"]);return null!=i&&function(e,t){const n=ie(e,["numberOfImages"]);void 0!==t&&null!=n&&re(t,["parameters","sampleCount"],n);const s=ie(e,["baseSteps"]);void 0!==t&&null!=s&&re(t,["parameters","baseSteps"],s);const r=ie(e,["outputGcsUri"]);void 0!==t&&null!=r&&re(t,["parameters","storageUri"],r);const i=ie(e,["seed"]);void 0!==t&&null!=i&&re(t,["parameters","seed"],i);const o=ie(e,["safetyFilterLevel"]);void 0!==t&&null!=o&&re(t,["parameters","safetySetting"],o);const a=ie(e,["personGeneration"]);void 0!==t&&null!=a&&re(t,["parameters","personGeneration"],a);const l=ie(e,["addWatermark"]);void 0!==t&&null!=l&&re(t,["parameters","addWatermark"],l);const c=ie(e,["outputMimeType"]);void 0!==t&&null!=c&&re(t,["parameters","outputOptions","mimeType"],c);const d=ie(e,["outputCompressionQuality"]);void 0!==t&&null!=d&&re(t,["parameters","outputOptions","compressionQuality"],d);const u=ie(e,["enhancePrompt"]);void 0!==t&&null!=u&&re(t,["parameters","enhancePrompt"],u);const p=ie(e,["labels"]);void 0!==t&&null!=p&&re(t,["labels"],p)}(i,n),n}function Br(e){const t={},n=ie(e,["safetyAttributes","categories"]);null!=n&&re(t,["categories"],n);const s=ie(e,["safetyAttributes","scores"]);null!=s&&re(t,["scores"],s);const r=ie(e,["contentType"]);return null!=r&&re(t,["contentType"],r),t}function Vr(e){const t={},n=ie(e,["safetyAttributes","categories"]);null!=n&&re(t,["categories"],n);const s=ie(e,["safetyAttributes","scores"]);null!=s&&re(t,["scores"],s);const r=ie(e,["contentType"]);return null!=r&&re(t,["contentType"],r),t}function Fr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["source"]);null!=r&&function(e,t){const n={},s=ie(e,["prompt"]);void 0!==t&&null!=s&&re(t,["instances[0]","prompt"],s);const r=ie(e,["image"]);void 0!==t&&null!=r&&re(t,["instances[0]","image"],Mr(r));const i=ie(e,["scribbleImage"]);void 0!==t&&null!=i&&re(t,["instances[0]","scribble"],function(e){const t={},n=ie(e,["image"]);return null!=n&&re(t,["image"],Mr(n)),t}(i))}(r,n);const i=ie(t,["config"]);return null!=i&&function(e,t){const n=ie(e,["mode"]);void 0!==t&&null!=n&&re(t,["parameters","mode"],n);const s=ie(e,["maxPredictions"]);void 0!==t&&null!=s&&re(t,["parameters","maxPredictions"],s);const r=ie(e,["confidenceThreshold"]);void 0!==t&&null!=r&&re(t,["parameters","confidenceThreshold"],r);const i=ie(e,["maskDilation"]);void 0!==t&&null!=i&&re(t,["parameters","maskDilation"],i);const o=ie(e,["binaryColorThreshold"]);void 0!==t&&null!=o&&re(t,["parameters","binaryColorThreshold"],o);const a=ie(e,["labels"]);void 0!==t&&null!=a&&re(t,["labels"],a)}(i,n),n}function Wr(e){const t={},n=ie(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["_self"]);null!=n&&re(t,["mask"],Pr(n));const s=ie(e,["labels"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["labels"],e)}return t}(e))),re(t,["generatedMasks"],e)}return t}function Jr(e){const t={},n=ie(e,["retrieval"]);null!=n&&re(t,["retrieval"],n);const s=ie(e,["computerUse"]);if(null!=s&&re(t,["computerUse"],s),void 0!==ie(e,["fileSearch"]))throw new Error("fileSearch parameter is not supported in Vertex AI.");const r=ie(e,["codeExecution"]);null!=r&&re(t,["codeExecution"],r);const i=ie(e,["enterpriseWebSearch"]);null!=i&&re(t,["enterpriseWebSearch"],i);const o=ie(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["description"]);null!=n&&re(t,["description"],n);const s=ie(e,["name"]);null!=s&&re(t,["name"],s);const r=ie(e,["parameters"]);null!=r&&re(t,["parameters"],r);const i=ie(e,["parametersJsonSchema"]);null!=i&&re(t,["parametersJsonSchema"],i);const o=ie(e,["response"]);null!=o&&re(t,["response"],o);const a=ie(e,["responseJsonSchema"]);if(null!=a&&re(t,["responseJsonSchema"],a),void 0!==ie(e,["behavior"]))throw new Error("behavior parameter is not supported in Vertex AI.");return t}(e))),re(t,["functionDeclarations"],e)}const a=ie(e,["googleMaps"]);null!=a&&re(t,["googleMaps"],a);const l=ie(e,["googleSearch"]);null!=l&&re(t,["googleSearch"],l);const c=ie(e,["googleSearchRetrieval"]);null!=c&&re(t,["googleSearchRetrieval"],c);const d=ie(e,["urlContext"]);return null!=d&&re(t,["urlContext"],d),t}function $r(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","name"],Wn(e,s));const r=ie(t,["config"]);return null!=r&&function(e,t){const n=ie(e,["displayName"]);void 0!==t&&null!=n&&re(t,["displayName"],n);const s=ie(e,["description"]);void 0!==t&&null!=s&&re(t,["description"],s);const r=ie(e,["defaultCheckpointId"]);void 0!==t&&null!=r&&re(t,["defaultCheckpointId"],r)}(r,n),n}function zr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["config"]);return null!=r&&function(e,t){const n=ie(e,["displayName"]);void 0!==t&&null!=n&&re(t,["displayName"],n);const s=ie(e,["description"]);void 0!==t&&null!=s&&re(t,["description"],s);const r=ie(e,["defaultCheckpointId"]);void 0!==t&&null!=r&&re(t,["defaultCheckpointId"],r)}(r,n),n}function Yr(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["image"]);null!=r&&re(n,["instances[0]","image"],Mr(r));const i=ie(t,["upscaleFactor"]);null!=i&&re(n,["parameters","upscaleConfig","upscaleFactor"],i);const o=ie(t,["config"]);return null!=o&&function(e,t){const n=ie(e,["outputGcsUri"]);void 0!==t&&null!=n&&re(t,["parameters","storageUri"],n);const s=ie(e,["safetyFilterLevel"]);void 0!==t&&null!=s&&re(t,["parameters","safetySetting"],s);const r=ie(e,["personGeneration"]);void 0!==t&&null!=r&&re(t,["parameters","personGeneration"],r);const i=ie(e,["includeRaiReason"]);void 0!==t&&null!=i&&re(t,["parameters","includeRaiReason"],i);const o=ie(e,["outputMimeType"]);void 0!==t&&null!=o&&re(t,["parameters","outputOptions","mimeType"],o);const a=ie(e,["outputCompressionQuality"]);void 0!==t&&null!=a&&re(t,["parameters","outputOptions","compressionQuality"],a);const l=ie(e,["enhanceInputImage"]);void 0!==t&&null!=l&&re(t,["parameters","upscaleConfig","enhanceInputImage"],l);const c=ie(e,["imagePreservationFactor"]);void 0!==t&&null!=c&&re(t,["parameters","upscaleConfig","imagePreservationFactor"],c);const d=ie(e,["labels"]);void 0!==t&&null!=d&&re(t,["labels"],d);const u=ie(e,["numberOfImages"]);void 0!==t&&null!=u&&re(t,["parameters","sampleCount"],u);const p=ie(e,["mode"]);void 0!==t&&null!=p&&re(t,["parameters","mode"],p)}(o,n),n}function Kr(e){const t={},n=ie(e,["uri"]);null!=n&&re(t,["uri"],n);const s=ie(e,["videoBytes"]);null!=s&&re(t,["encodedVideo"],ms(s));const r=ie(e,["mimeType"]);return null!=r&&re(t,["encoding"],r),t}function Xr(e){const t={},n=ie(e,["uri"]);null!=n&&re(t,["gcsUri"],n);const s=ie(e,["videoBytes"]);null!=s&&re(t,["bytesBase64Encoded"],ms(s));const r=ie(e,["mimeType"]);return null!=r&&re(t,["mimeType"],r),t}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Qr(e){const t={},n=ie(e,["config"]);return null!=n&&function(e,t){const n=ie(e,["displayName"]);void 0!==t&&null!=n&&re(t,["displayName"],n)}(n,t),t}function Zr(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["_url","name"],n);const s=ie(e,["config"]);return null!=s&&function(e,t){const n=ie(e,["force"]);void 0!==t&&null!=n&&re(t,["_query","force"],n)}(s,t),t}function ei(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["name"],n);const s=ie(e,["metadata"]);null!=s&&re(t,["metadata"],s);const r=ie(e,["done"]);null!=r&&re(t,["done"],r);const i=ie(e,["error"]);null!=i&&re(t,["error"],i);const o=ie(e,["response"]);return null!=o&&re(t,["response"],function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["parent"]);null!=s&&re(t,["parent"],s);const r=ie(e,["documentName"]);null!=r&&re(t,["documentName"],r);return t}(o)),t}function ti(e){const t={},n=ie(e,["fileSearchStoreName"]);null!=n&&re(t,["_url","file_search_store_name"],n);const s=ie(e,["fileName"]);null!=s&&re(t,["fileName"],s);const r=ie(e,["config"]);return null!=r&&function(e,t){const n=ie(e,["customMetadata"]);if(void 0!==t&&null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["customMetadata"],e)}const s=ie(e,["chunkingConfig"]);void 0!==t&&null!=s&&re(t,["chunkingConfig"],s)}(r,t),t}function ni(e){const t={},n=ie(e,["config"]);return null!=n&&function(e,t){const n=ie(e,["pageSize"]);void 0!==t&&null!=n&&re(t,["_query","pageSize"],n);const s=ie(e,["pageToken"]);void 0!==t&&null!=s&&re(t,["_query","pageToken"],s)}(n,t),t}function si(e,t){const n=ie(e,["mimeType"]);void 0!==t&&null!=n&&re(t,["mimeType"],n);const s=ie(e,["displayName"]);void 0!==t&&null!=s&&re(t,["displayName"],s);const r=ie(e,["customMetadata"]);if(void 0!==t&&null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["customMetadata"],e)}const i=ie(e,["chunkingConfig"]);return void 0!==t&&null!=i&&re(t,["chunkingConfig"],i),{}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
const ri="x-goog-api-client";class ii{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const s={};this.clientOptions.vertexai?(s.apiVersion=null!==(t=this.clientOptions.apiVersion)&&void 0!==t?t:"v1beta1",s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=null!==(n=this.clientOptions.apiVersion)&&void 0!==n?n:"v1beta",s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&"global"!==this.clientOptions.location?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:(this.clientOptions.project=void 0,this.clientOptions.location=void 0)}isVertexAI(){var e;return null!==(e=this.clientOptions.vertexai)&&void 0!==e&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw new Error("HTTP options are not correctly set.");const t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol="http:"==t.protocol?"ws":"wss",t.toString()}setBaseUrl(e){if(!this.clientOptions.httpOptions)throw new Error("HTTP options are not correctly set.");this.clientOptions.httpOptions.baseUrl=e}constructUrl(e,t,n){const s=[this.getRequestUrlInternal(t)];n&&s.push(this.getBaseResourcePath()),""!==e&&s.push(e);return new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!this.clientOptions.apiKey&&(!!this.clientOptions.vertexai&&(!e.path.startsWith("projects/")&&("GET"!==e.httpMethod||!e.path.startsWith("publishers/google/models"))))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);if(e.queryParams)for(const[i,o]of Object.entries(e.queryParams))s.searchParams.append(i,String(o));let r={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.unaryApiCall(s,r,e.httpMethod)}patchHttpOptions(e,t){const n=JSON.parse(JSON.stringify(e));for(const[s,r]of Object.entries(t))"object"==typeof r?n[s]=Object.assign(Object.assign({},n[s]),r):void 0!==r&&(n[s]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);s.searchParams.has("alt")&&"sse"===s.searchParams.get("alt")||s.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.streamApiCall(s,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,s){if(t&&t.timeout||s){const n=new AbortController,r=n.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){const e=setTimeout(()=>n.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}s&&s.addEventListener("abort",()=>{n.abort()}),e.signal=r}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob)return;let n={};if("string"==typeof e.body&&e.body.length>0)try{const t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t))return;n=t}catch(i){return}function s(e,t){const n=Object.assign({},e);for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const e=t[r],i=n[r];e&&"object"==typeof e&&!Array.isArray(e)&&i&&"object"==typeof i&&!Array.isArray(i)?n[r]=s(i,e):n[r]=e}return n}const r=s(n,t);e.body=JSON.stringify(r)}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await oi(e),new xn(e))).catch(e=>{throw e instanceof Error?e:new Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await oi(e),this.processStreamResponse(e))).catch(e=>{throw e instanceof Error?e:new Error(JSON.stringify(e))})}processStreamResponse(e){return $s(this,arguments,function*(){var t;const n=null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.getReader(),s=new TextDecoder("utf-8");if(!n)throw new Error("Response body is empty");try{let t="";const i="data:",o=["\n\n","\r\r","\r\n\r\n"];for(;;){const{done:a,value:l}=yield Js(n.read());if(a){if(t.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const c=s.decode(l,{stream:!0});try{const e=JSON.parse(c);if("error"in e){const t=JSON.parse(JSON.stringify(e.error)),n=t.status,s=t.code,r=`got status: ${n}. ${JSON.stringify(e)}`;if(s>=400&&s<600){throw new er({message:r,status:s})}}}catch(r){if("ApiError"===r.name)throw r}t+=c;let d=-1,u=0;for(;;){d=-1,u=0;for(const e of o){const n=t.indexOf(e);-1!==n&&(-1===d||n<d)&&(d=n,u=e.length)}if(-1===d)break;const n=t.substring(0,d);t=t.substring(d+u);const s=n.trim();if(s.startsWith(i)){const t=s.substring(i.length).trim();try{const n=new Response(t,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield Js(new xn(n))}catch(r){throw new Error(`exception parsing stream chunk ${t}. ${r}`)}}}}}finally{n.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw new Error(`exception ${e} sending request`)})}getDefaultHeaders(){const e={},t="google-genai-sdk/1.35.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[ri]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){const n=new Headers;if(e&&e.headers){for(const[t,s]of Object.entries(e.headers))n.append(t,s);e.timeout&&e.timeout>0&&n.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return"string"==typeof e&&(n=e.replace(/[/\\]+$/,""),n=null!==(t=n.split(/[/\\]/).pop())&&void 0!==t?t:""),n}async uploadFile(e,t){var n;const s={};null!=t&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);const r=this.clientOptions.uploader,i=await r.stat(e);s.sizeBytes=String(i.size);const o=null!==(n=null==t?void 0:t.mimeType)&&void 0!==n?n:i.type;if(void 0===o||""===o)throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=o;const a={file:s},l=this.getFileName(e),c=se("upload/v1beta/files",a._url),d=await this.fetchUploadUrl(c,s.sizeBytes,s.mimeType,l,a,null==t?void 0:t.httpOptions);return r.upload(e,d,this)}async uploadFileToFileSearchStore(e,t,n){var s;const r=this.clientOptions.uploader,i=await r.stat(t),o=String(i.size),a=null!==(s=null==n?void 0:n.mimeType)&&void 0!==s?s:i.type;if(void 0===a||""===a)throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const l=`upload/v1beta/${e}:uploadToFileSearchStore`,c=this.getFileName(t),d={};null!=n&&si(n,d);const u=await this.fetchUploadUrl(l,o,a,c,d,null==n?void 0:n.httpOptions);return r.uploadToFileSearchStore(t,u,this)}async downloadFile(e){const t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t,n,s,r,i){var o;let a={};a=i||{apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},s?{"X-Goog-Upload-File-Name":s}:{})};const l=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:a});if(!l||!(null==l?void 0:l.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const c=null===(o=null==l?void 0:l.headers)||void 0===o?void 0:o["x-goog-upload-url"];if(void 0===c)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return c}}async function oi(e){var t;if(void 0===e)throw new Error("response is undefined");if(!e.ok){const n=e.status;let s;s=(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}};const r=JSON.stringify(s);if(n>=400&&n<600){throw new er({message:r,status:n})}throw new Error(r)}}function ai(e){for(const t of e){if(ci(t))return!0;if("object"==typeof t&&"inputSchema"in t)return!0}return false}function li(e){var t;const n=null!==(t=e[ri])&&void 0!==t?t:"";e[ri]=(n+" mcp_used/unknown").trimStart()}function ci(e){return null!==e&&"object"==typeof e&&e instanceof ui}function di(e){return $s(this,arguments,function*(e,t=100){let n,s=0;for(;s<t;){const t=yield Js(e.listTools({cursor:n}));for(const e of t.tools)yield yield Js(e),s++;if(!t.nextCursor)break;n=t.nextCursor}})}class ui{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new ui(e,t)}async initialize(){var e,t,n,s;if(this.mcpTools.length>0)return;const r={},i=[];for(const d of this.mcpClients)try{for(var o,a=!0,l=(t=void 0,zs(di(d)));!(e=(o=await l.next()).done);a=!0){s=o.value,a=!1;const e=s;i.push(e);const t=e.name;if(r[t])throw new Error(`Duplicate function name ${t} found in MCP tools. Please ensure function names are unique.`);r[t]=d}}catch(c){t={error:c}}finally{try{a||e||!(n=l.return)||await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=i,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),function(e,t={}){const n=[],s=new Set;for(const r of e){const e=r.name;if(s.has(e))throw new Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);s.add(e);const i=bs(r,t);i.functionDeclarations&&n.push(...i.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const n of e)if(n.name in this.functionNameToMcpClient){const e=this.functionNameToMcpClient[n.name];let s;this.config.timeout&&(s={timeout:this.config.timeout});const r=await e.callTool({name:n.name,arguments:n.args},void 0,s);t.push({functionResponse:{name:n.name,response:r.isError?{error:r}:r}})}return t}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class pi{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");const s=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),i=function(e){const t=new Headers;for(const[n,s]of Object.entries(e))t.append(n,s);return t}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(this.apiClient.getDefaultHeaders()),o=`${s}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${this.apiClient.getApiKey()}`;let a=()=>{};const l=new Promise(e=>{a=e}),c=e.callbacks,d=(this.apiClient,{onopen:function(){a({})},onmessage:e=>{!async function(e,t,n){const s=new Vn;let r;r=n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data),Object.assign(s,r),t(s)}(0,c.onmessage,e)},onerror:null!==(t=null==c?void 0:c.onerror)&&void 0!==t?t:function(e){},onclose:null!==(n=null==c?void 0:c.onclose)&&void 0!==n?n:function(e){}}),u=this.webSocketFactory.create(o,function(e){const t={};return e.forEach((e,n)=>{t[n]=e}),t}(i),d);u.connect(),await l;const p={setup:{model:Wn(this.apiClient,e.model)}};return u.send(JSON.stringify(p)),new mi(u,this.apiClient)}}class mi{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=function(e){const t={},n=ie(e,["weightedPrompts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=function(e){const t={},n=ie(e,["musicGenerationConfig"]);return null!=n&&re(t,["musicGenerationConfig"],n),t}(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(mn.PLAY)}pause(){this.sendPlaybackControl(mn.PAUSE)}stop(){this.sendPlaybackControl(mn.STOP)}resetContext(){this.sendPlaybackControl(mn.RESET_CONTEXT)}close(){this.conn.close()}}class hi{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new pi(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,s,r,i,o;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const a=this.apiClient.getWebsocketBaseUrl(),l=this.apiClient.getApiVersion();let c;const d=this.apiClient.getHeaders();e.config&&e.config.tools&&ai(e.config.tools)&&li(d);const u=function(e){const t=new Headers;for(const[n,s]of Object.entries(e))t.append(n,s);return t}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(d);if(this.apiClient.isVertexAI())c=`${a}/ws/google.cloud.aiplatform.${l}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(u,c);else{const e=this.apiClient.getApiKey();let t="BidiGenerateContent",n="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(t="BidiGenerateContentConstrained",n="access_token"),c=`${a}/ws/google.ai.generativelanguage.${l}.GenerativeService.${t}?${n}=${e}`}let p=()=>{};const m=new Promise(e=>{p=e}),h=e.callbacks,g=this.apiClient,f={onopen:function(){var e;null===(e=null==h?void 0:h.onopen)||void 0===e||e.call(h),p({})},onmessage:e=>{!async function(e,t,n){const s=new Bn;let r;r=n.data instanceof Blob?await n.data.text():n.data instanceof ArrayBuffer?(new TextDecoder).decode(n.data):n.data;const i=JSON.parse(r);if(e.isVertexAI()){const e=cr(i);Object.assign(s,e)}else{const e=i;Object.assign(s,e)}t(s)}(g,h.onmessage,e)},onerror:null!==(t=null==h?void 0:h.onerror)&&void 0!==t?t:function(e){},onclose:null!==(n=null==h?void 0:h.onclose)&&void 0!==n?n:function(e){}},x=this.webSocketFactory.create(c,function(e){const t={};return e.forEach((e,n)=>{t[n]=e}),t}(u),f);x.connect(),await m;let b=Wn(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&b.startsWith("publishers/")){b=`projects/${this.apiClient.getProject()}/locations/${this.apiClient.getLocation()}/`+b}let v={};this.apiClient.isVertexAI()&&void 0===(null===(s=e.config)||void 0===s?void 0:s.responseModalities)&&(void 0===e.config?e.config={responseModalities:[et.AUDIO]}:e.config.responseModalities=[et.AUDIO]),null===(r=e.config)||void 0===r||r.generationConfig;const y=null!==(o=null===(i=e.config)||void 0===i?void 0:i.tools)&&void 0!==o?o:[],w=[];for(const j of y)if(this.isCallableTool(j)){const e=j;w.push(await e.tool())}else w.push(j);w.length>0&&(e.config.tools=w);const N={model:b,config:e.config,callbacks:e.callbacks};return v=this.apiClient.isVertexAI()?function(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["setup","model"],Wn(e,s));const r=ie(t,["config"]);return null!=r&&re(n,["config"],or(r,n)),n}(this.apiClient,N):function(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["setup","model"],Wn(e,s));const r=ie(t,["config"]);return null!=r&&re(n,["config"],ir(r,n)),n}(this.apiClient,N),delete v.config,x.send(JSON.stringify(v)),new fi(x,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}const gi={turnComplete:!0};class fi{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let s=[];try{s=rs(t.turns),e.isVertexAI()||(s=s.map(e=>pr(e)))}catch(n){throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:s,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(null==t.functionResponses)throw new Error("functionResponses is required.");if(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses],0===n.length)throw new Error("functionResponses is required.");for(const s of n){if("object"!=typeof s||null===s||!("name"in s)||!("response"in s))throw new Error(`Could not parse function response, type '${typeof s}'.`);if(!e.isVertexAI()&&!("id"in s))throw new Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},gi),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:lr(e)}:{realtimeInput:ar(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function xi(e){var t,n,s;if(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.disable)return!0;let r=!1;for(const o of null!==(n=null==e?void 0:e.tools)&&void 0!==n?n:[])if(bi(o)){r=!0;break}if(!r)return!0;const i=null===(s=null==e?void 0:e.automaticFunctionCalling)||void 0===s?void 0:s.maximumRemoteCalls;return!!(i&&(i<0||!Number.isInteger(i))||0==i)}function bi(e){return"callTool"in e&&"function"==typeof e.callTool}function vi(e){var t;const n=[];return(null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.tools)?(e.config.tools.forEach((e,t)=>{if(bi(e))return;const s=e;s.functionDeclarations&&s.functionDeclarations.length>0&&n.push(t)}),n):n}function yi(e){var t;return!(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.ignoreCallHistory)}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class wi extends ne{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,n,s,r,i;const o=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!function(e){var t,n,s;return null!==(s=null===(n=null===(t=e.config)||void 0===t?void 0:t.tools)||void 0===n?void 0:n.some(e=>bi(e)))&&void 0!==s&&s}(e)||xi(e.config))return await this.generateContentInternal(o);const a=vi(e);if(a.length>0){const e=a.map(e=>`tools[${e}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${e}.`)}let l,c;const d=rs(o.contents),u=null!==(s=null===(n=null===(t=o.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls)&&void 0!==s?s:10;let p=0;for(;p<u&&(l=await this.generateContentInternal(o),l.functionCalls&&0!==l.functionCalls.length);){const t=l.candidates[0].content,n=[];for(const s of null!==(i=null===(r=e.config)||void 0===r?void 0:r.tools)&&void 0!==i?i:[])if(bi(s)){const e=s,t=await e.callTool(l.functionCalls);n.push(...t)}p++,c={role:"user",parts:n},o.contents=rs(o.contents),o.contents.push(t),o.contents.push(c),yi(o.config)&&(d.push(t),d.push(c))}return yi(o.config)&&(l.automaticFunctionCallingHistory=d),l},this.generateContentStream=async e=>{var t,n,s,r,i;if(this.maybeMoveToResponseJsonSchem(e),xi(e.config)){const t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}const o=vi(e);if(o.length>0){const e=o.map(e=>`tools[${e}]`).join(", ");throw new Error(`Incompatible tools found at ${e}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const a=null===(s=null===(n=null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.toolConfig)||void 0===n?void 0:n.functionCallingConfig)||void 0===s?void 0:s.streamFunctionCallArguments,l=null===(i=null===(r=null==e?void 0:e.config)||void 0===r?void 0:r.automaticFunctionCalling)||void 0===i?void 0:i.disable;if(a&&!l)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let n;const s=[];if(null==e?void 0:e.generatedImages)for(const i of e.generatedImages)i&&(null==i?void 0:i.safetyAttributes)&&"Positive Prompt"===(null===(t=null==i?void 0:i.safetyAttributes)||void 0===t?void 0:t.contentType)?n=null==i?void 0:i.safetyAttributes:s.push(i);let r;return r=n?{generatedImages:s,positivePromptSafetyAttributes:n,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:s,sdkHttpResponse:e.sdkHttpResponse},r}),this.list=async e=>{var t;const n={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase){if(null===(t=n.config)||void 0===t?void 0:t.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");n.config.filter="labels.tune-type:*"}return new Ps(gn.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(n),n)},this.editImage=async e=>{const t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));const n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)},this.generateVideos=async e=>{var t,n,s,r,i,o;if((e.prompt||e.image||e.video)&&e.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||((null===(t=e.video)||void 0===t?void 0:t.uri)&&(null===(n=e.video)||void 0===n?void 0:n.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null===(r=null===(s=e.source)||void 0===s?void 0:s.video)||void 0===r?void 0:r.uri)&&(null===(o=null===(i=e.source)||void 0===i?void 0:i.video)||void 0===o?void 0:o.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,s;const r=null===(t=e.config)||void 0===t?void 0:t.tools;if(!r)return e;const i=await Promise.all(r.map(async e=>{if(bi(e)){const t=e;return await t.tool()}return e})),o={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:i})};if(o.config.tools=i,e.config&&e.config.tools&&ai(e.config.tools)){const t=null!==(s=null===(n=e.config.httpOptions)||void 0===n?void 0:n.headers)&&void 0!==s?s:{};let r=Object.assign({},t);0===Object.keys(r).length&&(r=this.apiClient.getDefaultHeaders()),li(r),o.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:r})}return o}async initAfcToolsMap(e){var t,n,s;const r=new Map;for(const i of null!==(n=null===(t=e.config)||void 0===t?void 0:t.tools)&&void 0!==n?n:[])if(bi(i)){const e=i,t=await e.tool();for(const n of null!==(s=t.functionDeclarations)&&void 0!==s?s:[]){if(!n.name)throw new Error("Function declaration name is required.");if(r.has(n.name))throw new Error(`Duplicate tool declaration name: ${n.name}`);r.set(n.name,e)}}return r}async processAfcStream(e){var t,n,s;const r=null!==(s=null===(n=null===(t=e.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls)&&void 0!==s?s:10;let i=!1,o=0;return function(e,t,n){return $s(this,arguments,function*(){for(var s,a,l,c,d,u;o<r;){i&&(o++,i=!1);const f=yield Js(e.processParamsMaybeAddMcpUsage(n)),x=yield Js(e.generateContentStreamInternal(f)),b=[],v=[];try{for(var p,m=!0,h=(a=void 0,zs(x));!(s=(p=yield Js(h.next())).done);m=!0){c=p.value,m=!1;const e=c;if(yield yield Js(e),e.candidates&&(null===(d=e.candidates[0])||void 0===d?void 0:d.content)){v.push(e.candidates[0].content);for(const n of null!==(u=e.candidates[0].content.parts)&&void 0!==u?u:[])if(o<r&&n.functionCall){if(!n.functionCall.name)throw new Error("Function call name was not returned by the model.");if(!t.has(n.functionCall.name))throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${n.functionCall.name}`);{const e=yield Js(t.get(n.functionCall.name).callTool([n.functionCall]));b.push(...e)}}}}}catch(g){a={error:g}}finally{try{m||s||!(l=h.return)||(yield Js(l.call(h)))}finally{if(a)throw a.error}}if(!(b.length>0))break;{i=!0;const e=new bn;e.candidates=[{content:{role:"user",parts:b}}],yield yield Js(e);const t=[];t.push(...v),t.push({role:"user",parts:b});const s=rs(n.contents).concat(t);n.contents=s}}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=wr(this.apiClient,e);return o=se("{model}:generateContent",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=jr(e),n=new bn;return Object.assign(n,t),n})}{const t=yr(this.apiClient,e);return o=se("{model}:generateContent",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=Nr(e),n=new bn;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=wr(this.apiClient,e);o=se("{model}:streamGenerateContent?alt=sse",s._url),a=s._query,delete s._url,delete s._query;return i=this.apiClient.requestStream({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}),i.then(function(e){return $s(this,arguments,function*(){var t,n,s,r;try{for(var i,o=!0,a=zs(e);!(t=(i=yield Js(a.next())).done);o=!0){r=i.value,o=!1;const e=r,t=jr(yield Js(e.json()));t.sdkHttpResponse={headers:e.headers};const n=new bn;Object.assign(n,t),yield yield Js(n)}}catch(l){n={error:l}}finally{try{o||t||!(s=a.return)||(yield Js(s.call(a)))}finally{if(n)throw n.error}}})})}{const t=yr(this.apiClient,e);o=se("{model}:streamGenerateContent?alt=sse",t._url),a=t._query,delete t._url,delete t._query;return i=this.apiClient.requestStream({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}),i.then(function(e){return $s(this,arguments,function*(){var t,n,s,r;try{for(var i,o=!0,a=zs(e);!(t=(i=yield Js(a.next())).done);o=!0){r=i.value,o=!1;const e=r,t=Nr(yield Js(e.json()));t.sdkHttpResponse={headers:e.headers};const n=new bn;Object.assign(n,t),yield yield Js(n)}}catch(l){n={error:l}}finally{try{o||t||!(s=a.return)||(yield Js(s.call(a)))}finally{if(n)throw n.error}}})})}}async embedContent(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=xr(this.apiClient,e);return o=se("{model}:predict",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["predictions[]","embeddings"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>ur(e))),re(t,["embeddings"],e)}const r=ie(e,["metadata"]);return null!=r&&re(t,["metadata"],r),t}(e),n=new vn;return Object.assign(n,t),n})}{const t=fr(this.apiClient,e);return o=se("{model}:batchEmbedContents",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["embeddings"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["embeddings"],e)}const r=ie(e,["metadata"]);return null!=r&&re(t,["metadata"],r),t}(e),n=new vn;return Object.assign(n,t),n})}}async generateImagesInternal(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=Er(this.apiClient,e);return o=se("{model}:predict",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["predictions"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>Rr(e))),re(t,["generatedImages"],e)}const r=ie(e,["positivePromptSafetyAttributes"]);return null!=r&&re(t,["positivePromptSafetyAttributes"],Vr(r)),t}(e),n=new yn;return Object.assign(n,t),n})}{const t=Sr(this.apiClient,e);return o=se("{model}:predict",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=Cr(e),n=new yn;return Object.assign(n,t),n})}}async editImageInternal(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI()){const o=gr(this.apiClient,e);return r=se("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),s.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["predictions"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>Rr(e))),re(t,["generatedImages"],e)}return t}(e),n=new wn;return Object.assign(n,t),n})}throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI()){const o=Yr(this.apiClient,e);return r=se("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),s.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["predictions"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>Rr(e))),re(t,["generatedImages"],e)}return t}(e),n=new Nn;return Object.assign(n,t),n})}throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI()){const o=Hr(this.apiClient,e);return r=se("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>{const t=function(e){const t={},n=ie(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>Rr(e))),re(t,["generatedImages"],e)}return t}(e),n=new jn;return Object.assign(n,t),n})}throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI()){const o=Fr(this.apiClient,e);return r=se("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>{const t=Wr(e),n=new Sn;return Object.assign(n,t),n})}throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=function(e,t){const n={},s=ie(t,["model"]);return null!=s&&re(n,["_url","name"],Wn(e,s)),n}(this.apiClient,e);return o=se("{name}",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>Gr(e))}{const t=function(e,t){const n={},s=ie(t,["model"]);return null!=s&&re(n,["_url","name"],Wn(e,s)),n}(this.apiClient,e);return o=se("{name}",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),i.then(e=>qr(e))}}async listInternal(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=Ur(this.apiClient,e);return o=se("{models_url}",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["nextPageToken"]);null!=s&&re(t,["nextPageToken"],s);const r=ie(e,["_self"]);if(null!=r){let e=fs(r);Array.isArray(e)&&(e=e.map(e=>Gr(e))),re(t,["models"],e)}return t}(e),n=new En;return Object.assign(n,t),n})}{const t=Dr(this.apiClient,e);return o=se("{models_url}",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["nextPageToken"]);null!=s&&re(t,["nextPageToken"],s);const r=ie(e,["_self"]);if(null!=r){let e=fs(r);Array.isArray(e)&&(e=e.map(e=>qr(e))),re(t,["models"],e)}return t}(e),n=new En;return Object.assign(n,t),n})}}async update(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=zr(this.apiClient,e);return o=se("{model}",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>Gr(e))}{const t=$r(this.apiClient,e);return o=se("{name}",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),i.then(e=>qr(e))}}async delete(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=function(e,t){const n={},s=ie(t,["model"]);return null!=s&&re(n,["_url","name"],Wn(e,s)),n}(this.apiClient,e);return o=se("{name}",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);return null!=n&&re(t,["sdkHttpResponse"],n),t}(e),n=new Cn;return Object.assign(n,t),n})}{const t=function(e,t){const n={},s=ie(t,["model"]);return null!=s&&re(n,["_url","name"],Wn(e,s)),n}(this.apiClient,e);return o=se("{name}",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);return null!=n&&re(t,["sdkHttpResponse"],n),t}(e),n=new Cn;return Object.assign(n,t),n})}}async countTokens(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=function(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["contents"]);if(null!=r){let e=rs(r);Array.isArray(e)&&(e=e.map(e=>e)),re(n,["contents"],e)}const i=ie(t,["config"]);return null!=i&&mr(i,n),n}(this.apiClient,e);return o=se("{model}:countTokens",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["totalTokens"]);return null!=s&&re(t,["totalTokens"],s),t}(e),n=new _n;return Object.assign(n,t),n})}{const t=hr(this.apiClient,e);return o=se("{model}:countTokens",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["totalTokens"]);null!=s&&re(t,["totalTokens"],s);const r=ie(e,["cachedContentTokenCount"]);return null!=r&&re(t,["cachedContentTokenCount"],r),t}(e),n=new _n;return Object.assign(n,t),n})}}async computeTokens(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI()){const o=function(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["_url","model"],Wn(e,s));const r=ie(t,["contents"]);if(null!=r){let e=rs(r);Array.isArray(e)&&(e=e.map(e=>e)),re(n,["contents"],e)}return n}(this.apiClient,e);return r=se("{model}:computeTokens",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),s.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["tokensInfo"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["tokensInfo"],e)}return t}(e),n=new kn;return Object.assign(n,t),n})}throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=Or(this.apiClient,e);return o=se("{model}:predictLongRunning",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>{const t=Ar(e),n=new In;return Object.assign(n,t),n})}{const t=Tr(this.apiClient,e);return o=se("{model}:predictLongRunning",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),i.then(e=>{const t=Ir(e),n=new In;return Object.assign(n,t),n})}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ni extends ne{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const e=t.name.split("/operations/")[0];let s;n&&"httpOptions"in n&&(s=n.httpOptions);const r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:e,config:{httpOptions:s}});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}{const e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async get(e){const t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const e=t.name.split("/operations/")[0];let s;n&&"httpOptions"in n&&(s=n.httpOptions);const r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:e,config:{httpOptions:s}});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}{const e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=function(e){const t={},n=ie(e,["operationName"]);return null!=n&&re(t,["_url","operationName"],n),t}(e);return o=se("{operationName}",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i}{const t=function(e){const t={},n=ie(e,["operationName"]);return null!=n&&re(t,["_url","operationName"],n),t}(e);return o=se("{operationName}",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),i}}async fetchPredictVideosOperationInternal(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI()){const o=function(e){const t={},n=ie(e,["operationName"]);null!=n&&re(t,["operationName"],n);const s=ie(e,["resourceName"]);return null!=s&&re(t,["_url","resourceName"],s),t}(e);return r=se("{resourceName}:fetchPredictOperation",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s}throw new Error("This method is only supported by the Vertex AI.")}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ji(e){const t={},n=ie(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=ie(e,["mediaResolution"]);null!=n&&re(t,["mediaResolution"],n);const s=ie(e,["codeExecutionResult"]);null!=s&&re(t,["codeExecutionResult"],s);const r=ie(e,["executableCode"]);null!=r&&re(t,["executableCode"],r);const i=ie(e,["fileData"]);null!=i&&re(t,["fileData"],function(e){const t={};if(void 0!==ie(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=ie(e,["fileUri"]);null!=n&&re(t,["fileUri"],n);const s=ie(e,["mimeType"]);null!=s&&re(t,["mimeType"],s);return t}(i));const o=ie(e,["functionCall"]);null!=o&&re(t,["functionCall"],function(e){const t={},n=ie(e,["id"]);null!=n&&re(t,["id"],n);const s=ie(e,["args"]);null!=s&&re(t,["args"],s);const r=ie(e,["name"]);null!=r&&re(t,["name"],r);if(void 0!==ie(e,["partialArgs"]))throw new Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ie(e,["willContinue"]))throw new Error("willContinue parameter is not supported in Gemini API.");return t}(o));const a=ie(e,["functionResponse"]);null!=a&&re(t,["functionResponse"],a);const l=ie(e,["inlineData"]);null!=l&&re(t,["inlineData"],function(e){const t={},n=ie(e,["data"]);if(null!=n&&re(t,["data"],n),void 0!==ie(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const s=ie(e,["mimeType"]);return null!=s&&re(t,["mimeType"],s),t}(l));const c=ie(e,["text"]);null!=c&&re(t,["text"],c);const d=ie(e,["thought"]);null!=d&&re(t,["thought"],d);const u=ie(e,["thoughtSignature"]);null!=u&&re(t,["thoughtSignature"],u);const p=ie(e,["videoMetadata"]);null!=p&&re(t,["videoMetadata"],p);return t}(e))),re(t,["parts"],e)}const s=ie(e,["role"]);return null!=s&&re(t,["role"],s),t}function Si(e,t,n){const s=ie(t,["expireTime"]);void 0!==n&&null!=s&&re(n,["expireTime"],s);const r=ie(t,["newSessionExpireTime"]);void 0!==n&&null!=r&&re(n,["newSessionExpireTime"],r);const i=ie(t,["uses"]);void 0!==n&&null!=i&&re(n,["uses"],i);const o=ie(t,["liveConnectConstraints"]);void 0!==n&&null!=o&&re(n,["bidiGenerateContentSetup"],function(e,t){const n={},s=ie(t,["model"]);null!=s&&re(n,["setup","model"],Wn(e,s));const r=ie(t,["config"]);null!=r&&re(n,["config"],function(e,t){const n={},s=ie(e,["generationConfig"]);void 0!==t&&null!=s&&re(t,["setup","generationConfig"],s);const r=ie(e,["responseModalities"]);void 0!==t&&null!=r&&re(t,["setup","generationConfig","responseModalities"],r);const i=ie(e,["temperature"]);void 0!==t&&null!=i&&re(t,["setup","generationConfig","temperature"],i);const o=ie(e,["topP"]);void 0!==t&&null!=o&&re(t,["setup","generationConfig","topP"],o);const a=ie(e,["topK"]);void 0!==t&&null!=a&&re(t,["setup","generationConfig","topK"],a);const l=ie(e,["maxOutputTokens"]);void 0!==t&&null!=l&&re(t,["setup","generationConfig","maxOutputTokens"],l);const c=ie(e,["mediaResolution"]);void 0!==t&&null!=c&&re(t,["setup","generationConfig","mediaResolution"],c);const d=ie(e,["seed"]);void 0!==t&&null!=d&&re(t,["setup","generationConfig","seed"],d);const u=ie(e,["speechConfig"]);void 0!==t&&null!=u&&re(t,["setup","generationConfig","speechConfig"],ls(u));const p=ie(e,["thinkingConfig"]);void 0!==t&&null!=p&&re(t,["setup","generationConfig","thinkingConfig"],p);const m=ie(e,["enableAffectiveDialog"]);void 0!==t&&null!=m&&re(t,["setup","generationConfig","enableAffectiveDialog"],m);const h=ie(e,["systemInstruction"]);void 0!==t&&null!=h&&re(t,["setup","systemInstruction"],ji(ns(h)));const g=ie(e,["tools"]);if(void 0!==t&&null!=g){let e=ds(g);Array.isArray(e)&&(e=e.map(e=>function(e){const t={};if(void 0!==ie(e,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const n=ie(e,["computerUse"]);null!=n&&re(t,["computerUse"],n);const s=ie(e,["fileSearch"]);null!=s&&re(t,["fileSearch"],s);const r=ie(e,["codeExecution"]);null!=r&&re(t,["codeExecution"],r);if(void 0!==ie(e,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const i=ie(e,["functionDeclarations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["functionDeclarations"],e)}const o=ie(e,["googleMaps"]);null!=o&&re(t,["googleMaps"],function(e){const t={};if(void 0!==ie(e,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=ie(e,["enableWidget"]);null!=n&&re(t,["enableWidget"],n);return t}(o));const a=ie(e,["googleSearch"]);null!=a&&re(t,["googleSearch"],function(e){const t={};if(void 0!==ie(e,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ie(e,["blockingConfidence"]))throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=ie(e,["timeRangeFilter"]);null!=n&&re(t,["timeRangeFilter"],n);return t}(a));const l=ie(e,["googleSearchRetrieval"]);null!=l&&re(t,["googleSearchRetrieval"],l);const c=ie(e,["urlContext"]);null!=c&&re(t,["urlContext"],c);return t}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(cs(e)))),re(t,["setup","tools"],e)}const f=ie(e,["sessionResumption"]);void 0!==t&&null!=f&&re(t,["setup","sessionResumption"],function(e){const t={},n=ie(e,["handle"]);null!=n&&re(t,["handle"],n);if(void 0!==ie(e,["transparent"]))throw new Error("transparent parameter is not supported in Gemini API.");return t}(f));const x=ie(e,["inputAudioTranscription"]);void 0!==t&&null!=x&&re(t,["setup","inputAudioTranscription"],x);const b=ie(e,["outputAudioTranscription"]);void 0!==t&&null!=b&&re(t,["setup","outputAudioTranscription"],b);const v=ie(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&re(t,["setup","realtimeInputConfig"],v);const y=ie(e,["contextWindowCompression"]);void 0!==t&&null!=y&&re(t,["setup","contextWindowCompression"],y);const w=ie(e,["proactivity"]);void 0!==t&&null!=w&&re(t,["setup","proactivity"],w);if(void 0!==ie(e,["explicitVadSignal"]))throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}(r,n));return n}(e,o));const a=ie(t,["lockAdditionalFields"]);return void 0!==n&&null!=a&&re(n,["fieldMask"],a),{}}function Ei(e,t){let n=null;const s=e.bidiGenerateContentSetup;if("object"==typeof s&&null!==s&&"setup"in s){const t=s.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else void 0!==s&&delete e.bidiGenerateContentSetup;const r=e.fieldMask;if(n){const s=function(e){const t=[];for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const s=e[n];if("object"==typeof s&&null!=s&&Object.keys(s).length>0){const e=Object.keys(s).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(",")}(n);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&0===(null==t?void 0:t.lockAdditionalFields.length))s?e.fieldMask=s:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==r&&Array.isArray(r)&&r.length>0){const t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let n=[];r.length>0&&(n=r.map(e=>t.includes(e)?`generationConfig.${e}`:e));const i=[];s&&i.push(s),n.length>0&&i.push(...n),i.length>0?e.fieldMask=i.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==r&&Array.isArray(r)&&r.length>0?e.fieldMask=r.join(","):delete e.fieldMask;return e}class Ci extends ne{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const o=function(e,t){const n={},s=ie(t,["config"]);return null!=s&&re(n,["config"],Si(e,s,n)),n}(this.apiClient,e);r=se("auth_tokens",o._url),i=o._query,delete o.config,delete o._url,delete o._query;const a=Ei(o,e.config);return s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>e)}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _i(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["_url","name"],n);const s=ie(e,["config"]);return null!=s&&function(e,t){const n=ie(e,["force"]);void 0!==t&&null!=n&&re(t,["_query","force"],n)}(s,t),t}function ki(e){const t={},n=ie(e,["parent"]);null!=n&&re(t,["_url","parent"],n);const s=ie(e,["config"]);return null!=s&&function(e,t){const n=ie(e,["pageSize"]);void 0!==t&&null!=n&&re(t,["_query","pageSize"],n);const s=ie(e,["pageToken"]);void 0!==t&&null!=s&&re(t,["_query","pageToken"],s)}(s,t),t}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
class Ii extends ne{constructor(e){super(),this.apiClient=e,this.list=async e=>new Ps(gn.PAGED_ITEM_DOCUMENTS,t=>this.listInternal({parent:e.parent,config:t.config}),await this.listInternal(e),e)}async get(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=function(e){const t={},n=ie(e,["name"]);return null!=n&&re(t,["_url","name"],n),t}(e);return r=se("{name}",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>e)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const i=_i(e);s=se("{name}",i._url),r=i._query,delete i._url,delete i._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(i),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=ki(e);return r=se("{parent}/documents",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["nextPageToken"]);null!=s&&re(t,["nextPageToken"],s);const r=ie(e,["documents"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["documents"],e)}return t}(e),n=new Pn;return Object.assign(n,t),n})}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ai extends ne{constructor(e,t=new Ii(e)){super(),this.apiClient=e,this.documents=t,this.list=async(e={})=>new Ps(gn.PAGED_ITEM_FILE_SEARCH_STORES,e=>this.listInternal(e),await this.listInternal(e),e)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=Qr(e);return r=se("fileSearchStores",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>e)}}async get(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=function(e){const t={},n=ie(e,["name"]);return null!=n&&re(t,["_url","name"],n),t}(e);return r=se("{name}",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>e)}}async delete(e){var t,n;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const i=Zr(e);s=se("{name}",i._url),r=i._query,delete i._url,delete i._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(i),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=ni(e);return r=se("fileSearchStores",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["nextPageToken"]);null!=s&&re(t,["nextPageToken"],s);const r=ie(e,["fileSearchStores"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["fileSearchStores"],e)}return t}(e),n=new Ln;return Object.assign(n,t),n})}}async uploadToFileSearchStoreInternal(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=function(e){const t={},n=ie(e,["fileSearchStoreName"]);null!=n&&re(t,["_url","file_search_store_name"],n);const s=ie(e,["config"]);return null!=s&&si(s,t),t}(e);return r=se("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);return null!=n&&re(t,["sdkHttpResponse"],n),t}(e),n=new Mn;return Object.assign(n,t),n})}}async importFile(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=ti(e);return r=se("{file_search_store_name}:importFile",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),s.then(e=>{const t=ei(e),n=new Dn;return Object.assign(n,t),n})}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Ti=function(){const{crypto:e}=globalThis;if(null==e?void 0:e.randomUUID)return Ti=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^n()&15>>+e/4).toString(16))};
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
function Oi(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const Ri=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch(t){}try{return new Error(JSON.stringify(e))}catch(n){}}return new Error(e)};
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Pi extends Error{}class Li extends Pi{constructor(e,t,n,s){super(`${Li.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,n){const s=(null==t?void 0:t.message)?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new Di({message:n,cause:Ri(t)});const r=t;return 400===e?new qi(e,r,n,s):401===e?new Gi(e,r,n,s):403===e?new Hi(e,r,n,s):404===e?new Bi(e,r,n,s):409===e?new Vi(e,r,n,s):422===e?new Fi(e,r,n,s):429===e?new Wi(e,r,n,s):e>=500?new Ji(e,r,n,s):new Li(e,r,n,s)}}class Mi extends Li{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Di extends Li{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Ui extends Di{constructor({message:e}={}){super({message:null!=e?e:"Request timed out."})}}class qi extends Li{}class Gi extends Li{}class Hi extends Li{}class Bi extends Li{}class Vi extends Li{}class Fi extends Li{}class Wi extends Li{}class Ji extends Li{}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const $i=/^[a-z][a-z0-9+.-]*:/i;let zi=e=>(zi=Array.isArray,zi(e));const Yi=zi;const Ki="0.0.1";const Xi=()=>{var e,t,n,s,r;const i="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===i)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ki,"X-Stainless-OS":Zi(Deno.build.os),"X-Stainless-Arch":Qi(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:null!==(t=null===(e=Deno.version)||void 0===e?void 0:e.deno)&&void 0!==t?t:"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ki,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===i)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ki,"X-Stainless-OS":Zi(null!==(n=globalThis.process.platform)&&void 0!==n?n:"unknown"),"X-Stainless-Arch":Qi(null!==(s=globalThis.process.arch)&&void 0!==s?s:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":null!==(r=globalThis.process.version)&&void 0!==r?r:"unknown"};const o=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return o?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ki,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${o.browser}`,"X-Stainless-Runtime-Version":o.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ki,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const Qi=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",Zi=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let eo;function to(...e){const t=globalThis.ReadableStream;if(void 0===t)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function no(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return to({start(){},async pull(e){const{done:n,value:s}=await t.next();n?e.close():e.enqueue(s)},async cancel(){var e;await(null===(e=t.return)||void 0===e?void 0:e.call(t))}})}function so(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return(null==e?void 0:e.done)&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
const ro=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),io=()=>{var e;if("undefined"==typeof File){const{process:t}=globalThis,n="string"==typeof(null===(e=null==t?void 0:t.versions)||void 0===e?void 0:e.node)&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function oo(e,t,n){return io(),new File(e,null!=t?t:"unknown_file",n)}const ao=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function lo(e){var t,n,s,r,i;let o=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)o.push(e);else if(ao(e))o.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!(e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator])(e)){const t=null===(i=null==e?void 0:e.constructor)||void 0===i?void 0:i.name;throw new Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";const t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(e)}`)}try{for(var a,l=!0,c=zs(e);!(t=(a=await c.next()).done);l=!0){r=a.value,l=!1;const e=r;o.push(...await lo(e))}}catch(d){n={error:d}}finally{try{l||t||!(s=c.return)||await s.call(c)}finally{if(n)throw n.error}}}return o}class co{constructor(e){this._client=e}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
function uo(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}co._key=[];const po=Object.freeze(Object.create(null)),mo=((e=uo)=>function(t,...n){if(1===t.length)return t[0];let s=!1;const r=[],i=t.reduce((t,i,o)=>{var a,l,c;/[?#]/.test(i)&&(s=!0);const d=n[o];let u=(s?encodeURIComponent:e)(""+d);return o!==n.length&&(null==d||"object"==typeof d&&d.toString===(null===(c=Object.getPrototypeOf(null!==(l=Object.getPrototypeOf(null!==(a=d.hasOwnProperty)&&void 0!==a?a:po))&&void 0!==l?l:po))||void 0===c?void 0:c.toString))&&(u=d+"",r.push({start:t.length+i.length,length:u.length,error:`Value of type ${Object.prototype.toString.call(d).slice(8,-1)} is not a valid path parameter`})),t+i+(o===n.length?"":u)},""),o=i.split(/[?#]/,1)[0],a=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;let l;for(;null!==(l=a.exec(o));)r.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can't be safely passed as a path parameter`});if(r.sort((e,t)=>e.start-t.start),r.length>0){let e=0;const t=r.reduce((t,n)=>{const s=" ".repeat(n.start-e),r="^".repeat(n.length);return e=n.start+n.length,t+s+r},"");throw new Pi(`Path parameters result in path with invalid segments:\n${r.map(e=>e.error).join("\n")}\n${i}\n${t}`)}return i})(uo);
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
class ho extends co{create(e,t){var n;const{api_version:s=this._client.apiVersion}=e,r=Fs(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new Pi("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new Pi("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(mo`/${s}/interactions`,Object.assign(Object.assign({body:r},t),{stream:null!==(n=e.stream)&&void 0!==n&&n}))}delete(e,t={},n){const{api_version:s=this._client.apiVersion}=null!=t?t:{};return this._client.delete(mo`/${s}/interactions/${e}`,n)}cancel(e,t={},n){const{api_version:s=this._client.apiVersion}=null!=t?t:{};return this._client.post(mo`/${s}/interactions/${e}/cancel`,n)}get(e,t={},n){var s;const r=null!=t?t:{},{api_version:i=this._client.apiVersion}=r,o=Fs(r,["api_version"]);return this._client.get(mo`/${i}/interactions/${e}`,Object.assign(Object.assign({query:o},n),{stream:null!==(s=null==t?void 0:t.stream)&&void 0!==s&&s}))}}ho._key=Object.freeze(["interactions"]);class go extends ho{}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let fo,xo;function bo(e){let t;return(null!=fo?fo:(t=new globalThis.TextEncoder,fo=t.encode.bind(t)))(e)}function vo(e){let t;return(null!=xo?xo:(t=new globalThis.TextDecoder,xo=t.decode.bind(t)))(e)}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yo{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?bo(e):e;this.buffer=function(e){let t=0;for(const r of e)t+=r.length;const n=new Uint8Array(t);let s=0;for(const r of e)n.set(r,s),s+=r.length;return n}([this.buffer,t]);const n=[];let s;for(;null!=(s=wo(this.buffer,this.carriageReturnIndex));){if(s.carriage&&null==this.carriageReturnIndex){this.carriageReturnIndex=s.index;continue}if(null!=this.carriageReturnIndex&&(s.index!==this.carriageReturnIndex+1||s.carriage)){n.push(vo(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const e=null!==this.carriageReturnIndex?s.preceding-1:s.preceding,t=vo(this.buffer.subarray(0,e));n.push(t),this.buffer=this.buffer.subarray(s.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode("\n"):[]}}function wo(e,t){for(let n=null!=t?t:0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function No(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */yo.NEWLINE_CHARS=new Set(["\n","\r"]),yo.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const jo={off:0,error:200,warn:300,info:400,debug:500},So=(e,t,n)=>{var s,r;if(e)return s=jo,r=e,Object.prototype.hasOwnProperty.call(s,r)?e:void Io(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(jo))}`)};function Eo(){}function Co(e,t,n){return!t||jo[e]>jo[n]?Eo:t[e].bind(t)}const _o={error:Eo,warn:Eo,info:Eo,debug:Eo};let ko=new WeakMap;function Io(e){var t;const n=e.logger,s=null!==(t=e.logLevel)&&void 0!==t?t:"off";if(!n)return _o;const r=ko.get(n);if(r&&r[0]===s)return r[1];const i={error:Co("error",n,s),warn:Co("warn",n,s),info:Co("info",n,s),debug:Co("debug",n,s)};return ko.set(n,[s,i]),i}const Ao=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-goog-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class To{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let s=!1;const r=n?Io(n):console;return new To(function(){return $s(this,arguments,function*(){var n,i,o,a;if(s)throw new Pi("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let l=!1;try{try{for(var c,d=!0,u=zs(function(e,t){return $s(this,arguments,function*(){var n,s,r,i;if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new Pi("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new Pi("Attempted to iterate over a response with no body")}const o=new Oo,a=new yo,l=so(e.body);try{for(var c,d=!0,u=zs(function(e){return $s(this,arguments,function*(){var t,n,s,r;let i=new Uint8Array;try{for(var o,a=!0,l=zs(e);!(t=(o=yield Js(l.next())).done);a=!0){r=o.value,a=!1;const e=r;if(null==e)continue;const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?bo(e):e;let n,s=new Uint8Array(i.length+t.length);for(s.set(i),s.set(t,i.length),i=s;-1!==(n=No(i));)yield yield Js(i.slice(0,n)),i=i.slice(n)}}catch(c){n={error:c}}finally{try{a||t||!(s=l.return)||(yield Js(s.call(l)))}finally{if(n)throw n.error}}i.length>0&&(yield yield Js(i))})}(l));!(n=(c=yield Js(u.next())).done);d=!0){i=c.value,d=!1;const e=i;for(const t of a.decode(e)){const e=o.decode(t);e&&(yield yield Js(e))}}}catch(p){s={error:p}}finally{try{d||n||!(r=u.return)||(yield Js(r.call(u)))}finally{if(s)throw s.error}}for(const e of a.flush()){const t=o.decode(e);t&&(yield yield Js(t))}})}(e,t));!(n=(c=yield Js(u.next())).done);d=!0){a=c.value,d=!1;const e=a;if(!l)if(e.data.startsWith("[DONE]"))l=!0;else try{yield yield Js(JSON.parse(e.data))}catch(p){throw r.error("Could not parse message into JSON:",e.data),r.error("From chunk:",e.raw),p}}}catch(m){i={error:m}}finally{try{d||n||!(o=u.return)||(yield Js(o.call(u)))}finally{if(i)throw i.error}}l=!0}catch(p){if(Oi(p))return yield Js(void 0);throw p}finally{l||t.abort()}})},t,n)}static fromReadableStream(e,t,n){let s=!1;return new To(function(){return $s(this,arguments,function*(){var n,r,i,o;if(s)throw new Pi("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{try{for(var l,c=!0,d=zs(function(){return $s(this,arguments,function*(){var t,n,s,r;const i=new yo,o=so(e);try{for(var a,l=!0,c=zs(o);!(t=(a=yield Js(c.next())).done);l=!0){r=a.value,l=!1;const e=r;for(const t of i.decode(e))yield yield Js(t)}}catch(d){n={error:d}}finally{try{l||t||!(s=c.return)||(yield Js(s.call(c)))}finally{if(n)throw n.error}}for(const e of i.flush())yield yield Js(e)})}());!(n=(l=yield Js(d.next())).done);c=!0){o=l.value,c=!1;const e=o;a||e&&(yield yield Js(JSON.parse(e)))}}catch(u){r={error:u}}finally{try{c||n||!(i=d.return)||(yield Js(i.call(d)))}finally{if(r)throw r.error}}a=!0}catch(p){if(Oi(p))return yield Js(void 0);throw p}finally{a||t.abort()}})},t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=s=>({next:()=>{if(0===s.length){const s=n.next();e.push(s),t.push(s)}return s.shift()}});return[new To(()=>s(e),this.controller,this.client),new To(()=>s(t),this.controller,this.client)]}toReadableStream(){const e=this;let t;return to({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:s}=await t.next();if(s)return e.close();const r=bo(JSON.stringify(n)+"\n");e.enqueue(r)}catch(n){e.error(n)}},async cancel(){var e;await(null===(e=t.return)||void 0===e?void 0:e.call(t))}})}}class Oo{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(e,":");return s.startsWith(" ")&&(s=s.substring(1)),"event"===t?this.event=s:"data"===t&&this.data.push(s),null}}async function Ro(e,t){const{response:n,requestLogID:s,retryOfRequestLogID:r,startTime:i}=t,o=await(async()=>{var s;if(t.options.stream)return Io(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):To.fromSSEResponse(n,t.controller,e);if(204===n.status)return null;if(t.options.__binaryResponse)return n;const r=n.headers.get("content-type"),i=null===(s=null==r?void 0:r.split(";")[0])||void 0===s?void 0:s.trim();if((null==i?void 0:i.includes("application/json"))||(null==i?void 0:i.endsWith("+json"))){return await n.json()}return await n.text()})();return Io(e).debug(`[${s}] response parsed`,Ao({retryOfRequestLogID:r,url:n.url,status:n.status,body:o,durationMs:Date.now()-i})),o}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Po extends Promise{constructor(e,t,n=Ro){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new Po(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Lo=Symbol("brand.privateNullableHeaders");function*Mo(e){if(!e)return;if(Lo in e){const{values:t,nulls:n}=e;yield*t.entries();for(const e of n)yield[e,null];return}let t,n=!1;e instanceof Headers?t=e.entries():Yi(e)?t=e:(n=!0,t=Object.entries(null!=e?e:{}));for(let s of t){const e=s[0];if("string"!=typeof e)throw new TypeError("expected header name to be a string");const t=Yi(s[1])?s[1]:[s[1]];let r=!1;for(const s of t)void 0!==s&&(n&&!r&&(r=!0,yield[e,null]),yield[e,s])}}const Do=e=>{const t=new Headers,n=new Set;for(const s of e){const e=new Set;for(const[r,i]of Mo(s)){const s=r.toLowerCase();e.has(s)||(t.delete(r),e.add(s)),null===i?(t.delete(r),n.add(s)):(t.append(r,i),n.delete(s))}}return{[Lo]:!0,values:t,nulls:n}},Uo=e=>{var t,n,s,r,i,o;return void 0!==globalThis.process?null!==(s=null===(n=null===(t=Q)||void 0===t?void 0:t[e])||void 0===n?void 0:n.trim())&&void 0!==s?s:void 0:void 0!==globalThis.Deno?null===(o=null===(i=null===(r=globalThis.Deno.env)||void 0===r?void 0:r.get)||void 0===i?void 0:i.call(r,e))||void 0===o?void 0:o.trim():void 0};
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
var qo;class Go{constructor(e){var t,n,s,r,i,o,a,{baseURL:l=Uo("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:c=(null!==(t=Uo("GEMINI_API_KEY"))&&void 0!==t?t:null),apiVersion:d="v1beta"}=e,u=Fs(e,["baseURL","apiKey","apiVersion"]);const p=Object.assign(Object.assign({apiKey:c,apiVersion:d},u),{baseURL:l||"https://generativelanguage.googleapis.com"});this.baseURL=p.baseURL,this.timeout=null!==(n=p.timeout)&&void 0!==n?n:Go.DEFAULT_TIMEOUT,this.logger=null!==(s=p.logger)&&void 0!==s?s:console;const m="warn";this.logLevel=m,this.logLevel=null!==(i=null!==(r=So(p.logLevel,"ClientOptions.logLevel",this))&&void 0!==r?r:So(Uo("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))&&void 0!==i?i:m,this.fetchOptions=p.fetchOptions,this.maxRetries=null!==(o=p.maxRetries)&&void 0!==o?o:2,this.fetch=null!==(a=p.fetch)&&void 0!==a?a:
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
function(){if("undefined"!=typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),this.encoder=ro,this._options=p,this.apiKey=c,this.apiVersion=d,this.clientAdapter=p.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return"https://generativelanguage.googleapis.com"!==this.baseURL}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!e.has("authorization")&&!e.has("x-goog-api-key")&&!(this.apiKey&&e.get("x-goog-api-key")||t.has("x-goog-api-key")))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const t=Do([e.headers]);if(!t.values.has("authorization")&&!t.values.has("x-goog-api-key"))return this.apiKey?Do([{"x-goog-api-key":this.apiKey}]):this.clientAdapter.isVertexAI()?Do([await this.clientAdapter.getAuthHeaders()]):void 0}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new Pi(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Ki}`}defaultIdempotencyKey(){return`stainless-node-retry-${Ti()}`}makeStatusError(e,t,n,s){return Li.generate(e,t,n,s)}buildURL(e,t,n){const s=!this.baseURLOverridden()&&n||this.baseURL,r=(e=>$i.test(e))(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(i)||(t=Object.assign(Object.assign({},i),t)),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>Object.assign({method:e,path:t},n)))}request(e,t=null){return new Po(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var s,r,i;const o=await e,a=null!==(s=o.maxRetries)&&void 0!==s?s:this.maxRetries;null==t&&(t=a),await this.prepareOptions(o);const{req:l,url:c,timeout:d}=await this.buildRequest(o,{retryCount:a-t});await this.prepareRequest(l,{url:c,options:o});const u="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),p=void 0===n?"":`, retryOf: ${n}`,m=Date.now();if(Io(this).debug(`[${u}] sending request`,Ao({retryOfRequestLogID:n,method:o.method,url:c,options:o,headers:l.headers})),null===(r=o.signal)||void 0===r?void 0:r.aborted)throw new Mi;const h=new AbortController,g=await this.fetchWithTimeout(c,l,d,h).catch(Ri),f=Date.now();if(g instanceof globalThis.Error){const e=`retrying, ${t} attempts remaining`;if(null===(i=o.signal)||void 0===i?void 0:i.aborted)throw new Mi;const s=Oi(g)||/timed? ?out/i.test(String(g)+("cause"in g?String(g.cause):""));if(t)return Io(this).info(`[${u}] connection ${s?"timed out":"failed"} - ${e}`),Io(this).debug(`[${u}] connection ${s?"timed out":"failed"} (${e})`,Ao({retryOfRequestLogID:n,url:c,durationMs:f-m,message:g.message})),this.retryRequest(o,t,null!=n?n:u);if(Io(this).info(`[${u}] connection ${s?"timed out":"failed"} - error; no more retries left`),Io(this).debug(`[${u}] connection ${s?"timed out":"failed"} (error; no more retries left)`,Ao({retryOfRequestLogID:n,url:c,durationMs:f-m,message:g.message})),s)throw new Ui;throw new Di({cause:g})}const x=`[${u}${p}] ${l.method} ${c} ${g.ok?"succeeded":"failed"} with status ${g.status} in ${f-m}ms`;if(!g.ok){const e=await this.shouldRetry(g);if(t&&e){const e=`retrying, ${t} attempts remaining`;return await async function(e){var t,n;if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void(await(null===(n=(t=e[Symbol.asyncIterator]()).return)||void 0===n?void 0:n.call(t)));const s=e.getReader(),r=s.cancel();s.releaseLock(),await r}(g.body),Io(this).info(`${x} - ${e}`),Io(this).debug(`[${u}] response error (${e})`,Ao({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,durationMs:f-m})),this.retryRequest(o,t,null!=n?n:u,g.headers)}const s=e?"error; no more retries left":"error; not retryable";Io(this).info(`${x} - ${s}`);const r=await g.text().catch(e=>Ri(e).message),i=(e=>{try{return JSON.parse(e)}catch(t){return}})(r),a=i?void 0:r;Io(this).debug(`[${u}] response error (${s})`,Ao({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,message:a,durationMs:Date.now()-m}));throw this.makeStatusError(g.status,i,a,g.headers)}return Io(this).info(x),Io(this).debug(`[${u}] response start`,Ao({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,durationMs:f-m})),{response:g,options:o,controller:h,requestLogID:u,retryOfRequestLogID:n,startTime:m}}async fetchWithTimeout(e,t,n,s){const r=t||{},{signal:i,method:o}=r,a=Fs(r,["signal","method"]);i&&i.addEventListener("abort",()=>s.abort());const l=setTimeout(()=>s.abort(),n),c=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,d=Object.assign(Object.assign(Object.assign({signal:s.signal},c?{duplex:"half"}:{}),{method:"GET"}),a);o&&(d.method=o.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(l)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n,s){var r;let i;const o=null==s?void 0:s.get("retry-after-ms");if(o){const e=parseFloat(o);Number.isNaN(e)||(i=e)}const a=null==s?void 0:s.get("retry-after");if(a&&!i){const e=parseFloat(a);i=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(i&&0<=i&&i<6e4)){const n=null!==(r=e.maxRetries)&&void 0!==r?r:this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,n)}var l;return await(l=i,new Promise(e=>setTimeout(e,l))),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,s,r;const i=Object.assign({},e),{method:o,path:a,query:l,defaultBaseURL:c}=i,d=this.buildURL(a,l,c);"timeout"in i&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new Pi(`${e} must be an integer`);if(t<0)throw new Pi(`${e} must be a positive integer`)})("timeout",i.timeout),i.timeout=null!==(n=i.timeout)&&void 0!==n?n:this.timeout;const{bodyHeaders:u,body:p}=this.buildBody({options:i}),m=await this.buildHeaders({options:e,method:o,bodyHeaders:u,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:o,headers:m},i.signal&&{signal:i.signal}),globalThis.ReadableStream&&p instanceof globalThis.ReadableStream&&{duplex:"half"}),p&&{body:p}),null!==(s=this.fetchOptions)&&void 0!==s?s:{}),null!==(r=i.fetchOptions)&&void 0!==r?r:{}),url:d,timeout:i.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:s}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const i=await this.authHeaders(e);let o=Do([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),null!=eo?eo:eo=Xi()),this._options.defaultHeaders,n,e.headers,i]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=Do([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:no(e)}:this.encoder({body:e,headers:n})}}Go.DEFAULT_TIMEOUT=6e4;class Ho extends Go{constructor(){super(...arguments),this.interactions=new go(this)}}function Bo(e,t){const n={},s=ie(e,["baseModel"]);null!=s&&re(n,["baseModel"],s);const r=ie(e,["preTunedModel"]);null!=r&&re(n,["preTunedModel"],r);const i=ie(e,["trainingDataset"]);null!=i&&function(e){const t={};if(void 0!==ie(e,["gcsUri"]))throw new Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==ie(e,["vertexDatasetResource"]))throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=ie(e,["examples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),re(t,["examples","examples"],e)}}(i);const o=ie(e,["config"]);return null!=o&&function(e,t){const n={};if(void 0!==ie(e,["validationDataset"]))throw new Error("validationDataset parameter is not supported in Gemini API.");const s=ie(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=s&&re(t,["displayName"],s),void 0!==ie(e,["description"]))throw new Error("description parameter is not supported in Gemini API.");const r=ie(e,["epochCount"]);void 0!==t&&null!=r&&re(t,["tuningTask","hyperparameters","epochCount"],r);const i=ie(e,["learningRateMultiplier"]);if(null!=i&&re(n,["tuningTask","hyperparameters","learningRateMultiplier"],i),void 0!==ie(e,["exportLastCheckpointOnly"]))throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==ie(e,["preTunedModelCheckpointId"]))throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==ie(e,["adapterSize"]))throw new Error("adapterSize parameter is not supported in Gemini API.");const o=ie(e,["batchSize"]);void 0!==t&&null!=o&&re(t,["tuningTask","hyperparameters","batchSize"],o);const a=ie(e,["learningRate"]);if(void 0!==t&&null!=a&&re(t,["tuningTask","hyperparameters","learningRate"],a),void 0!==ie(e,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");if(void 0!==ie(e,["beta"]))throw new Error("beta parameter is not supported in Gemini API.")}(o,n),n}function Vo(e,t){const n={},s=ie(e,["baseModel"]);null!=s&&re(n,["baseModel"],s);const r=ie(e,["preTunedModel"]);null!=r&&re(n,["preTunedModel"],r);const i=ie(e,["trainingDataset"]);null!=i&&function(e,t,n){const s={};let r=ie(n,["config","method"]);void 0===r&&(r="SUPERVISED_FINE_TUNING");if("SUPERVISED_FINE_TUNING"===r){const n=ie(e,["gcsUri"]);void 0!==t&&null!=n&&re(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===r){const n=ie(e,["gcsUri"]);void 0!==t&&null!=n&&re(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}let i=ie(n,["config","method"]);void 0===i&&(i="SUPERVISED_FINE_TUNING");if("SUPERVISED_FINE_TUNING"===i){const n=ie(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&re(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===i){const n=ie(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&re(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}if(void 0!==ie(e,["examples"]))throw new Error("examples parameter is not supported in Vertex AI.")}(i,n,t);const o=ie(e,["config"]);return null!=o&&function(e,t,n){let s=ie(n,["config","method"]);if(void 0===s&&(s="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===s){const n=ie(e,["validationDataset"]);void 0!==t&&null!=n&&re(t,["supervisedTuningSpec"],zo(n))}else if("PREFERENCE_TUNING"===s){const n=ie(e,["validationDataset"]);void 0!==t&&null!=n&&re(t,["preferenceOptimizationSpec"],zo(n))}const r=ie(e,["tunedModelDisplayName"]);void 0!==t&&null!=r&&re(t,["tunedModelDisplayName"],r);const i=ie(e,["description"]);void 0!==t&&null!=i&&re(t,["description"],i);let o=ie(n,["config","method"]);if(void 0===o&&(o="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===o){const n=ie(e,["epochCount"]);void 0!==t&&null!=n&&re(t,["supervisedTuningSpec","hyperParameters","epochCount"],n)}else if("PREFERENCE_TUNING"===o){const n=ie(e,["epochCount"]);void 0!==t&&null!=n&&re(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],n)}let a=ie(n,["config","method"]);if(void 0===a&&(a="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===a){const n=ie(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&re(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],n)}else if("PREFERENCE_TUNING"===a){const n=ie(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&re(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],n)}let l=ie(n,["config","method"]);if(void 0===l&&(l="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===l){const n=ie(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&re(t,["supervisedTuningSpec","exportLastCheckpointOnly"],n)}else if("PREFERENCE_TUNING"===l){const n=ie(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&re(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],n)}let c=ie(n,["config","method"]);if(void 0===c&&(c="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===c){const n=ie(e,["adapterSize"]);void 0!==t&&null!=n&&re(t,["supervisedTuningSpec","hyperParameters","adapterSize"],n)}else if("PREFERENCE_TUNING"===c){const n=ie(e,["adapterSize"]);void 0!==t&&null!=n&&re(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],n)}if(void 0!==ie(e,["batchSize"]))throw new Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==ie(e,["learningRate"]))throw new Error("learningRate parameter is not supported in Vertex AI.");const d=ie(e,["labels"]);void 0!==t&&null!=d&&re(t,["labels"],d);const u=ie(e,["beta"]);void 0!==t&&null!=u&&re(t,["preferenceOptimizationSpec","hyperParameters","beta"],u)}(o,n,t),n}function Fo(e,t){const n={},s=ie(e,["config"]);return null!=s&&function(e,t){const n=ie(e,["pageSize"]);void 0!==t&&null!=n&&re(t,["_query","pageSize"],n);const s=ie(e,["pageToken"]);void 0!==t&&null!=s&&re(t,["_query","pageToken"],s);const r=ie(e,["filter"]);void 0!==t&&null!=r&&re(t,["_query","filter"],r)}(s,n),n}function Wo(e,t){const n={},s=ie(e,["config"]);return null!=s&&function(e,t){const n=ie(e,["pageSize"]);void 0!==t&&null!=n&&re(t,["_query","pageSize"],n);const s=ie(e,["pageToken"]);void 0!==t&&null!=s&&re(t,["_query","pageToken"],s);const r=ie(e,["filter"]);void 0!==t&&null!=r&&re(t,["_query","filter"],r)}(s,n),n}function Jo(e,t){const n={},s=ie(e,["sdkHttpResponse"]);null!=s&&re(n,["sdkHttpResponse"],s);const r=ie(e,["name"]);null!=r&&re(n,["name"],r);const i=ie(e,["state"]);null!=i&&re(n,["state"],ps(i));const o=ie(e,["createTime"]);null!=o&&re(n,["createTime"],o);const a=ie(e,["tuningTask","startTime"]);null!=a&&re(n,["startTime"],a);const l=ie(e,["tuningTask","completeTime"]);null!=l&&re(n,["endTime"],l);const c=ie(e,["updateTime"]);null!=c&&re(n,["updateTime"],c);const d=ie(e,["description"]);null!=d&&re(n,["description"],d);const u=ie(e,["baseModel"]);null!=u&&re(n,["baseModel"],u);const p=ie(e,["_self"]);return null!=p&&re(n,["tunedModel"],function(e){const t={},n=ie(e,["name"]);null!=n&&re(t,["model"],n);const s=ie(e,["name"]);return null!=s&&re(t,["endpoint"],s),t}(p)),n}function $o(e,t){const n={},s=ie(e,["sdkHttpResponse"]);null!=s&&re(n,["sdkHttpResponse"],s);const r=ie(e,["name"]);null!=r&&re(n,["name"],r);const i=ie(e,["state"]);null!=i&&re(n,["state"],ps(i));const o=ie(e,["createTime"]);null!=o&&re(n,["createTime"],o);const a=ie(e,["startTime"]);null!=a&&re(n,["startTime"],a);const l=ie(e,["endTime"]);null!=l&&re(n,["endTime"],l);const c=ie(e,["updateTime"]);null!=c&&re(n,["updateTime"],c);const d=ie(e,["error"]);null!=d&&re(n,["error"],d);const u=ie(e,["description"]);null!=u&&re(n,["description"],u);const p=ie(e,["baseModel"]);null!=p&&re(n,["baseModel"],p);const m=ie(e,["tunedModel"]);null!=m&&re(n,["tunedModel"],m);const h=ie(e,["preTunedModel"]);null!=h&&re(n,["preTunedModel"],h);const g=ie(e,["supervisedTuningSpec"]);null!=g&&re(n,["supervisedTuningSpec"],g);const f=ie(e,["preferenceOptimizationSpec"]);null!=f&&re(n,["preferenceOptimizationSpec"],f);const x=ie(e,["tuningDataStats"]);null!=x&&re(n,["tuningDataStats"],x);const b=ie(e,["encryptionSpec"]);null!=b&&re(n,["encryptionSpec"],b);const v=ie(e,["partnerModelTuningSpec"]);null!=v&&re(n,["partnerModelTuningSpec"],v);const y=ie(e,["customBaseModel"]);null!=y&&re(n,["customBaseModel"],y);const w=ie(e,["experiment"]);null!=w&&re(n,["experiment"],w);const N=ie(e,["labels"]);null!=N&&re(n,["labels"],N);const j=ie(e,["outputUri"]);null!=j&&re(n,["outputUri"],j);const S=ie(e,["pipelineJob"]);null!=S&&re(n,["pipelineJob"],S);const E=ie(e,["serviceAccount"]);null!=E&&re(n,["serviceAccount"],E);const C=ie(e,["tunedModelDisplayName"]);null!=C&&re(n,["tunedModelDisplayName"],C);const _=ie(e,["veoTuningSpec"]);return null!=_&&re(n,["veoTuningSpec"],_),n}function zo(e,t){const n={},s=ie(e,["gcsUri"]);null!=s&&re(n,["validationDatasetUri"],s);const r=ie(e,["vertexDatasetResource"]);return null!=r&&re(n,["validationDatasetUri"],r),n}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */qo=Ho,Ho.GeminiNextGenAPIClient=qo,Ho.GeminiNextGenAPIClientError=Pi,Ho.APIError=Li,Ho.APIConnectionError=Di,Ho.APIConnectionTimeoutError=Ui,Ho.APIUserAbortError=Mi,Ho.NotFoundError=Bi,Ho.ConflictError=Vi,Ho.RateLimitError=Wi,Ho.BadRequestError=qi,Ho.AuthenticationError=Gi,Ho.InternalServerError=Ji,Ho.PermissionDeniedError=Hi,Ho.UnprocessableEntityError=Fi,Ho.toFile=async function(e,t,n){if(io(),(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&ao(e))(e=await e))return e instanceof File?e:oo([await e.arrayBuffer()],e.name);if((e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob)(e)){const s=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),oo(await lo(s),t,n)}const s=await lo(e);if(t||(t=function(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}(e)),!(null==n?void 0:n.type)){const e=s.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(n=Object.assign(Object.assign({},n),{type:e}))}return oo(s,t,n)},Ho.Interactions=go;class Yo extends ne{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new Ps(gn.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.get=async e=>await this.getInternal(e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI()){if(e.baseModel.startsWith("projects/")){const n={tunedModelName:e.baseModel};(null===(t=e.config)||void 0===t?void 0:t.preTunedModelCheckpointId)&&(n.checkpointId=e.config.preTunedModelCheckpointId);const s=Object.assign(Object.assign({},e),{preTunedModel:n});return s.baseModel=void 0,await this.tuneInternal(s)}{const t=Object.assign({},e);return await this.tuneInternal(t)}}{const t=Object.assign({},e),n=await this.tuneMldevInternal(t);let s="";void 0!==n.metadata&&void 0!==n.metadata.tunedModel?s=n.metadata.tunedModel:void 0!==n.name&&n.name.includes("/operations/")&&(s=n.name.split("/operations/")[0]);return{name:s,state:lt.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=function(e){const t={},n=ie(e,["name"]);return null!=n&&re(t,["_url","name"],n),t}(e);return o=se("{name}",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>$o(e))}{const t=function(e){const t={},n=ie(e,["name"]);return null!=n&&re(t,["_url","name"],n),t}(e);return o=se("{name}",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>Jo(e))}}async listInternal(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=Wo(e);return o=se("tuningJobs",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["nextPageToken"]);null!=s&&re(t,["nextPageToken"],s);const r=ie(e,["tuningJobs"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>$o(e))),re(t,["tuningJobs"],e)}return t}(e),n=new An;return Object.assign(n,t),n})}{const t=Fo(e);return o=se("tunedModels",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["nextPageToken"]);null!=s&&re(t,["nextPageToken"],s);const r=ie(e,["tunedModels"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>Jo(e))),re(t,["tuningJobs"],e)}return t}(e),n=new An;return Object.assign(n,t),n})}}async cancel(e){var t,n,s,r;let i,o="",a={};if(this.apiClient.isVertexAI()){const s=function(e){const t={},n=ie(e,["name"]);return null!=n&&re(t,["_url","name"],n),t}(e);return o=se("{name}:cancel",s._url),a=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);return null!=n&&re(t,["sdkHttpResponse"],n),t}(e),n=new Tn;return Object.assign(n,t),n})}{const t=
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
function(e){const t={},n=ie(e,["name"]);return null!=n&&re(t,["_url","name"],n),t}(e);return o=se("{name}:cancel",t._url),a=t._query,delete t._url,delete t._query,i=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(s=e.config)||void 0===s?void 0:s.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=ie(e,["sdkHttpResponse"]);return null!=n&&re(t,["sdkHttpResponse"],n),t}(e),n=new Tn;return Object.assign(n,t),n})}}async tuneInternal(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI()){const o=Vo(e,e);return r=se("tuningJobs",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),s.then(e=>$o(e))}throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let s,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=Bo(e);return r=se("tunedModels",o._url),i=o._query,delete o._url,delete o._query,s=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),s.then(e=>function(e){const t={},n=ie(e,["sdkHttpResponse"]);null!=n&&re(t,["sdkHttpResponse"],n);const s=ie(e,["name"]);null!=s&&re(t,["name"],s);const r=ie(e,["metadata"]);null!=r&&re(t,["metadata"],r);const i=ie(e,["done"]);null!=i&&re(t,["done"],i);const o=ie(e,["error"]);return null!=o&&re(t,["error"],o),t}(e))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ko{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Xo="x-goog-upload-status";async function Qo(e,t,n){var s,r;let i=0,o=0,a=new xn(new Response),l="upload";for(i=e.size;o<i;){const c=Math.min(8388608,i-o),d=e.slice(o,o+c);o+c>=i&&(l+=", finalize");let u=0,p=1e3;for(;u<3&&(a=await n.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(o),"Content-Length":String(c)}}}),!(null===(s=null==a?void 0:a.headers)||void 0===s?void 0:s[Xo]));)u++,await Zo(p),p*=2;if(o+=c,"active"!==(null===(r=null==a?void 0:a.headers)||void 0===r?void 0:r[Xo]))break;if(i<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}function Zo(e){return new Promise(t=>setTimeout(t,e))}class ea{async upload(e,t,n){if("string"==typeof e)throw new Error("File path is not supported in browser uploader.");return await async function(e,t,n){var s;const r=await Qo(e,t,n),i=await(null==r?void 0:r.json());if("final"!==(null===(s=null==r?void 0:r.headers)||void 0===s?void 0:s[Xo]))throw new Error("Failed to upload file: Upload status is not finalized.");return i.file}(e,t,n)}async uploadToFileSearchStore(e,t,n){if("string"==typeof e)throw new Error("File path is not supported in browser uploader.");return await async function(e,t,n){var s;const r=await Qo(e,t,n),i=await(null==r?void 0:r.json());if("final"!==(null===(s=null==r?void 0:r.headers)||void 0===s?void 0:s[Xo]))throw new Error("Failed to upload file: Upload status is not finalized.");const o=ue(i),a=new Fn;return Object.assign(a,o),a}(e,t,n)}async stat(e){if("string"==typeof e)throw new Error("File path is not supported in browser uploader.");return await async function(e){return{size:e.size,type:e.type}}(e)}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ta{create(e,t,n){return new na(e,t,n)}}class na{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw new Error("WebSocket is not connected");this.ws.close()}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const sa="x-goog-api-key";class ra{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(null===e.get(sa)){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(sa,this.apiKey)}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ia{get interactions(){if(void 0!==this._interactions)return this._interactions;const e=this.httpOptions;null==e||e.extraBody;const t=new Ho({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:null==e?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(null==e.apiKey)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=null!==(t=e.vertexai)&&void 0!==t&&t,this.apiKey=e.apiKey;const n=te(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const s=new ra(this.apiKey);this.apiClient=new ii({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:"gl-node/web",uploader:new ea,downloader:new Ko}),this.models=new wi(this.apiClient),this.live=new hi(this.apiClient,s,new ta),this.batches=new Ls(this.apiClient),this.chats=new Qs(this.models,this.apiClient),this.caches=new Vs(this.apiClient),this.files=new nr(this.apiClient),this.operations=new Ni(this.apiClient),this.authTokens=new Ci(this.apiClient),this.tunings=new Yo(this.apiClient),this.fileSearchStores=new Ai(this.apiClient)}}var oa={};const aa=({message:e,type:t,onClose:n})=>{const s={success:{bg:"bg-emerald-950",border:"border-emerald-500/50",icon:g.jsx("svg",{className:"w-5 h-5 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{d:"M5 13l4 4L19 7"})}),label:"SUCCESS"},error:{bg:"bg-rose-950",border:"border-rose-500/50",icon:g.jsx("svg",{className:"w-5 h-5 text-rose-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{d:"M6 18L18 6M6 6l12 12"})}),label:"CRITICAL"},info:{bg:"bg-slate-900",border:"border-indigo-500/50",icon:g.jsx("svg",{className:"w-5 h-5 text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),label:"SYSTEM"},warning:{bg:"bg-amber-950",border:"border-amber-500/50",icon:g.jsx("svg",{className:"w-5 h-5 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),label:"ALERT"}}[t];return g.jsx("div",{className:"fixed top-4 left-4 right-4 sm:left-auto sm:right-6 sm:max-w-md z-[1000] animate-fadeIn no-print",children:g.jsxs("div",{className:`${s.bg} ${s.border} border-l-4 rounded-xl shadow-2xl p-4 flex items-center gap-4 relative overflow-hidden group`,children:[g.jsx("div",{className:"shrink-0 bg-white/5 p-2 rounded-lg border border-white/10 shadow-inner",children:s.icon}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"flex items-center gap-2 mb-0.5",children:g.jsx("span",{className:"text-[9px] font-bold uppercase tracking-widest "+("success"===t?"text-emerald-400":"error"===t?"text-rose-400":"info"===t?"text-indigo-400":"text-amber-400"),children:s.label})}),g.jsx("p",{className:"text-white text-xs font-medium leading-relaxed truncate opacity-90",children:e})]}),g.jsx("button",{onClick:n,className:"p-1.5 text-white/30 hover:text-white hover:bg-white/10 rounded-lg transition-all active:scale-90",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]})})},la=({onClose:t,onPrint:n,children:s,title:r})=>{const[i,o]=e.useState(!1);return g.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-md animate-fadeIn no-print",children:g.jsxs("div",{className:"bg-white w-full max-w-5xl h-[94vh] rounded-3xl shadow-2xl flex flex-col overflow-hidden border border-white/20",children:[g.jsxs("div",{className:"px-6 py-4 border-b flex justify-between items-center bg-slate-50 border-slate-200",children:[g.jsx("div",{className:"flex items-center gap-6",children:g.jsxs("button",{onClick:t,className:"text-sm font-bold text-slate-500 hover:text-slate-800 transition-colors uppercase tracking-wider flex items-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Close"]})}),g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsxs("button",{onClick:()=>{o(!0);const e=document.getElementById("printable-report-content");if(!e)return void o(!1);const t={margin:0,filename:`${r.replace(/[^a-zA-Z0-9]/g,"_")}_${(new Date).toISOString().split("T")[0]}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,letterRendering:!0,scrollY:0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}},s=window.html2pdf;s?s().set(t).from(e).save().then(()=>{o(!1)}).catch(e=>{o(!1),alert("Failed to generate PDF. You can use the Print button as a fallback.")}):(n(),o(!1))},disabled:i,className:"px-5 py-2.5 text-xs font-bold text-white bg-slate-900 hover:bg-black rounded-xl shadow-lg flex items-center gap-2 transition-all active:scale-95 disabled:bg-slate-400",children:[i?g.jsxs("svg",{className:"animate-spin w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download PDF"]}),g.jsxs("button",{onClick:n,className:"hidden sm:flex px-5 py-2.5 text-xs font-bold text-slate-700 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-all items-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print"]})]})]}),g.jsx("div",{className:"flex-1 overflow-auto bg-slate-100 p-4 sm:p-10 flex justify-center relative",children:g.jsx("div",{className:"origin-top transform scale-[0.9] lg:scale-100 transition-transform duration-500",children:g.jsx("div",{id:"printable-report-content",className:"bg-white shadow-2xl min-h-[297mm] relative z-10 w-[210mm] print:shadow-none",children:s})})})]})})},ca=({status:e,onClose:t,onViewReport:n,aiAnalysis:s})=>"idle"===e?null:g.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center overflow-y-auto py-10",children:[g.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md transition-all duration-300"}),g.jsxs("div",{className:"relative bg-white rounded-3xl shadow-2xl p-6 sm:p-8 w-full mx-4 text-center transform transition-all duration-300 scale-100 animate-fadeIn border border-white/20 max-w-xl my-auto",children:["submitting"===e&&g.jsxs("div",{className:"flex flex-col items-center gap-4 py-10",children:[g.jsxs("div",{className:"relative",children:[g.jsx("div",{className:"w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"}),g.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:g.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})})]}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-bold text-gray-900 uppercase tracking-tight",children:"Uploading Inspection"}),g.jsx("p",{className:"text-xs text-gray-500 mt-1 font-medium uppercase tracking-widest opacity-60",children:"Syncing with Fleet Database..."})]})]}),"success"===e&&g.jsxs("div",{className:"flex flex-col items-center gap-6 py-4 animate-fadeIn",children:[g.jsx("div",{className:"w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center shadow-inner",children:g.jsx("svg",{className:"w-8 h-8 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-xl font-black text-gray-900 uppercase tracking-tighter",children:"Submission Successful"}),g.jsx("p",{className:"text-xs text-slate-500 mt-1 font-medium uppercase tracking-widest",children:"Fleet repository updated"})]}),g.jsxs("div",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl p-5 text-left relative overflow-hidden",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[g.jsx("div",{className:"w-6 h-6 bg-indigo-600 rounded-lg flex items-center justify-center text-white",children:g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),g.jsx("h4",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-[0.2em]",children:"Safety AI Insights"})]}),s?g.jsx("div",{className:"animate-fadeIn",children:g.jsx("p",{className:"text-xs font-medium text-slate-700 leading-relaxed whitespace-pre-wrap",children:s})}):g.jsxs("div",{className:"flex flex-col items-center py-6 gap-3",children:[g.jsxs("svg",{className:"animate-spin h-5 w-5 text-indigo-400",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),g.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest animate-pulse",children:"Analyzing Vehicle Condition..."})]})]}),g.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full",children:[g.jsxs("button",{onClick:n,className:"w-full py-4 bg-white border border-slate-200 text-slate-700 font-bold rounded-xl shadow-sm hover:bg-slate-50 transition-all flex items-center justify-center gap-2 text-[10px] uppercase tracking-widest",children:[g.jsxs("svg",{className:"w-4 h-4 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:[g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Digital PDF"]}),g.jsx("button",{onClick:t,className:"w-full py-4 bg-slate-900 text-white font-black rounded-xl shadow-lg hover:bg-black transition-all flex items-center justify-center gap-2 text-[10px] uppercase tracking-widest active:scale-95",children:"Return Home"})]})]}),"offline_saved"===e&&g.jsxs("div",{className:"flex flex-col items-center gap-4 py-10",children:[g.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center shadow-inner",children:g.jsx("svg",{className:"w-10 h-10 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-xl font-black text-gray-900 uppercase tracking-tighter",children:"Offline Saved"}),g.jsx("p",{className:"text-sm text-gray-500 mt-2 leading-relaxed font-medium",children:"Data stored on-device. Sync will resume automatically when internet returns."})]}),g.jsx("button",{onClick:t,className:"w-full mt-4 py-4 bg-slate-100 text-slate-600 font-bold rounded-xl hover:bg-slate-200 transition-all text-[10px] uppercase tracking-widest",children:"Got It"})]})]})]}),da=({user:t,settings:n,appScriptUrl:s,onClose:r,showToast:i,onUpdateSuccess:o,onLogout:a})=>{const l=(t.name||"").split(" "),c=l[0]||"",d=l.slice(1).join(" ")||"",[u,p]=e.useState(""),[m,h]=e.useState(""),[f,x]=e.useState(!1),[b,v]=e.useState(t.preferences||{emailNotifications:!0,notifyGeneral:!0,notifyPetroleum:!0,notifyPetroleumV2:!0,notifyAcid:!0}),[y,w]=e.useState(!1),N=e=>{(async e=>{v(e),w(!0);try{const n=await fetch(s,{method:"POST",body:JSON.stringify({action:"update_user",originalUsername:t.username,preferences:e})});"success"===(await n.json()).status&&(o({...t,preferences:e}),i("Preferences synced.","success"))}catch(n){i("Sync failed.","error")}finally{w(!1)}})({...b,[e]:!b[e]})};return g.jsxs("div",{className:"fixed inset-0 z-[100] bg-white flex flex-col animate-fadeIn overflow-y-auto",children:[g.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-100 px-4 py-3 flex items-center shrink-0 z-10 shadow-sm",children:[g.jsx("button",{onClick:r,className:"p-2 text-blue-500 hover:bg-blue-50 rounded-full transition-all",children:g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),g.jsx("h1",{className:"flex-1 text-center font-bold text-slate-800 text-sm uppercase tracking-widest",children:"My Workspace"}),g.jsx("div",{className:"w-10"})]}),g.jsxs("div",{className:"max-w-2xl mx-auto w-full px-6 py-10 space-y-12 pb-24",children:[g.jsxs("section",{className:"space-y-4",children:[g.jsx("h3",{className:"text-lg font-bold text-slate-800 border-b border-gray-100 pb-2 uppercase tracking-tight",children:"Identity Profile"}),g.jsxs("div",{className:"space-y-3",children:[g.jsxs("div",{className:"flex justify-between items-center text-sm py-1",children:[g.jsx("span",{className:"font-semibold text-slate-600",children:"Organization"}),g.jsx("span",{className:"text-slate-400 font-medium",children:n.companyName||"Transport Pro"})]}),g.jsxs("div",{className:"flex justify-between items-center text-sm py-1",children:[g.jsx("span",{className:"font-semibold text-slate-600",children:"First Name"}),g.jsx("span",{className:"text-slate-400 font-medium",children:c})]}),g.jsxs("div",{className:"flex justify-between items-center text-sm py-1",children:[g.jsx("span",{className:"font-semibold text-slate-600",children:"Last Name"}),g.jsx("span",{className:"text-slate-400 font-medium",children:d})]}),g.jsxs("div",{className:"flex justify-between items-center text-sm py-1",children:[g.jsx("span",{className:"font-semibold text-slate-600",children:"Login ID"}),g.jsx("span",{className:"text-slate-400 font-medium",children:t.username})]})]})]}),g.jsxs("section",{className:"space-y-4",children:[g.jsx("h3",{className:"text-lg font-bold text-slate-800 border-b border-gray-100 pb-2 uppercase tracking-tight",children:"Security Access"}),g.jsxs("div",{className:"space-y-4",children:[g.jsx("input",{type:"password",placeholder:"Set New Password",className:"w-full p-3.5 border border-gray-200 rounded-xl text-sm bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-100 outline-none transition-all font-semibold",value:u,onChange:e=>p(e.target.value)}),g.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full p-3.5 border border-gray-200 rounded-xl text-sm bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-100 outline-none transition-all font-semibold",value:m,onChange:e=>h(e.target.value)}),g.jsx("button",{onClick:async()=>{if(u)if(u===m){x(!0);try{const e=await fetch(s,{method:"POST",body:JSON.stringify({action:"update_user",originalUsername:t.username,password:u})}),n=await e.json();"success"===n.status?(i("Security updated!","success"),p(""),h("")):i(n.message||"Failed to update.","error")}catch(e){i("Sync failed.","error")}finally{x(!1)}}else i("Passwords do not match.","error");else i("Please enter a new password.","warning")},disabled:f,className:"w-full py-4 bg-slate-900 hover:bg-black text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 text-xs uppercase tracking-widest",children:f?g.jsxs(g.Fragment,{children:[g.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Update Security"})]})]}),g.jsxs("section",{className:"space-y-4",children:[g.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 pb-2",children:[g.jsx("h3",{className:"text-lg font-bold text-slate-800 uppercase tracking-tight",children:"Alert Preferences"}),y&&g.jsxs("svg",{className:"animate-spin h-4 w-4 text-blue-500",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("label",{className:"flex items-center justify-between p-4 rounded-2xl bg-slate-50 border border-slate-100 cursor-pointer group",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-sm font-bold text-slate-800",children:"Master Email Alert"}),g.jsx("p",{className:"text-[10px] text-slate-400 font-semibold uppercase tracking-wider",children:"Automated system triggers"})]}),g.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500",checked:b.emailNotifications,onChange:()=>N("emailNotifications")})]}),g.jsx("div",{className:`grid grid-cols-1 md:grid-cols-2 gap-3 pt-2 transition-opacity duration-300 ${!b.emailNotifications&&"opacity-40 pointer-events-none"}`,children:[{key:"notifyGeneral",label:"General Fleet"},{key:"notifyPetroleum",label:"Petroleum V1"},{key:"notifyPetroleumV2",label:"Petroleum V2"},{key:"notifyAcid",label:"Acid Tankers"}].map(e=>g.jsxs("label",{className:"flex items-center justify-between px-4 py-3.5 rounded-xl border border-gray-100 bg-white hover:bg-gray-50 cursor-pointer transition-colors shadow-sm",children:[g.jsx("span",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest",children:e.label}),g.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300 text-blue-600",checked:b[e.key],onChange:()=>N(e.key)})]},e.key))})]})]}),g.jsx("section",{className:"pt-8",children:g.jsxs("button",{onClick:a,className:"w-full py-4 bg-white border-2 border-red-500 text-red-500 hover:bg-red-50 font-bold rounded-xl transition-all flex items-center justify-center gap-3 uppercase tracking-[0.2em] active:scale-95 text-xs",children:[g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H5a3 3-0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Sign Out"]})})]})]})},ua=({id:t,notifications:n,onMarkAsRead:s,onDismiss:r,onClearAll:i,onAcknowledge:o,canAcknowledge:a})=>{const[l,c]=e.useState(!1),[d,u]=e.useState("all"),p=e.useRef(null);e.useEffect(()=>{function e(e){p.current&&!p.current.contains(e.target)&&c(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[p]);const m=n.filter(e=>!e.read).length,h=n.filter(e=>!e.read&&"critical"===e.type).length,f=e.useMemo(()=>{let e=[...n];return"unread"===d?e=e.filter(e=>!e.read):"critical"===d&&(e=e.filter(e=>"critical"===e.type)),e},[n,d]),x=e=>{const t=new Date(e),n=new Date,s=Math.floor((n.getTime()-t.getTime())/1e3);return s<60?"Just now":s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:t.toLocaleDateString([],{month:"short",day:"numeric"})},b=e=>{const t="w-9 h-9 rounded-xl flex items-center justify-center shrink-0 border shadow-sm transition-all";switch(e){case"critical":return g.jsx("div",{className:`${t} bg-rose-50 text-rose-600 border-rose-100`,children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})});case"success":return g.jsx("div",{className:`${t} bg-emerald-50 text-emerald-600 border-emerald-100`,children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M5 13l4 4L19 7"})})});default:return g.jsx("div",{className:`${t} bg-indigo-50 text-indigo-600 border-indigo-100`,children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})}};return g.jsxs("div",{className:"relative",ref:p,children:[g.jsxs("button",{id:t,onClick:()=>c(!l),className:`relative p-2 rounded-xl transition-all duration-300 group\n                    ${l?"bg-slate-900 text-white shadow-lg":"text-slate-400 hover:text-slate-900 hover:bg-slate-50"}\n                `,children:[g.jsx("svg",{className:"w-5 h-5 group-hover:rotate-12 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),m>0&&g.jsxs("span",{className:"absolute -top-1 -right-1 flex h-4 w-4",children:[g.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 "+(h>0?"bg-rose-400":"bg-indigo-400")}),g.jsx("span",{className:"relative inline-flex rounded-full h-4 w-4 text-[8px] font-bold text-white items-center justify-center border-2 border-white shadow-sm "+(h>0?"bg-rose-600":"bg-indigo-600"),children:m})]})]}),l&&g.jsxs("div",{className:"fixed inset-x-4 bottom-4 top-20 sm:top-auto sm:bottom-auto sm:absolute sm:right-0 sm:inset-x-auto sm:mt-4 w-auto sm:w-[400px] bg-white rounded-[2rem] sm:rounded-2xl shadow-2xl ring-1 ring-black/5 z-[100] flex flex-col overflow-hidden animate-slideUp origin-bottom sm:origin-top-right",children:[g.jsxs("div",{className:"p-6 border-b border-slate-50 flex justify-between items-center bg-white shrink-0",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-bold text-slate-900 tracking-tight",children:"Notifications"}),g.jsx("p",{className:"text-[10px] text-slate-400 font-medium uppercase tracking-widest mt-0.5",children:"Fleet Activity Monitor"})]}),g.jsx("button",{onClick:i,className:"px-4 py-2 bg-slate-50 hover:bg-rose-50 text-slate-500 hover:text-rose-600 rounded-xl transition-all text-[10px] font-bold uppercase tracking-widest border border-slate-100",children:"Clear All"})]}),g.jsx("div",{className:"flex bg-slate-50/50 p-1 border-b border-slate-50 shrink-0",children:["all","unread","critical"].map(e=>g.jsx("button",{onClick:()=>u(e),className:`flex-1 py-2 text-[10px] font-bold uppercase tracking-widest transition-all rounded-lg\n                                    ${d===e?"bg-white text-indigo-600 shadow-sm":"text-slate-400 hover:text-slate-600"}\n                                `,children:e},e))}),g.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide bg-white divide-y divide-slate-50 max-h-[50vh] sm:max-h-[400px]",children:0===f.length?g.jsxs("div",{className:"py-20 text-center flex flex-col items-center",children:[g.jsx("div",{className:"w-12 h-12 bg-slate-50 rounded-full flex items-center justify-center mb-4 border border-slate-100 text-slate-200",children:g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M5 13l4 4L19 7",strokeWidth:"3"})})}),g.jsx("p",{className:"text-xs font-medium text-slate-400",children:"Your archive is clear"})]}):f.map(e=>g.jsxs("div",{className:`p-4 sm:p-5 transition-all relative group cursor-pointer hover:bg-slate-50/50\n                                        ${e.read?"bg-white":"bg-indigo-50/10"}\n                                    `,onClick:()=>s(e.id),children:[g.jsxs("div",{className:"flex gap-4",children:[b(e.type),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex justify-between items-start mb-0.5",children:[g.jsx("h4",{className:"text-xs font-bold truncate pr-6 "+("critical"===e.type?"text-rose-600":"text-slate-900"),children:e.title}),g.jsx("span",{className:"text-[9px] font-medium text-slate-400 whitespace-nowrap bg-slate-100 px-1.5 py-0.5 rounded",children:x(e.timestamp)})]}),g.jsx("p",{className:"text-[11px] font-medium text-slate-500 leading-relaxed line-clamp-2",children:e.message}),a&&"critical"===e.type&&o&&g.jsx("button",{onClick:t=>{t.stopPropagation(),o(e.id)},className:"mt-3 px-3 py-1.5 bg-slate-900 text-white text-[8px] font-black uppercase tracking-widest rounded-lg hover:bg-black transition-all shadow-sm",children:"Acknowledge Global"})]})]}),g.jsx("button",{onClick:t=>{t.stopPropagation(),r(e.id)},className:"absolute top-4 right-4 p-1.5 text-slate-200 hover:text-rose-500 rounded-lg transition-all opacity-0 group-hover:opacity-100",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]},e.id))}),g.jsx("div",{className:"p-3 bg-slate-50 border-t border-slate-100 shrink-0 text-center",children:g.jsx("p",{className:"text-[9px] font-medium text-slate-400 uppercase tracking-[0.2em]",children:"Automated Intelligence Suite v4.0"})})]})]})},pa=({isOpen:e,onClose:t,onStartNew:n,onResume:s,hasDraft:r,moduleName:i})=>e?g.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-slate-900/70 backdrop-blur-sm animate-fadeIn",children:g.jsxs("div",{className:"bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-100",children:[g.jsxs("div",{className:"bg-gradient-to-r from-emerald-900 to-emerald-800 p-6 text-white",children:[g.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[g.jsx("svg",{className:"w-6 h-6 text-emerald-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Start ",i," Inspection"]}),g.jsx("p",{className:"text-emerald-100 text-sm mt-1",children:"Select how you would like to proceed."})]}),g.jsxs("div",{className:"p-6 space-y-4",children:[r&&g.jsxs("div",{className:"bg-amber-50 border border-amber-100 rounded-xl p-4 mb-2",children:[g.jsxs("div",{className:"flex items-start gap-3",children:[g.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center shrink-0 mt-1",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),g.jsxs("div",{children:[g.jsx("h4",{className:"font-bold text-amber-800 text-sm",children:"Unsaved Draft Found"}),g.jsx("p",{className:"text-xs text-amber-700 mt-0.5",children:"You have an inspection in progress. Would you like to continue where you left off?"})]})]}),g.jsx("button",{onClick:s,className:"w-full mt-3 py-3 bg-amber-500 hover:bg-amber-600 text-white font-bold rounded-lg shadow-md transition flex items-center justify-center gap-2",children:"Resume Draft"})]}),g.jsxs("button",{onClick:n,className:"w-full py-4 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition flex items-center justify-center gap-3 group",children:[g.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/50 flex items-center justify-center group-hover:scale-110 transition-transform",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})}),g.jsxs("div",{className:"text-left",children:[g.jsx("div",{className:"text-sm font-black uppercase tracking-wide",children:"Start Inspection"}),r&&g.jsx("div",{className:"text-[10px] font-medium text-emerald-100 opacity-80",children:"This will discard the current draft"})]})]}),g.jsx("button",{onClick:t,className:"w-full py-3 bg-white border border-gray-200 text-gray-500 hover:bg-gray-50 hover:text-gray-700 font-bold rounded-xl transition",children:"Cancel"})]})]})}):null,ma=({subscription:e,user:t,onManage:n})=>{if(!t)return null;const s="SuperAdmin"===t.role;if(null===e)return g.jsxs("div",{className:"w-full px-4 py-3 flex items-center justify-center gap-3 bg-slate-800 text-white shadow-md relative z-[100] animate-fadeIn",children:[g.jsxs("svg",{className:"animate-spin h-4 w-4 text-slate-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),g.jsx("span",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400",children:"Verifying System License Validation..."})]});const r="Expired"===e.status||!e.expiryDate||e.daysRemaining<=0,i=!r&&"Active"===e.status&&e.daysRemaining>0&&e.daysRemaining<=7;return r||i?g.jsxs("div",{className:`w-full px-4 py-3 flex items-center justify-between shadow-md relative z-[100] animate-fadeIn\n            ${r?"bg-red-600 text-white":"bg-amber-500 text-white"}\n        `,children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"p-1.5 bg-white/20 rounded-full",children:r?g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}):g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),g.jsxs("div",{children:[g.jsx("p",{className:"text-sm font-bold uppercase tracking-wide",children:r?"SYSTEM LICENSE EXPIRED":"LICENSE EXPIRING SOON"}),g.jsx("p",{className:"text-xs font-medium opacity-90",children:r?"Access to core features is restricted. Renew to restore modification access.":`${e?.daysRemaining} days remaining. Please renew soon.`})]})]}),s&&g.jsx("button",{onClick:n,className:"px-4 py-2 bg-white text-gray-900 rounded-lg text-xs font-bold uppercase tracking-wider hover:bg-gray-100 transition-colors shadow-sm",children:"Manage License"})]}):null},ha=({isOpen:t,onClose:n,onSubmit:s,validationLists:r})=>{if(!t)return null;const[i,o]=e.useState(""),[a,l]=e.useState(""),[c,d]=e.useState("General"),[u,p]=e.useState("Normal"),[m,h]=e.useState(""),[f,x]=e.useState(""),[b,v]=e.useState(!1),[y,w]=e.useState({}),N=({label:t,value:n,onChange:s,options:r,placeholder:i="Select...",error:o,isOptional:a=!1})=>{const[l,c]=e.useState(!1),[d,u]=e.useState(""),p=e.useRef(null);e.useEffect(()=>{function e(e){p.current&&!p.current.contains(e.target)&&c(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[p]);const m=r.filter(e=>String(e).toLowerCase().includes(d.toLowerCase()));return g.jsxs("div",{className:"relative",ref:p,children:[g.jsxs("label",{className:"block text-[10px] font-semibold text-slate-400 uppercase tracking-widest mb-1.5 ml-1",children:[t," ",a&&g.jsx("span",{className:"opacity-50 text-[8px]",children:"(Optional)"})]}),g.jsxs("div",{onClick:()=>{r.length>0&&c(!l)},className:`relative w-full p-4 bg-slate-50 border rounded-2xl outline-none text-sm font-medium text-slate-700 transition-all cursor-pointer flex items-center justify-between\n                        ${o?"border-red-200 bg-red-50 text-red-900 shadow-sm":l?"border-indigo-400 ring-4 ring-indigo-50 bg-white":"border-slate-100 hover:border-slate-200 hover:bg-slate-100/30"}\n                        ${0===r.length?"opacity-60 cursor-not-allowed":""}\n                    `,children:[g.jsx("span",{className:`truncate mr-4 ${!n&&"text-slate-300"}`,children:n||(0===r.length?"No data":i)}),g.jsx("svg",{className:"w-3.5 h-3.5 text-slate-300 transition-transform "+(l?"rotate-180 text-indigo-400":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),l&&r.length>0&&g.jsxs("div",{className:"absolute z-[110] w-full mt-2 bg-white border border-slate-100 rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-56 animate-fadeIn",children:[g.jsx("div",{className:"p-3 border-b border-slate-50 bg-slate-50/50 sticky top-0 shrink-0",children:g.jsx("input",{type:"text",autoFocus:!0,className:"w-full px-4 py-2 text-sm border border-slate-200 rounded-xl focus:outline-none focus:border-indigo-400 placeholder-slate-300 font-medium",placeholder:"Search...",value:d,onChange:e=>u(e.target.value),onClick:e=>e.stopPropagation()})}),g.jsx("div",{className:"overflow-y-auto scrollbar-hide flex-1 py-1",children:0===m.length?g.jsx("div",{className:"p-6 text-center text-xs text-slate-400 font-medium uppercase tracking-widest",children:"No results"}):m.map((e,t)=>g.jsx("div",{onClick:()=>{s(e),c(!1)},className:"px-5 py-3 text-sm cursor-pointer transition-all "+(n===e?"bg-indigo-50 text-indigo-600 font-semibold":"text-slate-600 hover:bg-slate-50"),children:e},t))})]}),o&&g.jsx("p",{className:"text-[10px] text-red-500 font-semibold mt-1 ml-1 uppercase",children:o})]})};return g.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-fadeIn overflow-y-auto no-print",children:g.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[2rem] shadow-2xl overflow-hidden border border-white/20 my-auto",children:[g.jsxs("div",{className:"px-8 py-6 border-b border-slate-100 flex justify-between items-center bg-white sticky top-0 z-10",children:[g.jsx("div",{children:g.jsx("h3",{className:"text-xl font-semibold text-slate-800 tracking-tight uppercase",children:"Request Inspection"})}),g.jsx("button",{onClick:n,className:"text-slate-300 hover:text-slate-800 transition-colors p-2 hover:bg-slate-50 rounded-full",children:g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsx("div",{className:"p-8",children:g.jsxs("form",{onSubmit:async e=>{e.preventDefault();const t={};if(i||(t.truckNo="Required"),m.trim()||(t.reason="Required"),Object.keys(t).length>0)w(t);else{v(!0);try{await s({truckNo:i,trailerNo:a,type:c,priority:u,reason:m,assignedInspector:f}),n()}finally{v(!1)}}},className:"space-y-6",children:[g.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[g.jsx(N,{label:"Truck Number",value:i,onChange:o,options:r.trucks,placeholder:"Select Truck...",error:y.truckNo}),g.jsx(N,{label:"Trailer Number",value:a,onChange:l,options:r.trailers,placeholder:"Select Trailer...",isOptional:!0})]}),g.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[g.jsx(N,{label:"Inspection Type",value:c,onChange:d,options:["General","Petroleum","Petroleum_V2","Acid"]}),g.jsx(N,{label:"Priority",value:u,onChange:p,options:["Normal","Urgent","Critical"]})]}),g.jsx(N,{label:"Assign Inspector",value:f,onChange:x,options:r.inspectors,placeholder:"Unassigned",isOptional:!0}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-[10px] font-semibold text-slate-400 uppercase tracking-widest mb-1.5 ml-1",children:"Details"}),g.jsx("textarea",{className:`w-full p-5 bg-slate-50 border rounded-2xl outline-none focus:ring-4 focus:ring-indigo-50 text-sm font-medium h-28 placeholder:text-slate-300 resize-none transition-all\n                                    ${y.reason?"border-red-200 bg-red-50 text-red-900":"border-slate-100 focus:border-indigo-100"}\n                                `,placeholder:"Enter any specific instructions...",value:m,onChange:e=>{h(e.target.value),w(e=>({...e,reason:""}))},required:!0}),y.reason&&g.jsx("p",{className:"text-[10px] text-red-500 font-semibold mt-1 ml-1 uppercase",children:y.reason})]}),g.jsx("button",{type:"submit",disabled:b,className:`w-full py-4.5 rounded-xl font-semibold text-white shadow-lg transition-all flex items-center justify-center gap-3 text-xs uppercase tracking-widest active:scale-95 border-t border-white/10\n                                ${b?"bg-slate-400 cursor-wait":"bg-slate-900 hover:bg-black"}\n                            `,children:b?"Processing...":"Send Request"})]})})]})})},ga=({user:t,appScriptUrl:n,onComplete:s,onLogout:r})=>{const[i,o]=e.useState(0),[a,l]=e.useState(!1),[c,d]=e.useState(t.name||""),[u,p]=e.useState(t.username||""),[m,h]=e.useState(""),[f,x]=e.useState(""),[b,v]=e.useState(""),[y,w]=e.useState({emailNotifications:!0,notifyGeneral:!0,notifyPetroleum:!0,notifyPetroleumV2:!0,notifyAcid:!0}),N=async e=>{if(e.preventDefault(),0===i){if(!c.trim())return void v("Enter your official name.");if(!u.trim()||!u.includes("@"))return void v("Enter a valid email address.")}if(1===i){if(m.length<4)return void v("Password must be at least 4 characters.");if(m!==f)return void v("Passwords do not match.")}v(""),o(e=>e+1)};return g.jsx("div",{className:"fixed inset-0 z-[200] bg-slate-100 flex items-center justify-center p-0 sm:p-4 animate-fadeIn overflow-hidden",children:g.jsxs("div",{className:"w-full h-full sm:h-auto sm:max-w-4xl bg-white sm:rounded-[2rem] shadow-2xl overflow-hidden flex flex-col md:flex-row",children:[g.jsxs("div",{className:"md:w-1/3 bg-slate-900 p-4 md:p-10 flex flex-row md:flex-col justify-between items-center md:items-start text-white shrink-0",children:[g.jsxs("div",{className:"flex items-center md:block gap-3",children:[g.jsx("div",{className:"w-8 h-8 md:w-12 md:h-12 bg-indigo-600 rounded-lg md:rounded-2xl flex items-center justify-center md:mb-8",children:g.jsx("svg",{className:"w-4 h-4 md:w-6 md:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M12 11c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),g.jsxs("div",{className:"md:block",children:[g.jsx("h1",{className:"text-sm md:text-2xl font-bold uppercase tracking-tight leading-none",children:"Onboarding"}),g.jsx("p",{className:"hidden md:block text-indigo-400 text-[10px] font-semibold uppercase tracking-widest mt-1 opacity-80",children:"Profile Setup"})]})]}),g.jsx("div",{className:"flex flex-row md:flex-col gap-2 md:gap-5",children:[{l:"Identity"},{l:"Security"},{l:"Alerts"}].map((e,t)=>g.jsxs("div",{className:"flex items-center gap-1.5 md:gap-4 transition-all duration-500 "+(i>=t?"opacity-100":"opacity-30"),children:[g.jsx("div",{className:`w-5 h-5 md:w-7 md:h-7 rounded-full flex items-center justify-center border ${i>t?"bg-emerald-500 border-emerald-500 text-white":i===t?"border-indigo-400 text-indigo-400":"border-slate-600 text-slate-400"} font-bold text-[9px] md:text-xs`,children:i>t?"✓":t+1}),g.jsx("span",{className:"hidden md:block font-medium text-[10px] uppercase tracking-[0.1em]",children:e.l})]},t))})]}),g.jsxs("div",{className:"flex-1 p-6 md:p-12 bg-white flex flex-col justify-center relative",children:[0===i&&g.jsxs("div",{className:"animate-fadeIn w-full max-w-sm mx-auto flex flex-col",children:[g.jsxs("div",{className:"mb-6 md:mb-10",children:[g.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-slate-800 tracking-tight",children:"Identity Profile"}),g.jsx("p",{className:"text-slate-400 text-xs mt-1",children:"Please verify your details for the fleet registry."})]}),g.jsxs("form",{onSubmit:N,className:"space-y-4 md:space-y-6",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-[10px] font-bold uppercase text-slate-500 mb-1.5 tracking-wide ml-1",children:"Full Name"}),g.jsx("input",{type:"text",autoFocus:!0,required:!0,className:"w-full p-3 md:p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none font-medium text-slate-700 focus:ring-2 focus:ring-indigo-100 transition-all text-sm",value:c,onChange:e=>d(e.target.value),placeholder:"Enter your name"})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-[10px] font-bold uppercase text-slate-500 mb-1.5 tracking-wide ml-1",children:"Email Address"}),g.jsx("input",{type:"email",required:!0,className:"w-full p-3 md:p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none font-medium text-slate-700 focus:ring-2 focus:ring-indigo-100 transition-all text-sm",value:u,onChange:e=>p(e.target.value.toLowerCase()),placeholder:"email@company.com"})]}),b&&g.jsx("div",{className:"p-3 bg-rose-50 text-rose-600 text-xs font-medium rounded-lg border border-rose-100",children:b}),g.jsxs("div",{className:"pt-4 flex flex-col gap-2",children:[g.jsx("button",{type:"submit",className:"w-full py-4 bg-slate-900 hover:bg-black text-white font-semibold rounded-xl uppercase tracking-widest text-xs shadow-lg active:scale-[0.98] transition-all",children:"Update Profile"}),g.jsxs("div",{className:"flex gap-2",children:[g.jsx("button",{type:"button",onClick:()=>{s({...t,needsSetup:!1})},className:"flex-1 py-3 text-slate-400 hover:text-slate-600 font-semibold text-[10px] uppercase tracking-wider transition-colors",children:"Setup Later"}),r&&g.jsx("button",{type:"button",onClick:r,className:"flex-1 py-3 text-rose-500 hover:text-rose-600 font-semibold text-[10px] uppercase tracking-wider",children:"Sign Out"})]})]})]})]}),1===i&&g.jsxs("div",{className:"animate-fadeIn w-full max-w-sm mx-auto",children:[g.jsxs("div",{className:"mb-6 md:mb-10",children:[g.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-slate-800 tracking-tight",children:"Security Access"}),g.jsx("p",{className:"text-slate-400 text-xs mt-1",children:"Set your master password for future logins."})]}),g.jsxs("form",{onSubmit:N,className:"space-y-4 md:space-y-5",children:[g.jsx("input",{type:"password",autoFocus:!0,required:!0,className:"w-full p-3 md:p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none font-medium text-slate-700 focus:ring-2 focus:ring-indigo-100 transition-all text-sm",value:m,onChange:e=>h(e.target.value),placeholder:"New Password"}),g.jsx("input",{type:"password",required:!0,className:"w-full p-3 md:p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none font-medium text-slate-700 focus:ring-2 focus:ring-indigo-100 transition-all text-sm",value:f,onChange:e=>x(e.target.value),placeholder:"Confirm Password"}),b&&g.jsx("div",{className:"p-3 bg-rose-50 text-rose-600 text-xs font-medium rounded-lg border border-rose-100",children:b}),g.jsx("button",{type:"submit",className:"w-full py-4 bg-slate-900 hover:bg-black text-white font-semibold rounded-xl uppercase tracking-widest text-xs shadow-lg active:scale-[0.98] transition-all mt-4",children:"Finalize Security"})]})]}),2===i&&g.jsxs("div",{className:"animate-fadeIn w-full max-w-sm mx-auto flex flex-col justify-center",children:[g.jsxs("div",{className:"mb-6 md:mb-10",children:[g.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-slate-800 tracking-tight",children:"Alert Preferences"}),g.jsx("p",{className:"text-slate-400 text-xs mt-1",children:"Configure your automated notification streams."})]}),g.jsxs("div",{className:"space-y-3 mb-8",children:[g.jsxs("label",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-200 cursor-pointer hover:bg-slate-100 transition-colors",children:[g.jsx("span",{className:"text-xs font-semibold text-slate-700 uppercase tracking-tight",children:"System Email Alerts"}),g.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-slate-300 text-indigo-600",checked:y.emailNotifications,onChange:()=>w(e=>({...e,emailNotifications:!e.emailNotifications}))})]}),g.jsx("div",{className:`grid grid-cols-2 gap-2 transition-opacity duration-300 ${!y.emailNotifications&&"opacity-30 pointer-events-none"}`,children:[{k:"notifyGeneral",l:"General"},{k:"notifyPetroleum",l:"Petro V1"},{k:"notifyPetroleumV2",l:"Petro V2"},{k:"notifyAcid",l:"Acid"}].map(e=>g.jsxs("label",{className:"flex items-center justify-between p-3 bg-white border border-slate-100 rounded-xl cursor-pointer hover:border-indigo-200 transition-all shadow-sm",children:[g.jsx("span",{className:"text-[10px] font-medium text-slate-500 uppercase",children:e.l}),g.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-slate-300 text-indigo-600",checked:y[e.k],onChange:()=>w(t=>({...t,[e.k]:!t[e.k]}))})]},e.k))})]}),b&&g.jsx("div",{className:"p-3 bg-rose-50 text-rose-600 text-xs font-medium rounded-lg mb-6 border border-rose-100",children:b}),g.jsx("button",{onClick:async()=>{l(!0),v("");try{const e={action:"update_user",originalUsername:t.username,username:u,name:c,password:m,preferences:{...y,hasCompletedTour:!1}},s=await fetch(n,{method:"POST",body:JSON.stringify(e)}),r=await s.json();"success"===r.status?o(3):v(r.message||"Unable to sync profile. Try again.")}catch(e){v("Connection error. Please check your signal.")}finally{l(!1)}},disabled:a,className:"w-full py-4 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl uppercase tracking-widest text-xs flex items-center justify-center gap-2 shadow-lg active:scale-[0.98] transition-all",children:a?g.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):"Complete Registration"})]}),3===i&&g.jsxs("div",{className:"text-center animate-fadeIn w-full max-w-sm mx-auto py-8",children:[g.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-8 border border-emerald-100 text-emerald-600",children:g.jsx("svg",{className:"w-8 h-8 md:w-10 md:h-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{d:"M5 13l4 4L19 7"})})}),g.jsx("h2",{className:"text-xl md:text-2xl font-bold text-slate-800 mb-2",children:"Verified Successfully"}),g.jsx("p",{className:"text-slate-500 text-sm mb-10 leading-relaxed",children:"Your workspace provisioning is complete. You now have full access to the inspection portal."}),g.jsx("button",{onClick:()=>s({...t,username:u,name:c,preferences:y,needsSetup:!1}),className:"w-full py-5 bg-slate-900 hover:bg-black text-white font-bold rounded-2xl uppercase tracking-[0.2em] text-xs shadow-xl active:scale-[0.98] transition-all",children:"Enter Dashboard"})]})]})]})})},fa=[{targetId:"system-mgmt-section",title:"Central Control",description:"Manage your staff, fleet registry, and global system settings from this primary control hub.",position:"bottom"},{targetId:"inspection-forms-section",title:"Inspection Hub",description:"Choose from various specialized inspection modules. All reports are synced to Google Sheets in real-time.",position:"bottom"},{targetId:"notification-bell",title:"Live Alerts",description:"Real-time notifications for critical vehicle failures and automated safety broadcasts.",position:"bottom"},{targetId:"profile-trigger",title:"User Profile",description:"Update your password, manage email alert preferences, or sign out of your session here.",position:"bottom"}],xa=({onComplete:t})=>{const[n,s]=e.useState(0),[r,i]=e.useState({}),[o,a]=e.useState({});e.useEffect(()=>{const e=()=>{const e=fa[n],t=document.getElementById(e.targetId);if(t){const e=t.getBoundingClientRect();i({position:"fixed",top:e.top-4,left:e.left-4,width:e.width+8,height:e.height+8,borderRadius:"12px",boxShadow:"0 0 0 9999px rgba(15, 23, 42, 0.85)",zIndex:150,pointerEvents:"none",transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)"});const n=Math.min(340,.85*window.innerWidth);let s=e.bottom+16,r=e.left+e.width/2-n/2;s+250>window.innerHeight&&(s=e.top-220),r+n>window.innerWidth-20&&(r=window.innerWidth-n-20),r<20&&(r=20),a({position:"fixed",top:Math.max(20,s),left:r,width:n,zIndex:151,transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)"})}else i({display:"none"}),a({position:"fixed",top:"50%",left:"50%",width:Math.min(340,.85*window.innerWidth),transform:"translate(-50%, -50%)",zIndex:151})},t=setTimeout(e,150);return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),clearTimeout(t)}},[n]);const l=fa[n];return g.jsxs("div",{className:"fixed inset-0 z-[140] overflow-hidden pointer-events-none",children:[g.jsx("div",{style:r,className:"ring-2 ring-indigo-400 animate-pulse"}),g.jsxs("div",{className:"bg-white rounded-3xl shadow-[0_20px_50px_rgba(0,0,0,0.3)] p-6 sm:p-8 animate-fadeIn border border-slate-100 pointer-events-auto flex flex-col",style:o,children:[g.jsxs("div",{className:"flex justify-between items-center mb-5 shrink-0",children:[g.jsxs("span",{className:"text-[10px] font-black text-white bg-indigo-600 px-3 py-1.5 rounded-full uppercase tracking-widest shadow-sm",children:["Tip ",n+1," / ",fa.length]}),g.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600 transition-colors p-1.5 hover:bg-slate-50 rounded-lg",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsxs("div",{className:"flex-1 overflow-visible",children:[g.jsx("h3",{className:"text-lg sm:text-xl font-black text-slate-800 mb-3 uppercase tracking-tight leading-tight",children:l.title}),g.jsx("p",{className:"text-sm text-slate-500 leading-relaxed font-medium break-words",children:l.description})]}),g.jsxs("div",{className:"flex justify-between items-center pt-6 mt-6 border-t border-slate-50 shrink-0",children:[g.jsx("div",{className:"flex gap-2",children:fa.map((e,t)=>g.jsx("div",{className:"h-1.5 rounded-full transition-all duration-500 "+(t===n?"bg-indigo-600 w-6":"bg-slate-100 w-1.5")},t))}),g.jsxs("button",{onClick:()=>{n<fa.length-1?s(e=>e+1):t()},className:"px-6 py-3 bg-slate-900 hover:bg-black text-white text-[10px] font-black rounded-xl shadow-lg transition-all active:scale-95 flex items-center gap-2 uppercase tracking-widest",children:[n===fa.length-1?"Start Working":"Next Tip",g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{d:"M9 5l7 7-7 7"})})]})]})]})]})},ba=()=>{const[t,n]=e.useState(null),[s,r]=e.useState(!1),[i,o]=e.useState(!1);e.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone)return;const e=localStorage.getItem("sc_install_dismissed");if(e){const t=new Date(parseInt(e)),n=new Date,s=Math.abs(n.getTime()-t.getTime());if(Math.ceil(s/864e5)<7)return}const t=window.navigator.userAgent.toLowerCase(),s=/iphone|ipad|ipod/.test(t);if(o(s),!s){const e=e=>{e.preventDefault(),n(e),r(!0)};return window.addEventListener("beforeinstallprompt",e),()=>{window.removeEventListener("beforeinstallprompt",e)}}setTimeout(()=>r(!0),3e3)},[]);return s?g.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-[9999] md:left-auto md:right-4 md:w-96 animate-fadeIn",children:g.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-md text-white p-4 rounded-2xl shadow-2xl border border-slate-700 flex flex-col gap-4",children:[g.jsxs("div",{className:"flex items-start gap-4",children:[g.jsx("div",{className:"bg-white/10 p-2.5 rounded-xl shrink-0",children:g.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/716/716766.png",alt:"Logo",className:"w-8 h-8 object-contain"})}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("h4",{className:"font-bold text-sm",children:"Install SafetyCheck Pro"}),g.jsx("p",{className:"text-xs text-slate-300 mt-1 leading-relaxed",children:"Add to your home screen for offline access, full-screen view, and faster performance."})]}),g.jsx("button",{onClick:()=>{r(!1),localStorage.setItem("sc_install_dismissed",Date.now().toString())},className:"text-slate-400 hover:text-white p-1",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),i?g.jsxs("div",{className:"bg-white/10 rounded-lg p-3 text-xs text-slate-300 flex items-center gap-3",children:[g.jsx("span",{className:"text-xl",children:"👉"}),g.jsxs("span",{children:["Tap the ",g.jsx("span",{className:"font-bold text-white",children:"Share"})," button below and select ",g.jsx("span",{className:"font-bold text-white",children:'"Add to Home Screen"'})," [+]"]})]}):g.jsxs("button",{onClick:async()=>{if(!t)return;t.prompt();const{outcome:e}=await t.userChoice;"accepted"===e&&r(!1),n(null)},className:"w-full py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl text-sm transition-colors shadow-lg flex items-center justify-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Install App"]})]})}):null},va=({label:e,icon:t,onClick:n})=>g.jsxs("button",{onClick:n,className:"flex flex-col items-center justify-center p-3 sm:p-6 bg-slate-50 border border-slate-100 rounded-[1.5rem] sm:rounded-[2rem] hover:bg-white hover:shadow-xl hover:border-indigo-100 transition-all group active:scale-95 text-center min-h-[100px] sm:min-h-[160px]",children:[g.jsx("div",{className:"mb-2 sm:mb-4 text-slate-400 group-hover:text-indigo-600 transition-colors scale-75 sm:scale-100",children:t}),g.jsx("span",{className:"text-[8px] sm:text-[10px] font-black text-slate-600 group-hover:text-slate-900 uppercase tracking-widest leading-tight px-1",children:e})]}),ya=({isOpen:e,onClose:t,onAction:n})=>{const s=[{id:"HR & PAYROLL",label:"HR & PAYROLL",icon:g.jsxs("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:[g.jsx("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),g.jsx("circle",{cx:"9",cy:"7",r:"4"}),g.jsx("path",{d:"M23 21v-2a4 4 0 00-3-3.87"}),g.jsx("path",{d:"M16 3.13a4 4 0 010 7.75"})]})},{id:"FLEET MAINTENANCE SOFTWARE",label:"FLEET MAINTENANCE SOFTWARE",icon:g.jsxs("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:[g.jsx("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),g.jsx("circle",{cx:"12",cy:"12",r:"3"})]})},{id:"DRIVER MANAGEMENT SYSTEM",label:"DRIVER MANAGEMENT SYSTEM",icon:g.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})},{id:"FLEET PLANNING SYSTEM",label:"FLEET PLANNING SYSTEM",icon:g.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})},{id:"INCIDENT MANAGEMENT SYSTEM",label:"INCIDENT MANAGEMENT SYSTEM",icon:g.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})},{id:"FINANCE TICKETING SYSTEM",label:"FINANCE TICKETING SYSTEM",icon:g.jsxs("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:[g.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),g.jsx("path",{d:"M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"})]})},{id:"AUTOMATED GATE PASS",label:"AUTOMATED GATE PASS",icon:g.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})},{id:"FUEL PRO RECONCILIATION",label:"FUEL PRO RECONCILIATION",icon:g.jsxs("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:[g.jsx("path",{d:"M3 22V2h11l7 7v13H3z"}),g.jsx("path",{d:"M14 2v7h7"}),g.jsx("path",{d:"M7 13h10M7 17h10"})]})}];return g.jsxs("div",{className:"fixed inset-0 z-[200] animate-fadeIn flex items-end sm:items-center justify-center p-0 sm:p-4 no-print",children:[g.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md",onClick:t}),g.jsx("div",{className:"relative bg-white w-full max-w-4xl rounded-t-[2.5rem] sm:rounded-[3rem] shadow-2xl overflow-hidden animate-slideUp",children:g.jsxs("div",{className:"p-6 sm:p-12",children:[g.jsxs("div",{className:"flex justify-between items-center mb-6 sm:mb-12",children:[g.jsx("div",{children:g.jsx("h2",{className:"text-xl sm:text-3xl font-black text-slate-900 uppercase tracking-tighter leading-none",children:"Enterprise Solutions"})}),g.jsx("button",{onClick:t,className:"p-2 sm:p-3 hover:bg-slate-100 rounded-2xl transition-all",children:g.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-6",children:s.map(e=>g.jsx(va,{label:e.label,icon:e.icon,onClick:()=>n(`support:info:${e.id}`)},e.id))}),g.jsx("div",{className:"mt-6 sm:mt-12 text-center pb-4 sm:pb-0",children:g.jsx("p",{className:"text-[8px] sm:text-[10px] text-slate-300 font-bold uppercase tracking-[0.3em]",children:"Proprietary Modular Framework v4.0"})})]})})]})},wa=({onLogin:t,appScriptUrl:n,setAppScriptUrl:s,settings:r})=>{const[i,o]=e.useState(""),[a,l]=e.useState(""),[c,d]=e.useState(!1),[u,p]=e.useState(!1),[m,h]=e.useState(""),[f,x]=e.useState(!1),[b,v]=e.useState(""),[y,w]=e.useState(""),[N,j]=e.useState(!1),[S,E]=e.useState(!1),[C,_]=e.useState(n);e.useEffect(()=>{const e=localStorage.getItem("sc_remembered_creds");if(e)try{const{u:t,p:n}=JSON.parse(atob(e));o(t),l(n),d(!0)}catch(t){localStorage.removeItem("sc_remembered_creds")}},[]);const k=n&&n.startsWith("https://script.google.com");return g.jsxs("div",{className:"h-screen w-full bg-slate-100 flex flex-col md:flex-row font-sans text-slate-700 overflow-hidden",children:[g.jsxs("div",{className:"w-full md:w-[35%] lg:w-[30%] bg-slate-900 p-6 md:p-12 flex flex-col justify-between shrink-0 border-b md:border-none shadow-xl z-10",children:[g.jsxs("div",{className:"flex md:block items-center justify-between",children:[g.jsx("div",{className:"bg-white p-2 rounded-xl inline-block",children:r.companyLogo&&!N?g.jsx("img",{src:r.companyLogo,alt:"Logo",className:"h-6 sm:h-10 w-auto object-contain",onError:()=>j(!0)}):g.jsx("div",{className:"flex items-center gap-1.5 px-2",children:g.jsx("span",{className:"font-bold text-slate-900 text-lg uppercase tracking-tight",children:"SafetyCheck"})})}),g.jsxs("div",{className:"md:mt-10 text-right md:text-left",children:[g.jsx("h1",{className:"text-lg sm:text-2xl font-semibold text-white leading-tight uppercase",children:r.companyName||"Fleet Portal"}),g.jsx("p",{className:"text-slate-400 font-medium uppercase tracking-widest text-[9px] mt-1",children:"Vehicle Inspection System"})]})]}),g.jsxs("div",{className:"mt-4 space-y-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-2 h-2 rounded-full "+(u?"bg-blue-400 animate-pulse":k?"bg-emerald-500":"bg-rose-500")}),g.jsx("span",{className:"text-[10px] font-semibold text-slate-400 uppercase tracking-widest",children:u?"Processing":k?"System Ready":"Connection Error"})]}),g.jsx("div",{className:"hidden sm:block pt-4 border-t border-white/5",children:g.jsx("span",{className:"text-[10px] text-slate-500 uppercase tracking-widest",children:"© 2026 Fleet Safety"})})]})]}),g.jsxs("div",{className:"flex-1 flex flex-col bg-white overflow-hidden relative justify-center px-6",children:[g.jsxs("div",{className:"w-full max-w-sm mx-auto",children:[g.jsxs("div",{className:"mb-8 text-center md:text-left",children:[g.jsx("h2",{className:"text-2xl font-semibold text-slate-800 tracking-tight",children:f?"Setup Admin":"Welcome Back"}),g.jsx("p",{className:"text-slate-500 text-sm mt-1",children:f?"Create your master account.":"Sign in to your inspection portal."})]}),m&&g.jsx("div",{className:"mb-6 p-4 rounded-xl text-xs font-medium border animate-fadeIn\n              "+(m.includes("created")?"bg-emerald-50 text-emerald-700 border-emerald-100":"bg-rose-50 text-rose-700 border-rose-100"),children:m}),g.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!n||!n.startsWith("https://script.google.com"))return h("System connection required. Click the gear icon below."),void E(!0);h(""),p(!0);try{const e=f?{action:"register_user",username:i,password:a,name:b,position:y,role:"SuperAdmin"}:{action:"login",username:i,password:a},s=await fetch(n,{method:"POST",body:JSON.stringify(e)}),r=await s.json();if("success"===r.status){const e=r.user;if(c&&a){const e=btoa(JSON.stringify({u:i,p:a}));localStorage.setItem("sc_remembered_creds",e)}else localStorage.removeItem("sc_remembered_creds");if(f)h("Admin created. Please sign in."),x(!1),v(""),w(""),l("");else{let n="Inspector";const s=e.role?String(e.role).trim().toLowerCase():"";"superadmin"===s?n="SuperAdmin":"admin"===s?n="Admin":"operations"===s?n="Operations":"maintenance"===s?n="Maintenance":"other"===s&&(n="Other"),t({...e,role:n,position:e.position||"",needsSetup:!e.name})}}else"NO_USERS"===r.code?(h("Initial setup: Create administrator."),x(!0)):h(r.message||"Sign in failed.")}catch(s){h("Cannot reach server. Check internet and URL.")}finally{p(!1)}},className:"space-y-4",children:[f&&g.jsxs("div",{className:"space-y-3 p-4 bg-slate-50 rounded-xl border border-slate-100",children:[g.jsx("input",{type:"text",required:!0,className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-lg text-sm font-medium outline-none",value:b,onChange:e=>v(e.target.value),placeholder:"Full Name"}),g.jsx("input",{type:"text",required:!0,className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-lg text-sm font-medium outline-none",value:y,onChange:e=>w(e.target.value),placeholder:"Job Title"})]}),g.jsxs("div",{className:"space-y-4",children:[g.jsx("input",{type:"email",required:!0,className:"w-full px-4 py-4 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-slate-100 outline-none font-medium text-sm",value:i,onChange:e=>o(e.target.value),placeholder:"Email Address"}),g.jsx("input",{type:"password",required:!0,className:"w-full px-4 py-4 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-slate-100 outline-none font-medium text-sm",value:a,onChange:e=>l(e.target.value),placeholder:"Password"})]}),g.jsx("div",{className:"flex items-center justify-between px-1 pt-1",children:g.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[g.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-slate-300 text-slate-800",checked:c,onChange:e=>d(e.target.checked)}),g.jsx("span",{className:"text-xs text-slate-500 font-medium",children:"Keep me signed in"})]})}),g.jsx("div",{className:"pt-4",children:g.jsx("button",{type:"submit",disabled:u||!k,className:"w-full py-4 rounded-xl font-semibold text-white bg-slate-800 hover:bg-slate-900 transition-all text-sm disabled:bg-slate-200 disabled:text-slate-400 shadow-md",children:u?"Processing...":f?"Register Admin":"Sign In"})})]})]}),g.jsx("button",{onClick:()=>E(!S),className:"absolute bottom-6 right-6 p-3 text-slate-300 hover:text-slate-600 transition-colors",children:g.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),g.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}),S&&g.jsx("div",{className:"absolute inset-0 bg-white/95 backdrop-blur-sm z-20 flex flex-col items-center justify-center p-8 animate-fadeIn",children:g.jsxs("div",{className:"w-full max-w-sm space-y-6",children:[g.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"Connection Endpoint"}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Script URL"}),g.jsx("input",{type:"text",className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl text-xs font-mono outline-none",placeholder:"https://script.google.com/...",value:C,onChange:e=>_(e.target.value)})]}),g.jsxs("div",{className:"flex gap-3",children:[g.jsx("button",{onClick:()=>E(!1),className:"flex-1 py-3 text-xs font-semibold text-slate-500 hover:bg-slate-50 rounded-xl",children:"Cancel"}),g.jsx("button",{onClick:()=>{C.startsWith("https://script.google.com")?(s(C),localStorage.setItem("safetyCheck_scriptUrl",C),E(!1),h("")):alert("Invalid URL. Must be a Google Apps Script endpoint.")},className:"flex-1 py-3 bg-slate-800 text-white font-semibold rounded-xl text-xs",children:"Apply"})]})]})})]})]})},Na=({label:e})=>g.jsxs("div",{className:"w-full flex items-center gap-4 mb-6 opacity-60",children:[g.jsx("span",{className:"text-[10px] font-semibold text-slate-400 uppercase tracking-widest whitespace-nowrap",children:e}),g.jsx("div",{className:"h-px flex-1 bg-slate-200"})]}),ja=({settings:t,setSettings:n,handleSaveSettings:s,isSavingSettings:r,user:i,showToast:o})=>{const[a,l]=e.useState(!1),c=e.useRef(null);e.useEffect(()=>{l(!1)},[t.companyLogo]);const d="SuperAdmin"===i?.role||"Admin"===i?.role,u="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium text-slate-700 outline-none focus:ring-2 focus:ring-indigo-100 focus:bg-white transition-all disabled:opacity-50",p="block text-[10px] font-bold text-slate-400 uppercase tracking-wide mb-1.5 ml-1";return g.jsxs("div",{className:"max-w-4xl mx-auto py-4 sm:py-8 space-y-8 animate-fadeIn px-2",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[g.jsxs("div",{children:[g.jsx("h2",{className:"text-2xl font-semibold text-slate-800 tracking-tight uppercase",children:"Application Settings"}),g.jsx("p",{className:"text-xs text-slate-400 font-medium mt-1",children:"Configure your workspace and organization details"})]}),!d&&g.jsx("div",{className:"px-3 py-1 bg-amber-50 border border-amber-100 rounded-lg",children:g.jsx("span",{className:"text-[10px] font-bold text-amber-600 uppercase",children:"Read-Only"})})]}),g.jsxs("div",{className:"bg-white p-6 sm:p-10 rounded-2xl border border-slate-200 shadow-sm space-y-10",children:[g.jsxs("section",{children:[g.jsx(Na,{label:"Organization"}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[g.jsxs("div",{className:"space-y-1",children:[g.jsx("label",{className:p,children:"Organization Name"}),g.jsx("input",{type:"text",disabled:!d,value:t.companyName,onChange:e=>n(t=>({...t,companyName:e.target.value})),className:u,placeholder:"Enter company name"})]}),g.jsxs("div",{className:"space-y-1",children:[g.jsx("label",{className:p,children:"Admin Contact Email"}),g.jsx("input",{type:"email",disabled:!d,value:t.managerEmail,onChange:e=>n(t=>({...t,managerEmail:e.target.value})),className:u,placeholder:"admin@company.com"})]})]})]}),g.jsxs("section",{children:[g.jsx(Na,{label:"System Links"}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[g.jsxs("div",{className:"space-y-1",children:[g.jsx("label",{className:p,children:"Web Portal URL"}),g.jsx("input",{type:"url",disabled:!d,value:t.webAppUrl||"",onChange:e=>n(t=>({...t,webAppUrl:e.target.value})),placeholder:"https://app.fleetpro.com",className:u})]}),g.jsxs("div",{className:"space-y-1",children:[g.jsx("label",{className:p,children:"Mobile App (APK) Link"}),g.jsx("input",{type:"url",disabled:!d,value:t.mobileApkLink||"",onChange:e=>n(t=>({...t,mobileApkLink:e.target.value})),placeholder:"Download link for mobile app",className:u})]})]})]}),g.jsxs("section",{children:[g.jsx(Na,{label:"Branding"}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-start",children:[g.jsxs("div",{className:"space-y-3",children:[g.jsx("label",{className:p,children:"Company Logo"}),g.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:c,onChange:e=>{const t=e.target.files?.[0];if(!t)return;if(t.size>1048576)return void o("Logo must be under 1MB","error");const s=new FileReader;s.onload=e=>{const t=e.target?.result;n(e=>({...e,companyLogo:t})),o("Logo updated","success")},s.readAsDataURL(t)},disabled:!d}),g.jsxs("button",{onClick:()=>c.current?.click(),disabled:!d,className:"w-full py-8 bg-slate-50 border border-dashed border-slate-300 rounded-xl flex flex-col items-center justify-center gap-2 hover:bg-slate-100 transition-all disabled:opacity-50",children:[g.jsx("svg",{className:"w-6 h-6 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),g.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wide",children:"Upload Image"})]})]}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("label",{className:p,children:"Preview"}),g.jsx("div",{className:"w-full h-32 bg-slate-50 rounded-xl border border-slate-200 flex items-center justify-center p-4",children:t.companyLogo&&!a?g.jsx("img",{src:t.companyLogo,alt:"Preview",className:"max-h-full object-contain grayscale opacity-50",onError:()=>l(!0)}):g.jsx("span",{className:"text-[10px] font-bold text-slate-300 uppercase",children:"No Logo"})})]})]})]}),d&&g.jsx("div",{className:"pt-6 border-t border-slate-100 flex justify-end",children:g.jsx("button",{onClick:s,disabled:r,className:"w-full sm:w-auto px-10 py-3.5 bg-slate-800 hover:bg-slate-900 text-white font-semibold rounded-xl shadow-md transition-all active:scale-[0.98] disabled:opacity-50 text-sm",children:r?"Saving Changes...":"Save Configuration"})})]})]})},Sa=({isLocked:e,children:t,isSuperAdmin:n,onUnlock:s,lockReason:r="license",maintenanceMessage:i})=>g.jsxs("div",{className:"relative",children:[g.jsx("div",{className:"transition-all duration-500 "+(e?"opacity-40 pointer-events-none select-none grayscale":""),children:t}),e&&g.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center p-4",children:g.jsxs("div",{className:"bg-white/95 border border-slate-200 rounded-2xl shadow-2xl p-6 max-w-sm w-full text-center transform scale-100 animate-fadeIn",children:[g.jsx("div",{className:"w-14 h-14 rounded-full flex items-center justify-center mx-auto mb-4 shadow-inner "+("maintenance"===r?"bg-amber-100":"bg-red-100"),children:"maintenance"===r?g.jsx("svg",{className:"w-7 h-7 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}):g.jsx("svg",{className:"w-7 h-7 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),g.jsx("h2",{className:"text-xl font-black text-slate-800 mb-1",children:"Action Restricted"}),g.jsx("div",{className:"text-[11px] text-slate-500 mb-4 leading-relaxed",children:"maintenance"===r?g.jsxs("p",{children:["System is in ",g.jsx("strong",{children:"View-Only"})," mode for scheduled maintenance.",g.jsx("br",{}),g.jsxs("span",{className:"text-slate-400 mt-1 block italic",children:['"',i||"Updating core services...",'"']})]}):g.jsxs("p",{children:["System is in ",g.jsx("strong",{children:"View-Only"})," mode because the license has expired. No new records or updates can be added."]})}),n&&"license"===r?g.jsx("button",{onClick:s,className:"w-full py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl transition-all shadow-lg shadow-red-200 flex items-center justify-center gap-2 text-xs uppercase tracking-widest",children:"Manage License"}):n&&"maintenance"===r?g.jsx("button",{onClick:s,className:"w-full py-3 bg-slate-900 hover:bg-black text-white font-bold rounded-xl transition-all shadow-lg flex items-center justify-center gap-2 text-xs uppercase tracking-widest",children:"Security Console"}):g.jsx("div",{className:"bg-slate-50 border border-slate-100 rounded-xl p-3",children:g.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest leading-normal",children:"maintenance"===r?"Please check back later once maintenance is complete.":"Please notify your supervisor to restore full administrative access."})})]})})]}),Ea=({title:t,description:n,icon:s,stats:r,startNewInspection:i,fetchHistory:o,isLoadingHistory:a,historyList:l,onViewReport:c,userRole:d,isLocked:u=!1,lockReason:p="license",maintenanceMessage:m})=>{const[h,f]=e.useState(""),x=e.useMemo(()=>{let e=l;if(h.trim()){const t=h.toLowerCase();e=e.filter(e=>e.truckNo&&e.truckNo.toLowerCase().includes(t)||e.driverName&&e.driverName.toLowerCase().includes(t)||e.inspectedBy&&e.inspectedBy.toLowerCase().includes(t))}else e=e.slice(0,15);return e},[l,h]),b="SuperAdmin"===d,v=("Admin"===d||"Inspector"===d||"SuperAdmin"===d)&&!u;return g.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-fadeIn py-1",children:[g.jsx(Sa,{isLocked:u,lockReason:p,maintenanceMessage:m,isSuperAdmin:b,children:g.jsxs("div",{className:"bg-white rounded-[2rem] p-6 sm:p-8 border border-slate-100 shadow-sm flex flex-col md:flex-row justify-between items-center gap-6 sm:gap-8",children:[g.jsxs("div",{className:"flex-1 w-full",children:[g.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[g.jsx("span",{className:"p-2.5 rounded-2xl bg-slate-50 text-slate-600 shadow-inner",children:s}),g.jsx("h2",{className:"text-xl sm:text-2xl font-medium text-slate-800 tracking-tight uppercase",children:t})]}),g.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6",children:[v&&g.jsxs("button",{onClick:i,className:"px-7 py-3.5 bg-slate-900 hover:bg-black text-white text-[10px] font-black rounded-2xl transition-all flex items-center justify-center gap-3 uppercase tracking-[0.2em] shadow-lg active:scale-95 border-t border-white/10",children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{d:"M12 4v16m8-8H4"})}),"Start Inspection"]}),g.jsxs("button",{onClick:()=>o(!0),disabled:a,className:"px-6 py-3.5 bg-white border border-slate-200 text-slate-500 text-[10px] font-bold rounded-2xl hover:bg-slate-50 transition-all flex items-center justify-center gap-2.5 uppercase tracking-widest active:scale-95 shadow-sm disabled:opacity-50",children:[g.jsx("svg",{className:"w-4 h-4 "+(a?"animate-spin":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Sync Hub"]})]})]}),g.jsxs("div",{className:"flex gap-3 sm:gap-5 w-full sm:w-auto",children:[g.jsxs("div",{className:"flex-1 sm:flex-none bg-slate-50 rounded-[1.5rem] p-4 sm:p-5 text-center min-w-[90px] border border-slate-100 shadow-inner",children:[g.jsx("div",{className:"text-2xl sm:text-3xl font-medium text-slate-800 leading-none",children:r.total}),g.jsx("div",{className:"text-[8px] sm:text-[9px] text-slate-400 uppercase font-medium tracking-[0.2em] mt-2",children:"Logs"})]}),g.jsxs("div",{className:"flex-1 sm:flex-none bg-emerald-50 rounded-[1.5rem] p-4 sm:p-5 text-center min-w-[90px] border border-emerald-100 shadow-inner",children:[g.jsxs("div",{className:"text-2xl sm:text-3xl font-medium text-emerald-600 leading-none",children:[r.passRate,"%"]}),g.jsx("div",{className:"text-[8px] sm:text-[9px] text-slate-400 uppercase font-medium tracking-[0.2em] mt-2",children:"Pass"})]})]})]})}),g.jsxs("div",{className:"bg-white rounded-[2rem] border border-slate-100 overflow-hidden shadow-sm flex flex-col min-h-0",children:[g.jsxs("div",{className:"px-6 py-4 border-b border-slate-50 flex flex-col sm:flex-row justify-between items-center bg-slate-50/30 gap-4",children:[g.jsxs("div",{className:"flex items-center gap-4 self-start",children:[g.jsx("h3",{className:"text-[10px] font-semibold text-slate-400 uppercase tracking-[0.3em]",children:"Inspection History"}),u&&g.jsx("span",{className:"text-[8px] font-black text-rose-600 bg-rose-50 px-2 py-0.5 rounded border border-rose-100 uppercase",children:"View Only"})]}),g.jsxs("div",{className:"relative w-full sm:w-auto",children:[g.jsx("svg",{className:"w-3.5 h-3.5 absolute left-3 top-1/2 -translate-y-1/2 text-slate-300 pointer-events-none",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),g.jsx("input",{type:"text",placeholder:"Search logs...",value:h,onChange:e=>f(e.target.value),className:"w-full sm:w-60 pl-9 pr-4 py-2 bg-white border border-slate-200 rounded-xl text-[11px] outline-none font-normal focus:ring-4 focus:ring-indigo-50/50 transition-all"})]})]}),g.jsx("div",{className:"flex-1 overflow-hidden",children:a?g.jsxs("div",{className:"py-24 text-center",children:[g.jsx("div",{className:"w-8 h-8 border-4 border-slate-100 border-t-slate-900 rounded-full animate-spin mx-auto mb-4"}),g.jsx("p",{className:"text-[9px] font-semibold text-slate-300 uppercase tracking-[0.3em]",children:"Downloading archive"})]}):0===x.length?g.jsx("div",{className:"py-24 text-center text-[10px] font-medium text-slate-300 uppercase tracking-[0.3em]",children:"Archive is empty"}):g.jsx("div",{className:"divide-y divide-slate-50",children:x.map((e,t)=>g.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center px-6 py-4 hover:bg-slate-50/50 transition-colors gap-4",children:[g.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[g.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-xl text-sm font-black text-white shadow-sm shrink-0\n                                        ${Number(e.rate)>=4?"bg-emerald-500":3===Number(e.rate)?"bg-amber-500":"bg-rose-500"}\n                                    `,children:e.rate}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"font-semibold text-slate-800 text-sm truncate uppercase tracking-tight",children:e.truckNo}),g.jsx("div",{className:"text-[10px] text-slate-400 font-medium truncate uppercase tracking-wider",children:e.trailerNo||"Solo Unit"})]})]}),g.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:items-center gap-4 sm:gap-10 shrink-0",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-7 h-7 rounded-lg bg-slate-100 flex items-center justify-center text-[9px] font-bold text-slate-400 border border-slate-200 uppercase shrink-0",children:String(e.inspectedBy||"?").charAt(0)}),g.jsxs("div",{className:"min-w-0",children:[g.jsx("div",{className:"text-[10px] font-bold text-slate-600 truncate",children:e.inspectedBy}),g.jsx("div",{className:"text-[8px] text-slate-400 uppercase tracking-widest",children:"Auditor"})]})]}),g.jsxs("div",{className:"text-right sm:text-left",children:[g.jsx("div",{className:"text-[10px] font-bold text-slate-600",children:new Date(e.timestamp).toLocaleDateString()}),g.jsx("div",{className:"text-[8px] text-slate-400 uppercase tracking-widest",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),g.jsx("div",{className:"sm:ml-4 border-t sm:border-t-0 border-slate-50 pt-3 sm:pt-0 shrink-0",children:g.jsxs("button",{onClick:()=>c(e),className:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-6 py-2.5 text-[10px] font-bold text-indigo-600 bg-indigo-50 hover:bg-indigo-600 hover:text-white rounded-xl transition-all uppercase tracking-widest border border-indigo-100 shadow-sm",children:[g.jsxs("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:[g.jsx("path",{d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),g.jsx("path",{d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View Report"]})})]},t))})})]})]})},Ca=e=>g.jsx(Ea,{...e,title:"General Inspection",description:"",icon:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),colorTheme:"slate",titlePrefix:"VEHICLE INSPECTION"}),_a=e=>g.jsx(Ea,{...e,title:"Petroleum V1 Inspection",description:"",icon:g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),colorTheme:"orange",titlePrefix:"PETROLEUM INSPECTION"}),ka=e=>g.jsx(Ea,{...e,title:"Petroleum V2 Inspection",description:"",icon:g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),colorTheme:"rose",titlePrefix:"PETROLEUM V2 INSPECTION"}),Ia=e=>g.jsx(Ea,{...e,title:"Acid Inspection",description:"",icon:g.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("path",{d:"M12 2l-5.5 9h11z"}),g.jsx("path",{d:"M10 13v6h4v-6z"})]}),colorTheme:"purple",titlePrefix:"ACID TANKER INSPECTION"}),Aa=({label:t,value:n,onChange:s,options:r=[],placeholder:i,isRegNo:o,isTitleCase:a,readOnly:l,error:c})=>{const[d,u]=e.useState(!1),[p,m]=e.useState(-1),h=e.useRef(null),f=e.useRef(null),x=r.filter(e=>null!=e&&String(e).toLowerCase().includes((n||"").toLowerCase()));e.useEffect(()=>{function e(e){h.current&&!h.current.contains(e.target)&&u(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[h]);const b=e=>{l||(s(String(e)),u(!1),m(-1))};return g.jsxs("div",{className:"relative",ref:h,children:[g.jsxs("label",{className:"block text-xs font-bold uppercase mb-1.5 tracking-wide flex justify-between "+(c?"text-red-600":"text-gray-500"),children:[t,l&&g.jsxs("span",{className:"text-[10px] bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded flex items-center gap-1",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Verified"]})]}),g.jsxs("div",{className:"relative",children:[g.jsx("input",{ref:f,type:"text",value:n,onChange:e=>{if(l)return;let t=e.target.value;if(o){t=t.toUpperCase();let e=t.replace(/[^A-Z0-9]/g,"");e=e.replace(/([A-Z])(\d)/g,"$1 $2"),e=e.replace(/(\d)([A-Z])/g,"$1 $2"),t=e}a&&!o&&(t=t.replace(/\b\w/g,e=>e.toUpperCase())),s(t),u(!0),m(-1)},onFocus:()=>!l&&u(!0),onKeyDown:e=>{l||("ArrowDown"===e.key?(e.preventDefault(),m(e=>Math.min(e+1,x.length-1))):"ArrowUp"===e.key?(e.preventDefault(),m(e=>Math.max(e-1,0))):"Enter"===e.key?(e.preventDefault(),p>=0&&x[p]?b(x[p]):b(n)):"Escape"===e.key&&u(!1))},placeholder:i,readOnly:l,className:`w-full p-3.5 border rounded-lg transition-all font-medium \n             ${l?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed focus:outline-none":c?"bg-red-50 border-red-300 focus:ring-2 focus:ring-red-200 text-red-900 placeholder-red-300":"bg-gray-50 border-gray-200 focus:ring-2 focus:ring-blue-500 focus:bg-white text-gray-800 placeholder-gray-400"}\n          `}),g.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none "+(c?"text-red-400":"text-gray-400"),children:l?g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}):c?g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}):g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),c&&g.jsx("p",{className:"text-[10px] text-red-500 font-bold mt-1 ml-1 animate-fadeIn",children:"This field is required"}),!l&&d&&(n.length>0||x.length>0)&&g.jsx("ul",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-xl max-h-60 overflow-y-auto",children:x.length>0?x.map((e,t)=>g.jsxs("li",{onClick:()=>b(e),className:`px-4 py-2.5 text-sm cursor-pointer transition-colors border-b border-gray-50 last:border-none flex justify-between items-center\n                  ${t===p?"bg-blue-50 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-50"}\n                `,children:[e,o&&g.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded border border-gray-200",children:"EXISTING"})]},t)):g.jsxs("li",{onMouseDown:e=>{e.preventDefault(),b(n)},className:"px-4 py-3 text-sm text-blue-600 bg-blue-50 cursor-pointer font-medium flex items-center gap-2 hover:bg-blue-100 transition-colors",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),'Add New Entry: "',n,'"']})})]})},Ta=({label:e})=>g.jsxs("div",{className:"w-full flex items-center gap-4 mb-4 sm:mb-6 opacity-70 shrink-0",children:[g.jsx("span",{className:"text-[10px] font-semibold text-slate-400 uppercase tracking-[0.3em] whitespace-nowrap",children:e}),g.jsx("div",{className:"h-px flex-1 bg-gradient-to-r from-slate-100 to-transparent"})]}),Oa=({currentUser:t,appScriptUrl:n,showToast:s,validationLists:r,settings:i})=>{const[o,a]=e.useState([]),[l,c]=e.useState(!1),[d,u]=e.useState("list"),[p,m]=e.useState(!1),[h,f]=e.useState(""),[x,b]=e.useState({name:"",username:"",password:"",role:"Inspector",position:""}),[v,y]=e.useState(!1),w="SuperAdmin"===t.role,N="Admin"===t.role||w;if(e.useEffect(()=>{N&&j()},[N]),!N)return g.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center font-sans min-h-[50vh]",children:[g.jsx("div",{className:"w-12 h-12 bg-red-50 text-red-500 rounded-full flex items-center justify-center mb-4",children:g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),g.jsx("h3",{className:"text-lg font-medium text-slate-800 tracking-tight uppercase",children:"Access Restricted"}),g.jsx("p",{className:"text-slate-400 max-w-xs mt-1 text-[9px] font-medium uppercase tracking-widest leading-relaxed",children:"Admin clearance required."})]});const j=async(e=!1)=>{if(n){c(!0);try{const e=await fetch(n,{method:"POST",body:JSON.stringify({action:"get_users"})}),t=await e.json();"success"===t.status&&Array.isArray(t.users)&&a(t.users)}catch(t){s("Failed to load users","error")}finally{c(!1)}}},S=async e=>{if(window.confirm(`Remove user "${e}"?`)){c(!0);try{const t=await fetch(n,{method:"POST",body:JSON.stringify({action:"delete_user",username:e})}),r=await t.json();"success"===r.status?(s("User removed","success"),j()):s(r.message||"Delete failed","error")}catch(t){s("Connection error","error")}finally{c(!1)}}},E=async e=>{if(e.username===t.username)return void s("Cannot restrict own access.","warning");const r=!e.isActive;a(t=>t.map(t=>t.username===e.username?{...t,isActive:r}:t));try{const t=await fetch(n,{method:"POST",body:JSON.stringify({action:"update_user",username:e.username,isActive:r})});"success"!==(await t.json()).status&&(a(t=>t.map(t=>t.username===e.username?{...t,isActive:!r}:t)),s("Sync failed.","error"))}catch(i){a(t=>t.map(t=>t.username===e.username?{...t,isActive:!r}:t)),s("Connection failed.","error")}},C=e=>{b({name:e.name||"",username:e.username,role:e.role,position:e.position||"",password:""}),f(e.username),m(!0),u("form")},_=async e=>{if(e.preventDefault(),x.username){y(!0);try{const e={action:p?"update_user":"register_user",...x,preferences:{...p?{}:{mustChangePassword:!0}}};p&&(e.originalUsername=h);const t=await fetch(n,{method:"POST",body:JSON.stringify(e)}),r=await t.json();"success"===r.status?(s(p?"Updated":"Enrolled","success"),u("list"),j()):s(r.message||"Failed","error")}catch(t){s("Error","error")}finally{y(!1)}}};return"form"===d?g.jsx("div",{className:"max-w-2xl mx-auto py-4 flex flex-col items-center justify-center min-h-[calc(100vh-140px)] px-4 animate-fadeIn font-sans overflow-hidden",children:g.jsxs("div",{className:"w-full space-y-4",children:[g.jsxs("button",{onClick:()=>u("list"),className:"text-[10px] font-medium text-slate-400 hover:text-slate-800 flex items-center gap-2 uppercase tracking-widest",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),g.jsxs("div",{className:"bg-white rounded-[1.5rem] shadow-sm border border-slate-100 p-6 md:p-10",children:[g.jsx(Ta,{label:p?"Modify Profile":"Staff Enrollment"}),g.jsxs("form",{onSubmit:_,className:"space-y-6",children:[g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-[9px] font-semibold uppercase text-slate-400 mb-1.5 tracking-widest",children:"Email Address"}),g.jsx("input",{type:"email",required:!0,className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none font-medium text-slate-700 text-sm",value:x.username,onChange:e=>b({...x,username:e.target.value}),placeholder:"staff@domain.com"})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-[9px] font-semibold uppercase text-slate-400 mb-1.5 tracking-widest",children:"Role"}),g.jsxs("select",{className:"w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium text-slate-700 outline-none h-[46px] appearance-none",value:x.role,onChange:e=>b({...x,role:e.target.value}),children:[g.jsx("option",{value:"Inspector",children:"Inspector"}),g.jsx("option",{value:"Operations",children:"Operations"}),g.jsx("option",{value:"Maintenance",children:"Maintenance"}),g.jsx("option",{value:"Admin",children:"Admin"}),w&&g.jsx("option",{value:"SuperAdmin",children:"SuperAdmin"})]})]})]}),g.jsxs("div",{className:"space-y-4",children:[g.jsx(Aa,{label:"Designation",value:x.position,onChange:e=>b({...x,position:e}),options:r.positions,isTitleCase:!0}),p&&g.jsx(Aa,{label:"Display Name",value:x.name,onChange:e=>b({...x,name:e}),options:r.inspectors,isTitleCase:!0})]})]}),g.jsx("div",{className:"pt-2 flex justify-end",children:g.jsx("button",{type:"submit",disabled:v,className:"w-full md:w-auto px-10 py-3 bg-slate-900 hover:bg-black text-white font-medium rounded-xl transition-all text-[10px] uppercase tracking-widest active:scale-95",children:v?"Wait...":p?"Sync":"Enroll"})})]})]})]})}):g.jsx("div",{className:"max-w-6xl mx-auto py-2 flex flex-col min-h-[calc(100vh-140px)] px-2 sm:px-4 animate-fadeIn font-sans overflow-hidden",children:g.jsxs("div",{className:"w-full flex-1 flex flex-col min-h-0",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 px-2 mb-6 shrink-0",children:[g.jsxs("div",{children:[g.jsx("h2",{className:"text-3xl font-normal text-slate-800 uppercase tracking-tight leading-none",children:"Staff Directory"}),g.jsx("p",{className:"text-[9px] text-slate-400 font-medium uppercase tracking-[0.3em] mt-2",children:"Access Control"})]}),g.jsxs("button",{onClick:()=>{b({name:"",username:"",password:"",role:"Inspector",position:""}),m(!1),u("form")},className:"w-full sm:w-auto px-8 py-3 bg-slate-900 hover:bg-black text-white font-medium rounded-xl shadow-lg transition-all flex items-center justify-center gap-2 text-[10px] uppercase tracking-widest active:scale-95",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{d:"M12 4v16m8-8H4"})}),"Add Personnel"]})]}),g.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[g.jsx(Ta,{label:"Fleet Personnel"}),g.jsx("div",{className:"bg-white rounded-[1.5rem] shadow-sm border border-slate-100 overflow-hidden flex-1 flex flex-col min-h-0",children:g.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-hide",children:[g.jsxs("table",{className:"w-full text-left text-sm border-collapse hidden md:table",children:[g.jsx("thead",{className:"bg-slate-50/50 text-[9px] font-semibold text-slate-400 uppercase tracking-widest border-b border-slate-50 sticky top-0 z-10 backdrop-blur-md",children:g.jsxs("tr",{children:[g.jsx("th",{className:"px-8 py-4",children:"Identity"}),g.jsx("th",{className:"px-8 py-4",children:"Privileges"}),g.jsx("th",{className:"px-8 py-4",children:"State"}),g.jsx("th",{className:"px-8 py-4 text-right",children:"Actions"})]})}),g.jsx("tbody",{className:"divide-y divide-slate-50",children:l?g.jsx("tr",{children:g.jsx("td",{colSpan:4,className:"py-24 text-center",children:g.jsx("div",{className:"w-6 h-6 border-2 border-slate-200 border-t-indigo-500 rounded-full animate-spin mx-auto"})})}):0===o.length?g.jsx("tr",{children:g.jsx("td",{colSpan:4,className:"py-24 text-center text-[10px] font-medium text-slate-300 uppercase tracking-widest",children:"No personnel logged"})}):o.map((e,t)=>g.jsxs("tr",{className:`hover:bg-slate-50/30 transition-colors group ${!e.isActive&&"opacity-60"}`,children:[g.jsx("td",{className:"px-8 py-4",children:g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-50 border border-slate-100 flex items-center justify-center font-semibold text-slate-300 text-[10px] shrink-0",children:e.name?e.name.substring(0,2).toUpperCase():"??"}),g.jsxs("div",{className:"min-w-0",children:[g.jsx("div",{className:"font-medium text-slate-800 text-xs tracking-tight truncate uppercase",children:e.name||"Setup Pending"}),g.jsx("div",{className:"text-[10px] text-slate-400 font-normal truncate",children:"SuperAdmin"!==e.role||w?e.username:"••••••"})]})]})}),g.jsx("td",{className:"px-8 py-4",children:g.jsx("span",{className:"px-2 py-0.5 rounded-md text-[9px] font-semibold uppercase tracking-widest border "+("Admin"===e.role||"SuperAdmin"===e.role?"bg-indigo-50 text-indigo-600 border-indigo-100":"bg-slate-50 text-slate-500 border-slate-100"),children:e.role})}),g.jsx("td",{className:"px-8 py-4",children:g.jsx("button",{onClick:()=>E(e),disabled:"SuperAdmin"===e.role&&!w,className:"relative inline-flex h-3.5 w-8 items-center rounded-full transition-all "+(e.isActive?"bg-emerald-500":"bg-slate-200"),children:g.jsx("span",{className:"inline-block h-2.5 w-2.5 transform rounded-full bg-white transition-transform "+(e.isActive?"translate-x-5":"translate-x-0.5")})})}),g.jsx("td",{className:"px-8 py-4 text-right",children:g.jsxs("div",{className:"flex justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[g.jsx("button",{onClick:()=>C(e),className:"p-1.5 text-blue-400 hover:text-blue-600 transition-colors",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z",strokeWidth:"2.5"})})}),g.jsx("button",{onClick:()=>S(e.username),className:"p-1.5 text-rose-400 hover:text-rose-600 transition-colors",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16",strokeWidth:"2.5"})})})]})})]},t))})]}),g.jsx("div",{className:"md:hidden divide-y divide-slate-50",children:l?g.jsx("div",{className:"py-24 text-center",children:g.jsx("div",{className:"w-6 h-6 border-2 border-slate-100 border-t-indigo-500 rounded-full animate-spin mx-auto"})}):0===o.length?g.jsx("div",{className:"py-24 text-center text-[10px] font-medium text-slate-300 uppercase tracking-widest",children:"No Personnel"}):o.map((e,t)=>g.jsxs("div",{className:`p-3.5 flex flex-col gap-2.5 transition-all ${!e.isActive&&"opacity-60"}`,children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[g.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-50 border border-slate-100 flex items-center justify-center font-semibold text-slate-300 text-[10px] shrink-0",children:e.name?e.name.substring(0,2).toUpperCase():"??"}),g.jsxs("div",{className:"min-w-0",children:[g.jsx("div",{className:"font-medium text-slate-800 text-xs tracking-tight truncate uppercase leading-none",children:e.name||"Setup Pending"}),g.jsx("div",{className:"text-[9px] text-slate-400 font-normal truncate mt-1",children:"SuperAdmin"!==e.role||w?e.username:"••••••"})]})]}),g.jsxs("div",{className:"flex gap-1 shrink-0",children:[g.jsx("button",{onClick:()=>C(e),className:"p-1.5 text-blue-500 bg-blue-50 rounded-lg",children:g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),g.jsx("button",{onClick:()=>S(e.username),className:"p-1.5 text-rose-500 bg-rose-50 rounded-lg",children:g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),g.jsxs("div",{className:"flex items-center justify-between pt-1",children:[g.jsxs("div",{className:"flex gap-2",children:[g.jsx("span",{className:"px-2 py-0.5 rounded-md text-[8px] font-semibold uppercase tracking-widest border "+("Admin"===e.role||"SuperAdmin"===e.role?"bg-indigo-50 text-indigo-600 border-indigo-100":"bg-slate-50 text-slate-500 border-slate-100"),children:e.role}),e.position&&g.jsx("span",{className:"text-[8px] font-medium text-slate-400 uppercase tracking-tight self-center truncate max-w-[100px]",children:e.position})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-[8px] font-semibold uppercase tracking-widest "+(e.isActive?"text-emerald-500":"text-slate-300"),children:e.isActive?"Live":"Off"}),g.jsx("button",{onClick:()=>E(e),disabled:"SuperAdmin"===e.role&&!w,className:"relative inline-flex h-3.5 w-8 items-center rounded-full transition-all "+(e.isActive?"bg-emerald-500":"bg-slate-200"),children:g.jsx("span",{className:"inline-block h-2.5 w-2.5 transform rounded-full bg-white transition-transform "+(e.isActive?"translate-x-5":"translate-x-0.5")})})]})]})]},t))})]})})]})]})})},Ra=({children:e})=>g.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 flex items-center justify-center text-slate-700 transition-all duration-300 group-hover:scale-110",children:n.isValidElement(e)?n.cloneElement(e,{className:"w-full h-full",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}):e}),Pa=()=>g.jsx(Ra,{children:g.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[g.jsx("path",{d:"M9 11l3 3L22 4"}),g.jsx("path",{d:"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"})]})}),La=()=>g.jsx(Ra,{children:g.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:g.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})})}),Ma=()=>g.jsx(Ra,{children:g.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[g.jsx("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),g.jsx("circle",{cx:"9",cy:"7",r:"4"}),g.jsx("path",{d:"M23 21v-2a4 4 0 00-3-3.87"}),g.jsx("path",{d:"M16 3.13a4 4 0 010 7.75"})]})}),Da=()=>g.jsx(Ra,{children:g.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[g.jsx("circle",{cx:"12",cy:"12",r:"3"}),g.jsx("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"})]})}),Ua=()=>g.jsx(Ra,{children:g.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[g.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2"}),g.jsx("path",{d:"M7 8h10M7 12h10M7 16h6"})]})}),qa=()=>g.jsx(Ra,{children:g.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:g.jsx("path",{d:"M18 20V10M12 20V4M6 20v-6"})})}),Ga=()=>g.jsx(Ra,{children:g.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[g.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),g.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 113 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),Ha=()=>g.jsx(Ra,{children:g.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[g.jsx("path",{d:"M12 21a9 9 0 100-18 9 9 0 000 18z"}),g.jsx("path",{d:"M12 17v-4M12 9h.01",strokeWidth:"3"})]})}),Ba=({id:e,label:t,icon:n,isForcedLock:s=!1,badgeCount:r=0,badgeColor:i="bg-slate-800",isInspectionModule:o=!1,isLocked:a,onNavigate:l,isAddon:c=!1})=>{const d=s||o&&a;return g.jsxs("button",{onClick:()=>!d&&l(e),className:"flex flex-col items-center p-4 sm:p-8 transition-all w-full group relative rounded-[2rem]\n                "+(d?"opacity-30 cursor-not-allowed grayscale":"hover:bg-white hover:shadow-2xl active:scale-95 border border-transparent hover:border-slate-50"),children:[g.jsxs("div",{className:"mb-4 flex items-center justify-center relative",children:[n,d&&g.jsx("div",{className:"absolute -top-1 -right-1 bg-slate-900 text-white rounded-full p-1.5 shadow-xl ring-4 ring-slate-50",children:g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeWidth:"3",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),r>0&&!d&&g.jsx("div",{className:`absolute -top-1 -right-1 ${i} text-white text-[9px] font-black w-6 h-6 rounded-full flex items-center justify-center border-4 border-white shadow-lg`,children:r}),c&&!d&&g.jsx("div",{className:"absolute -top-1 -right-1 bg-indigo-600 text-white text-[7px] font-black px-1.5 py-0.5 rounded shadow-sm border border-indigo-500 uppercase tracking-tighter",children:"Pro"})]}),g.jsx("span",{className:"text-[10px] font-black text-center leading-tight uppercase tracking-[0.2em] "+(d?"text-slate-400":"text-slate-600 group-hover:text-slate-900"),children:t})]})},Va=({label:e})=>g.jsxs("div",{className:"w-full flex items-center gap-6 mb-8 opacity-40",children:[g.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.4em] whitespace-nowrap",children:e}),g.jsx("div",{className:"h-px flex-1 bg-gradient-to-r from-slate-200 to-transparent"})]}),Fa=({onNavigate:e,userRole:t,isLocked:n=!1,pendingAlertsCount:s=0})=>{const r="Admin"===t||"SuperAdmin"===t,i="SuperAdmin"===t;return g.jsx("div",{className:"max-w-5xl mx-auto py-10 sm:py-16 px-4 min-h-screen",children:g.jsxs("div",{className:"space-y-16",children:[g.jsxs("section",{id:"system-mgmt-section",className:"animate-fadeIn",children:[g.jsx(Va,{label:"CONTROL CENTER"}),g.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-6",children:[g.jsx(Ba,{id:"maintenance",label:"SECURITY",isLocked:n,isForcedLock:!i,onNavigate:e,icon:g.jsx(La,{})}),g.jsx(Ba,{id:"users",label:"PERSONNEL",isLocked:n,isForcedLock:!r,onNavigate:e,icon:g.jsx(Ma,{})}),g.jsx(Ba,{id:"registry",label:"REGISTRY",isLocked:n,isForcedLock:!r,onNavigate:e,icon:g.jsx(Ua,{})}),g.jsx(Ba,{id:"settings",label:"SETTINGS",isLocked:n,isForcedLock:!r,onNavigate:e,icon:g.jsx(Da,{})})]})]}),g.jsxs("section",{id:"inspection-forms-section",className:"animate-fadeIn",style:{animationDelay:"100ms"},children:[g.jsx(Va,{label:"AUDIT MODULES"}),g.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-6",children:[g.jsx(Ba,{id:"general",label:"GENERAL",isInspectionModule:!0,isLocked:n,onNavigate:e,icon:g.jsx(Pa,{})}),g.jsx(Ba,{id:"petroleum",label:"PETRO V1",isInspectionModule:!0,isLocked:n,onNavigate:e,icon:g.jsx(Pa,{})}),g.jsx(Ba,{id:"petroleum_v2",label:"PETRO V2",isInspectionModule:!0,isLocked:n,onNavigate:e,icon:g.jsx(Pa,{})}),g.jsx(Ba,{id:"acid",label:"ACID CHECK",isInspectionModule:!0,isLocked:n,onNavigate:e,icon:g.jsx(Pa,{})})]})]}),g.jsxs("section",{className:"animate-fadeIn",style:{animationDelay:"200ms"},children:[g.jsx(Va,{label:"OPERATIONS"}),g.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-6",children:[g.jsx(Ba,{id:"analytics",label:"ANALYTICS",isLocked:n,onNavigate:e,icon:g.jsx(qa,{}),badgeCount:s,badgeColor:"bg-rose-600"}),g.jsx(Ba,{id:"track_requests",label:"PIPELINE",isLocked:n,onNavigate:e,icon:g.jsx(Ga,{})}),g.jsx(Ba,{id:"support",label:"SUPPORT",isLocked:n,onNavigate:e,icon:g.jsx(Ha,{})}),g.jsxs("div",{className:"hidden sm:flex flex-col items-center justify-center p-8 opacity-20 select-none",children:[g.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-slate-300",children:"HUB ACTIVE"}),g.jsx("div",{className:"w-4 h-1 bg-indigo-500 mt-2 rounded-full animate-pulse"})]})]})]})]})})},Wa=({label:t,onCapture:n,existingImage:s})=>{const r=e.useRef(null),[i,o]=e.useState(s);return g.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[g.jsx("span",{className:"text-sm font-semibold text-gray-700",children:t}),g.jsx("div",{className:"relative w-full aspect-video bg-gray-200 rounded-md overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-300",children:i?g.jsx("img",{src:i,alt:"Capture",className:"w-full h-full object-cover"}):g.jsxs("div",{className:"text-gray-400 flex flex-col items-center",children:[g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),g.jsx("circle",{cx:"12",cy:"13",r:"3"})]}),g.jsx("span",{className:"text-xs mt-1",children:"No Image"})]})}),g.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:r,onChange:e=>{const t=e.target.files?.[0];if(t){const e=new FileReader;e.onloadend=()=>{const t=e.result;o(t),n(t)},e.readAsDataURL(t)}},className:"hidden"}),g.jsxs("button",{type:"button",onClick:()=>r.current?.click(),className:"w-full py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 transition flex items-center justify-center gap-2",children:[g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),g.jsx("circle",{cx:"12",cy:"13",r:"4"})]}),i?"Retake Photo":"Take Photo"]})]})},Ja=({label:t,onSave:n,existingSignature:s})=>{const r=e.useRef(null),i=e.useRef(null),[o,a]=e.useState(!1),l=e.useRef(!1);e.useEffect(()=>{const e=r.current,t=i.current;if(!e||!t)return;const n=()=>{const n=e.toDataURL(),r=t.getBoundingClientRect();e.width=r.width,e.height=160;const i=e.getContext("2d");if(l.current||s){const t=new Image;t.src=l.current?n:s||"",t.onload=()=>{i?.drawImage(t,0,0,e.width,e.height),l.current=!0}}};n();const o=new ResizeObserver(()=>{n()});return o.observe(t),()=>o.disconnect()},[s]);const c=e=>{const t=r.current;if(!t)return{x:0,y:0};const n=t.getBoundingClientRect();let s,i;return"touches"in e?(s=e.touches[0].clientX,i=e.touches[0].clientY):(s=e.clientX,i=e.clientY),{x:s-n.left,y:i-n.top}},d=e=>{"touches"in e&&e.preventDefault();const t=r.current;if(!t)return;const n=t.getContext("2d");if(!n)return;a(!0);const{x:s,y:i}=c(e);n.beginPath(),n.moveTo(s,i),n.lineWidth=2,n.lineCap="round",n.strokeStyle="#000"},u=e=>{if("touches"in e&&e.preventDefault(),!o)return;const t=r.current;if(!t)return;const n=t.getContext("2d");if(!n)return;const{x:s,y:i}=c(e);n.lineTo(s,i),n.stroke()},p=e=>{"touches"in e&&e.preventDefault(),o&&(a(!1),r.current&&n(r.current.toDataURL()))};return g.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[g.jsxs("div",{className:"flex justify-between items-end",children:[g.jsx("label",{className:"block text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:t}),g.jsx("button",{type:"button",onClick:()=>{const e=r.current;if(e){const t=e.getContext("2d");t?.clearRect(0,0,e.width,e.height),n(""),l.current=!1}},className:"text-[10px] text-rose-500 hover:text-rose-700 font-bold uppercase tracking-widest",children:"Clear"})]}),g.jsxs("div",{ref:i,className:"w-full border border-slate-200 rounded-2xl bg-white overflow-hidden relative shadow-sm h-[160px]",children:[g.jsx("canvas",{ref:r,className:"w-full h-full bg-white cursor-crosshair touch-none block",onMouseDown:d,onMouseMove:u,onMouseUp:p,onMouseLeave:p,onTouchStart:d,onTouchMove:u,onTouchEnd:p}),g.jsx("div",{className:"absolute bottom-3 right-4 text-[9px] font-black text-slate-200 pointer-events-none select-none uppercase tracking-[0.2em]",children:"Authentication Required"})]})]})},$a=({label:e,status:t,current:n,onClick:s,colorClass:r})=>{const i=t===n,o={green:i?"bg-emerald-600 text-white border-emerald-600 shadow-lg shadow-emerald-100":"bg-white text-emerald-700 border-emerald-100 hover:bg-emerald-50",red:i?"bg-rose-600 text-white border-rose-600 shadow-lg shadow-rose-100":"bg-white text-rose-700 border-rose-100 hover:bg-rose-50",yellow:i?"bg-amber-500 text-white border-amber-500 shadow-lg shadow-amber-100":"bg-white text-amber-600 border-amber-100 hover:bg-amber-50",gray:i?"bg-slate-700 text-white border-slate-700 shadow-lg shadow-slate-100":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"};return g.jsxs("button",{onClick:s,className:`relative py-3 px-1 rounded-xl border font-black text-[9px] transition-all flex flex-col items-center justify-center gap-1.5 flex-1 min-w-0 ${o[r]} ${i?"z-10 scale-[1.02]":"shadow-sm opacity-90 hover:opacity-100 hover:scale-[1.01]"}`,children:[g.jsxs("div",{className:"h-4 flex items-center justify-center pointer-events-none scale-90 sm:scale-100",children:[t===x.GOOD&&g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{d:"M5 13l4 4L19 7"})}),t===x.BAD&&g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{d:"M6 18L18 6M6 6l12 12"})}),t===x.ATTENTION&&g.jsx("span",{className:"text-sm font-black italic",children:"!"}),t===x.NIL&&g.jsx("span",{className:"text-sm font-black opacity-40",children:"Ø"})]}),g.jsx("span",{className:"uppercase tracking-tighter sm:tracking-widest truncate w-full px-1 text-center pointer-events-none",children:e})]})},za=({label:e,value:t,onChange:n,type:s="text",placeholder:r,error:i})=>g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs font-bold uppercase mb-1.5 tracking-wide "+(i?"text-red-600":"text-gray-500"),children:e}),g.jsx("input",{type:s,value:t,onChange:e=>n(e.target.value),placeholder:r,className:`w-full p-3.5 border rounded-lg focus:ring-2 focus:outline-none transition-all font-medium placeholder-gray-400\n        ${i?"bg-red-50 border-red-300 focus:ring-red-200 text-red-900":"bg-gray-50 border-gray-200 focus:ring-blue-500 focus:bg-white text-gray-800"}\n      `}),i&&g.jsx("p",{className:"text-[10px] text-red-500 font-bold mt-1 ml-1 animate-fadeIn",children:"This field is required"})]}),Ya=({initialData:t,activeModule:s,validationLists:r,onSaveDraft:i,onSubmit:o,onExit:a,submissionStatus:l})=>{const[c,d]=e.useState(t),[u,p]=e.useState(0),[m,h]=e.useState({}),[f,b]=e.useState(!1),F=(e,t)=>{d(n=>({...n,[e]:t})),m[e]&&h(t=>{const n={...t};return delete n[e],n})},W=e=>{let t=[],n=[];return"general"===s?n=C:"petroleum"===s?n=O:"petroleum_v2"===s?n=V:"acid"===s&&(n=D),"general"===s?(2===e&&(t=[y,w]),3===e&&(t=[N,j]),4===e&&(t=[S,E])):"petroleum"===s?(2===e&&(t=[_]),3===e&&(t=[k,I]),4===e&&(t=[A,T])):"petroleum_v2"===s?(2===e&&(t=[U]),3===e&&(t=[q]),4===e&&(t=[G,H,B])):"acid"===s&&(2===e&&(t=[R]),3===e&&(t=[P]),4===e&&(t=[L,M])),n.filter(e=>t.includes(e.category))},J=e=>{const t={};if(0===e&&(c.truckNo||(t.truckNo=!0),c.trailerNo||(t.trailerNo=!0),c.driverName||(t.driverName=!0),c.location||(t.location=!0),c.odometer||(t.odometer=!0),"general"===s||c.jobCard||(t.jobCard=!0)),e>=2&&e<=4){W(e).forEach(e=>{c[e.id]||(t[e.id]=!0)})}return 5===e&&(c.remarks&&""!==c.remarks.trim()||(t.remarks=!0),c.rate&&0!==c.rate||(t.rate=!0),c.inspectorSignature||(t.inspectorSignature=!0),c.driverSignature||(t.driverSignature=!0)),Object.keys(t).length>0?(h(t),window.scrollTo({top:0,behavior:"smooth"}),!1):(h({}),!0)};return g.jsxs("div",{className:"flex flex-col min-h-[calc(100vh-56px)] bg-slate-50/50",children:[g.jsx("div",{className:"bg-white border-b border-slate-100 sticky top-14 z-30 shadow-sm shrink-0",children:g.jsx("div",{className:"max-w-5xl mx-auto px-4 py-4 sm:py-5 overflow-hidden",children:g.jsx("div",{className:"flex justify-between items-center gap-1 sm:gap-4",children:v.map((e,t)=>{const s=t===u,r=t<u;return g.jsxs(n.Fragment,{children:[g.jsxs("div",{className:"flex flex-col items-center gap-1.5 min-w-0 transition-all duration-500",children:[g.jsx("div",{className:`\n                                            w-6 h-6 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center text-[8px] sm:text-xs font-black transition-all\n                                            ${s?"bg-slate-900 text-white shadow-lg scale-110":r?"bg-emerald-500 text-white":"bg-slate-100 text-slate-300"}\n                                        `,children:r?"✓":t+1}),g.jsx("span",{className:"text-[7px] font-black uppercase tracking-tighter sm:tracking-widest truncate w-full text-center hidden xs:block "+(s?"text-slate-900":"text-slate-300"),children:e.title})]}),t<v.length-1&&g.jsx("div",{className:"h-px flex-1 rounded-full "+(r?"bg-emerald-500":"bg-slate-100")})]},e.id)})})})}),g.jsxs("div",{className:"flex-1 p-4 sm:p-8 w-full max-w-5xl mx-auto pb-32",children:[0===u&&g.jsx("div",{className:"space-y-4 animate-fadeIn",children:g.jsxs("div",{className:"bg-white p-6 sm:p-10 rounded-[2rem] border border-slate-100 shadow-sm",children:[g.jsx("h2",{className:"text-xl sm:text-2xl font-black text-slate-800 mb-8 uppercase tracking-tight",children:"Inspection Details"}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8",children:[g.jsx(Aa,{label:"Truck Registration *",value:c.truckNo,onChange:e=>F("truckNo",e),options:r.trucks,isRegNo:!0,error:m.truckNo}),g.jsx(Aa,{label:"Trailer ID *",value:c.trailerNo,onChange:e=>F("trailerNo",e),options:r.trailers,isRegNo:!0,error:m.trailerNo}),g.jsx(za,{label:"Job Card (if any)",value:c.jobCard||"",onChange:e=>F("jobCard",e),error:m.jobCard}),g.jsx(Aa,{label:"Inspector",value:c.inspectedBy,onChange:e=>F("inspectedBy",e),options:r.inspectors,readOnly:!0}),g.jsx(Aa,{label:"Driver Name *",value:c.driverName,onChange:e=>F("driverName",e),options:r.drivers,isTitleCase:!0,error:m.driverName}),g.jsx(Aa,{label:"Location *",value:c.location,onChange:e=>F("location",e),options:r.locations,isTitleCase:!0,error:m.location}),g.jsx(za,{label:"Odometer Reading (KM) *",type:"number",value:c.odometer,onChange:e=>F("odometer",e),error:m.odometer})]})]})}),1===u&&g.jsx("div",{className:"space-y-4 animate-fadeIn",children:g.jsxs("div",{className:"bg-white p-6 sm:p-10 rounded-[2rem] border border-slate-100 shadow-sm",children:[g.jsx("h2",{className:"text-xl sm:text-2xl font-black text-slate-800 mb-8 uppercase tracking-tight",children:"Vehicle Photos"}),g.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[g.jsx(Wa,{label:"Front View",existingImage:c.photoFront,onCapture:e=>F("photoFront",e)}),g.jsx(Wa,{label:"Left Side",existingImage:c.photoLS,onCapture:e=>F("photoLS",e)}),g.jsx(Wa,{label:"Right Side",existingImage:c.photoRS,onCapture:e=>F("photoRS",e)}),g.jsx(Wa,{label:"Rear View",existingImage:c.photoBack,onCapture:e=>F("photoBack",e)})]})]})}),u>=2&&u<=4&&g.jsx("div",{className:"space-y-6 animate-fadeIn",children:Array.from(new Set(W(u).map(e=>e.category))).map(e=>g.jsxs("div",{className:"bg-white rounded-[2rem] border border-slate-100 shadow-sm overflow-hidden",children:[g.jsx("div",{className:"bg-slate-50/50 px-6 py-4 border-b border-slate-100 flex justify-between items-center",children:g.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]",children:e})}),g.jsx("div",{className:"divide-y divide-slate-50",children:W(u).filter(t=>t.category===e).map(e=>g.jsxs("div",{className:"p-6 sm:p-8 transition-colors "+(m[e.id]?"bg-rose-50/30":""),children:[g.jsx("p",{className:"font-bold text-xs sm:text-sm text-slate-700 uppercase tracking-tight mb-5 leading-snug",children:e.label}),g.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-4 max-w-2xl",children:[g.jsx($a,{label:"Good",status:x.GOOD,current:c[e.id],onClick:()=>F(e.id,x.GOOD),colorClass:"green"}),g.jsx($a,{label:"Fault",status:x.BAD,current:c[e.id],onClick:()=>F(e.id,x.BAD),colorClass:"red"}),g.jsx($a,{label:"Review",status:x.ATTENTION,current:c[e.id],onClick:()=>F(e.id,x.ATTENTION),colorClass:"yellow"}),g.jsx($a,{label:"N/A",status:x.NIL,current:c[e.id],onClick:()=>F(e.id,x.NIL),colorClass:"gray"})]})]},e.id))})]},e))}),5===u&&g.jsx("div",{className:"space-y-4 animate-fadeIn",children:g.jsxs("div",{className:"bg-white p-6 sm:p-10 rounded-[2rem] border border-slate-100 shadow-sm",children:[g.jsx("h2",{className:"text-xl sm:text-2xl font-black text-slate-800 mb-8 uppercase tracking-tight",children:"Review & Sign"}),g.jsxs("div",{className:"space-y-8",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-[10px] font-black uppercase text-slate-400 mb-3 tracking-widest",children:"Comments *"}),g.jsx("textarea",{className:"w-full p-6 bg-slate-50 border border-slate-100 rounded-2xl h-40 outline-none font-medium text-sm focus:ring-4 focus:ring-indigo-50/50 resize-none transition-all",value:c.remarks,onChange:e=>F("remarks",e.target.value)})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-[10px] font-black uppercase text-slate-400 mb-4 tracking-widest",children:"Overall Condition Rating *"}),g.jsx("div",{className:"flex gap-2 sm:gap-4",children:[1,2,3,4,5].map(e=>g.jsx("button",{onClick:()=>F("rate",e),className:"flex-1 h-12 sm:h-14 rounded-xl font-black text-lg transition-all "+(c.rate===e?"bg-slate-900 text-white shadow-lg scale-105":"bg-slate-50 text-slate-400 hover:bg-slate-100"),children:e},e))})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 pt-6 border-t border-slate-50",children:[g.jsx(Ja,{label:"Inspector Signature",existingSignature:c.inspectorSignature,onSave:e=>F("inspectorSignature",e)}),g.jsx(Ja,{label:"Driver Signature",existingSignature:c.driverSignature,onSave:e=>F("driverSignature",e)})]})]})]})}),6===u&&g.jsxs("div",{className:"animate-fadeIn py-10 text-center",children:[g.jsx("div",{className:"w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-8 border border-emerald-100",children:g.jsx("svg",{className:"w-10 h-10 text-emerald-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),g.jsx("button",{onClick:()=>{J(u)&&o(c)},disabled:"idle"!==l,className:"w-full sm:w-auto px-12 py-5 bg-slate-900 hover:bg-black text-white rounded-2xl font-black text-sm shadow-2xl transition-all flex items-center justify-center gap-3 active:scale-95 border-t border-white/10 uppercase tracking-[0.2em]",children:"submitting"===l?"Uploading...":"Submit"})]})]}),g.jsx("footer",{className:"bg-white/90 backdrop-blur-md border-t border-slate-100 p-4 sm:p-6 fixed bottom-0 left-0 right-0 z-40 pb-[max(1rem,env(safe-area-inset-bottom))]",children:g.jsxs("div",{className:"max-w-5xl mx-auto flex gap-3 sm:gap-6",children:[g.jsx("button",{onClick:()=>{0===u?a():(window.scrollTo({top:0,behavior:"smooth"}),p(e=>Math.max(e-1,0)))},className:"flex-1 sm:flex-none px-6 sm:px-10 py-3.5 rounded-xl sm:rounded-2xl border border-slate-200 font-black text-slate-400 hover:text-slate-800 transition-all text-[10px] uppercase tracking-widest active:scale-95",children:0===u?"Cancel":"Previous"}),g.jsxs("div",{className:"flex gap-3 flex-[2] sm:flex-1 justify-end",children:[g.jsx("button",{onClick:()=>{i(c),b(!0),setTimeout(()=>b(!1),2e3)},className:"flex-1 sm:flex-none px-4 sm:px-8 py-3.5 rounded-xl sm:rounded-2xl bg-indigo-50 text-indigo-600 font-black hover:bg-indigo-100 transition-all flex items-center justify-center gap-2 text-[10px] uppercase tracking-widest active:scale-95",children:f?"Saved":"Save Draft"}),u<v.length-1&&g.jsxs("button",{onClick:()=>{J(u)&&(window.scrollTo({top:0,behavior:"smooth"}),p(e=>Math.min(e+1,v.length-1)))},className:"flex-[1.5] sm:flex-none px-8 sm:px-12 py-3.5 rounded-xl sm:rounded-2xl bg-slate-900 text-white font-black hover:bg-black shadow-lg transition-all flex items-center justify-center gap-3 text-[10px] uppercase tracking-[0.2em] active:scale-95 border-t border-white/10",children:["Continue",g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"3",children:g.jsx("path",{d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})]})]})})]})},Ka=({tickets:t,isLoading:n,onRefresh:s,onSelect:r,filterStatus:i})=>{const o=e.useMemo(()=>"OPEN"===i?t.filter(e=>"Open"===e.status||"In Progress"===e.status):"CLOSED"===i?t.filter(e=>"Resolved"===e.status||"Closed"===e.status):t,[t,i]);return g.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden min-h-[300px]",children:[g.jsxs("div",{className:"p-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center",children:[g.jsxs("span",{className:"font-semibold text-sm text-slate-700",children:["Recent Requests (",o.length,")"]}),g.jsx("button",{onClick:s,className:"text-[10px] text-indigo-600 font-bold uppercase tracking-wide bg-white px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors",children:"Refresh"})]}),g.jsx("div",{className:"divide-y divide-slate-100",children:n?g.jsx("div",{className:"p-12 text-center text-slate-400 text-xs",children:"Checking for updates..."}):0===o.length?g.jsx("div",{className:"p-16 text-center text-slate-400 italic text-xs",children:"No active support requests."}):o.map(e=>g.jsxs("div",{onClick:()=>r(e),className:"p-4 sm:p-5 hover:bg-slate-50 cursor-pointer transition-colors group",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start mb-2 gap-2",children:[g.jsxs("span",{className:"font-semibold text-sm text-slate-800 group-hover:text-indigo-600 line-clamp-1",children:["#",e.ticketId,": ",e.subject]}),g.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider px-2 py-0.5 rounded border self-start "+("Resolved"===e.status?"bg-emerald-50 text-emerald-600 border-emerald-100":"bg-indigo-50 text-indigo-600 border-indigo-100"),children:e.status})]}),g.jsx("p",{className:"text-xs text-slate-500 line-clamp-2 mb-3 leading-relaxed",children:e.description}),g.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[g.jsx("span",{className:"text-[10px] text-slate-400 whitespace-nowrap",children:new Date(e.timestamp).toLocaleDateString()}),g.jsx("span",{className:"text-[10px] text-slate-300",children:"•"}),g.jsx("span",{className:"text-[10px] text-slate-400 truncate",children:e.user})]})]},e.ticketId))})]})},Xa=({ticket:t,currentUser:n,isAdmin:s,onClose:r,onReply:i,isSendingReply:o,isLocked:a})=>{const[l,c]=e.useState("");return g.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden flex flex-col h-[500px] sm:h-[600px] animate-fadeIn",children:[g.jsxs("div",{className:"p-4 bg-slate-50 border-b flex justify-between items-center",children:[g.jsxs("button",{onClick:r,className:"text-xs font-medium text-slate-600 hover:text-slate-900 flex items-center gap-1",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Back"]}),g.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[g.jsx("span",{className:"font-semibold text-slate-800 text-sm truncate max-w-[120px] sm:max-w-[200px]",children:t.subject}),a&&g.jsx("span",{className:"text-[9px] font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded border border-amber-200 shrink-0",children:"View Only"})]})]}),g.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50/20",children:[g.jsxs("div",{className:"p-4 rounded-xl bg-white border border-slate-100 shadow-sm",children:[g.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wide mb-1",children:"Description"}),g.jsx("p",{className:"text-sm text-slate-700 leading-relaxed break-words",children:t.description})]}),t.comments?.map((e,t)=>{const s=e.role?.toLowerCase()||"",r="admin"===s||"superadmin"===s?"Support":e.user;return g.jsxs("div",{className:`p-3 rounded-xl border ${e.user===n?.name?"bg-indigo-600 text-white ml-auto border-indigo-500":"bg-white text-slate-700 mr-auto border-slate-100"} max-w-[90%] sm:max-w-[85%]`,children:[g.jsxs("div",{className:"flex justify-between items-center mb-1 gap-4",children:[g.jsx("p",{className:"text-[10px] font-semibold opacity-70 truncate",children:r}),g.jsx("p",{className:"text-[9px] opacity-50 whitespace-nowrap",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),g.jsx("p",{className:"text-sm break-words",children:e.message})]},t)})]}),!a&&g.jsxs("div",{className:"p-3 border-t bg-white flex gap-2 items-center",children:[g.jsx("input",{className:"flex-1 border border-slate-200 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-100 outline-none transition-all",placeholder:"Type a message...",value:l,onChange:e=>c(e.target.value)}),g.jsx("button",{onClick:()=>{l.trim()&&!a&&(i(l),c(""))},disabled:o||!l.trim(),className:"px-5 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl text-sm transition-all disabled:bg-slate-300",children:o?"...":"Send"})]})]})},Qa=({appScriptUrl:t,currentUser:n,showToast:s,settings:r,prefillData:i,onPrefillConsumed:o})=>{const a=window.isSubscriptionLocked||!1,[l,c]=e.useState("create"),[d,u]=e.useState([]),[p,m]=e.useState(null),[h,f]=e.useState(!1),[x,b]=e.useState(!1),[v,y]=e.useState(!1),[w,N]=e.useState({subject:"",description:"",priority:"Medium"});e.useEffect(()=>{i&&(N({subject:i.subject,description:i.description,priority:"Medium"}),c("create"),o&&o())},[i]);const j=async()=>{if(t&&n){f(!0);try{const e=await fetch(t,{method:"POST",body:JSON.stringify({action:"get_tickets",email:n.username,role:n.role})}),s=await e.json();"success"===s.status&&u(s.tickets)}finally{f(!1)}}};e.useEffect(()=>{j()},[]);return g.jsxs("div",{className:"max-w-6xl mx-auto space-y-8 animate-fadeIn pb-20 px-2 sm:px-4",children:[g.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[g.jsxs("div",{children:[g.jsx("h2",{className:"text-2xl font-semibold text-slate-800 tracking-tight uppercase",children:"Support Center"}),g.jsx("p",{className:"text-xs text-slate-400 font-medium mt-1",children:"Get assistance or report issues"})]}),a&&g.jsx("span",{className:"px-4 py-1.5 bg-amber-50 text-amber-700 border border-amber-200 rounded-lg text-[10px] font-bold uppercase tracking-wide",children:"View-Only"})]}),g.jsxs("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit border border-slate-200",children:[g.jsx("button",{onClick:()=>!a&&c("create"),disabled:a,className:`px-5 py-2 rounded-lg text-xs font-semibold transition-all ${"create"===l?"bg-white text-indigo-600 shadow-sm":"text-slate-500"} ${a&&"opacity-30"}`,children:"New Ticket"}),g.jsx("button",{onClick:()=>c("list"),className:"px-5 py-2 rounded-lg text-xs font-semibold transition-all "+("list"===l?"bg-white text-indigo-600 shadow-sm":"text-slate-500"),children:"My History"})]}),g.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[g.jsx("div",{className:"lg:col-span-2",children:"create"===l?g.jsxs("div",{className:"bg-white p-6 sm:p-10 rounded-2xl border border-slate-200 shadow-sm animate-fadeIn",children:[g.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-6",children:"Submit a Request"}),g.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),a)s("System is in view-only mode.","error");else{b(!0);try{const e={action:"submit_support_ticket",type:"Issue",...w,user:n?.name,email:n?.username,role:n?.role},r=await fetch(t,{method:"POST",body:JSON.stringify(e)});"success"===(await r.json()).status&&(s("Request submitted successfully.","success"),N({subject:"",description:"",priority:"Medium"}),c("list"),j())}catch(r){s("Failed to send request.","error")}finally{b(!1)}}},className:"space-y-6",children:[g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wide ml-1",children:"Subject"}),g.jsx("input",{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-indigo-100 transition-all",placeholder:"e.g. Odometer sync issue",value:w.subject,onChange:e=>N({...w,subject:e.target.value}),required:!0})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wide ml-1",children:"Details"}),g.jsx("textarea",{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl text-sm h-32 outline-none focus:ring-2 focus:ring-indigo-100 transition-all resize-none",placeholder:"Describe your problem...",value:w.description,onChange:e=>N({...w,description:e.target.value}),required:!0})]}),g.jsx("button",{type:"submit",disabled:x,className:"w-full py-4 bg-slate-800 hover:bg-slate-900 text-white font-semibold rounded-xl transition-all shadow active:scale-[0.98] text-sm flex items-center justify-center gap-2",children:x?"Sending...":"Submit Request"})]})]}):p?g.jsx(Xa,{ticket:p,currentUser:n,isAdmin:"Admin"===n?.role||"SuperAdmin"===n?.role,onClose:()=>m(null),onReply:async e=>{if(p&&!a){y(!0);try{const r={user:n?.name,role:n?.role,message:e,timestamp:(new Date).toISOString()};await fetch(t,{method:"POST",body:JSON.stringify({action:"update_ticket",ticketId:p.ticketId,comment:r}),mode:"no-cors"});const i={...p,comments:[...p.comments,r]};m(i),u(e=>e.map(e=>e.ticketId===i.ticketId?i:e)),s("Reply sent.","success")}finally{y(!1)}}},isSendingReply:v,isLocked:a}):g.jsx(Ka,{tickets:d,isLoading:h,onRefresh:j,onSelect:m,isAdmin:"Admin"===n?.role||"SuperAdmin"===n?.role,filterStatus:"ALL"})}),g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm",children:[g.jsx("h3",{className:"text-sm font-semibold text-slate-800 uppercase tracking-tight mb-2",children:"Share Application"}),g.jsx("p",{className:"text-xs text-slate-500 leading-relaxed mb-4",children:"Share access links for the web portal and mobile application with your team."}),g.jsxs("button",{onClick:async()=>{if(!r)return;const e=r.companyName||"Fleet Portal",t=r.webAppUrl||window.location.href,n=r.mobileApkLink;let i=`${e} Access Links:\n\n💻 Web Portal: ${t}`;n&&(i+=`\n\n📱 Android App: ${n}`);const o={title:e,text:i,url:t};try{navigator.share?await navigator.share(o):(await navigator.clipboard.writeText(i),s("Links copied to clipboard.","info"))}catch(a){}},className:"w-full py-3.5 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-xl text-xs flex items-center justify-center gap-2 transition-all",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Copy Share Links"]})]}),g.jsxs("div",{className:"bg-slate-100 p-6 rounded-2xl border border-slate-200",children:[g.jsx("h4",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3",children:"Service Hours"}),g.jsxs("div",{className:"space-y-2 text-xs text-slate-600 font-medium",children:[g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"Mon - Fri"}),g.jsx("span",{children:"08:00 - 17:00"})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"Sat"}),g.jsx("span",{children:"09:00 - 13:00"})]})]})]})]})]})]})},Za=({label:e})=>g.jsxs("div",{className:"w-full flex items-center gap-4 sm:gap-6 mb-4 sm:mb-6 opacity-80 shrink-0",children:[g.jsx("span",{className:"text-[10px] sm:text-[11px] font-black text-slate-300 uppercase tracking-[0.4em] whitespace-nowrap",children:e}),g.jsx("div",{className:"h-px flex-1 bg-gradient-to-r from-slate-100 to-transparent"})]}),el=({appScriptUrl:t,settings:n,onSettingsUpdate:s,showToast:r,subscription:i,onRefreshSubscription:o,history:a=[]})=>{const[l,c]=e.useState("info"),[d,u]=e.useState(""),[p,m]=e.useState(!1),[h,f]=e.useState(n.maintenanceMode||!1),[x,b]=e.useState(n.maintenanceMessage||"System under scheduled maintenance."),[v,y]=e.useState(!1),[w,N]=e.useState(i?.plan||"Enterprise"),[j,S]=e.useState(i?.expiryDate||""),[E,C]=e.useState(!1),[_,k]=e.useState(!1),I=i?.daysRemaining??0,A=I<=0;return g.jsx("div",{className:"max-w-6xl mx-auto py-2 sm:py-6 flex flex-col items-center justify-center min-h-[calc(100vh-140px)] px-2 sm:px-4 animate-fadeIn font-sans overflow-hidden",children:g.jsxs("div",{className:"w-full max-w-5xl space-y-6 sm:space-y-10",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 px-2",children:[g.jsxs("div",{children:[g.jsx("h2",{className:"text-2xl sm:text-3xl font-normal text-slate-800 uppercase tracking-tight leading-none",children:"System Security"}),g.jsx("p",{className:"text-[9px] text-slate-400 font-normal uppercase tracking-[0.25em] mt-2",children:"Security Console & Management Hub"})]}),g.jsxs("div",{className:"hidden sm:flex items-center gap-3 px-5 py-2.5 bg-white border border-slate-100 rounded-2xl shadow-sm",children:[g.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"}),g.jsx("span",{className:"text-[9px] font-normal text-slate-500 uppercase tracking-widest",children:"Admin Mode"})]})]}),g.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[g.jsxs("div",{className:"flex flex-col",children:[g.jsx(Za,{label:"Global Alerts"}),g.jsxs("div",{className:"bg-white rounded-[1.5rem] sm:rounded-[2rem] shadow-sm border border-slate-100 p-5 sm:p-8 flex flex-col h-fit",children:[g.jsx("textarea",{className:"w-full p-4 bg-slate-50 border border-slate-100 rounded-xl h-24 sm:h-28 outline-none focus:ring-2 focus:ring-indigo-500/10 font-normal text-xs text-slate-600 transition-all resize-none mb-4",placeholder:"System-wide notification text...",value:d,onChange:e=>u(e.target.value)}),g.jsxs("div",{className:"flex gap-2",children:[g.jsxs("select",{value:l,onChange:e=>c(e.target.value),className:"px-3 py-2 bg-slate-50 border border-slate-100 rounded-xl text-[10px] font-normal uppercase tracking-widest text-slate-400 outline-none",children:[g.jsx("option",{value:"info",children:"Info"}),g.jsx("option",{value:"critical",children:"Critical"})]}),g.jsx("button",{onClick:async()=>{if(d.trim()){m(!0);try{await fetch(t,{method:"POST",body:JSON.stringify({action:"broadcast",type:l,message:d}),mode:"no-cors"}),r("Broadcast dispatched.","success"),u("")}catch(e){r("Broadcast failed.","error")}finally{m(!1)}}else r("Enter alert message.","error")},disabled:p,className:"flex-1 py-3 bg-slate-900 hover:bg-black text-white font-normal rounded-xl shadow-lg transition-all text-[10px] uppercase tracking-[0.2em] active:scale-95 disabled:opacity-50",children:p?"Sending":"Dispatch Alert"})]})]})]}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx(Za,{label:"System Access"}),g.jsxs("div",{className:"bg-white rounded-[1.5rem] sm:rounded-[2rem] shadow-sm border border-slate-100 p-5 sm:p-8 flex flex-col h-fit",children:[g.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-xl mb-4 border border-slate-50",children:[g.jsxs("div",{children:[g.jsx("span",{className:"text-xs font-normal text-slate-800 uppercase tracking-tight",children:"Maintenance Mode"}),g.jsx("p",{className:"text-[8px] text-slate-400 font-normal uppercase tracking-widest mt-0.5",children:"Restrict system state"})]}),g.jsx("button",{onClick:()=>f(!h),className:"relative inline-flex h-5 w-10 items-center rounded-full transition-all duration-300 "+(h?"bg-rose-500 shadow-[0_0_8px_rgba(244,63,94,0.3)]":"bg-slate-200"),children:g.jsx("span",{className:"inline-block h-3.5 w-3.5 transform rounded-full bg-white transition-transform duration-300 "+(h?"translate-x-6":"translate-x-0.5")})})]}),g.jsx("input",{type:"text",value:x,onChange:e=>b(e.target.value),placeholder:"Display message...",className:"w-full p-3 bg-slate-50 border border-slate-100 rounded-xl font-normal text-slate-700 outline-none text-xs mb-4"}),g.jsx("button",{onClick:async()=>{y(!0);try{await fetch(t,{method:"POST",body:JSON.stringify({action:"update_settings",...n,maintenanceMode:h,maintenanceMessage:x}),mode:"no-cors"}),s({maintenanceMode:h,maintenanceMessage:x}),r(h?"System Lock Active":"Access Restored","success")}catch(e){r("Sync failed.","error")}finally{y(!1)}},disabled:v,className:"w-full py-3 bg-slate-900 hover:bg-black text-white font-normal rounded-xl shadow-lg transition-all text-[10px] uppercase tracking-[0.2em] active:scale-95",children:"Update Status"})]})]})]}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx(Za,{label:"License Status"}),g.jsxs("div",{className:"bg-white rounded-[1.5rem] sm:rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden",children:[g.jsxs("div",{className:"px-6 py-4 border-b border-slate-50 bg-slate-50/50 flex justify-between items-center",children:[g.jsx("div",{className:"flex items-center gap-3",children:g.jsxs("span",{className:"text-[9px] font-normal uppercase tracking-widest px-3 py-1 rounded-full border "+(A?"bg-rose-50 text-rose-600 border-rose-100":"bg-emerald-50 text-emerald-600 border-emerald-100"),children:[I," Days Left"]})}),g.jsxs("span",{className:"text-[9px] font-normal text-slate-400 uppercase tracking-widest",children:["Plan: ",i?.plan||"Enterprise"]})]}),g.jsxs("div",{className:"p-6 sm:p-8 space-y-6",children:[g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[g.jsxs("div",{className:"space-y-1.5",children:[g.jsx("label",{className:"text-[8px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Plan Tier"}),g.jsxs("select",{value:w,onChange:e=>N(e.target.value),className:"w-full p-3 bg-slate-50 border border-slate-100 rounded-xl text-xs font-normal text-slate-700 outline-none",children:[g.jsx("option",{value:"Standard",children:"Standard Fleet"}),g.jsx("option",{value:"Enterprise",children:"Enterprise Pro"}),g.jsx("option",{value:"Unlimited",children:"Corporate Max"})]})]}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsx("label",{className:"text-[8px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Renewal Expiry"}),g.jsx("input",{type:"date",value:j,onChange:e=>S(e.target.value),className:"w-full p-3 bg-slate-50 border border-slate-100 rounded-xl text-xs font-normal text-slate-700 outline-none"})]}),g.jsx("div",{className:"flex items-end",children:g.jsx("button",{onClick:async()=>{C(!0);try{await fetch(t,{method:"POST",body:JSON.stringify({action:"update_subscription",plan:w,expiryDate:j,status:"Active"}),mode:"no-cors"}),r("License synced.","success"),o&&o()}catch(e){r("Sync failed.","error")}finally{C(!1)}},disabled:E,className:"w-full py-3 bg-slate-900 hover:bg-black text-white font-normal rounded-xl shadow-lg transition-all text-[10px] uppercase tracking-[0.2em] active:scale-95 disabled:opacity-50 h-[46px]",children:"Sync License"})})]}),g.jsxs("div",{className:"border-t border-slate-50 pt-4",children:[g.jsxs("button",{onClick:()=>k(!_),className:"flex items-center gap-2 text-[9px] font-normal text-slate-400 uppercase tracking-[0.2em] hover:text-indigo-600 transition-colors",children:[g.jsx("svg",{className:"w-3 h-3 transition-transform "+(_?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M19 9l-7 7-7-7"})}),"Registry Audit Trail"]}),_&&g.jsx("div",{className:"mt-4 bg-slate-50/50 rounded-xl overflow-hidden border border-slate-100 max-h-32 overflow-y-auto scrollbar-hide animate-fadeIn",children:g.jsxs("table",{className:"w-full text-left",children:[g.jsx("thead",{className:"bg-slate-50 text-[8px] font-black text-slate-400 uppercase tracking-widest border-b border-slate-100",children:g.jsxs("tr",{children:[g.jsx("th",{className:"px-4 py-2",children:"Sync Date"}),g.jsx("th",{className:"px-4 py-2",children:"Tier"}),g.jsx("th",{className:"px-4 py-2 text-right",children:"Validity"})]})}),g.jsx("tbody",{className:"divide-y divide-slate-50",children:0===a.length?g.jsx("tr",{children:g.jsx("td",{colSpan:3,className:"px-4 py-4 text-[9px] text-slate-400 text-center italic",children:"No prior renewal records detected."})}):a.map((e,t)=>g.jsxs("tr",{className:"text-[9px] text-slate-600",children:[g.jsx("td",{className:"px-4 py-2 font-mono uppercase opacity-60",children:e.timestamp?.split("T")[0]||"N/A"}),g.jsx("td",{className:"px-4 py-2 font-normal uppercase tracking-tight",children:e.plan||"Standard"}),g.jsx("td",{className:"px-4 py-2 text-right font-medium text-slate-400",children:e.expiryDate||"N/A"})]},t))})]})})]})]})]})]}),g.jsx("div",{className:"text-center py-2 shrink-0",children:g.jsx("p",{className:"text-[9px] font-normal text-slate-300 uppercase tracking-[0.4em]",children:"Proprietary Modular Framework v2.0"})})]})})},tl=({appScriptUrl:t,currentUser:n,showToast:s,onRequestNew:r})=>{const[i,o]=e.useState([]),[a,l]=e.useState(!1),c=window.isSubscriptionLocked||!1;e.useEffect(()=>{d();const e=setInterval(d,3e5);return()=>clearInterval(e)},[n?.username,t]);const d=async()=>{if(t&&n){0===i.length&&l(!0);try{const e=await fetch(`${t}?t=${(new Date).getTime()}`),s=(await e.json()).Inspection_Requests;if(s&&Array.isArray(s)&&s.length>1){const e=s.slice(1).map(e=>({id:e[0],requester:e[1],truck:e[3],trailer:e[4],type:e[5],reason:e[6],priority:e[7],assignedTo:e[8],status:e[9]||"Pending",timestamp:e[10]})).filter(e=>{const t=n.role.toLowerCase();if("admin"===t||"superadmin"===t)return!0;const s=String(n.name||"").toLowerCase(),r=String(e.requester).toLowerCase()===s,i=String(e.assignedTo).toLowerCase()===s,o="unassigned"===String(e.assignedTo).toLowerCase();return"inspector"===t&&(i||o)||r}).sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime());o(e)}else o([])}catch(e){0===i.length&&s("Failed to load requests.","error")}finally{l(!1)}}},u=i.filter(e=>"Pending"===e.status).length,p=i.filter(e=>"Completed"===e.status).length,m=i.length>0?Math.round(p/i.length*100):0;return g.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-fadeIn px-2 sm:px-4 pb-12",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 px-2",children:[g.jsxs("div",{children:[g.jsx("h2",{className:"text-2xl font-semibold text-slate-800 tracking-tight uppercase",children:"Inspection Requests"}),g.jsx("p",{className:"text-slate-400 font-medium mt-1 uppercase tracking-widest text-[9px]",children:"Live Pipeline"})]}),r&&g.jsxs("button",{onClick:r,disabled:c,className:`w-full sm:w-auto px-6 py-3 text-white font-semibold rounded-xl shadow-md transition-all active:scale-95 flex items-center justify-center gap-2.5 text-[10px] uppercase tracking-widest\n                            ${c?"bg-slate-200 cursor-not-allowed text-slate-400 shadow-none":"bg-slate-900 hover:bg-black border-t border-white/10"}\n                        `,children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M12 4v16m8-8H4"})}),"New Request"]})]}),g.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 sm:gap-6",children:[g.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-slate-100 shadow-sm",children:[g.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"Pending"}),g.jsx("h3",{className:"text-2xl font-semibold text-amber-500",children:u})]}),g.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-slate-100 shadow-sm",children:[g.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"Completed"}),g.jsx("h3",{className:"text-2xl font-semibold text-emerald-600",children:p})]}),g.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-slate-100 shadow-sm col-span-2 md:col-span-1",children:[g.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"Overall Progress"}),g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsxs("h3",{className:"text-2xl font-semibold text-slate-700",children:[m,"%"]}),g.jsx("div",{className:"flex-1 h-1.5 bg-slate-50 rounded-full overflow-hidden border border-slate-100",children:g.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-1000",style:{width:`${m}%`}})})]})]})]}),g.jsxs("div",{className:"bg-white rounded-[2rem] border border-slate-100 shadow-sm overflow-hidden flex flex-col",children:[g.jsx("div",{className:"px-6 py-4 bg-slate-50/50 border-b border-slate-100",children:g.jsx("h3",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em]",children:"Active Queue"})}),g.jsx("div",{className:"divide-y divide-slate-50",children:a?g.jsxs("div",{className:"py-20 text-center",children:[g.jsx("div",{className:"w-8 h-8 border-3 border-slate-100 border-t-indigo-600 rounded-full animate-spin mx-auto mb-4"}),g.jsx("p",{className:"text-[10px] font-semibold text-slate-300 uppercase tracking-widest",children:"Updating data..."})]}):0===i.length?g.jsx("div",{className:"py-20 text-center",children:g.jsx("p",{className:"text-[11px] font-medium text-slate-300 uppercase tracking-widest",children:"No active requests found"})}):i.map(e=>g.jsxs("div",{className:"p-5 sm:px-8 sm:py-6 hover:bg-slate-50/30 transition-colors flex flex-col sm:flex-row sm:items-center gap-4 sm:gap-12",children:[g.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[g.jsx("div",{className:"w-2 h-2 rounded-full shrink-0 "+("Completed"===e.status?"bg-emerald-500":"bg-amber-400 animate-pulse")}),g.jsxs("div",{className:"min-w-0",children:[g.jsx("div",{className:"text-sm font-semibold text-slate-800 uppercase tracking-tight truncate",children:e.truck}),g.jsx("div",{className:"text-[10px] text-slate-400 font-medium uppercase tracking-wider",children:e.trailer||"Stand-alone Unit"})]})]}),g.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:items-center gap-4 sm:gap-12 shrink-0",children:[g.jsxs("div",{className:"min-w-[110px]",children:[g.jsx("div",{className:"text-[11px] font-semibold text-slate-600 uppercase tracking-tight",children:e.type}),g.jsxs("div",{className:"text-[9px] font-bold uppercase tracking-widest "+("Critical"===e.priority||"Urgent"===e.priority?"text-rose-500":"text-slate-400"),children:[e.priority," Priority"]})]}),g.jsxs("div",{className:"min-w-[130px] text-right sm:text-left",children:[g.jsx("div",{className:"text-[11px] font-semibold text-slate-600 truncate max-w-[120px]",children:e.assignedTo&&"Unassigned"!==e.assignedTo?e.assignedTo:"Unassigned"}),g.jsx("div",{className:"text-[9px] text-slate-400 font-bold uppercase tracking-widest",children:"Personnel"})]})]}),g.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-8 pt-3 sm:pt-0 border-t sm:border-t-0 border-slate-50",children:[g.jsxs("div",{className:"text-left sm:text-right shrink-0",children:[g.jsx("div",{className:"text-[11px] font-semibold text-slate-500",children:new Date(e.timestamp).toLocaleDateString()}),g.jsx("div",{className:"text-[9px] text-slate-300 font-bold uppercase tracking-widest",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),g.jsx("div",{className:`px-4 py-1.5 rounded-lg text-[9px] font-bold uppercase tracking-widest border shrink-0\n                                    ${"Completed"===e.status?"bg-emerald-50 text-emerald-600 border-emerald-100":"bg-slate-50 text-slate-500 border-slate-200"}\n                                `,children:"Completed"===e.status?"Completed":"Pending"})]})]},e.id))})]})]})},nl=({historyList:t,isLoading:n})=>{const[s,r]=e.useState(!1),[i,o]=e.useState(null),a=e.useMemo(()=>{if(!t.length)return null;const e=t.length,n=t.filter(e=>Number(e.rate)<=2).length,s=t.filter(e=>3===Number(e.rate)).length,r=t.filter(e=>Number(e.rate)>=4).length,i=r/e*100,o=i.toFixed(1),a={},l={},c={"Mechanical & Braking":0,"Tyres & Wheels":0,"Documentation & PPE":0,"Electrical & Lights":0,"Visibility & Body":0,"Fluid Leaks & Environmental":0};t.forEach(e=>{const t=Number(e.rate);if(t<=3&&(a[e.truckNo]=(a[e.truckNo]||0)+1),Object.entries(e).forEach(([e,t])=>{if("Bad"===t||"Needs Attention"===t){const t=e.toLowerCase();t.includes("brake")||t.includes("mech")||t.includes("fifth")||t.includes("landing")?c["Mechanical & Braking"]++:t.includes("tyre")||t.includes("wheel")||t.includes("nut")?c["Tyres & Wheels"]++:t.includes("road")||t.includes("doc")||t.includes("suit")||t.includes("gear")||t.includes("ppe")||t.includes("manual")?c["Documentation & PPE"]++:t.includes("light")||t.includes("lamp")||t.includes("indica")||t.includes("horn")||t.includes("elec")||t.includes("ignit")?c["Electrical & Lights"]++:t.includes("wind")||t.includes("mirror")||t.includes("screen")||t.includes("cab")||t.includes("body")?c["Visibility & Body"]++:(t.includes("leak")||t.includes("spill")||t.includes("fluid")||t.includes("oil"))&&c["Fluid Leaks & Environmental"]++}}),e.driverName){const n=5===t?10:4===t?5:3===t?-5:-20;l[e.driverName]=(l[e.driverName]||0)+n}});const d=Object.values(c).reduce((e,t)=>e+t,0);return{total:e,criticalCount:n,warningCount:s,goodCount:r,passRate:o,passRateNum:i,sortedRisks:Object.entries(c).map(([e,t])=>({label:e,count:t,pct:d>0?t/d*100:0})).sort((e,t)=>t.count-e.count),leaderboard:Object.entries(l).sort(([,e],[,t])=>t-e).slice(0,3),conditionDistribution:[{label:"Exemplary (5/5)",count:t.filter(e=>5===Number(e.rate)).length,color:"bg-emerald-600"},{label:"Good (4/5)",count:t.filter(e=>4===Number(e.rate)).length,color:"bg-emerald-400"},{label:"Serviceable (3/5)",count:s,color:"bg-amber-400"},{label:"Immediate Action (1-2/5)",count:n,color:"bg-rose-500"}],totalFaults:d}},[t]);return n?g.jsxs("div",{className:"flex flex-col items-center justify-center py-24 gap-4",children:[g.jsx("div",{className:"w-12 h-12 border-4 border-slate-100 border-t-indigo-600 rounded-full animate-spin"}),g.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Compiling Fleet Intelligence..."})]}):a?g.jsxs("div",{className:"max-w-6xl mx-auto space-y-10 animate-fadeIn font-sans pb-24 px-4 md:px-0",children:[g.jsxs("div",{className:"flex justify-between items-end px-2",children:[g.jsxs("div",{children:[g.jsx("h2",{className:"text-3xl font-black text-slate-900 uppercase tracking-tight leading-none",children:"Fleet Insights"}),g.jsx("p",{className:"text-slate-400 text-[10px] font-bold uppercase tracking-[0.3em] mt-3",children:"Safety & Risk Intelligence"})]}),g.jsx("div",{className:"text-right hidden sm:block",children:g.jsx("span",{className:"text-[10px] font-black text-slate-300 uppercase tracking-widest",children:"Analytics Engine v3.0"})})]}),g.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6",children:[g.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-100 shadow-sm",children:[g.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4",children:"Total Audits"}),g.jsx("h3",{className:"text-4xl font-black text-slate-900",children:a.total})]}),g.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-100 shadow-sm",children:[g.jsx("p",{className:"text-[10px] font-black text-emerald-500 uppercase tracking-widest mb-4",children:"Pass Rate"}),g.jsxs("h3",{className:"text-4xl font-black text-emerald-600",children:[a.passRate,"%"]})]}),g.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-100 shadow-sm",children:[g.jsx("p",{className:"text-[10px] font-black text-amber-500 uppercase tracking-widest mb-4",children:"Warnings"}),g.jsx("h3",{className:"text-4xl font-black text-amber-600",children:a.warningCount})]}),g.jsxs("div",{className:"bg-rose-50 p-6 rounded-3xl border border-rose-100 shadow-sm",children:[g.jsx("p",{className:"text-[10px] font-black text-rose-500 uppercase tracking-widest mb-4",children:"Grounded"}),g.jsx("h3",{className:"text-4xl font-black text-rose-600",children:a.criticalCount})]})]}),g.jsxs("div",{className:"bg-gradient-to-br from-indigo-900 via-slate-900 to-black p-10 rounded-[2.5rem] text-white shadow-2xl relative overflow-hidden",children:[g.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-indigo-500/10 rounded-full -mr-32 -mt-32 blur-3xl"}),g.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-center justify-between gap-12",children:[g.jsxs("div",{className:"max-w-md text-center md:text-left",children:[g.jsx("h4",{className:"text-sm font-black text-indigo-300 uppercase tracking-[0.2em] mb-4",children:"Safety Excellence Leaderboard"}),g.jsx("p",{className:"text-slate-400 text-sm font-medium leading-relaxed",children:"Recognizing outstanding safety standards. Points are aggregated from deterministic vehicle health scores."})]}),g.jsxs("div",{className:"flex items-end gap-2 sm:gap-6 pt-10",children:[a.leaderboard[1]&&g.jsxs("div",{className:"flex flex-col items-center group",children:[g.jsx("div",{className:"w-12 h-12 bg-slate-400/20 rounded-full border border-slate-400/30 flex items-center justify-center font-black text-slate-300 mb-2 group-hover:scale-110 transition-transform",children:"2"}),g.jsxs("div",{className:"w-20 sm:w-28 h-20 sm:h-24 bg-gradient-to-t from-slate-400/20 to-slate-400/40 rounded-t-2xl border-x border-t border-slate-400/20 p-4 text-center",children:[g.jsx("p",{className:"text-[8px] font-black text-slate-400 uppercase truncate",children:a.leaderboard[1][0]}),g.jsxs("p",{className:"text-xs font-black text-white mt-1",children:[a.leaderboard[1][1]," pts"]})]})]}),a.leaderboard[0]&&g.jsxs("div",{className:"flex flex-col items-center group",children:[g.jsx("div",{className:"w-16 h-16 bg-amber-500/20 rounded-full border border-amber-500/40 flex items-center justify-center font-black text-amber-400 mb-2 shadow-[0_0_20px_rgba(245,158,11,0.2)] group-hover:scale-110 transition-transform",children:"1"}),g.jsxs("div",{className:"w-24 sm:w-32 h-28 sm:h-36 bg-gradient-to-t from-amber-500/20 to-amber-500/40 rounded-t-2xl border-x border-t border-amber-500/30 p-4 text-center",children:[g.jsx("p",{className:"text-[10px] font-black text-amber-300 uppercase truncate",children:a.leaderboard[0][0]}),g.jsxs("p",{className:"text-lg font-black text-white mt-1",children:[a.leaderboard[0][1]," pts"]}),g.jsx("div",{className:"mt-3 flex justify-center",children:g.jsx("svg",{className:"w-4 h-4 text-amber-400 animate-bounce",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})})})]})]}),a.leaderboard[2]&&g.jsxs("div",{className:"flex flex-col items-center group",children:[g.jsx("div",{className:"w-12 h-12 bg-orange-800/20 rounded-full border border-orange-800/30 flex items-center justify-center font-black text-orange-400 mb-2 group-hover:scale-110 transition-transform",children:"3"}),g.jsxs("div",{className:"w-20 sm:w-28 h-16 sm:h-20 bg-gradient-to-t from-orange-800/20 to-orange-800/40 rounded-t-2xl border-x border-t border-orange-800/20 p-4 text-center",children:[g.jsx("p",{className:"text-[8px] font-black text-orange-300 uppercase truncate",children:a.leaderboard[2][0]}),g.jsxs("p",{className:"text-xs font-black text-white mt-1",children:[a.leaderboard[2][1]," pts"]})]})]})]})]})]}),g.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[g.jsxs("div",{className:"bg-white p-6 sm:p-10 rounded-[2.5rem] border border-slate-100 shadow-sm",children:[g.jsxs("h4",{className:"text-sm font-black text-slate-800 uppercase tracking-widest mb-8 flex items-center gap-2",children:[g.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"}),"Asset Condition Profile"]}),g.jsx("div",{className:"space-y-6",children:a.conditionDistribution.map((e,t)=>{const n=(e.count/a.total*100).toFixed(0);return g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex justify-between text-[11px] font-bold text-slate-500 uppercase tracking-tighter",children:[g.jsx("span",{children:e.label}),g.jsxs("span",{className:"text-slate-900",children:[e.count," Units (",n,"%)"]})]}),g.jsx("div",{className:"h-3 bg-slate-50 rounded-lg overflow-hidden border border-slate-100",children:g.jsx("div",{className:`h-full ${e.color} transition-all duration-1000`,style:{width:`${n}%`}})})]},t)})})]}),g.jsxs("div",{className:"bg-slate-900 p-6 sm:p-10 rounded-[2.5rem] text-white shadow-2xl relative overflow-hidden flex flex-col",children:[g.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-indigo-500/10 rounded-full -mr-20 -mt-20 blur-3xl"}),g.jsxs("div",{className:"flex justify-between items-start mb-8 relative z-10",children:[g.jsx("h4",{className:"text-sm font-black text-indigo-400 uppercase tracking-widest",children:"Systemic Risk Profile"}),g.jsx("span",{className:"text-[8px] font-black bg-white/10 px-2 py-1 rounded text-slate-400 uppercase tracking-widest",children:"Fault Frequency"})]}),g.jsx("div",{className:"flex-1 space-y-6 relative z-10 overflow-y-auto pr-2 scrollbar-hide",children:a.totalFaults>0?a.sortedRisks.map((e,t)=>g.jsxs("div",{className:"space-y-2 group",children:[g.jsxs("div",{className:"flex justify-between items-end",children:[g.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-300 group-hover:text-white transition-colors",children:e.label}),g.jsxs("p",{className:"text-[10px] font-bold text-indigo-400",children:[e.count," Faults"]})]}),g.jsx("div",{className:"h-2 bg-white/5 rounded-full overflow-hidden border border-white/5",children:g.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-600 to-indigo-400 transition-all duration-1000 ease-out",style:{width:`${e.pct}%`}})})]},t)):g.jsx("div",{className:"h-40 flex items-center justify-center",children:g.jsx("p",{className:"text-slate-500 italic text-sm text-center px-6",children:"No systemic safety failures identified in active registry."})})}),g.jsx("p",{className:"text-[8px] text-slate-500 font-bold uppercase tracking-[0.2em] mt-6 border-t border-white/5 pt-4",children:"Root-Cause Intelligence Hub v3.0 (Pattern Logic)"})]})]}),g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:"bg-white p-8 sm:p-10 rounded-[2.5rem] border border-slate-100 shadow-sm flex flex-col md:flex-row items-center justify-between gap-6",children:[g.jsxs("div",{children:[g.jsx("h4",{className:"font-black text-lg uppercase tracking-tight leading-none",children:"Management Briefing"}),g.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:"Cross-Fleet Logic Aggregator"})]}),g.jsx("button",{onClick:()=>{a&&(r(!0),setTimeout(()=>{const e=a.passRateNum,t=a.sortedRisks[0];let n="";n=e>=90?"The fleet is operating at peak safety compliance.":e>=75?"Overall fleet health is stable, though minor maintenance trends are emerging.":"CRITICAL: The fleet safety rating has fallen below acceptable thresholds.";const s=t&&t.count>0?`The systemic analysis identifies '${t.label}' as the primary source of safety downgrades, accounting for ${t.pct.toFixed(0)}% of all recorded faults.`:"No significant systemic failure patterns detected.",i=`EXECUTIVE BRIEFING:\n${n} Out of ${a.total} audits, ${a.goodCount} were satisfactory.\n\nSYSTEMIC ANALYSIS:\n${s}\n\nSTRATEGY:\n1. Prioritize preventative maintenance on ${t?.label||"critical systems"}.\n2. Reinforce compliance standards for underperforming domains.\n3. Review driver pre-trip inspection diligence for high-frequency fault areas.`;o(i),r(!1)},600))},disabled:s,className:"w-full md:w-auto px-8 py-3 bg-slate-900 text-white rounded-xl font-black text-[11px] uppercase tracking-widest hover:bg-black transition-all shadow-lg active:scale-95 disabled:bg-slate-200",children:s?"Analyzing Patterns...":"Generate Executive Brief"})]}),i&&g.jsx("div",{className:"bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-2xl animate-fadeIn",children:g.jsx("div",{className:"prose prose-slate max-w-none",children:g.jsx("p",{className:"text-slate-700 font-medium whitespace-pre-wrap leading-relaxed text-sm",children:i})})})]})]}):g.jsx("div",{className:"py-24 text-center",children:g.jsx("p",{className:"text-slate-400 font-medium text-sm italic",children:"Insufficient data to generate analytics report."})})},sl=({historyList:t,isLoading:n,onClose:s})=>{const r=e.useMemo(()=>{if(!t.length)return null;const e={};t.forEach(t=>{(!e[t.truckNo]||new Date(t.timestamp)>new Date(e[t.truckNo].timestamp))&&(e[t.truckNo]=t)});const n=Object.values(e);return{grounded:n.filter(e=>Number(e.rate)<=2),warning:n.filter(e=>3===Number(e.rate)),active:n.filter(e=>Number(e.rate)>=4),recentLogs:[...t].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()).slice(0,12),totalAssets:n.length}},[t]);return n?g.jsxs("div",{className:"fixed inset-0 z-[200] bg-slate-950 flex flex-col items-center justify-center gap-6",children:[g.jsx("div",{className:"w-16 h-16 border-4 border-slate-900 border-t-emerald-500 rounded-full animate-spin"}),g.jsx("p",{className:"text-xs font-black text-slate-400 uppercase tracking-widest",children:"Waking Operations Monitor..."})]}):r?g.jsxs("div",{className:"fixed inset-0 z-[200] bg-slate-950 text-white overflow-hidden flex flex-col font-sans",children:[g.jsxs("div",{className:"h-20 border-b border-white/5 flex items-center justify-between px-10 shrink-0 bg-slate-900/50 backdrop-blur-md",children:[g.jsxs("div",{className:"flex items-center gap-6",children:[g.jsx("div",{className:"w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center font-black text-xl italic shadow-[0_0_20px_rgba(79,70,229,0.4)]",children:"S"}),g.jsxs("div",{children:[g.jsx("h2",{className:"text-xl font-black uppercase tracking-tighter leading-none",children:"Fleet Control Center"}),g.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-[0.3em] mt-1",children:"Live Telemetry Interface"})]})]}),g.jsxs("div",{className:"hidden lg:flex gap-10",children:[g.jsxs("div",{className:"text-center",children:[g.jsx("p",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest mb-1",children:"Fleet Deployment"}),g.jsx("p",{className:"text-2xl font-black tracking-tight",children:r.totalAssets})]}),g.jsxs("div",{className:"text-center",children:[g.jsx("p",{className:"text-[9px] font-bold text-emerald-500 uppercase tracking-widest mb-1",children:"Operational"}),g.jsx("p",{className:"text-2xl font-black text-emerald-400 tracking-tight",children:r.active.length})]}),g.jsxs("div",{className:"text-center",children:[g.jsx("p",{className:"text-[9px] font-bold text-rose-500 uppercase tracking-widest mb-1",children:"Grounded"}),g.jsx("p",{className:"text-2xl font-black text-rose-400 tracking-tight",children:r.grounded.length})]})]}),g.jsxs("button",{onClick:s,className:"px-6 py-2.5 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 group",children:[g.jsx("svg",{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M15 19l-7-7 7-7"})}),"Exit Monitor"]})]}),g.jsxs("div",{className:"flex-1 grid grid-cols-12 gap-px bg-white/5 overflow-hidden",children:[g.jsxs("div",{className:"col-span-12 md:col-span-3 bg-slate-950 flex flex-col",children:[g.jsx("div",{className:"p-6 border-b border-white/5",children:g.jsxs("h3",{className:"text-xs font-black text-rose-500 uppercase tracking-[0.2em] flex items-center gap-2",children:[g.jsx("span",{className:"w-2 h-2 rounded-full bg-rose-500 animate-ping"}),"Safety Exceptions"]})}),g.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide p-4 space-y-3",children:0===r.grounded.length?g.jsx("div",{className:"h-full flex items-center justify-center text-slate-600 text-[10px] font-bold uppercase tracking-widest italic text-center px-4",children:"No critical exceptions detected in active fleet."}):r.grounded.map((e,t)=>g.jsxs("div",{className:"bg-rose-500/10 border border-rose-500/20 rounded-2xl p-5 animate-pulse",children:[g.jsxs("div",{className:"flex justify-between items-start mb-3",children:[g.jsx("span",{className:"text-lg font-black text-white tracking-tighter uppercase",children:e.truckNo}),g.jsx("span",{className:"text-[10px] font-bold text-rose-400 bg-rose-950 px-2 py-0.5 rounded border border-rose-800",children:"GROUNDED"})]}),g.jsxs("p",{className:"text-[10px] text-rose-200/60 font-medium leading-relaxed italic line-clamp-2",children:['"',e.remarks,'"']}),g.jsxs("div",{className:"mt-4 pt-4 border-t border-rose-500/10 flex justify-between items-end",children:[g.jsx("span",{className:"text-[8px] font-bold text-rose-300 uppercase",children:e.inspectedBy}),g.jsx("span",{className:"text-[8px] font-black text-slate-500 uppercase",children:new Date(e.timestamp).toLocaleDateString()})]})]},t))})]}),g.jsxs("div",{className:"hidden md:flex md:col-span-5 bg-slate-900/20 flex-col border-x border-white/5",children:[g.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center",children:[g.jsx("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-[0.2em]",children:"Activity Stream"}),g.jsx("span",{className:"text-[8px] text-indigo-400 font-black animate-pulse uppercase",children:"Syncing Now"})]}),g.jsxs("div",{className:"flex-1 overflow-hidden p-6 relative",children:[g.jsx("div",{className:"space-y-4",children:r.recentLogs.map((e,t)=>g.jsxs("div",{className:"flex items-center gap-6 p-4 bg-white/5 rounded-2xl border border-white/5 hover:bg-white/10 transition-all duration-500 group",children:[g.jsx("div",{className:`w-3 h-3 rounded-full shrink-0 shadow-[0_0_10px_currentColor] ${Number(e.rate)>=4?"text-emerald-500":3===Number(e.rate)?"text-amber-500":"text-rose-500"} bg-current`}),g.jsxs("div",{className:"flex-1 flex items-center justify-between min-w-0",children:[g.jsxs("div",{children:[g.jsx("p",{className:"text-sm font-black uppercase tracking-tight group-hover:text-indigo-300 transition-colors",children:e.truckNo}),g.jsx("p",{className:"text-[9px] text-slate-500 font-bold uppercase tracking-widest",children:e.inspectedBy})]}),g.jsxs("div",{className:"text-right",children:[g.jsxs("p",{className:"text-xs font-black text-slate-300",children:[e.rate,"/5"]}),g.jsx("p",{className:"text-[8px] font-medium text-slate-600 uppercase mt-1",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})]},t))}),g.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent"})]})]}),g.jsxs("div",{className:"hidden lg:flex lg:col-span-4 bg-slate-950 flex flex-col",children:[g.jsx("div",{className:"p-6 border-b border-white/5",children:g.jsx("h3",{className:"text-xs font-black text-indigo-400 uppercase tracking-[0.2em]",children:"Asset Inventory Status"})}),g.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide p-6",children:g.jsx("div",{className:"grid grid-cols-2 gap-3",children:[...r.active,...r.warning,...r.grounded].map((e,t)=>g.jsxs("div",{className:"p-3 rounded-xl bg-white/5 border border-white/5 flex items-center justify-between",children:[g.jsxs("div",{className:"min-w-0",children:[g.jsx("p",{className:"text-[11px] font-black uppercase truncate",children:e.truckNo}),g.jsx("p",{className:"text-[8px] text-slate-500 font-bold uppercase mt-0.5",children:e.location})]}),g.jsx("div",{className:"w-1.5 h-1.5 rounded-full "+(Number(e.rate)>=4?"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]":3===Number(e.rate)?"bg-amber-500 shadow-[0_0_8px_rgba(245,158,11,0.4)]":"bg-rose-500 shadow-[0_0_8px_rgba(244,63,94,0.4)]")})]},t))})}),g.jsx("div",{className:"p-6 border-t border-white/5 bg-slate-900/30 text-center",children:g.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"© SCBC Operations Desk 2026"})})]})]})]}):null},rl=[{id:"1",title:"Tire Inspection SOP",category:"SOP",url:"#",description:"Standard protocol for multi-point tire wear and pressure auditing."},{id:"2",title:"Acid Handling Safety",category:"Safety",url:"#",description:"Emergency protocols for sulfuric and hydrochloric acid transport."},{id:"3",title:"Petroleum V2 Guidelines",category:"Manual",url:"#",description:"Detailed walkthrough of the updated Petroleum V2 checklist."},{id:"4",title:"Brake Testing Video",category:"Video",url:"#",description:"Instructional video on conducting static and dynamic brake tests."},{id:"5",title:"PPE Compliance 2026",category:"Safety",url:"#",description:"Latest requirements for protective gear in high-risk zones."},{id:"6",title:"Electronic Logging Manual",category:"Manual",url:"#",description:"Guide for using the electronic on-board recording system."}],il=()=>{const[t,n]=e.useState(""),[s,r]=e.useState("All"),i=rl.filter(e=>{const n=e.title.toLowerCase().includes(t.toLowerCase())||e.description.toLowerCase().includes(t.toLowerCase()),r="All"===s||e.category===s;return n&&r});return g.jsxs("div",{className:"max-w-6xl mx-auto space-y-10 animate-fadeIn font-sans pb-24",children:[g.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-6 px-2",children:[g.jsxs("div",{children:[g.jsx("h2",{className:"text-3xl font-black text-slate-900 uppercase tracking-tight leading-none",children:"Resource Vault"}),g.jsx("p",{className:"text-slate-400 text-[10px] font-bold uppercase tracking-[0.3em] mt-3",children:"SOPs, Manuals & Compliance Media"})]}),g.jsx("div",{className:"flex gap-2 w-full md:w-auto overflow-x-auto pb-1 scrollbar-hide",children:["All","SOP","Manual","Safety","Video"].map(e=>g.jsx("button",{onClick:()=>r(e),className:`px-6 py-2 rounded-full text-[10px] font-black uppercase tracking-widest transition-all whitespace-nowrap\n                                ${s===e?"bg-indigo-600 text-white shadow-lg shadow-indigo-100":"bg-slate-100 text-slate-500 hover:bg-slate-200"}\n                            `,children:e},e))})]}),g.jsxs("div",{className:"relative",children:[g.jsx("svg",{className:"w-5 h-5 absolute left-5 top-1/2 -translate-y-1/2 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),g.jsx("input",{type:"text",placeholder:"Search documentation library...",className:"w-full pl-14 pr-6 py-5 bg-white border border-slate-100 rounded-3xl shadow-sm outline-none focus:ring-4 focus:ring-indigo-50 transition-all font-medium text-slate-700",value:t,onChange:e=>n(e.target.value)})]}),g.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:i.map(e=>g.jsxs("div",{className:"bg-white rounded-[2rem] border border-slate-100 p-8 shadow-sm hover:shadow-xl transition-all group flex flex-col justify-between",children:[g.jsxs("div",{children:[g.jsxs("div",{className:"flex justify-between items-start mb-6",children:[g.jsx("div",{className:`px-4 py-1 rounded-full text-[9px] font-black uppercase tracking-[0.2em]\n                                    ${"SOP"===e.category?"bg-emerald-50 text-emerald-600":"Video"===e.category?"bg-rose-50 text-rose-600":"Manual"===e.category?"bg-blue-50 text-blue-600":"bg-amber-50 text-amber-600"}\n                                `,children:e.category}),g.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-50 flex items-center justify-center text-slate-300 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})})]}),g.jsx("h3",{className:"text-lg font-black text-slate-800 uppercase tracking-tight mb-2 group-hover:text-indigo-600 transition-colors",children:e.title}),g.jsx("p",{className:"text-slate-500 text-xs font-medium leading-relaxed",children:e.description})]}),g.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"mt-8 flex items-center justify-between px-6 py-3 bg-slate-50 hover:bg-indigo-600 hover:text-white rounded-xl transition-all text-[10px] font-black uppercase tracking-widest text-slate-500",children:["Open Resource",g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]},e.id))}),0===i.length&&g.jsx("div",{className:"py-20 text-center",children:g.jsx("p",{className:"text-slate-400 font-medium text-sm italic",children:"No resources found matching your search."})})]})},ol=({appScriptUrl:t,validationLists:n,onRefresh:s,showToast:r,isLocked:i})=>{const[o,a]=e.useState(""),[l,c]=e.useState(""),[d,u]=e.useState(""),[p,m]=e.useState(""),[h,f]=e.useState(!1),[x,b]=e.useState(!1),[v,y]=e.useState(!1),w=e.useRef(null),N=e.useMemo(()=>n.trucks.filter(e=>e.toLowerCase().includes(d.toLowerCase())).slice(0,100),[n.trucks,d]),j=e.useMemo(()=>n.trailers.filter(e=>e.toLowerCase().includes(p.toLowerCase())).slice(0,100),[n.trailers,p]),S=async e=>{const d=("truck"===e?o:l).trim().toUpperCase();if(!d||i)return;if(("truck"===e?n.trucks:n.trailers).some(e=>e.toUpperCase()===d))r(("truck"===e?"Truck":"Trailer")+" already exists.","warning");else{f(!0);try{await fetch(t,{method:"POST",body:JSON.stringify({action:"manage_fleet",type:e,value:d}),mode:"no-cors"}),r(("truck"===e?"Truck":"Trailer")+" added.","success"),"truck"===e?a(""):c(""),setTimeout(s,1e3)}finally{f(!1)}}};return g.jsxs("div",{className:"max-w-6xl mx-auto flex flex-col h-[calc(100vh-140px)] py-2 sm:py-4 px-2 sm:px-4 animate-fadeIn font-sans overflow-hidden",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 px-2 mb-6 shrink-0",children:[g.jsxs("div",{children:[g.jsx("h2",{className:"text-3xl font-normal text-slate-800 uppercase tracking-tight leading-none",children:"Fleet Registry"}),g.jsx("p",{className:"text-[9px] text-slate-400 font-medium uppercase tracking-[0.3em] mt-2",children:"Assets & Equipment"})]}),g.jsxs("div",{className:"flex gap-1.5 w-full sm:w-auto",children:[g.jsxs("button",{onClick:()=>{const e=Math.max(n.trucks.length,n.trailers.length);let t="";for(let o=0;o<e;o++){t+=`${n.trucks[o]||""},${n.trailers[o]||""}\n`}const s=new Blob(["Truck,Trailer\n"+t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(s),i=document.createElement("a");i.setAttribute("href",r),i.setAttribute("download",`fleet_export_${(new Date).toISOString().split("T")[0]}.csv`),i.click(),URL.revokeObjectURL(r)},className:"flex-1 sm:flex-none px-4 py-3 bg-white border border-slate-200 text-slate-500 rounded-xl font-medium text-[10px] uppercase tracking-widest transition-all hover:bg-slate-50 active:scale-95 flex items-center justify-center gap-2 shadow-sm",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2",children:g.jsx("path",{d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export"]}),g.jsx("button",{onClick:()=>y(!0),className:"p-3 bg-white border border-slate-200 text-indigo-500 rounded-xl hover:bg-indigo-50 transition-all shadow-sm",title:"Bulk Import Guide",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),g.jsx("input",{type:"file",accept:".csv",className:"hidden",ref:w,onChange:e=>{const o=e.target.files?.[0];if(!o||i)return;const a=new FileReader;a.onload=async e=>{const i=e.target?.result;if(i){b(!0);try{const e=i.split(/\r?\n/),o=[],a=[];for(let t=1;t<e.length;t++){const s=e[t].trim();if(!s)continue;const r=s.split(","),i=r[0]?.trim().toUpperCase(),l=r[1]?.trim().toUpperCase();i&&!n.trucks.includes(i)&&o.push(i),l&&!n.trailers.includes(l)&&a.push(l)}if(0===o.length&&0===a.length)return void r("No unique data found.","info");await fetch(t,{method:"POST",body:JSON.stringify({action:"bulk_manage_fleet",trucks:o,trailers:a}),mode:"no-cors"}),r("Bulk import synced.","success"),setTimeout(s,1500)}finally{b(!1),w.current&&(w.current.value="")}}},a.readAsText(o)}}),g.jsxs("button",{onClick:()=>w.current?.click(),disabled:i||x,className:"flex-[2] sm:flex-none px-6 py-3 bg-slate-900 text-white rounded-xl font-medium text-[10px] uppercase tracking-widest transition-all hover:bg-black active:scale-95 disabled:opacity-30 flex items-center justify-center gap-2 shadow-lg",children:[x?g.jsxs("svg",{className:"animate-spin h-3.5 w-3.5 text-white",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Bulk Sync"]})]})]}),g.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 min-h-0",children:[g.jsxs("div",{className:"flex flex-col min-h-0 bg-white rounded-[1.5rem] border border-slate-100 shadow-sm overflow-hidden",children:[g.jsxs("div",{className:"p-4 border-b border-slate-50 bg-slate-50/30 shrink-0",children:[g.jsx("div",{className:"flex items-center justify-between mb-4",children:g.jsxs("span",{className:"text-[10px] font-semibold text-slate-400 uppercase tracking-widest",children:["Horses (",n.trucks.length,")"]})}),g.jsxs("div",{className:"space-y-3",children:[g.jsxs("div",{className:"flex gap-2",children:[g.jsx("input",{type:"text",placeholder:"Enter Reg...",className:"flex-1 px-4 py-3 bg-white border border-slate-200 rounded-xl text-sm font-normal uppercase outline-none focus:ring-4 focus:ring-indigo-50/50 transition-all placeholder:text-slate-300 placeholder:normal-case",value:o,onChange:e=>a(e.target.value.toUpperCase())}),g.jsx("button",{onClick:()=>S("truck"),disabled:h||!o.trim()||i,className:"px-6 py-3 bg-slate-900 hover:bg-black text-white rounded-xl font-medium text-[10px] uppercase tracking-widest transition-all active:scale-95 disabled:opacity-30 shrink-0",children:"Add"})]}),g.jsxs("div",{className:"relative",children:[g.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeWidth:"2.5"})}),g.jsx("input",{type:"text",placeholder:"Filter horses...",className:"w-full pl-9 pr-4 py-2 bg-white border border-slate-200 rounded-xl text-[11px] font-normal outline-none focus:border-indigo-200 transition-all",value:d,onChange:e=>u(e.target.value)})]})]})]}),g.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide",children:g.jsx("div",{className:"divide-y divide-slate-50",children:0===N.length?g.jsx("div",{className:"p-12 text-center text-[10px] font-medium text-slate-300 uppercase tracking-widest italic",children:"No matches"}):N.map((e,t)=>g.jsx("div",{className:"px-6 py-3 flex items-center justify-between hover:bg-slate-50/50 transition-colors group",children:g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-100 group-hover:bg-indigo-400 transition-colors"}),g.jsx("span",{className:"text-sm font-normal text-slate-600 group-hover:text-slate-900 transition-colors",children:e})]})},t))})})]}),g.jsxs("div",{className:"flex flex-col min-h-0 bg-white rounded-[1.5rem] border border-slate-100 shadow-sm overflow-hidden",children:[g.jsxs("div",{className:"p-4 border-b border-slate-50 bg-slate-50/30 shrink-0",children:[g.jsx("div",{className:"flex items-center justify-between mb-4",children:g.jsxs("span",{className:"text-[10px] font-semibold text-slate-400 uppercase tracking-widest",children:["Trailers (",n.trailers.length,")"]})}),g.jsxs("div",{className:"space-y-3",children:[g.jsxs("div",{className:"flex gap-2",children:[g.jsx("input",{type:"text",placeholder:"Enter ID...",className:"flex-1 px-4 py-3 bg-white border border-slate-200 rounded-xl text-sm font-normal uppercase outline-none focus:ring-4 focus:ring-emerald-50/50 transition-all placeholder:text-slate-300 placeholder:normal-case",value:l,onChange:e=>c(e.target.value.toUpperCase())}),g.jsx("button",{onClick:()=>S("trailer"),disabled:h||!l.trim()||i,className:"px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-medium text-[10px] uppercase tracking-widest transition-all active:scale-95 disabled:opacity-30 shrink-0",children:"Add"})]}),g.jsxs("div",{className:"relative",children:[g.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeWidth:"2.5"})}),g.jsx("input",{type:"text",placeholder:"Filter trailers...",className:"w-full pl-9 pr-4 py-2 bg-white border border-slate-200 rounded-xl text-[11px] font-normal outline-none focus:border-emerald-200 transition-all",value:p,onChange:e=>m(e.target.value)})]})]})]}),g.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide",children:g.jsx("div",{className:"divide-y divide-slate-50",children:0===j.length?g.jsx("div",{className:"p-12 text-center text-[10px] font-medium text-slate-300 uppercase tracking-widest italic",children:"No matches"}):j.map((e,t)=>g.jsx("div",{className:"px-6 py-3 flex items-center justify-between hover:bg-slate-50/50 transition-colors group",children:g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-100 group-hover:bg-emerald-400 transition-colors"}),g.jsx("span",{className:"text-sm font-normal text-slate-600 group-hover:text-slate-900 transition-colors",children:e})]})},t))})})]})]}),v&&g.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-fadeIn",children:g.jsx("div",{className:"bg-white rounded-[2rem] shadow-2xl w-full max-w-md overflow-hidden animate-fadeIn",children:g.jsxs("div",{className:"p-8",children:[g.jsxs("div",{className:"flex justify-between items-start mb-6",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-xl font-normal text-slate-800 uppercase tracking-tight",children:"Bulk Import Guide"}),g.jsx("p",{className:"text-[9px] text-indigo-500 font-bold uppercase tracking-widest mt-1",children:"Setup Instructions"})]}),g.jsx("button",{onClick:()=>y(!1),className:"p-2 hover:bg-slate-50 rounded-full transition-colors text-slate-400",children:g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsxs("div",{className:"space-y-6 text-sm font-normal text-slate-600 leading-relaxed",children:[g.jsxs("div",{className:"flex gap-4",children:[g.jsx("div",{className:"w-6 h-6 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center shrink-0 font-bold text-xs",children:"1"}),g.jsxs("p",{children:["Ensure your file is in ",g.jsx("strong",{className:"text-slate-900 font-medium",children:"CSV (.csv)"})," format. Use commas to separate columns."]})]}),g.jsxs("div",{className:"flex gap-4",children:[g.jsx("div",{className:"w-6 h-6 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center shrink-0 font-bold text-xs",children:"2"}),g.jsxs("p",{children:["The first row must be the header: ",g.jsx("code",{className:"bg-slate-50 px-2 py-1 rounded text-indigo-600 font-mono text-xs",children:"Truck,Trailer"})]})]}),g.jsxs("div",{className:"flex gap-4",children:[g.jsx("div",{className:"w-6 h-6 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center shrink-0 font-bold text-xs",children:"3"}),g.jsx("p",{children:"Duplicates or small letters will be automatically converted and handled by the system."})]}),g.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-100 flex items-center justify-between",children:[g.jsx("p",{className:"text-xs font-medium text-slate-400 uppercase tracking-tight",children:"Need a template?"}),g.jsx("button",{onClick:()=>{const e=new Blob(["Truck,Trailer\nZM 1234,T-001\nZM 5678,T-002"],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download","fleet_import_template.csv"),n.click(),URL.revokeObjectURL(t)},className:"text-[10px] font-black text-indigo-600 uppercase tracking-widest hover:text-indigo-800 transition-colors",children:"Get Sample File"})]})]}),g.jsx("button",{onClick:()=>y(!1),className:"w-full mt-10 py-4 bg-slate-900 text-white font-medium rounded-xl text-[10px] uppercase tracking-[0.2em] active:scale-95 transition-all shadow-lg",children:"Got It"})]})})})]})},al=({data:e,settings:t})=>g.jsxs("div",{className:"max-w-[210mm] mx-auto text-sm leading-tight text-gray-900 font-sans p-8 bg-white min-h-[297mm]",children:[g.jsxs("div",{className:"flex flex-col items-center mb-6",children:[g.jsx("div",{className:"flex flex-col items-center justify-center gap-2 mb-6 w-full",children:t.companyLogo?g.jsx("img",{src:t.companyLogo,alt:"Company Logo",className:"h-28 max-w-sm object-contain"}):g.jsx("div",{className:"text-center py-4",children:g.jsx("h1",{className:"text-3xl font-serif font-bold text-gray-900 tracking-wide",children:t.companyName||"Company Name"})})}),g.jsxs("div",{className:"w-full border-2 border-black mt-2",children:[g.jsxs("div",{className:"grid grid-cols-3 divide-x-2 divide-black border-b-2 border-black",children:[g.jsx("div",{className:"p-1.5 pl-2 font-medium text-sm",children:"Doc. No. MNT-F-015"}),g.jsx("div",{className:"p-1.5 pl-2 font-medium text-sm",children:"Revision No.: 01"}),g.jsxs("div",{className:"p-1.5 pl-2 font-medium text-sm",children:["Date/Time: ",new Date(e.timestamp).toLocaleString()]})]}),g.jsx("div",{className:"p-2 text-center font-black text-xl uppercase tracking-wide bg-gray-50",children:"GENERAL VEHICLE CHECKLIST"})]})]}),g.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-3 mb-6 p-4 border border-gray-300 text-xs",children:[g.jsxs("div",{className:"grid grid-cols-[100px_1fr] gap-2 items-center",children:[g.jsx("span",{className:"font-bold uppercase text-gray-600",children:"Reg No:"}),g.jsx("span",{className:"font-mono font-bold text-base border-b border-gray-300",children:e.truckNo||"N/A"})]}),g.jsxs("div",{className:"grid grid-cols-[100px_1fr] gap-2 items-center",children:[g.jsx("span",{className:"font-bold uppercase text-gray-600",children:"Trailer/Unit:"}),g.jsx("span",{className:"font-mono font-bold text-base border-b border-gray-300",children:e.trailerNo||"N/A"})]}),g.jsxs("div",{className:"grid grid-cols-[100px_1fr] gap-2 items-center",children:[g.jsx("span",{className:"font-bold uppercase text-gray-600",children:"Driver Name:"}),g.jsx("span",{className:"font-medium border-b border-gray-300",children:e.driverName||"N/A"})]}),g.jsxs("div",{className:"grid grid-cols-[100px_1fr] gap-2 items-center",children:[g.jsx("span",{className:"font-bold uppercase text-gray-600",children:"Inspected By:"}),g.jsx("span",{className:"font-medium border-b border-gray-300",children:e.inspectedBy||"N/A"})]}),g.jsxs("div",{className:"grid grid-cols-[100px_1fr] gap-2 items-center",children:[g.jsx("span",{className:"font-bold uppercase text-gray-600",children:"Location:"}),g.jsx("span",{className:"font-medium border-b border-gray-300",children:e.location||"N/A"})]}),g.jsxs("div",{className:"grid grid-cols-[100px_1fr] gap-2 items-center",children:[g.jsx("span",{className:"font-bold uppercase text-gray-600",children:"Odometer:"}),g.jsxs("span",{className:"font-medium border-b border-gray-300",children:[e.odometer||"N/A"," km"]})]})]}),g.jsx("div",{className:"mb-6",children:g.jsx("div",{className:"grid grid-cols-2 gap-x-8 gap-y-0 border-t border-gray-300",children:C.map((t,n)=>{const s=e[t.id];let r="text-gray-900",i="";return"Bad"===s&&(r="text-red-700 font-bold",i="bg-red-50"),"Needs Attention"===s&&(r="text-amber-700 font-bold",i="bg-amber-50"),"Nil"===s&&(r="text-gray-400 italic"),g.jsxs("div",{className:`flex justify-between items-center border-b border-gray-300 py-1.5 px-2 text-xs ${i} ${n%2==0?"pr-4 border-r border-gray-300":"pl-4"}`,children:[g.jsx("span",{className:"text-gray-800 font-medium",children:t.label}),g.jsx("span",{className:`uppercase tracking-tighter ${r}`,children:s})]},t.id)})})}),g.jsxs("div",{className:"grid grid-cols-2 gap-12 mt-8 border-t-2 border-black pt-6 break-inside-avoid",children:[g.jsxs("div",{className:"text-center",children:[e.driverSignature?g.jsx("img",{src:e.driverSignature,className:"h-12 mx-auto mb-1",alt:"Driver Sig"}):g.jsx("div",{className:"h-12"}),g.jsx("p",{className:"border-t border-gray-400 pt-1 font-bold uppercase text-[10px] tracking-widest text-gray-600",children:"Driver Signature"})]}),g.jsxs("div",{className:"text-center",children:[e.inspectorSignature?g.jsx("img",{src:e.inspectorSignature,className:"h-12 mx-auto mb-1",alt:"Inspector Sig"}):g.jsx("div",{className:"h-12"}),g.jsx("p",{className:"border-t border-gray-400 pt-1 font-bold uppercase text-[10px] tracking-widest text-gray-600",children:"Inspector Signature"})]})]})]}),ll=({data:e,settings:t})=>g.jsxs("div",{className:"max-w-[210mm] mx-auto text-sm leading-tight text-gray-900 font-sans p-8 bg-white min-h-[297mm]",children:[g.jsxs("div",{className:"border border-black mb-6",children:[g.jsxs("div",{className:"grid grid-cols-[120px_1fr_150px] divide-x divide-black border-b border-black",children:[g.jsx("div",{className:"p-2 flex items-center justify-center",children:t.companyLogo?g.jsx("img",{src:t.companyLogo,alt:"Logo",className:"w-20 object-contain"}):g.jsx("span",{className:"font-bold text-xs",children:t.companyName})}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("div",{className:"border-b border-black px-2 py-1 text-xs font-medium",children:"Doc No: MNT – F – 002"}),g.jsx("div",{className:"flex-1 flex items-center justify-center p-2",children:g.jsx("h1",{className:"text-xl font-bold uppercase tracking-wider text-center",children:"PETROLEUM TANKER CHECKLIST"})})]}),g.jsxs("div",{className:"text-xs divide-y divide-black",children:[g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black",children:"Initial Issue Date"}),g.jsx("span",{className:"p-1 text-center",children:"03/02/2017"})]}),g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black",children:"Revision Date:"}),g.jsx("span",{className:"p-1 text-center",children:"01/02/2024"})]}),g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black",children:"Revision No."}),g.jsx("span",{className:"p-1 text-center",children:"05"})]}),g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black",children:"Next Revision:"}),g.jsx("span",{className:"p-1 text-center",children:"12/04/2026"})]})]})]}),g.jsx("div",{className:"bg-gray-50 p-4 text-xs font-mono border-b border-black",children:g.jsxs("div",{className:"grid grid-cols-2 gap-y-2 gap-x-8",children:[g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"TRUCK #:"})," ",g.jsx("span",{className:"font-bold",children:e.truckNo})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"TRAILER #:"})," ",g.jsx("span",{className:"font-bold",children:e.trailerNo})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"JOB CARD #:"})," ",g.jsx("span",{className:"font-bold",children:e.jobCard})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"DATE/TIME:"})," ",g.jsx("span",{className:"font-bold",children:new Date(e.timestamp).toLocaleString()})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"ODOMETER:"})," ",g.jsx("span",{className:"font-bold",children:e.odometer})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"LOCATION:"})," ",g.jsx("span",{className:"font-bold",children:e.location})]})]})}),g.jsx("div",{className:"p-2 text-[10px] text-center font-medium border-black bg-gray-100 italic",children:"NA = Not Applicable, NI = Not Inspected, Tick to indicate status under Good Order or Needs Attention. If Tick Critical (Bad), The Truck Must Not Leave The Garage Until The Problem Has Been Fixed."})]}),g.jsxs("div",{className:"border border-black text-xs",children:[g.jsxs("div",{className:"grid grid-cols-[30px_1fr_60px_70px_60px_1fr] bg-gray-300 border-b border-black font-bold text-center items-center py-2",children:[g.jsx("span",{children:"No."}),g.jsx("span",{className:"text-left pl-2",children:"ITEM DESCRIPTION"}),g.jsx("span",{children:"Good Order"}),g.jsx("span",{children:"Needs Attn"}),g.jsx("span",{children:"Critical"}),g.jsx("span",{children:"COMMENTS"})]}),O.map((t,n)=>{const s=e[t.id],r=s===x.GOOD,i=s===x.ATTENTION,o=s===x.BAD,a=t.label.split(". "),l=a[0]+".",c=a.slice(1).join(". ");return g.jsxs("div",{className:"grid grid-cols-[30px_1fr_60px_70px_60px_1fr] border-b border-gray-400 min-h-[30px] items-center "+(n%2==0?"bg-white":"bg-gray-50"),children:[g.jsx("span",{className:"text-center font-medium",children:l}),g.jsx("span",{className:"pl-2 border-l border-gray-300 h-full flex items-center py-1",children:c}),g.jsx("span",{className:"border-l border-gray-300 h-full flex items-center justify-center font-bold text-green-600",children:r?"✓":""}),g.jsx("span",{className:"border-l border-gray-300 h-full flex items-center justify-center font-bold text-amber-600",children:i?"!":""}),g.jsx("span",{className:"border-l border-gray-300 h-full flex items-center justify-center font-bold text-red-600 bg-red-50",children:o?"X":""}),g.jsx("span",{className:"border-l border-gray-300 h-full flex items-center pl-2 italic text-gray-500 py-1",children:o?"CRITICAL FAULT":i?"Check required":""})]},t.id)})]}),g.jsxs("div",{className:"mt-6 border border-black p-2 min-h-[60px]",children:[g.jsx("span",{className:"font-bold underline",children:"Remarks:"})," ",e.remarks]}),g.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-8 text-xs",children:[g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1",children:[g.jsx("span",{children:"Inspected By:"})," ",g.jsx("span",{className:"font-bold",children:e.inspectedBy})]}),g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1 items-end",children:[g.jsx("span",{children:"Inspector Sign:"}),e.inspectorSignature&&g.jsx("img",{src:e.inspectorSignature,className:"h-8",alt:"Sig"})]}),g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1",children:[g.jsx("span",{children:"Date:"})," ",g.jsx("span",{children:new Date(e.timestamp).toLocaleDateString()})]})]}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1",children:[g.jsx("span",{children:"Driver Name:"})," ",g.jsx("span",{className:"font-bold",children:e.driverName})]}),g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1 items-end",children:[g.jsx("span",{children:"Driver Sign:"}),e.driverSignature&&g.jsx("img",{src:e.driverSignature,className:"h-8",alt:"Sig"})]}),g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1",children:[g.jsx("span",{children:"Date:"})," ",g.jsx("span",{children:new Date(e.timestamp).toLocaleDateString()})]})]})]})]}),cl=({data:e,settings:t})=>g.jsxs("div",{className:"max-w-[210mm] mx-auto text-sm leading-tight text-gray-900 font-sans p-8 bg-white min-h-[297mm]",children:[g.jsxs("div",{className:"border border-black mb-6",children:[g.jsxs("div",{className:"grid grid-cols-[120px_1fr_150px] divide-x divide-black border-b border-black",children:[g.jsx("div",{className:"p-2 flex items-center justify-center",children:t.companyLogo?g.jsx("img",{src:t.companyLogo,alt:"Logo",className:"w-20 object-contain"}):g.jsx("span",{className:"font-bold text-xs",children:t.companyName})}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("div",{className:"border-b border-black px-2 py-1 text-xs font-medium",children:"Doc No: MNT – F – 002"}),g.jsx("div",{className:"flex-1 flex items-center justify-center p-2",children:g.jsx("h1",{className:"text-xl font-bold uppercase tracking-wider text-center",children:"PETROLEUM TANKER CHECKLIST"})})]}),g.jsxs("div",{className:"text-xs divide-y divide-black",children:[g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black",children:"Initial Issue Date"}),g.jsx("span",{className:"p-1 text-center",children:"03/02/2017"})]}),g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black",children:"Revision Date:"}),g.jsx("span",{className:"p-1 text-center",children:"15/03/2022"})]}),g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black",children:"Revision No."}),g.jsx("span",{className:"p-1 text-center",children:"05"})]}),g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black",children:"Next Review Date:"}),g.jsx("span",{className:"p-1 text-center",children:"15/04/2025"})]})]})]}),g.jsx("div",{className:"bg-gray-50 p-4 text-xs font-mono border-b border-black",children:g.jsxs("div",{className:"grid grid-cols-2 gap-y-2 gap-x-8",children:[g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"TRUCK #:"})," ",g.jsx("span",{className:"font-bold",children:e.truckNo})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"TRAILER #:"})," ",g.jsx("span",{className:"font-bold",children:e.trailerNo})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"JOB CARD #:"})," ",g.jsx("span",{className:"font-bold",children:e.jobCard})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"DATE/TIME:"})," ",g.jsx("span",{className:"font-bold",children:new Date(e.timestamp).toLocaleString()})]})]})}),g.jsxs("div",{className:"p-2 text-[10px] text-center font-bold border-black bg-gray-100",children:["C = Compliant, NC = Non-Compliant, NA = Not Applicable, NI = Not Inspected (Tick Accordingly)",g.jsx("br",{}),"Critical = Do Not Release, Non-Critical = Waiver Applicable"]})]}),g.jsxs("div",{className:"border border-black text-xs mb-8",children:[g.jsxs("div",{className:"grid grid-cols-[30px_1fr_30px_30px_30px_30px_1fr] bg-gray-300 border-b border-black font-bold text-center items-center py-2",children:[g.jsx("span",{children:"No."}),g.jsx("span",{className:"text-left pl-2",children:"ITEM DESCRIPTION"}),g.jsx("span",{children:"C"}),g.jsx("span",{children:"NC"}),g.jsx("span",{children:"NI"}),g.jsx("span",{children:"NA"}),g.jsx("span",{children:"COMMENTS"})]}),V.map((t,s)=>{const r=e[t.id],i=r===x.GOOD,o=r===x.BAD,a=r===x.NIL,l=r===x.ATTENTION,c=t.label.split(". "),d=c[0],u=c.slice(1).join(". ");let p=null;return"petro2_1"===t.id&&(p="PRIME MOVER"),"petro2_16"===t.id&&(p="TRAILER/TANKS"),"petro2_33"===t.id&&(p="DRIVER"),"petro2_38"===t.id&&(p="SAFETY & WARNING SIGNS"),"petro2_45"===t.id&&(p="LICENCE & MANDATORY DOCUMENTS"),g.jsxs(n.Fragment,{children:[p&&g.jsx("div",{className:"grid grid-cols-[1fr] bg-gray-200 border-b border-black font-bold px-2 py-1 text-center border-t-2 border-t-black",children:p}),g.jsxs("div",{className:"grid grid-cols-[30px_1fr_30px_30px_30px_30px_1fr] border-b border-gray-400 min-h-[30px] items-stretch "+(s%2==0?"bg-white":"bg-gray-50"),children:[g.jsx("span",{className:"text-center font-medium py-1 border-r border-gray-300 flex items-center justify-center",children:d}),g.jsx("span",{className:"pl-2 border-r border-gray-300 flex items-center py-1",children:u}),g.jsx("span",{className:"border-r border-gray-300 flex items-center justify-center font-bold text-black",children:i?"✔":""}),g.jsx("span",{className:"border-r border-gray-300 flex items-center justify-center font-bold text-black",children:o?"✔":""}),g.jsx("span",{className:"border-r border-gray-300 flex items-center justify-center font-bold text-black",children:a?"✔":""}),g.jsx("span",{className:"border-r border-gray-300 flex items-center justify-center font-bold text-black",children:l?"✔":""}),g.jsx("span",{className:"flex items-center pl-2 italic text-gray-500 py-1",children:o?"NON-COMPLIANT":l?"N/A":""})]})]},t.id)})]}),g.jsxs("div",{className:"mt-6 border border-black p-2 min-h-[60px]",children:[g.jsx("span",{className:"font-bold underline",children:"Remarks:"})," ",e.remarks]}),g.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-8 text-xs",children:[g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1",children:[g.jsx("span",{children:"Inspected By:"})," ",g.jsx("span",{className:"font-bold",children:e.inspectedBy})]}),g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1 items-end",children:[g.jsx("span",{children:"Inspector Sign:"}),e.inspectorSignature&&g.jsx("img",{src:e.inspectorSignature,className:"h-8",alt:"Sig"})]}),g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1",children:[g.jsx("span",{children:"Date:"})," ",g.jsx("span",{children:new Date(e.timestamp).toLocaleDateString()})]})]}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1",children:[g.jsx("span",{children:"Driver Name:"})," ",g.jsx("span",{className:"font-bold",children:e.driverName})]}),g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1 items-end",children:[g.jsx("span",{children:"Driver Sign:"}),e.driverSignature&&g.jsx("img",{src:e.driverSignature,className:"h-8",alt:"Sig"})]}),g.jsxs("div",{className:"flex justify-between border-b border-gray-400 pb-1",children:[g.jsx("span",{children:"Date:"})," ",g.jsx("span",{children:new Date(e.timestamp).toLocaleDateString()})]})]})]})]}),dl=({data:e,settings:t})=>g.jsxs("div",{className:"max-w-[210mm] mx-auto text-sm leading-tight text-gray-900 font-sans p-8 bg-white min-h-[297mm]",children:[g.jsx("div",{className:"border-2 border-black mb-4",children:g.jsxs("div",{className:"grid grid-cols-[120px_1fr_150px] divide-x-2 divide-black border-b-2 border-black",children:[g.jsx("div",{className:"p-2 flex items-center justify-center",children:t.companyLogo?g.jsx("img",{src:t.companyLogo,alt:"Logo",className:"w-24 object-contain"}):g.jsx("span",{className:"font-bold text-xs",children:t.companyName})}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("div",{className:"border-b-2 border-black px-2 py-1 text-xs font-medium",children:"Doc No: MNT – F – 013"}),g.jsx("div",{className:"flex-1 flex items-center justify-center p-2 bg-gray-50",children:g.jsx("h1",{className:"text-xl font-black uppercase tracking-wider text-center",children:"ACID TANKER CHECKLIST"})})]}),g.jsxs("div",{className:"text-xs divide-y divide-black",children:[g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black font-semibold",children:"Initial Issue Date"}),g.jsx("span",{className:"p-1 text-center",children:"03/02/2017"})]}),g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black font-semibold",children:"Revision Date:"}),g.jsx("span",{className:"p-1 text-center",children:"15/03/2022"})]}),g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black font-semibold",children:"Revision No."}),g.jsx("span",{className:"p-1 text-center",children:"05"})]}),g.jsxs("div",{className:"grid grid-cols-[1fr_80px]",children:[g.jsx("span",{className:"p-1 pl-2 border-r border-black font-semibold",children:"Next Revision:"}),g.jsx("span",{className:"p-1 text-center",children:"15/03/2023"})]})]})]})}),g.jsxs("div",{className:"mb-4 text-xs font-mono",children:[g.jsxs("div",{className:"flex flex-wrap gap-x-8 gap-y-2 mb-2",children:[g.jsxs("div",{className:"flex gap-2",children:[g.jsx("span",{children:"Horse #:"})," ",g.jsx("span",{className:"font-bold border-b border-gray-400 min-w-[100px]",children:e.truckNo})]}),g.jsxs("div",{className:"flex gap-2",children:[g.jsx("span",{children:"Trailer #:"})," ",g.jsx("span",{className:"font-bold border-b border-gray-400 min-w-[100px]",children:e.trailerNo})]}),g.jsxs("div",{className:"flex gap-2",children:[g.jsx("span",{children:"Job Card #:"})," ",g.jsx("span",{className:"font-bold border-b border-gray-400 min-w-[100px]",children:e.jobCard})]})]}),g.jsxs("div",{className:"flex flex-wrap gap-x-8 gap-y-2",children:[g.jsxs("div",{className:"flex gap-2",children:[g.jsx("span",{children:"Location:"})," ",g.jsx("span",{className:"font-bold border-b border-gray-400 min-w-[150px]",children:e.location})]}),g.jsxs("div",{className:"flex gap-2",children:[g.jsx("span",{children:"Inspection Date/Time:"})," ",g.jsx("span",{className:"font-bold border-b border-gray-400 min-w-[150px]",children:new Date(e.timestamp).toLocaleString()})]})]})]}),g.jsxs("div",{className:"border-2 border-black text-xs",children:[g.jsxs("div",{className:"grid grid-cols-[40px_1fr_120px] bg-white border-b-2 border-black font-bold items-center",children:[g.jsx("span",{className:"text-center py-2 border-r border-black",children:"S/N"}),g.jsx("span",{className:"text-left pl-2 py-2 border-r border-black",children:"ITEM"}),g.jsx("span",{className:"pl-2 py-2",children:"COMMENT"})]}),["PPE","VEHICLE","SPILL_KIT","DOCUMENTATION"].map(t=>{let s="",r=[];return"PPE"===t?(s="A. Personal Protective Equipment (PPE)",r=D.filter(e=>e.category.includes("Personal"))):"VEHICLE"===t?(s="B. Vehicle (Horse & Trailer)",r=D.filter(e=>e.category.includes("Vehicle"))):"SPILL_KIT"===t?(s="C. Spill Kit",r=D.filter(e=>e.category.includes("Spill"))):"DOCUMENTATION"===t&&(s="D. Documentation",r=D.filter(e=>e.category.includes("Documentation"))),g.jsxs(n.Fragment,{children:[g.jsx("div",{className:"grid grid-cols-[1fr] border-b border-black bg-gray-100 font-bold px-2 py-1",children:s}),r.map((t,n)=>{const s=e[t.id],r=t.label.split(". "),i=r[0],o=r.slice(1).join(". ");let a="";return s===x.GOOD?a="text-green-700 font-bold":s===x.BAD?a="text-red-700 font-bold bg-red-50":s===x.ATTENTION&&(a="text-amber-700 font-bold bg-amber-50"),g.jsxs("div",{className:"grid grid-cols-[40px_1fr_120px] border-b border-black items-stretch",children:[g.jsx("span",{className:"text-center py-1 border-r border-black flex items-center justify-center font-semibold",children:i}),g.jsx("span",{className:"pl-2 py-1 border-r border-black flex items-center",children:o}),g.jsx("span",{className:`pl-2 py-1 flex items-center ${a}`,children:s||"-"})]},t.id)})]},t)})]}),g.jsxs("div",{className:"mt-4 text-xs space-y-4",children:[g.jsxs("div",{className:"flex gap-2",children:[g.jsx("span",{className:"font-semibold",children:"Remarks:"}),g.jsx("span",{className:"border-b border-black flex-1 border-dashed",children:e.remarks})]}),g.jsxs("div",{className:"flex gap-2 items-center",children:[g.jsx("span",{className:"font-semibold w-24",children:"Inspector:"}),g.jsx("span",{className:"border-b border-black flex-1 border-dashed",children:e.inspectedBy})]}),g.jsxs("div",{className:"flex gap-2 items-end",children:[g.jsx("span",{className:"font-semibold w-24",children:"Inspector Sig:"}),g.jsx("div",{className:"border-b border-black flex-1 border-dashed h-12",children:e.inspectorSignature&&g.jsx("img",{src:e.inspectorSignature,className:"h-full object-contain"})})]}),g.jsxs("div",{className:"flex gap-2 items-center",children:[g.jsx("span",{className:"font-semibold w-24",children:"Driver:"}),g.jsx("span",{className:"border-b border-black flex-1 border-dashed",children:e.driverName})]}),g.jsxs("div",{className:"flex gap-2 items-end",children:[g.jsx("span",{className:"font-semibold w-24",children:"Driver Sig:"}),g.jsx("div",{className:"border-b border-black flex-1 border-dashed h-12",children:e.driverSignature&&g.jsx("img",{src:e.driverSignature,className:"h-full object-contain"})})]})]}),g.jsxs("div",{className:"mt-6 text-xs",children:[g.jsx("p",{className:"font-bold mb-2",children:"Pictures of Damage/Broken/Disfigured etc.:"}),g.jsx("div",{className:"h-32 border border-black flex items-center justify-center bg-gray-50 mb-4",children:e.photoDamage?g.jsx("img",{src:e.photoDamage,className:"h-full object-contain"}):g.jsx("span",{className:"text-gray-400",children:"No damage photo"})}),g.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[g.jsxs("div",{children:[g.jsx("p",{className:"font-bold mb-1",children:"Front Picture:"}),g.jsx("div",{className:"h-32 border border-black flex items-center justify-center bg-gray-50",children:e.photoFront?g.jsx("img",{src:e.photoFront,className:"h-full object-contain"}):g.jsx("span",{className:"text-gray-400",children:"No photo"})})]}),g.jsxs("div",{children:[g.jsx("p",{className:"font-bold mb-1",children:"LS Picture:"}),g.jsx("div",{className:"h-32 border border-black flex items-center justify-center bg-gray-50",children:e.photoLS?g.jsx("img",{src:e.photoLS,className:"h-full object-contain"}):g.jsx("span",{className:"text-gray-400",children:"No photo"})})]}),g.jsxs("div",{children:[g.jsx("p",{className:"font-bold mb-1",children:"BS Picture:"}),g.jsx("div",{className:"h-32 border border-black flex items-center justify-center bg-gray-50",children:e.photoBack?g.jsx("img",{src:e.photoBack,className:"h-full object-contain"}):g.jsx("span",{className:"text-gray-400",children:"No photo"})})]}),g.jsxs("div",{children:[g.jsx("p",{className:"font-bold mb-1",children:"RS Picture:"}),g.jsx("div",{className:"h-32 border border-black flex items-center justify-center bg-gray-50",children:e.photoRS?g.jsx("img",{src:e.photoRS,className:"h-full object-contain"}):g.jsx("span",{className:"text-gray-400",children:"No photo"})})]})]})]})]}),ul=()=>{const[t,n]=e.useState(!1),[i,o]=e.useState(!1),a=async()=>{try{n(!0)}catch(e){}};return e.useEffect(()=>{a();const e=setInterval(a,3e5);return()=>clearInterval(e)},[]),t?g.jsx("div",{className:"fixed top-0 left-0 right-0 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-3 z-50 shadow-lg animate-slideDown",children:g.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[g.jsxs("div",{className:"flex items-center",children:[g.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),g.jsxs("div",{children:[g.jsx("span",{className:"font-bold",children:"Update available!"}),g.jsx("span",{className:"text-sm ml-2 opacity-90",children:"• New features & improvements"})]})]}),g.jsx("button",{onClick:async()=>{try{o(!0),await s(),await r()}catch(e){o(!1)}},disabled:i,className:"bg-white text-blue-600 px-4 py-1.5 rounded-lg font-bold hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md",children:i?g.jsxs("span",{className:"flex items-center",children:[g.jsxs("svg",{className:"animate-spin h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Updating..."]}):"Update Now"})]})}):null},pl=()=>{const{currentUser:t,setCurrentUser:n,handleLogin:r,handleLogout:i,sessionExpired:o,setSessionExpired:a}=X(),{settings:l,setSettings:c,appScriptUrl:d,setAppScriptUrl:u,isSavingSettings:p,handleSaveSettings:m,fetchSystemSettings:h}=(()=>{const[t,n]=e.useState(()=>"https://script.google.com/macros/s/AKfycbwZRcAVA4eauiexlSe81T-iHhq8tzrvbP7k11D7FT7Z-_Pg3eVCVBK3DXyTBAfGCe9-NQ/exec"),[s,r]=e.useState(()=>{if("undefined"!=typeof window){const t=localStorage.getItem("safetyCheck_settings");if(t)try{return JSON.parse(t)}catch(e){}}return{companyName:"SafetyCheck Pro",managerEmail:""}}),[i,o]=e.useState(!1),a=e.useRef(!1),l=e.useRef(!1);e.useEffect(()=>{if(t&&t.startsWith("https://script.google.com")){c(t);const e=setInterval(()=>{l.current||c(t)},3e4);return()=>clearInterval(e)}},[t]);const c=async(e,t=!1)=>{if(e&&e.startsWith("https://script.google.com")&&navigator.onLine&&(!a.current||t)){a.current=!0;try{const t=`t=${(new Date).getTime()}`,n=`${e}${e.includes("?")?"&":"?"}${t}`,s=await fetch(n,{method:"GET",mode:"cors",cache:"no-store"});if(!s.ok)return;const i=(await s.json()).System_Settings;if(i&&Array.isArray(i)&&i.length>1){const e=i[1];if(e&&e.length>=8){const t="TRUE"===String(e[7]).toUpperCase().trim(),n={companyName:e[0]||"SafetyCheck Pro",managerEmail:e[1]||"",companyLogo:e[4]&&String(e[4]).length>100?e[4]:void 0,mobileApkLink:e[5]||"",webAppUrl:e[6]||"",maintenanceMode:t,maintenanceMessage:e[8]||"System under scheduled maintenance."};r(e=>JSON.stringify(e)!==JSON.stringify(n)?(localStorage.setItem("safetyCheck_settings",JSON.stringify(n)),n):e)}}}catch(n){}finally{a.current=!1}}};return{settings:s,setSettings:r,appScriptUrl:t,setAppScriptUrl:n,isSavingSettings:i,handleSaveSettings:async()=>{o(!0),l.current=!0;try{localStorage.setItem("safetyCheck_settings",JSON.stringify(s)),localStorage.setItem("safetyCheck_scriptUrl",t),t&&t.startsWith("https")&&navigator.onLine&&await fetch(t,{method:"POST",body:JSON.stringify({action:"update_settings",...s}),mode:"no-cors"})}catch(e){}finally{setTimeout(()=>{o(!1),l.current=!1},800)}},fetchSystemSettings:c}})(),{subscription:f,history:v,refreshSubscription:y}=((t,n)=>{const[s,r]=e.useState(null),[i,o]=e.useState([]),[a,l]=e.useState(!1),c=async()=>{if(t&&"string"==typeof t&&t.startsWith("http")&&n){l(!0);try{const e=await fetch(`${t}?t=${(new Date).getTime()}`);if(!e.ok)return;const n=await e.json();if(n.Subscription_Data){const e=n.Subscription_Data,t=e.current||e,s=e.history||[],i=String(t.expiryDate||"").trim();if(!i||"undefined"===i||"null"===i||""===i)return r({status:"Expired",plan:"None",expiryDate:"",daysRemaining:0}),void o(s);const a=i.split("T")[0],l=a.split("-");let c;if(3===l.length?c=new Date(parseInt(l[0]),parseInt(l[1])-1,parseInt(l[2]),23,59,59):(c=new Date(i),c.setHours(23,59,59,999)),isNaN(c.getTime()))return void r({status:"Expired",plan:"None",expiryDate:"",daysRemaining:0});const d=new Date,u=c.getTime()-d.getTime(),p=Math.ceil(u/864e5);r({status:p<=0?"Expired":t.status||"Active",plan:t.plan||"Standard",expiryDate:a,daysRemaining:Math.max(0,p)}),o(s)}else r({status:"Expired",plan:"None",expiryDate:"",daysRemaining:0})}catch(e){}finally{l(!1)}}};return e.useEffect(()=>{c()},[t,n]),{subscription:s,history:i,isLoading:a,refreshSubscription:c}})(d,t),[w,N]=e.useState("overview"),[j,S]=e.useState("dashboard"),[E,_]=e.useState(!1),[k,I]=e.useState(!1),[A,T]=e.useState(null),[R,P]=e.useState(!1),[L,M]=e.useState(!1),[U,q]=e.useState(!1),[G,H]=e.useState(null),[B,F]=e.useState(null),[Y,K]=e.useState(null),[Q,Z]=e.useState(!1),[ee,te]=e.useState(null),[ne,se]=e.useState(!1),{historyList:re,isLoadingHistory:ie,validationLists:oe,stats:ae,fetchHistory:le}=((t,n,s)=>{const[r,i]=e.useState([]),[o,a]=e.useState(!1),[l,c]=e.useState(!1),d=e.useRef(0),[u,p]=e.useState({trucks:[],trailers:[],drivers:[],inspectors:[],locations:[],positions:[]});e.useEffect(()=>{t&&s&&m(!1)},[n,t,s?.username]);const m=async(e=!1)=>{if(!t||"string"!=typeof t||!t.startsWith("http"))return;const r=!0===e,o=Date.now(),l=`sc_history_${s?`${s.username}_`:"anon_"}${n}`,u=localStorage.getItem(l);let m=!1;if(u&&!r)try{const e=JSON.parse(u);if(e.data&&Array.isArray(e.data)){i(e.data),m=!0;const t=localStorage.getItem("sc_validation_lists");if(t&&p(JSON.parse(t)),o-e.timestamp<3e5)return void a(!1)}}catch(h){}if(!(r&&o-d.current<15e3)){if(m?c(!0):a(!0),!navigator.onLine)return a(!1),void c(!1);try{d.current=o;const e=await fetch(`${t}?t=${o}`);if(!e.ok)throw new Error("Network response was not ok");const s=await e.text();if(!s||s.trim().startsWith("<"))throw new Error("Invalid response format");const r=JSON.parse(s),a=r.Validation_Data;if(a){const e={trucks:a.Truck_Reg_No||[],trailers:a.Trailer_Reg_No||[],drivers:a.Driver_Name||[],inspectors:a.Inspector_Name||[],locations:a.Location||[],positions:a.Position||[]};p(e),localStorage.setItem("sc_validation_lists",JSON.stringify(e))}let c="General",u=W;"petroleum"===n?(c="Petroleum",u=J):"petroleum_v2"===n?(c="Petroleum_V2",u=$):"acid"===n&&(c="Acid",u=z);const m=r[c];let h=[];void 0!==m&&Array.isArray(m)&&m.length>1&&(h=m.slice(1).map(e=>{const t={};return u.forEach((n,s)=>{t[n]=void 0!==e[s]?e[s]:null}),t}).reverse()),i(h),localStorage.setItem(l,JSON.stringify({timestamp:Date.now(),data:h}))}catch(g){}finally{a(!1),c(!1)}}},h=e.useMemo(()=>{if(!r.length)return{total:0,avgRate:0,passRate:0};const e=r.length;return{total:e,avgRate:0,passRate:(r.filter(e=>Number(e.rate)>=4).length/e*100).toFixed(0)}},[r]);return{historyList:r,isLoadingHistory:o,isBackgroundFetching:l,validationLists:u,stats:h,fetchHistory:m}})(d,w,t);e.useEffect(()=>{(async()=>{try{await s()}catch(e){}})()},[]),e.useEffect(()=>{t&&!t.needsSetup&&(N("overview"),S("dashboard"))},[t?.username,t?.needsSetup]);const ce=e.useMemo(()=>{const e="SuperAdmin"===t?.role,n=!!f&&("Expired"===f.status||f.daysRemaining<=0),s=!0===l.maintenanceMode;return e?{isLocked:!1,reason:null}:s?{isLocked:!0,reason:"maintenance"}:n?{isLocked:!0,reason:"license"}:{isLocked:!1,reason:null}},[f,l.maintenanceMode,t?.role]),de=ce.isLocked;e.useEffect(()=>{window.isSubscriptionLocked=de},[de]);const ue=(e,t)=>{T({message:e,type:t}),setTimeout(()=>T(null),4e3)};e.useEffect(()=>{"idle"===o?ue("Session expired due to inactivity.","warning"):"max_duration"===o&&ue("Session limit reached. Log in again.","info"),o&&a(null)},[o]);const{submissionStatus:pe,setSubmissionStatus:me,addToQueue:he}=((t,n,s)=>{const[r,i]=e.useState("idle"),[o,a]=e.useState([]),[l,c]=e.useState(!1),[d,u]=e.useState(!1);e.useEffect(()=>{const e=localStorage.getItem("safetycheck_offline_queue");if(e)try{a(JSON.parse(e))}catch(r){}const t=()=>{u(!1),n("Connection restored. Attempting background sync...","info"),p()},s=()=>{u(!1)};return window.addEventListener("online",t),window.addEventListener("offline",s),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}},[]);const p=async()=>{if(l)return;const e=JSON.parse(localStorage.getItem("safetycheck_offline_queue")||"[]");if(0===e.length)return;c(!0),u(!1);let r=0,i=[...e];i.length;try{for(;i.length>0;){const e=i[0];try{const n=new AbortController,s=setTimeout(()=>n.abort(),15e3);await fetch(t,{method:"POST",body:JSON.stringify(e),mode:"no-cors",headers:{"Content-Type":"text/plain"},signal:n.signal}),clearTimeout(s),i.shift(),r++,a([...i]),localStorage.setItem("safetycheck_offline_queue",JSON.stringify(i)),await new Promise(e=>setTimeout(e,1e3))}catch(o){if("AbortError"===o.name||o.message.includes("NetworkError")||o.message.includes("Failed to fetch")){u(!0);break}break}}}finally{c(!1),r>0?0===i.length?(n(`All ${r} offline records synced successfully!`,"success"),s()):n(`Synced ${r} items. ${i.length} remaining.`,"info"):d&&e.length}};return{submissionStatus:r,setSubmissionStatus:i,offlineQueue:o,isSyncing:l,isPoorConnection:d,syncOfflineQueue:p,addToQueue:e=>{const t=[...o,e];a(t),localStorage.setItem("safetycheck_offline_queue",JSON.stringify(t))}}})(d,ue,()=>le(!0)),ge=async e=>{if(e.startsWith("support:info:")){const t=e.replace("support:info:","");return K({subject:`Inquiry: ${t}`,description:`Automated Request: User is interested in learning more about integrating the "${t}" module into the current fleet workflow.`}),N("support"),S("dashboard"),void I(!1)}if(e.startsWith("request:start_inspection")){if(de)return void ue("System is in View-Only mode.","error");const t=e.split("|"),n=t[1]?.toLowerCase(),s=t[2],r=t[3],i=t[4],o=t[5];let a="general";return"petroleum"===n?a="petroleum":"petroleum_v2"===n?a="petroleum_v2":"acid"===n&&(a="acid"),N(a),void Ae(a,{truckNo:s,trailerNo:r,remarks:`Requested by ${i}: ${o}`,requestId:t[0].split("-")[1]})}"support"!==e&&K(null),N(e),S("dashboard")},fe=e=>{if(de)return void ue("System is currently in view-only mode.","error");const t=`sc_draft_${e}`;localStorage.getItem(t)?(te(e),se(!0),Z(!0)):Ae()},{notifications:xe,handleMarkNotificationRead:be,handleDismissNotification:ve,handleClearAllNotifications:ye,handleGlobalAcknowledge:we}=((t,n,s)=>{const[r,i]=e.useState([]),[o,a]=e.useState([]),[l,c]=e.useState([]),[d,u]=e.useState([]),p=e.useRef([]),m=e.useRef([]),h=e.useRef([]),g=e.useRef(null);e.useEffect(()=>{p.current=l},[l]),e.useEffect(()=>{m.current=o},[o]),e.useEffect(()=>{h.current=d},[d]),e.useEffect(()=>{if(!n)return void(g.current&&window.clearInterval(g.current));const e=n.username.replace(/[^a-z0-9]/gi,"_")+"_",t=localStorage.getItem(`sc_read_notifications_${e}`),s=localStorage.getItem(`sc_dismissed_notifications_${e}`),r=localStorage.getItem(`sc_pop_history_${e}`),i=t?JSON.parse(t):[],o=s?JSON.parse(s):[],l=r?JSON.parse(r):[];return a(i),c(o),u(l),x(),g.current=window.setInterval(x,6e4),()=>{g.current&&window.clearInterval(g.current)}},[n,t]);const f=(e,t)=>{if(!n)return;const s=n.username.replace(/[^a-z0-9]/gi,"_")+"_",r="read"===e?`sc_read_notifications_${s}`:"dismissed"===e?`sc_dismissed_notifications_${s}`:`sc_pop_history_${s}`;localStorage.setItem(r,JSON.stringify(t)),"read"===e?a(t):"dismissed"===e?c(t):"notified"===e&&u(t)},x=async()=>{if(t&&navigator.onLine&&n)try{const e=await fetch(`${t}?t=${Date.now()}`);if(!e.ok)return;const r=await e.text();if(!r||r.trim().startsWith("<"))return;const o=JSON.parse(r),a=(o.Acknowledgements||[]).map(e=>String(e)),l=Date.now();let c=[];const d=e=>p.current.includes(e)||a.includes(e),u=e=>m.current.includes(e),g=(e,t)=>{if(!Array.isArray(e)||e.length<=1)return[];const n="General"===t?8:9;return e.slice(Math.max(1,e.length-50)).map(e=>{const s=String(e[1]),r=Date.parse(s),i=String(e[2]||"UNIT").trim().toUpperCase(),o=Number(e[n]),a=`V_${t}_${r}_${i}`.replace(/\s+/g,"");return d(a)||isNaN(r)||l-r>864e5?null:o<=3?{id:a,title:o<=2?`CRITICAL: ${i}`:`WARNING: ${i}`,message:`${t} Audit: Rated ${o}/5`,type:o<=2?"critical":"warning",timestamp:s,read:u(a),module:t}:null}).filter(e=>null!==e)};["General","Petroleum","Petroleum_V2","Acid"].forEach(e=>{o[e]&&(c=[...c,...g(o[e],e)])});const x=o.SystemNotification||[];if(Array.isArray(x)&&x.length>1){const e=n.username.toLowerCase().trim(),t=n.role.toLowerCase().trim();x.forEach(n=>{const s=String(n[0]),r=String(n[1]).trim().toLowerCase(),i="TRUE"===String(n[5]).toUpperCase();d(s)||i||r!==e&&r!==t&&"all"!==r||c.push({id:s,title:"SYSTEM ALERT",message:String(n[3]),type:String(n[2]).toLowerCase()||"info",timestamp:n[4],read:u(s),actionLink:n[6],isServerEvent:!0})})}c.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime());const b=c.slice(0,50),v=b.filter(e=>!h.current.includes(e.id)&&!e.read&&!p.current.includes(e.id));if(v.length>0){const e=v[0];s(e.message,"critical"===e.type?"error":"info");const t=[...new Set([...h.current,...v.map(e=>e.id)])];f("notified",t)}i(b)}catch(e){}},b=e=>{i(t=>t.filter(t=>t.id!==e)),f("dismissed",[...new Set([...p.current,e])]),f("notified",[...new Set([...h.current,e])])};return{notifications:r,handleMarkNotificationRead:async(e,t)=>{i(t=>t.map(t=>t.id===e?{...t,read:!0}:t)),f("read",[...new Set([...m.current,e])]);const n=r.find(t=>t.id===e);n?.actionLink&&t&&t(n.actionLink)},handleDismissNotification:b,handleClearAllNotifications:()=>{const e=r.map(e=>e.id);f("dismissed",[...new Set([...p.current,...e])]),f("notified",[...new Set([...h.current,...e])]),i([])},handleGlobalAcknowledge:async e=>{if(t&&n){b(e);try{await fetch(t,{method:"POST",body:JSON.stringify({action:"acknowledge_notification",notificationId:e,user:n.username}),mode:"no-cors"}),s("Global acknowledgement synced.","success")}catch(r){}}},fetchNotifications:x}})(d,t,ue),[Ne,je]=e.useState(!1),[Se,Ee]=e.useState(null),[Ce,_e]=e.useState(b),ke="Admin"===t?.role||"SuperAdmin"===t?.role,Ie="SuperAdmin"===t?.role,Ae=(e,n)=>{de?ue("Access Restricted: View-Only mode active.","error"):(H(null),F(null),_e({...b,timestamp:(new Date).toISOString(),inspectedBy:t?.name||"",...n}),S("form"))},Te=e=>{Ee(e),je(!0)},Oe=e=>{const t={...e,needsSetup:!1};n(t),localStorage.setItem("safetyCheck_user",JSON.stringify(t)),N("overview"),S("dashboard"),ue("Profile verified successfully.","success"),M(!0)},Re="overview"===w;return t?t&&t.needsSetup?g.jsx(ga,{user:t,appScriptUrl:d,onComplete:Oe,onLogout:i}):g.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans text-slate-800 relative",children:[g.jsx(ul,{}),g.jsx(ca,{status:pe,onClose:()=>{me("idle"),S("dashboard")},onViewReport:()=>G&&Te(G),aiAnalysis:B}),A&&g.jsx(aa,{message:A.message,type:A.type,onClose:()=>T(null)}),L&&g.jsx(xa,{onComplete:()=>M(!1)}),E&&g.jsx(da,{user:t,settings:l,appScriptUrl:d,onClose:()=>_(!1),showToast:ue,onUpdateSuccess:e=>n(e),onLogout:()=>{_(!1),i()}}),k&&g.jsx(ya,{isOpen:k,onClose:()=>I(!1),onAction:ge}),g.jsx(ha,{isOpen:R,onClose:()=>P(!1),onSubmit:async e=>{if(de)ue("Requests are disabled in View-Only mode.","error");else if(d)try{await fetch(d,{method:"POST",body:JSON.stringify({action:"request_inspection",requester:t?.name,role:t?.role,...e}),mode:"no-cors"}),ue("Inspection request submitted successfully","success")}catch(n){ue("Failed to submit request","error")}},validationLists:oe,currentUserRole:t.role}),g.jsx(pa,{isOpen:Q,onClose:()=>Z(!1),onStartNew:()=>{ee&&(localStorage.removeItem(`sc_draft_${ee}`),N(ee),Ae(),Z(!1))},onResume:()=>{if(!ee)return;const e=`sc_draft_${ee}`,t=localStorage.getItem(e);t&&(_e(JSON.parse(t)),N(ee),S("form")),Z(!1)},hasDraft:ne,moduleName:ee||""}),g.jsxs("div",{className:"relative z-10 min-h-screen flex flex-col",children:[g.jsxs("div",{className:"no-print",children:[l.maintenanceMode&&g.jsxs("div",{className:"bg-amber-600 px-4 py-2.5 flex items-center justify-center gap-4 text-white shadow relative z-[101]",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4 text-amber-100",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),g.jsx("p",{className:"text-xs font-black",children:l.maintenanceMessage||"SYSTEM MAINTENANCE IN PROGRESS"})]}),g.jsx("button",{onClick:async()=>{q(!0);try{await h(d,!0),ue("Status updated.","info")}finally{q(!1)}},disabled:U,className:"px-3 py-1 bg-white/10 hover:bg-white/20 border border-white/30 rounded text-[10px] font-black transition-all uppercase tracking-widest",children:U?"SYNCING...":"CHECK STATUS"})]}),g.jsx(ma,{subscription:f,user:t,onManage:()=>N("maintenance")})]}),g.jsxs("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-40 px-4 py-2 flex items-center justify-between h-14 no-print",children:[g.jsx("div",{className:"flex items-center gap-2",children:!Re&&g.jsxs("button",{onClick:()=>{N("overview"),S("dashboard")},className:"p-2 text-slate-600 hover:bg-slate-50 rounded-lg transition-all flex items-center group",children:[g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),g.jsx("span",{className:"text-[10px] font-black ml-1 hidden sm:inline uppercase tracking-widest",children:"Dashboard"})]})}),g.jsxs("button",{onClick:()=>{N("overview"),S("dashboard")},className:"flex flex-col items-center hover:opacity-80 transition-opacity absolute left-1/2 -translate-x-1/2",children:[g.jsx("h1",{className:"text-sm sm:text-base font-black text-slate-900 tracking-tighter leading-none uppercase",children:l.companyName||"SAFETYCHECK PRO"}),g.jsx("span",{className:"text-[7px] font-black text-indigo-600 tracking-[0.4em] mt-1 hidden sm:block",children:"CORE SYSTEM v3.2"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(ua,{id:"notification-bell",notifications:xe,onMarkAsRead:e=>be(e,ge),onDismiss:ve,onClearAll:ye,onAcknowledge:we,canAcknowledge:ke}),g.jsx("button",{id:"profile-trigger",onClick:()=>_(!0),className:"p-2 text-slate-400 hover:text-slate-600 transition-colors",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"2.5",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})]})]}),de&&g.jsxs("div",{className:"bg-amber-50 border-b border-amber-200 px-4 py-1.5 flex items-center justify-center gap-2 no-print",children:[g.jsx("svg",{className:"w-3.5 h-3.5 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),g.jsx("span",{className:"text-[9px] font-black text-amber-800 uppercase tracking-[0.2em]",children:"maintenance"===ce.reason?"LOCKED: CORE MAINTENANCE":"RESTRICTED: VIEW-ONLY MODE"})]}),g.jsx("main",{className:"flex-1 p-4 md:p-6 w-full max-w-7xl mx-auto no-print",children:"form"===j?g.jsx(Ya,{initialData:Ce,activeModule:w,validationLists:oe,settings:l,onSaveDraft:e=>{localStorage.setItem(`sc_draft_${w}`,JSON.stringify(e)),S("dashboard")},onExit:()=>S("dashboard"),onSubmit:async e=>{if(de)return void ue("System is in View-Only mode. Submission blocked.","error");if(!d)return void ue("Application URL not configured","error");me("submitting"),H(e),F(null);let t="General",n=W,s="General Vehicle Inspection",r=C;"petroleum"===w?(t="Petroleum",n=J,s="Petroleum Tanker Inspection",r=O):"petroleum_v2"===w?(t="Petroleum_V2",n=$,s="Petroleum Tanker Inspection V2",r=V):"acid"===w&&(t="Acid",n=z,s="Acid Tanker Inspection",r=D);const i=n.map(t=>void 0!==e[t]?e[t]:""),o={title:s,timestamp:e.timestamp,truckNo:e.truckNo,trailerNo:e.trailerNo,jobCard:e.jobCard,location:e.location,odometer:e.odometer,inspectedBy:e.inspectedBy,driverName:e.driverName,remarks:e.remarks,rate:e.rate,signatures:{inspector:e.inspectorSignature,driver:e.driverSignature},photos:{front:e.photoFront,ls:e.photoLS,rs:e.photoRS,back:e.photoBack,damage:e.photoDamage},items:r.map(t=>({label:t.label,category:t.category,status:e[t.id]||"N/A"})),companyName:l.companyName,companyLogo:l.companyLogo},a={action:"create",sheet:t,headers:n,row:i,requestId:e.requestId||null,reportData:o};if(!navigator.onLine)return he(a),localStorage.removeItem(`sc_draft_${w}`),me("offline_saved"),void setTimeout(()=>{me("idle"),S("dashboard")},3500);try{await fetch(d,{method:"POST",body:JSON.stringify(a),mode:"no-cors"}),me("success"),localStorage.removeItem(`sc_draft_${w}`);try{const t=await(async e=>{const t=new ia({apiKey:oa.API_KEY});try{const n=C.filter(t=>e[t.id]===x.BAD),s=C.filter(t=>e[t.id]===x.ATTENTION);let r="You are a Senior Fleet Safety Manager. Review the following truck inspection report.\n";r+=`Truck No: ${e.truckNo}, Trailer: ${e.trailerNo}, Odometer: ${e.odometer}\n`,r+=`\nBAD / FAILED ITEMS (${n.length}):\n`,0===n.length?r+="None.\n":n.forEach(e=>{r+=`- ${e.label} (Status: Critical Failure)\n`}),r+=`\nITEMS NEEDING ATTENTION (${s.length}):\n`,0===s.length?r+="None.\n":s.forEach(e=>{r+=`- ${e.label} (Status: Needs Attention)\n`}),r+=`\nREMARKS from Inspector: ${e.remarks||"No remarks provided."}\n`,r+=`\nOverall Rating given by inspector: ${e.rate}/5\n`,r+="\nTask:\n",r+="1. Summarize the condition of the vehicle in 2 sentences.\n",r+='2. Provide a "Safety Risk Score" from 1 (Safe) to 10 (Critical).\n',r+="3. List 3 immediate prioritized actions for the maintenance team.\n",r+="\nFormat the output as professional, concise text.";const i=[{text:r}];if(e.photoDamage){const t=e.photoDamage.split(",")[1];t&&(i.push({inlineData:{mimeType:"image/jpeg",data:t}}),i.push({text:"Also analyze the attached photo of the reported damage for severity."}))}return(await t.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:i}})).text||"Analysis complete but no text returned."}catch(n){return"AI Safety Analysis currently unavailable. Please review the manual report."}})(e);F(t)}catch(c){F("AI analysis currently unavailable.")}le(!0)}catch(u){he(a),localStorage.removeItem(`sc_draft_${w}`),me("offline_saved"),setTimeout(()=>{me("idle"),S("dashboard")},3500)}},submissionStatus:pe,onViewReport:Te}):g.jsxs("div",{className:"animate-fadeIn",children:["overview"===w&&g.jsx(Fa,{appScriptUrl:d,onNavigate:ge,userRole:t.role,historyList:re,isLoading:ie,onViewReport:Te,isMaintenanceActive:l.maintenanceMode,pendingAlertsCount:xe.filter(e=>!e.read&&"critical"===e.type).length,isLocked:de}),"analytics"===w&&g.jsx(nl,{historyList:re,isLoading:ie}),"fleet_wall"===w&&g.jsx(sl,{historyList:re,isLoading:ie,onClose:()=>ge("overview")}),"library"===w&&g.jsx(il,{}),"settings"===w&&ke&&g.jsx(ja,{settings:l,setSettings:c,appScriptUrl:d,setAppScriptUrl:u,handleSaveSettings:m,isSavingSettings:p,showToast:ue,user:t}),"maintenance"===w&&Ie&&g.jsx(el,{user:t,appScriptUrl:d,settings:l,onSettingsUpdate:e=>c(t=>({...t,...e})),showToast:ue,onRefreshSubscription:y,subscription:f,history:v}),"general"===w&&g.jsx(Ca,{userRole:t.role,stats:ae,startNewInspection:()=>fe("general"),fetchHistory:le,isLoadingHistory:ie,historyList:re,onViewReport:Te,onPrint:()=>{},isLocked:de,lockReason:ce.reason,maintenanceMessage:l.maintenanceMessage}),"petroleum"===w&&g.jsx(_a,{userRole:t.role,stats:ae,startNewInspection:()=>fe("petroleum"),fetchHistory:le,isLoadingHistory:ie,historyList:re,onViewReport:Te,onPrint:()=>{},isLocked:de,lockReason:ce.reason,maintenanceMessage:l.maintenanceMessage}),"petroleum_v2"===w&&g.jsx(ka,{userRole:t.role,stats:ae,startNewInspection:()=>fe("petroleum_v2"),fetchHistory:le,isLoadingHistory:ie,historyList:re,onViewReport:Te,onPrint:()=>{},isLocked:de,lockReason:ce.reason,maintenanceMessage:l.maintenanceMessage}),"acid"===w&&g.jsx(Ia,{userRole:t.role,stats:ae,startNewInspection:()=>fe("acid"),fetchHistory:le,isLoadingHistory:ie,historyList:re,onViewReport:Te,onPrint:()=>{},isLocked:de,lockReason:ce.reason,maintenanceMessage:l.maintenanceMessage}),"users"===w&&ke&&g.jsx(Oa,{currentUser:t,appScriptUrl:d,showToast:ue,validationLists:oe,settings:l}),"support"===w&&g.jsx(Qa,{appScriptUrl:d,currentUser:t,showToast:ue,settings:l,validationLists:oe,prefillData:Y,onPrefillConsumed:()=>K(null)}),"track_requests"===w&&g.jsx(tl,{appScriptUrl:d,currentUser:t,showToast:ue,onRequestNew:()=>P(!0)}),"registry"===w&&g.jsx(ol,{appScriptUrl:d,validationLists:oe,onRefresh:()=>le(!0),showToast:ue,isLocked:de})]})}),!de&&"dashboard"===j&&g.jsx("div",{className:"fixed bottom-8 left-8 z-[100] no-print",children:g.jsxs("button",{onClick:()=>I(!0),className:"w-16 h-16 bg-slate-900 text-white rounded-2xl shadow-2xl flex items-center justify-center hover:bg-black hover:scale-110 transition-all group border-t border-white/10 relative",children:[g.jsx("div",{className:"absolute inset-0 rounded-2xl border-2 border-indigo-500 animate-pulse opacity-50"}),g.jsxs("svg",{className:"w-8 h-8 group-hover:rotate-12 transition-transform",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),g.jsx("path",{d:"M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"})]}),g.jsx("div",{className:"absolute -top-1 -right-1 bg-indigo-600 text-white text-[8px] font-black px-1.5 py-0.5 rounded shadow-sm border border-indigo-500 uppercase tracking-widest",children:"PRO"})]})}),g.jsx("footer",{className:"mt-auto py-6 border-t border-slate-100 text-center no-print",children:g.jsx("span",{className:"text-[9px] font-black text-slate-300 uppercase tracking-[0.4em]",children:"© Scbc 2026"})})]}),Ne&&Se&&g.jsx(la,{onClose:()=>je(!1),onPrint:()=>window.print(),title:`Report_${Se.id||"History"}`,children:"petroleum"===w?g.jsx(ll,{data:Se,settings:l}):"petroleum_v2"===w?g.jsx(cl,{data:Se,settings:l}):"acid"===w?g.jsx(dl,{data:Se,settings:l}):g.jsx(al,{data:Se,settings:l})})]}):g.jsxs(g.Fragment,{children:[g.jsx(ba,{}),A&&g.jsx(aa,{message:A.message,type:A.type,onClose:()=>T(null)}),g.jsx(wa,{onLogin:r,appScriptUrl:d,setAppScriptUrl:u,settings:l})]})},ml=document.getElementById("root");if(ml){h(ml).render(g.jsx(pl,{}))}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(e=>{}).catch(e=>{})});
